<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Odin: Microsofts Scalable FaultTolerant CDN Measurement System Matt Calder</p>
    <p>Manuel Schrder, Ryan Gao, Ryan Stewart, Jitendra Padhye, Ratul Mahajan, Ganesh Ananthanarayanan, Ethan Katz-Bassett</p>
    <p>NSDI, April 2018</p>
  </div>
  <div class="page">
    <p>CDN Overview</p>
    <p>Globally distributed front-ends serve CDN traffic</p>
    <p>Want low latency service for all clients</p>
  </div>
  <div class="page">
    <p>Problem: What is the impact of change in a CDN?</p>
    <p>Globally distributed front-ends serve CDN traffic</p>
    <p>No idea! IPv4 and IPv6 routing is often different</p>
    <p>? ?</p>
    <p>?</p>
    <p>?</p>
    <p>Microsoft News Feed Application</p>
    <p>News Feed app needs IPv6</p>
    <p>What is the global performance impact?</p>
  </div>
  <div class="page">
    <p>Problem: What is the impact of change in a CDN?</p>
    <p>Globally distributed front-ends serve CDN traffic</p>
    <p>News Feed app wants IPv6</p>
    <p>What is the global performance impact?</p>
    <p>No idea! IPv4 and IPv6 routing is often different</p>
    <p>? ?</p>
    <p>?</p>
    <p>?</p>
    <p>Microsoft News Feed Application</p>
    <p>Need to understand performance impact of CDN change</p>
    <p>Difficult to evaluate on a global scale</p>
  </div>
  <div class="page">
    <p>Large-scale what-if scenarios</p>
    <p>Odin can evaluate these types of changes easily</p>
  </div>
  <div class="page">
    <p>Outline</p>
  </div>
  <div class="page">
    <p>Internet is diverse and dynamic</p>
    <p>Tens of thousands of ISPs</p>
    <p>Factors outside of direct CDN control Congestion Routing changes Outages</p>
  </div>
  <div class="page">
    <p>Tens of thousands of ISPs</p>
    <p>Factors outside of direct CDN control Congestion Routing changes Outages</p>
    <p>Internet is diverse and dynamic</p>
    <p>CDN network operations require constant insight into user performance</p>
    <p>Internet measurement can provide this insight</p>
  </div>
  <div class="page">
    <p>Operational need for measurement</p>
    <p>When services become unavailable or slow, want to alert and reroute quickly</p>
    <p>Need diagnostic capabilities to find the root cause of issues  Comcast in Seattle is having trouble reaching my CDN. Are they</p>
    <p>able to reach other networks?</p>
    <p>Want to measure impact of changes on end-users  Want to take a front-end offline for maintenance. What is the</p>
    <p>performance impact on that front-ends users?</p>
  </div>
  <div class="page">
    <p>Outline</p>
  </div>
  <div class="page">
    <p>Layer 3 measurements from CDN infrastructure</p>
    <p>Traceroute, Ping with ICMP</p>
    <p>Launch from Front-ends to Internet destinations</p>
    <p>Issue 1: Poor coverage  74% of end-users unresponsive</p>
    <p>Issue 2: Missing layer 7 behaviors  HTTP redirection  SSL/TLS</p>
  </div>
  <div class="page">
    <p>Requirements Layer 3</p>
    <p>Measurement from CDN</p>
    <p>Coverage of Microsoft Users</p>
    <p>Application Layer Measurements</p>
    <p>Layer 3 measurements from CDN infrastructure</p>
  </div>
  <div class="page">
    <p>Server-side Instrumentation</p>
    <p>Client connections are instrumented at servers Collect TCP and application layer metrics Very useful but alone insufficient</p>
    <p>Issue 1: No explicit outage signal</p>
    <p>Issue 2: Alternate path exploration adds risk</p>
  </div>
  <div class="page">
    <p>Server-side Instrumentation</p>
    <p>Requirements Layer 3</p>
    <p>Measurement from CDN</p>
    <p>Server-side Instrumentation</p>
    <p>Coverage of Microsoft Users</p>
    <p>Application Layer Measurements</p>
    <p>Explicit Outage Signal</p>
  </div>
  <div class="page">
    <p>Third-party measurement platforms</p>
    <p>Operate set of vantage points on the Internet</p>
    <p>Run measurements on customers behalf</p>
    <p>Examples: ThousandEyes, Catchpoint, Cedexis, Dynatrace-Keynote,</p>
    <p>All have inadequate coverage: Fewer than 10 measurements per day from 88% of</p>
    <p>Microsoft customer networks</p>
  </div>
  <div class="page">
    <p>Third-party measurement platforms</p>
    <p>Requirements Layer 3</p>
    <p>Measurement from CDN</p>
    <p>Server-side Instrumentation</p>
    <p>Third-party Measurement</p>
    <p>Platforms</p>
    <p>Coverage of Microsoft Users</p>
    <p>Application Layer Measurements</p>
    <p>Explicit Outage Signal</p>
  </div>
  <div class="page">
    <p>Existing solutions dont meet our needs</p>
    <p>Requirements Layer 3</p>
    <p>Measurement from CDN</p>
    <p>Server-side Instrumentation</p>
    <p>Third-Party Measurement</p>
    <p>Platforms Odin</p>
    <p>Coverage of Microsoft Users</p>
    <p>Application Layer Measurements</p>
    <p>Explicit Outage Signal</p>
    <p>(see paper for others)</p>
  </div>
  <div class="page">
    <p>Outline</p>
  </div>
  <div class="page">
    <p>Odin Design</p>
    <p>Server A</p>
    <p>Offline Analysis</p>
    <p>Online Alerting</p>
    <p>Report Endpoint</p>
    <p>Microsoft</p>
    <p>Odin</p>
  </div>
  <div class="page">
    <p>Stock Ticker Desktop User</p>
    <p>Odin Design</p>
    <p>Server B</p>
    <p>Offline Analysis</p>
    <p>Online Alerting</p>
    <p>Report Endpoint</p>
    <p>Microsoft</p>
    <p>Odin</p>
  </div>
  <div class="page">
    <p>Odin Design</p>
    <p>Offline Analysis</p>
    <p>Online Alerting</p>
    <p>Report Endpoint</p>
    <p>Microsoft</p>
    <p>Odin</p>
    <p>Stock Ticker Desktop UserServer B</p>
  </div>
  <div class="page">
    <p>Odin Design</p>
    <p>Mail Server B</p>
    <p>Offline Analysis</p>
    <p>Online Alerting</p>
    <p>Report Upload Endpoint</p>
    <p>Microsoft</p>
    <p>Odin Examples showed measurements to the</p>
    <p>application server</p>
    <p>Want richer measurements</p>
  </div>
  <div class="page">
    <p>Odin Design</p>
    <p>Offline Analysis</p>
    <p>Online Alerting</p>
    <p>Report Upload Endpoint</p>
    <p>Odin Orchestration</p>
    <p>Service</p>
    <p>Microsoft Primary and backup report endpointsTarget URLs</p>
  </div>
  <div class="page">
    <p>Odin Design</p>
    <p>Offline Analysis</p>
    <p>Online Alerting</p>
    <p>Report Endpoint</p>
    <p>Microsoft U.S.</p>
    <p>Odin</p>
    <p>Orchestration Service</p>
    <p>m3.contoso.com</p>
    <p>Microsoft Europe</p>
    <p>Server B</p>
  </div>
  <div class="page">
    <p>Odin Design: Fault tolerance</p>
    <p>Odin</p>
    <p>Offline Analysis</p>
    <p>Report Endpoint</p>
    <p>Microsoft</p>
    <p>Orchestration Service</p>
    <p>Online Alerting</p>
    <p>Need to receive measurements even if Microsofts network is unavailable</p>
    <p>GET tiny.gif</p>
    <p>Server B</p>
  </div>
  <div class="page">
    <p>Odin Design: Fault tolerance</p>
    <p>Odin</p>
    <p>Offline Analysis</p>
    <p>Report Endpoint</p>
    <p>Microsoft</p>
    <p>Orchestration Service</p>
    <p>Online Alerting</p>
    <p>Report Proxy</p>
    <p>GET tiny.gif</p>
    <p>Server B</p>
  </div>
  <div class="page">
    <p>Odin Design: Fault tolerance</p>
    <p>Odin</p>
    <p>Offline Analysis</p>
    <p>Report Endpoint</p>
    <p>Microsoft</p>
    <p>Orchestration Service</p>
    <p>Online Alerting</p>
    <p>Mail Server B</p>
    <p>Report Proxy Paper discusses cases where failures impact</p>
    <p>primary and proxy report endpoints</p>
    <p>Similar mechanism for Orchestration Service</p>
    <p>Rich clients + external networks enable true availability measurements</p>
  </div>
  <div class="page">
    <p>Outline</p>
  </div>
  <div class="page">
    <p>Supporting Operations: Odins DNS redirection maps</p>
    <p>Azure Global Application Traffic Management</p>
    <p>Azure - 38 Cloud Regions</p>
    <p>Customers deploy services in a subset for resilience &amp; perf</p>
    <p>Cloud apps load balanced using DNS</p>
    <p>Direct user to lowest-latency region</p>
  </div>
  <div class="page">
    <p>Supporting Operations: Odins DNS redirection maps</p>
    <p>Azure Global Application Traffic Management</p>
    <p>Azure - 38 Cloud Regions</p>
    <p>Customers deploy services in a subset for resilience &amp; perf</p>
    <p>Cloud apps load balanced using DNS</p>
    <p>Direct user to lowest-latency region</p>
    <p>Odin can find the lowest latency region for users</p>
  </div>
  <div class="page">
    <p>DNS-based redirection for CDNs</p>
    <p>Local DNS (LDNS) 1.2.3.4</p>
    <p>IP for www.cdn.com?</p>
    <p>Region A</p>
    <p>Authoritative DNS for cdn.com</p>
    <p>Region B</p>
    <p>IP for www.cdn.com?</p>
    <p>from 1.2.3.4</p>
  </div>
  <div class="page">
    <p>Previous Approach: Predicting best region for LDNS</p>
    <p>LDNS 4.4.4.4</p>
    <p>Region A</p>
    <p>Region B</p>
    <p>LDNS 5.5.5.5</p>
    <p>LDNS 6.6.6.6</p>
    <p>Region C</p>
    <p>Ping all LDNSes from all Regions</p>
    <p>Direct LDNS to Region with minimum ping</p>
    <p>Limitations: - Most LDNS dont respond to ping - Ping to LDNS may not reflect client performance</p>
  </div>
  <div class="page">
    <p>Odins Approach: Predicting best region for LDNS</p>
    <p>Odin knows client =&gt; LDNS</p>
    <p>Know all clients served by an LDNS</p>
    <p>Associate client to region measurements with clients LDNS</p>
    <p>Compare median latency toward each region</p>
    <p>Select lowest latency region as best</p>
    <p>LDNS</p>
    <p>Region B Region C</p>
    <p>Latency Measurements</p>
    <p>Region A Region B Region C</p>
    <p>Region A</p>
  </div>
  <div class="page">
    <p>Improving cloud performance with Odin</p>
    <p>Japan, Italy, Spain over 25% latency improvement</p>
  </div>
  <div class="page">
    <p>AS 1759</p>
    <p>Supporting Operations: Using Odin to identify outages</p>
    <p>Microsoft</p>
    <p>Report Proxy</p>
    <p>Helsinki Front-end Report</p>
    <p>Report Endpoint</p>
    <p>Widespread Internet availability issues from AS1759?  Total outage between AS1759 &amp; Microsoft?  Is Helsinki front-end failing?  Regional outage between AS1759 &amp; Microsoft in Helsinki?</p>
    <p>Finland</p>
  </div>
  <div class="page">
    <p>Supporting Operations: Using Odin to identify outages</p>
    <p>Microsoft</p>
    <p>Report Proxy</p>
    <p>AS 1759 Helsinki Front-end</p>
    <p>External Measurement Endpoint</p>
    <p>Report Endpoint</p>
    <p>Finland</p>
    <p>Widespread Internet availability issues from AS1759?  Total outage between AS1759 &amp; Microsoft?  Is Helsinki front-end failing?  Regional outage between AS1759 &amp; Microsoft in Helsinki?</p>
  </div>
  <div class="page">
    <p>Supporting Operations: Using Odin to identify outages</p>
    <p>Microsoft</p>
    <p>Report Proxy</p>
    <p>AS 1759 Helsinki Front-end</p>
    <p>Azure Datacenter</p>
    <p>Report Endpoint</p>
    <p>Finland</p>
    <p>External Measurement Endpoint</p>
    <p>Widespread Internet availability issues from AS1759?  Total outage between AS1759 &amp; Microsoft?  Is Helsinki front-end failing?  Regional outage between AS1759 &amp; Microsoft in Helsinki?</p>
  </div>
  <div class="page">
    <p>Widespread Internet availability issues from AS1759?  Total outage between AS1759 &amp; Microsoft?  Is Helsinki front-end failing?  Regional outage between AS1759 &amp; Microsoft in Helsinki?</p>
    <p>AS 719</p>
    <p>Supporting Operations: Using Odin to identify outages</p>
    <p>Microsoft</p>
    <p>Report Proxy</p>
    <p>AS 1759</p>
    <p>Finland</p>
    <p>Helsinki Front-end</p>
    <p>Report Endpoint</p>
    <p>External Measurement Endpoint</p>
    <p>Azure Datacenter</p>
  </div>
  <div class="page">
    <p>Conclusion</p>
    <p>Odin is a client-side, active measurement platform to support Microsoft CDN operations  Running in production for over 2 years  Deployed in key Microsoft end-user applications  Billions of measurements per day</p>
    <p>Overcomes limitations of existing approaches</p>
    <p>Improves CDN operations  Detect and diagnose outages  Odin-based DNS-redirection for cloud customers</p>
  </div>
</Presentation>
