<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Alexandru A. Ormenisan1,2, Moritz Meister2, Fabio Buso2, Robin Andersson2,</p>
    <p>Seif Haridi1,2, Jim Dowling1,2</p>
    <p>TIME TRAVEL AND PROVENANCE FOR MACHINE LEARNING PIPELINES</p>
    <p>KTH - Royal Institute of Technology (1) Logical Clocks AB (2)</p>
  </div>
  <div class="page">
    <p>What is provenance - ML Pipeline</p>
    <p>ML Pipeline</p>
    <p>Feature engineering</p>
    <p>Training Serving</p>
    <p>Raw Data Features Models</p>
  </div>
  <div class="page">
    <p>Metadata (Provenance)</p>
    <p>In [ ]:</p>
    <p>add(fg_eng, raw_data, features)  add(training, features, model)</p>
    <p>&lt;fg_eng, raw_data, features&gt;</p>
    <p>Pipeline code</p>
    <p>What is provenance - Metadata</p>
    <p>Feature engineering</p>
    <p>Training Serving</p>
    <p>Raw Data</p>
    <p>Features Models</p>
  </div>
  <div class="page">
    <p>Libraries</p>
    <p>Application</p>
    <p>Running platform</p>
    <p>Metadata store</p>
    <p>Explicit</p>
    <p>Topdown tracking of provenance.</p>
    <p>Requires changes to application or library code.</p>
    <p>Metadata Store is decoupled from the data storage.</p>
    <p>Implicit</p>
    <p>Bottom-up tracking of provenance.</p>
    <p>Requires changing the platform.</p>
    <p>Conventions link files to artifacts.</p>
    <p>Metadata is strongly consistent with storage platform.</p>
    <p>Implicit and Explicit Provenance</p>
  </div>
  <div class="page">
    <p>Governance</p>
    <p>search:</p>
    <p>Discovery</p>
    <p>Debug &amp; Analyse ?</p>
    <p>Serving Feature</p>
    <p>Engineering Training &amp; Validating</p>
    <p>?</p>
    <p>Pipeline Automation</p>
    <p>Integrity &amp; Garbage</p>
    <p>Collection</p>
    <p>Traceability &amp; Compliance</p>
    <p>Why track provenance?</p>
  </div>
  <div class="page">
    <p>Provenance queries  Type  Throughput  Latency  Size</p>
    <p>ML Artifacts</p>
    <p>Files</p>
    <p>&lt;&lt;?&gt;&gt;Metadata</p>
    <p>Systems Challenges - Queries</p>
  </div>
  <div class="page">
    <p>Consistency issues Synchronization</p>
    <p>? ML Artifacts</p>
    <p>&lt;&lt;?&gt;&gt;Metadata</p>
    <p>Systems Challenges - Consistency</p>
  </div>
  <div class="page">
    <p>Change Data Capture (ePipe)</p>
    <p>Distributed File System (HopsFS)</p>
    <p>Provenance</p>
    <p>Sql, Graph, Timeseries, Full Text Search</p>
    <p>Feature engineering</p>
    <p>Training Serving</p>
    <p>Raw Data</p>
    <p>Features Models</p>
    <p>Let the platform manage the metadata!</p>
  </div>
  <div class="page">
    <p>ML Artifacts</p>
    <p>Features, Feature Metadata, Train/Test Datasets Models, Model Metadata</p>
    <p>Possibly thousands of files</p>
    <p>Distributed File System</p>
    <p>Generate thousands of operations</p>
    <p>Change Data Capture (CDC) Capture only relevant operations</p>
    <p>Systems Challenges - Operations</p>
  </div>
  <div class="page">
    <p>More context to base file system operations?</p>
    <p>user: John user: Alex</p>
    <p>Are any of these operations related?</p>
    <p>user: John, app1</p>
    <p>user: John, app3</p>
    <p>user: Alex, app2</p>
    <p>Certificates (with AppId) enabled FS Operation</p>
    <p>Order of operations Order of operations</p>
    <p>Richer provenance information</p>
  </div>
  <div class="page">
    <p>Distributed File System</p>
    <p>Read/Write/Create/Delete/XAttr/Metadata</p>
    <p>Resource Manager - Yarn (Application Context)</p>
    <p>Application X</p>
    <p>Job Manager - Hopsworks (Job Context)</p>
    <p>Workflow Manager - Airflow (Pipeline Context)</p>
    <p>Link input/output files via Apps</p>
    <p>Different Executions of the same Job</p>
    <p>Jobs as Stages of the same Pipeline</p>
    <p>Additional Context</p>
    <p>Richer provenance information</p>
    <p>&lt;file, op, user_id, app_id, job_id, pipeline_id&gt;</p>
  </div>
  <div class="page">
    <p>Hopsworks Conventions</p>
    <p>/training_datasets</p>
    <p>/models</p>
    <p>/logs</p>
    <p>/notebooks</p>
    <p>/featurestore</p>
    <p>CDC API - Filtering Mechanisms</p>
  </div>
  <div class="page">
    <p>/training_datasets</p>
    <p>/models</p>
    <p>/featurestoreProject Example</p>
    <p>CDC API - Filtering Mechanisms</p>
    <p>Path based filtering</p>
  </div>
  <div class="page">
    <p>Path based filtering</p>
    <p>Tag based filtering</p>
    <p>Example: Custom metadata based on HDFS XAttr. Tag: &lt;tutorial&gt;, &lt;debug&gt; Tags can enable logging of all operations, if path based filtering is not easy to set</p>
    <p>CDC API - Filtering Mechanisms</p>
  </div>
  <div class="page">
    <p>Path based filtering</p>
    <p>Tag based filtering</p>
    <p>Coalesce FS Operations</p>
    <p>Example: Read file1 Read file2  Read filen</p>
    <p>Access1 Training Dataset</p>
    <p>CDC API - Filtering Mechanisms</p>
  </div>
  <div class="page">
    <p>Path based filtering</p>
    <p>Tag based filtering</p>
    <p>Coalesce FS Operations</p>
    <p>Filtered Operations</p>
    <p>Create/Delete Artifact existence</p>
    <p>XAttr Linking metadata to artifact Read Artifact usage</p>
    <p>Children Files Create/Delete Artifact mutation</p>
    <p>Append/Truncate Artifact mutation</p>
    <p>Permissions/ACL Artifact Metadata mutation</p>
    <p>CDC API - Filtering Mechanisms</p>
  </div>
  <div class="page">
    <p>Hopsworks ML Pipelines</p>
  </div>
  <div class="page">
    <p>Bias Detected ! ?</p>
    <p>Provenance example</p>
    <p>What do I do</p>
  </div>
  <div class="page">
    <p>D elta C</p>
    <p>om m</p>
    <p>it 10/01/20@</p>
    <p>D elta C</p>
    <p>om m</p>
    <p>it 10/01/20@</p>
    <p>D elta C</p>
    <p>om m</p>
    <p>it 10/01/20@</p>
    <p>D elta C</p>
    <p>om m</p>
    <p>it 20/07/20@</p>
    <p>Hudi Feature Timeline</p>
    <p>Claim of Model Bias! Can we determine the exact features used?</p>
    <p>Provenance + Time travel</p>
    <p>Feature engineering</p>
    <p>Training Serving</p>
    <p>Raw Data Features Models</p>
    <p>Training timestamp</p>
    <p>Application</p>
  </div>
  <div class="page">
    <p>Provenance improves understanding of complex ML Pipelines.</p>
    <p>Provenance should not change the core ML pipeline code.</p>
    <p>Provenance facilitates Debugging, Analyzing, Automating and Cleaning of ML Pipelines.</p>
    <p>Provenance and Time Travel facilitate reproducibility of experiments.</p>
    <p>Conclusion</p>
  </div>
  <div class="page">
    <p>Alex Ormenisan Logical Clocks AB</p>
    <p>KTH Royal Institute of</p>
    <p>Technology</p>
    <p>Moritz Meister Logical Clocks AB</p>
    <p>Robin Andersson Logical Clocks AB</p>
    <p>Prof. Seif Haridi Logical Clocks AB</p>
    <p>Dr. Jim Dowling Logical Clocks AB</p>
    <p>Fabio Buso Logical Clocks AB</p>
    <p>KTH Royal Institute of</p>
    <p>Technology</p>
    <p>KTH Royal Institute of</p>
    <p>Technology</p>
    <p>@logicalclocks</p>
    <p>http://github.com/logicalclocks/hopsworks</p>
    <p>www.logicalclocks.com</p>
    <p>Thank You!</p>
  </div>
</Presentation>
