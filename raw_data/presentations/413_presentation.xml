<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Model Checking a Networked System Without the Network</p>
    <p>Maysam Yabandeh Rachid Guerraoui</p>
  </div>
  <div class="page">
    <p>Bugs</p>
    <p>Tes7ng  Looking for the bugs</p>
    <p>Debugging  Fixing the found bugs</p>
    <p>Local Model Checking 2</p>
    <p>www.soydemac.com</p>
  </div>
  <div class="page">
    <p>Tes7ng</p>
    <p>Local Model Checking 3</p>
  </div>
  <div class="page">
    <p>Model Checking (MC)</p>
    <p>?</p>
    <p>? ?</p>
    <p>?</p>
    <p>? ?</p>
    <p>? ? ?</p>
    <p>While ()  An old state  A new state</p>
    <p>Exhaus7ve explora7on of State Space</p>
  </div>
  <div class="page">
    <p>While ()  An old state  A new state</p>
    <p>[Classic] MC Distributed Systems</p>
    <p>Local Model Checking 5</p>
    <p>? ?</p>
  </div>
  <div class="page">
    <p>While ()  An old state  A new state</p>
    <p>[Classic] MC Distributed Systems</p>
    <p>Local Model Checking 6</p>
    <p>Network Network</p>
  </div>
  <div class="page">
    <p>While ()  An old state  A new state</p>
    <p>(Global) State: o System state, i.e., Local node states o + Network state</p>
    <p>Transi7on: o Message handler o Local events: 7mers</p>
    <p>[Classic] MC Distributed Systems</p>
    <p>Local Model Checking 7</p>
    <p>Network</p>
  </div>
  <div class="page">
    <p>State Space Coverage</p>
    <p>Exponen7al Explosion  Exhaus7veEmbarrassingly Parallel</p>
    <p>?</p>
    <p>Local Model Checking 8</p>
  </div>
  <div class="page">
    <p>Online Model Checking [NSDI09] MC run MC + run</p>
  </div>
  <div class="page">
    <p>How about Paxos?</p>
    <p>Simple state space: one local event (propose)</p>
    <p>LMC</p>
  </div>
  <div class="page">
    <p>Agenda</p>
    <p>Local Model Checking 11</p>
  </div>
  <div class="page">
    <p>Huge global state size</p>
    <p>Global Model Checking</p>
    <p>Local Model Checking 12</p>
    <p>Network Network</p>
  </div>
  <div class="page">
    <p>Local Global Model Checking (LMC)</p>
    <p>Local Model Checking 13</p>
  </div>
  <div class="page">
    <p>Local Model Checking (LMC)</p>
    <p>Transi7on?  Local events: 7mer</p>
    <p>Network events:</p>
    <p>Local Model Checking 14</p>
    <p>Network</p>
  </div>
  <div class="page">
    <p>LMC: Shared Network</p>
    <p>Local Model Checking 15</p>
    <p>Shared Network I+</p>
    <p>Node d states</p>
    <p>Valid?</p>
    <p>Invalid?</p>
  </div>
  <div class="page">
    <p>LMC: Architecture</p>
    <p>Local Model Checking 16</p>
    <p>Handler Execu7on</p>
    <p>Network I+ Local States msg</p>
    <p>msg LS</p>
    <p>LS</p>
    <p>Distributed System Implementa7on</p>
    <p>Ini7al States</p>
  </div>
  <div class="page">
    <p>LMC: Architecture</p>
    <p>Local Model Checking 17</p>
    <p>Handler Execu7on</p>
    <p>Network I+ Local States msg</p>
    <p>msg LS</p>
    <p>LS</p>
    <p>Distributed System Implementa7on</p>
    <p>Ini7al States</p>
    <p>SS Invariant Checking [false]</p>
    <p>Invariants</p>
    <p>Errors</p>
  </div>
  <div class="page">
    <p>LMC: Architecture</p>
    <p>Local Model Checking 18</p>
    <p>System State Crea7on</p>
    <p>Handler Execu7on</p>
    <p>Network I+ Local States msg</p>
    <p>msg LS</p>
    <p>LS</p>
    <p>LS LS</p>
    <p>Distributed System Implementa7on</p>
    <p>Ini7al States</p>
    <p>SS Invariant Checking [false]</p>
    <p>Invariants</p>
    <p>Errors</p>
  </div>
  <div class="page">
    <p>LMC: System State Crea7on</p>
    <p>Local Model Checking 19</p>
    <p>GS2 GS3</p>
    <p>GS0</p>
    <p>GS1</p>
    <p>Global Model Checking Local Model Checking</p>
    <p>Local States SS0</p>
    <p>SS1</p>
    <p>SS2</p>
    <p>SS3</p>
  </div>
  <div class="page">
    <p>LMC: System State Crea7on</p>
    <p>System States =  Combina7on of all local states: LMC-GEN  Only when there is a chance of bug</p>
    <p>Paxos: different chosen values: LMC-OPT</p>
    <p>Complete  Invalid states  Unsound bug report</p>
  </div>
  <div class="page">
    <p>LMC: Architecture</p>
    <p>Local Model Checking 21</p>
    <p>System State Crea7on</p>
    <p>Handler Execu7on</p>
    <p>Network I+ Local States msg</p>
    <p>msg LS</p>
    <p>LS</p>
    <p>LS LS</p>
    <p>Distributed System Implementa7on</p>
    <p>Ini7al States</p>
    <p>SS Invariant Checking [false]</p>
    <p>Invariants</p>
    <p>Errors</p>
  </div>
  <div class="page">
    <p>LMC: Architecture</p>
    <p>Local Model Checking 22</p>
    <p>Soundness Verifica7on</p>
    <p>Invariant Checking [false]</p>
    <p>System State Crea7on</p>
    <p>SS</p>
    <p>Handler Execu7on</p>
    <p>Network I+ Local States msg</p>
    <p>msg LS</p>
    <p>LS</p>
    <p>LS LS</p>
    <p>Distributed System Implementa7on</p>
    <p>Ini7al States</p>
    <p>Invariants</p>
    <p>Errors SS</p>
  </div>
  <div class="page">
    <p>Soundness Verifica7on</p>
    <p>Local Model Checking 23</p>
    <p>Predecessor</p>
  </div>
  <div class="page">
    <p>Soundness Verifica7on</p>
    <p>Local Model Checking 24</p>
    <p>Node 0</p>
    <p>Node 1</p>
    <p>Node 2</p>
    <p>System State Par7al Order</p>
    <p>Total Order</p>
  </div>
  <div class="page">
    <p>Soundness Verifica7on</p>
    <p>Input: set of event stacks  Output: valid or invalid  Greedy Algorithm:</p>
    <p>While exist enabled event e = stacki.top()  Run e  stacki.pop()</p>
    <p>Return valid if there is no event left</p>
    <p>Local Model Checking 25</p>
  </div>
  <div class="page">
    <p>Evalua7on</p>
    <p>Prototype using MaceMC [NSDI 07]  Mace: structured C++ programs  (De)Serializa7on of states  Handler boundary  events</p>
    <p>Paxos: Nodes agree on the same values  A very complex distributed algorithm  Lots of communica7on at each round</p>
    <p>State space: 3 Nodes, 1 Proposes  B-DFS: memory efficient MC [NSDI 07]</p>
    <p>Bounded Depth First Search  Maintain a DB of state hashes to avoid loops</p>
    <p>3 GHz Intel Pen7um 4 CPU, 1 MB L2 cache</p>
    <p>Local Model Checking 26</p>
  </div>
  <div class="page">
    <p>Evalua7on: Elapsed Time</p>
    <p>Local Model Checking 27</p>
  </div>
  <div class="page">
    <p>Evalua7on: # of states</p>
    <p>Local Model Checking 28</p>
  </div>
  <div class="page">
    <p>Tes7ng</p>
    <p>Paxos:  Injected a previously reported bug [Liu et al., NSDI07]</p>
    <p>Rediscovers the bug  1Paxos: an efficient variant that uses one acceptor  Found a new bug in ini7aliza7on of acceptor</p>
  </div>
  <div class="page">
    <p>Related Work</p>
    <p>LMC = CA + MA  CA: Cartesian Abstrac7on [Ball, et. al, 2001] [Flanagan and</p>
    <p>Qadeer, 2003][Henzinger et. al, 2003] [Malkis et. al, 2006] [Malkis et. al, 2010]  Thread-modular MC</p>
    <p>Local asserts  no system state crea7on  Complete, Unsound  Theorem proving vs. Tes7ng</p>
    <p>MA: Monotonic Abstrac7on [Mitchell, 2002]  Shared Network</p>
    <p>Local Model Checking 30</p>
  </div>
  <div class="page">
    <p>Summary</p>
    <p>Local Global Model Checking  Local states, Shared network state  Postpones State Explosion Problem  Op7mis7c  Decouples Explora7on, System State Crea7on, and Soundness Verifica7on  In Parallel  LMC-OPT (generalize?)</p>
  </div>
  <div class="page">
    <p>? Thank you</p>
  </div>
</Presentation>
