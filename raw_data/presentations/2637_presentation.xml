<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>C3: Cutting Tail Latency in Cloud Data Stores via</p>
    <p>Adaptive Replica Selection</p>
    <p>Lalith Suresh (TU Berlin)</p>
    <p>with Marco Canini (UCL), Stefan Schmid, Anja Feldmann (TU Berlin)</p>
  </div>
  <div class="page">
    <p>One User Request</p>
    <p>Tens to Thousands of data accesses</p>
    <p>Tail-latency matters</p>
  </div>
  <div class="page">
    <p>For 100 leaf servers, 99th percentile latency will reflect in 63% of user requests!</p>
    <p>One User Request</p>
    <p>Tail-latency matters</p>
    <p>Tens to Thousands of data accesses</p>
  </div>
  <div class="page">
    <p>Server performance fluctuations are the norm</p>
    <p>Queueing delays</p>
    <p>Skewed access patterns</p>
    <p>C D</p>
    <p>F</p>
    <p>Resource contention</p>
    <p>Background activities</p>
  </div>
  <div class="page">
    <p>Effectiveness of replica selection in reducing tail latency?</p>
    <p>? Client</p>
    <p>Server</p>
    <p>Server</p>
    <p>Server</p>
    <p>Request</p>
  </div>
  <div class="page">
    <p>Replica Selection Challenges</p>
  </div>
  <div class="page">
    <p>Replica Selection Challenges</p>
    <p>Service-time variations</p>
    <p>Request Client</p>
    <p>Server</p>
    <p>Server</p>
    <p>Server</p>
  </div>
  <div class="page">
    <p>Replica Selection Challenges</p>
    <p>Herd behavior and load oscillations</p>
    <p>Request</p>
    <p>Request</p>
    <p>Request Client</p>
    <p>Client</p>
    <p>Client</p>
    <p>Server</p>
    <p>Server</p>
    <p>Server</p>
  </div>
  <div class="page">
    <p>Impact of Replica Selection in Practice?</p>
    <p>Dynamic Snitching</p>
    <p>Uses history of read latencies and I/O load for replica selection</p>
  </div>
  <div class="page">
    <p>Experimental Setup</p>
    <p>Cassandra cluster on Amazon EC2  15 nodes, m1.xlarge instances  Read-heavy workload with YCSB (120 threads)  500M 1KB records (larger than memory)  Zipfian key access pattern</p>
  </div>
  <div class="page">
    <p>Cassandra Load Profile</p>
  </div>
  <div class="page">
    <p>Also observed that 99.9th percentile latency ~ 10x median latency</p>
    <p>Cassandra Load Profile</p>
  </div>
  <div class="page">
    <p>Load Conditioning in our Approach</p>
  </div>
  <div class="page">
    <p>C3 Adaptive replica selection mechanism that is robust to service time heterogeinity</p>
  </div>
  <div class="page">
    <p>C3  Replica Ranking Distributed Rate Control</p>
  </div>
  <div class="page">
    <p>C3  Replica Ranking Distributed Rate Control</p>
  </div>
  <div class="page">
    <p>Client Server</p>
    <p>Client</p>
    <p>Client</p>
    <p>Server</p>
    <p>-1 = 2 ms</p>
    <p>-1 = 6 ms</p>
  </div>
  <div class="page">
    <p>Client Server</p>
    <p>Client</p>
    <p>Client</p>
    <p>Server</p>
    <p>Balance product of queue-size and service time { q  -1 }</p>
    <p>-1 = 2 ms</p>
    <p>-1 = 6 ms</p>
  </div>
  <div class="page">
    <p>Server-side Feedback</p>
    <p>Servers piggyback {qs } and { #} in every response</p>
    <p>Client Server</p>
    <p>{ qs ,  # }</p>
  </div>
  <div class="page">
    <p>Server-side Feedback</p>
    <p>Concurrency compensation</p>
    <p>Servers piggyback {qs } and { #} in every response</p>
  </div>
  <div class="page">
    <p>Server-side Feedback</p>
    <p>Concurrency compensation</p>
    <p>&amp;' = 1 + '. + '</p>
    <p>Servers piggyback {qs } and { #} in every response</p>
    <p>Outstanding requests Feedback</p>
  </div>
  <div class="page">
    <p>Select server with min &amp;' .# ?</p>
  </div>
  <div class="page">
    <p>Select server with min &amp;' .# ?</p>
    <p>Server</p>
    <p>Server</p>
    <p>-1 = 4 ms</p>
    <p>-1 = 20 ms</p>
    <p>Potentially long queue sizes  What if a GC pause happens?</p>
  </div>
  <div class="page">
    <p>Penalizing Long Queues</p>
    <p>Server</p>
    <p>Server</p>
    <p>-1 = 4 ms</p>
    <p>-1 = 20 ms</p>
    <p>Select server with min &amp;' .# b</p>
    <p>b = 3</p>
  </div>
  <div class="page">
    <p>C3  Replica Ranking Distributed Rate Control</p>
  </div>
  <div class="page">
    <p>Need for rate control</p>
    <p>Replica ranking insufficient</p>
    <p>Avoid saturating individual servers?</p>
    <p>Non-internal sources of performance fluctuations?</p>
  </div>
  <div class="page">
    <p>Cubic Rate Control</p>
    <p>Clients adjust sending rates according to cubic function</p>
    <p>If receive rate isnt increasing further, multiplicatively decrease</p>
  </div>
  <div class="page">
    <p>Putting everything together</p>
    <p>Server</p>
    <p>Server</p>
    <p>Rate Limiters</p>
    <p>Replica group</p>
    <p>scheduler</p>
    <p>Sort replicas by score</p>
    <p>C3 Client</p>
    <p>{ Feedback }</p>
  </div>
  <div class="page">
    <p>Implementation in Cassandra</p>
    <p>Details in the paper!</p>
  </div>
  <div class="page">
    <p>Evaluation</p>
    <p>Amazon EC2</p>
    <p>Controlled Testbed</p>
    <p>Simulations</p>
  </div>
  <div class="page">
    <p>Evaluation</p>
    <p>Amazon EC2</p>
    <p>15 node Cassandra cluster  M1.xlarge  Workloads generated using YCSB (120 threads)  Read-heavy, update-heavy, read-only  500M 1KB records dataset (larger than memory)  Compare against Cassandras Dynamic Snitching (DS)</p>
  </div>
  <div class="page">
    <p>Lower is better</p>
  </div>
  <div class="page">
    <p>Also improves median and mean latencies</p>
  </div>
  <div class="page"/>
  <div class="page">
    <p>Takeaway:</p>
    <p>C3 does not tradeoff throughput for latency</p>
  </div>
  <div class="page">
    <p>How does C3 react to dynamic workload changes?</p>
    <p>Begin with 80 read-heavy workload generators</p>
    <p>40 update-heavy generators join the system after 640s</p>
    <p>Observe latency profile with and without C3</p>
  </div>
  <div class="page">
    <p>Latency profile degrades gracefully with C3</p>
    <p>Takeaway: C3 reacts effectively to dynamic workloads</p>
  </div>
  <div class="page">
    <p>Summary of other results</p>
    <p>Higher system load</p>
    <p>Skewed record sizes</p>
    <p>SSDs instead of HDDs</p>
    <p>&gt; 3x better 99.9th percentile latency</p>
  </div>
  <div class="page">
    <p>Ongoing work</p>
    <p>Tests at SoundCloud and Spotify</p>
    <p>Stability analysis of C3</p>
    <p>Alternative rate adaptation algorithms</p>
    <p>Token aware Cassandra clients</p>
  </div>
  <div class="page">
    <p>?</p>
    <p>Client</p>
    <p>Server</p>
    <p>Server</p>
    <p>Server</p>
    <p>C3 Replica Ranking</p>
    <p>+ Dist. Rate Control</p>
    <p>Summary</p>
  </div>
</Presentation>
