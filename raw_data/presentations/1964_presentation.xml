<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Baris Kasikci, Cris,an Zamfir, and George Candea School of Computer &amp; Communica3on Sciences</p>
    <p>CoRD: Collabora,ve Data Race Detec,on</p>
  </div>
  <div class="page">
    <p>Data Races</p>
  </div>
  <div class="page">
    <p>Accesses to shared memory loca,on</p>
    <p>Data Races</p>
  </div>
  <div class="page">
    <p>Accesses to shared memory loca,on  By mul3ple threads</p>
    <p>Data Races</p>
  </div>
  <div class="page">
    <p>Accesses to shared memory loca,on  By mul3ple threads  At least one of the accesses is a write</p>
    <p>Data Races</p>
  </div>
  <div class="page">
    <p>Accesses to shared memory loca,on  By mul3ple threads  At least one of the accesses is a write  The accesses can happen simultaneously</p>
    <p>Data Races</p>
  </div>
  <div class="page">
    <p>Data Races</p>
  </div>
  <div class="page">
    <p>Data Races</p>
    <p>Races are numerous in modern soDware</p>
  </div>
  <div class="page">
    <p>Data Races</p>
    <p>Races are numerous in modern soDware</p>
  </div>
  <div class="page">
    <p>Data races</p>
  </div>
  <div class="page">
    <p>C/C++ POSIX</p>
  </div>
  <div class="page">
    <p>C/C++ POSIX</p>
    <p>Compilers can arbitrarily break racy programs 4</p>
  </div>
  <div class="page">
    <p>How to Ensure SoDware is Race-free?</p>
  </div>
  <div class="page">
    <p>How to Ensure SoDware is Race-free?</p>
    <p>Sta,c race detectors  Full path analysis  Fast  Few false nega3ves  Many false posi3ves</p>
  </div>
  <div class="page">
    <p>Dynamic race detectors  Per-run analysis  Slow  Many false nega3ves  Few false posi3ves</p>
    <p>How to Ensure SoDware is Race-free?</p>
    <p>Sta,c race detectors  Full path analysis  Fast  Few false nega3ves  Many false posi3ves</p>
  </div>
  <div class="page">
    <p>Dynamic race detectors  Per-run analysis  Slow  Many false nega3ves  Few false posi3ves</p>
    <p>How to Ensure SoDware is Race-free?</p>
    <p>Sta,c race detectors  Full path analysis  Fast  Few false nega3ves  Many false posi3ves</p>
    <p>Exis,ng detectors have important limita,ons</p>
  </div>
  <div class="page">
    <p>Dynamic race detectors</p>
    <p>Few false posi3ves</p>
    <p>How to Ensure SoDware is Race-free?</p>
    <p>Sta,c race detectors  Full path analysis  Fast  Few false nega3ves</p>
  </div>
  <div class="page">
    <p>Collabora,ve race detec,on  Full path analysis  Fast  Few false nega3ves  Few false posi3ves</p>
    <p>CoRD</p>
  </div>
  <div class="page">
    <p>Collabora,ve race detec,on  Full path analysis  Fast  Few false nega3ves  Few false posi3ves</p>
    <p>CoRD</p>
    <p>Sta,cally detect poten,al races</p>
  </div>
  <div class="page">
    <p>Collabora,ve race detec,on  Full path analysis  Fast  Few false nega3ves  Few false posi3ves</p>
    <p>CoRD</p>
    <p>Sta,cally detect poten,al races</p>
    <p>Dynamically validate detected races</p>
  </div>
  <div class="page">
    <p>Collabora,ve race detec,on  Full path analysis  Fast  Few false nega3ves  Few false posi3ves</p>
    <p>CoRD</p>
    <p>Effec,vely detected 8 real races in two real programs with 1% overhead</p>
    <p>Sta,cally detect poten,al races</p>
    <p>Dynamically validate detected races</p>
  </div>
  <div class="page">
    <p>CoRD Architecture</p>
    <p>P</p>
    <p>P</p>
    <p>P</p>
    <p>P</p>
    <p>virtual clearing house</p>
    <p>P</p>
    <p>P</p>
    <p>P</p>
    <p>P</p>
    <p>Hive</p>
    <p>CoRD Architecture</p>
  </div>
  <div class="page">
    <p>CoRD Architecture</p>
    <p>P</p>
    <p>P</p>
    <p>P</p>
    <p>P</p>
    <p>virtual clearing house</p>
    <p>instances of program P</p>
    <p>P</p>
    <p>P</p>
    <p>P</p>
    <p>P</p>
    <p>Hive</p>
    <p>CoRD Architecture</p>
  </div>
  <div class="page">
    <p>CoRD Architecture</p>
    <p>P</p>
    <p>P</p>
    <p>P</p>
    <p>P</p>
    <p>virtual clearing house</p>
    <p>instances of program P</p>
    <p>P</p>
    <p>P</p>
    <p>P</p>
    <p>P</p>
    <p>Hive</p>
    <p>Sta,cally detect poten,al races in P</p>
    <p>CoRD Architecture</p>
  </div>
  <div class="page">
    <p>CoRD Architecture</p>
    <p>P</p>
    <p>P</p>
    <p>P</p>
    <p>P</p>
    <p>virtual clearing house</p>
    <p>instances of program P</p>
    <p>P</p>
    <p>P</p>
    <p>P</p>
    <p>P</p>
    <p>Hive pods</p>
    <p>Sta,cally detect poten,al races in P</p>
    <p>CoRD Architecture</p>
  </div>
  <div class="page">
    <p>CoRD Architecture</p>
    <p>P</p>
    <p>P</p>
    <p>P</p>
    <p>P</p>
    <p>virtual clearing house</p>
    <p>instances of program P</p>
    <p>P</p>
    <p>P</p>
    <p>P</p>
    <p>P</p>
    <p>Hive pods</p>
    <p>Sta,cally detect poten,al races in P</p>
    <p>Dynamically validate races</p>
    <p>CoRD Architecture</p>
  </div>
  <div class="page">
    <p>P</p>
    <p>P</p>
    <p>P</p>
    <p>P</p>
    <p>virtual clearing house</p>
    <p>gl e ch ro m e bl og</p>
    <p>. h F p: // ch ro m e. bl og</p>
    <p>sp ot . c h/ 20 12 _0 6_ 01 _a rc hi ve .h tm</p>
    <p>l 2 h</p>
    <p>F ps :/ /p lu s. go</p>
    <p>og le .c om</p>
    <p>/1 14 25 09 46 51 28 08 77 54 36 /p os ts /V aQ</p>
    <p>u9 sN</p>
    <p>xJ uY , 2 01 2</p>
    <p>l, M ar ke t S ha</p>
    <p>re : M</p>
    <p>ob ile D ev ic es b y Re</p>
    <p>gi on</p>
    <p>a nd</p>
    <p>C ou</p>
    <p>nt ry , G</p>
    <p>ar tn er , F eb 2 01 2</p>
    <p>p: // ar st ec hn</p>
    <p>ic a. co m /i nf or m a3</p>
    <p>on -t ec hn</p>
    <p>ol og</p>
    <p>y/ 20 09 /1 0/ w in do</p>
    <p>w s- 7- ha</p>
    <p>d- 8- m ill io n- te st er s- bi gg</p>
    <p>es t- be ta -e ve r/</p>
  </div>
  <div class="page">
    <p>P</p>
    <p>P</p>
    <p>P</p>
    <p>P</p>
    <p>virtual clearing house</p>
    <p>computers running Chrome 1</p>
    <p>gl e ch ro m e bl og</p>
    <p>. h F p: // ch ro m e. bl og</p>
    <p>sp ot . c h/ 20 12 _0 6_ 01 _a rc hi ve .h tm</p>
    <p>l 2 h</p>
    <p>F ps :/ /p lu s. go</p>
    <p>og le .c om</p>
    <p>/1 14 25 09 46 51 28 08 77 54 36 /p os ts /V aQ</p>
    <p>u9 sN</p>
    <p>xJ uY , 2 01 2</p>
    <p>l, M ar ke t S ha</p>
    <p>re : M</p>
    <p>ob ile D ev ic es b y Re</p>
    <p>gi on</p>
    <p>a nd</p>
    <p>C ou</p>
    <p>nt ry , G</p>
    <p>ar tn er , F eb 2 01 2</p>
    <p>p: // ar st ec hn</p>
    <p>ic a. co m /i nf or m a3</p>
    <p>on -t ec hn</p>
    <p>ol og</p>
    <p>y/ 20 09 /1 0/ w in do</p>
    <p>w s- 7- ha</p>
    <p>d- 8- m ill io n- te st er s- bi gg</p>
    <p>es t- be ta -e ve r/</p>
  </div>
  <div class="page">
    <p>P</p>
    <p>P</p>
    <p>P</p>
    <p>P</p>
    <p>virtual clearing house</p>
    <p>computers running Chrome 1</p>
    <p>servers owned by Google 2</p>
    <p>gl e ch ro m e bl og</p>
    <p>. h F p: // ch ro m e. bl og</p>
    <p>sp ot . c h/ 20 12 _0 6_ 01 _a rc hi ve .h tm</p>
    <p>l 2 h</p>
    <p>F ps :/ /p lu s. go</p>
    <p>og le .c om</p>
    <p>/1 14 25 09 46 51 28 08 77 54 36 /p os ts /V aQ</p>
    <p>u9 sN</p>
    <p>xJ uY , 2 01 2</p>
    <p>l, M ar ke t S ha</p>
    <p>re : M</p>
    <p>ob ile D ev ic es b y Re</p>
    <p>gi on</p>
    <p>a nd</p>
    <p>C ou</p>
    <p>nt ry , G</p>
    <p>ar tn er , F eb 2 01 2</p>
    <p>p: // ar st ec hn</p>
    <p>ic a. co m /i nf or m a3</p>
    <p>on -t ec hn</p>
    <p>ol og</p>
    <p>y/ 20 09 /1 0/ w in do</p>
    <p>w s- 7- ha</p>
    <p>d- 8- m ill io n- te st er s- bi gg</p>
    <p>es t- be ta -e ve r/</p>
  </div>
  <div class="page">
    <p>P</p>
    <p>P</p>
    <p>P</p>
    <p>P</p>
    <p>virtual clearing house</p>
    <p>computers running Chrome 1</p>
    <p>servers owned by Google 2</p>
    <p>gl e ch ro m e bl og</p>
    <p>. h F p: // ch ro m e. bl og</p>
    <p>sp ot . c h/ 20 12 _0 6_ 01 _a rc hi ve .h tm</p>
    <p>l 2 h</p>
    <p>F ps :/ /p lu s. go</p>
    <p>og le .c om</p>
    <p>/1 14 25 09 46 51 28 08 77 54 36 /p os ts /V aQ</p>
    <p>u9 sN</p>
    <p>xJ uY , 2 01 2</p>
    <p>l, M ar ke t S ha</p>
    <p>re : M</p>
    <p>ob ile D ev ic es b y Re</p>
    <p>gi on</p>
    <p>a nd</p>
    <p>C ou</p>
    <p>nt ry , G</p>
    <p>ar tn er , F eb 2 01 2</p>
    <p>p: // ar st ec hn</p>
    <p>ic a. co m /i nf or m a3</p>
    <p>on -t ec hn</p>
    <p>ol og</p>
    <p>y/ 20 09 /1 0/ w in do</p>
    <p>w s- 7- ha</p>
    <p>d- 8- m ill io n- te st er s- bi gg</p>
    <p>es t- be ta -e ve r/</p>
    <p>mobile devices bought in 2011 3</p>
  </div>
  <div class="page">
    <p>P</p>
    <p>P</p>
    <p>P</p>
    <p>P</p>
    <p>virtual clearing house</p>
    <p>computers running Chrome 1</p>
    <p>servers owned by Google 2</p>
    <p>gl e ch ro m e bl og</p>
    <p>. h F p: // ch ro m e. bl og</p>
    <p>sp ot . c h/ 20 12 _0 6_ 01 _a rc hi ve .h tm</p>
    <p>l 2 h</p>
    <p>F ps :/ /p lu s. go</p>
    <p>og le .c om</p>
    <p>/1 14 25 09 46 51 28 08 77 54 36 /p os ts /V aQ</p>
    <p>u9 sN</p>
    <p>xJ uY , 2 01 2</p>
    <p>l, M ar ke t S ha</p>
    <p>re : M</p>
    <p>ob ile D ev ic es b y Re</p>
    <p>gi on</p>
    <p>a nd</p>
    <p>C ou</p>
    <p>nt ry , G</p>
    <p>ar tn er , F eb 2 01 2</p>
    <p>p: // ar st ec hn</p>
    <p>ic a. co m /i nf or m a3</p>
    <p>on -t ec hn</p>
    <p>ol og</p>
    <p>y/ 20 09 /1 0/ w in do</p>
    <p>w s- 7- ha</p>
    <p>d- 8- m ill io n- te st er s- bi gg</p>
    <p>es t- be ta -e ve r/</p>
    <p>mobile devices bought in 2011 3</p>
    <p>Windows 7 beta testers4</p>
  </div>
  <div class="page">
    <p>Sta,c Race Detec,on</p>
  </div>
  <div class="page">
    <p>Sta,c Race Detec,on</p>
  </div>
  <div class="page">
    <p>Sta,c Race Detec,on</p>
    <p>CFG entry</p>
  </div>
  <div class="page">
    <p>Sta,c Race Detec,on</p>
    <p>CFG entry</p>
  </div>
  <div class="page">
    <p>Sta,c Race Detec,on</p>
    <p>CFG entry</p>
    <p>main()</p>
    <p>g()f()</p>
  </div>
  <div class="page">
    <p>Sta,c Race Detec,on</p>
    <p>CFG entry</p>
    <p>main()</p>
    <p>g()f()</p>
  </div>
  <div class="page">
    <p>Sta,c Race Detec,on</p>
    <p>CFG entry</p>
    <p>main()</p>
    <p>g()f()</p>
  </div>
  <div class="page"/>
  <div class="page"/>
  <div class="page">
    <p>Sta,c Race Detec,on</p>
  </div>
  <div class="page">
    <p>Sta,c Race Detec,on x = 0</p>
  </div>
  <div class="page">
    <p>Sta,c Race Detec,on</p>
    <p>x = 1</p>
    <p>lock(l)</p>
    <p>unlock(l)</p>
    <p>Path 1</p>
    <p>x = 0</p>
  </div>
  <div class="page">
    <p>Sta,c Race Detec,on</p>
    <p>x = 1</p>
    <p>lock(l)</p>
    <p>unlock(l)</p>
    <p>Path 1</p>
    <p>x = 2</p>
    <p>lock(k)</p>
    <p>unlock(k)</p>
    <p>Path 2</p>
    <p>x = 0</p>
  </div>
  <div class="page">
    <p>Sta,c Race Detec,on</p>
    <p>x = 1</p>
    <p>lock(l)</p>
    <p>unlock(l)</p>
    <p>Path 1</p>
    <p>x = 2</p>
    <p>lock(k)</p>
    <p>unlock(k)</p>
    <p>Path 2</p>
    <p>LS1 = {l} LS1 = {k}</p>
    <p>x = 0</p>
  </div>
  <div class="page">
    <p>LS1 = {l} x = 2x = 1 LS1 = {k}</p>
    <p>Sta,c Race Detec,on</p>
  </div>
  <div class="page">
    <p>LS1 = {l}</p>
    <p>x = 2x = 1</p>
    <p>LS1 = {k}</p>
    <p>Sta,c Race Detec,on</p>
    <p>= {}</p>
  </div>
  <div class="page">
    <p>LS1 = {l}</p>
    <p>x = 2x = 1</p>
    <p>LS1 = {k}</p>
    <p>Sta,c Race Detec,on</p>
    <p>= {} =&gt; x = 1 and x = 2 are RACING!</p>
  </div>
  <div class="page">
    <p>LS1 = {l}</p>
    <p>x = 2x = 1</p>
    <p>LS1 = {k}</p>
    <p>Sta,c Race Detec,on</p>
    <p>Top-down, flow sensi,ve, interprocedural, lockset-based</p>
    <p>= {} =&gt; x = 1 and x = 2 are RACING!</p>
  </div>
  <div class="page">
    <p>Dynamic Race Valida,on</p>
    <p>Hive x = 2 x = 1</p>
    <p>x = 2</p>
    <p>x = 1</p>
  </div>
  <div class="page">
    <p>Dynamic Race Valida,on</p>
    <p>Hive</p>
    <p>P Pod 2</p>
    <p>P Pod 1</p>
    <p>x = 2</p>
    <p>x = 1</p>
    <p>x = 2</p>
    <p>x = 1</p>
  </div>
  <div class="page">
    <p>Dynamic Race Valida,on</p>
    <p>Hive</p>
    <p>P Pod 2</p>
    <p>P Pod 1</p>
    <p>x = 2</p>
    <p>x = 1 x = 2</p>
    <p>x = 1</p>
    <p>Time</p>
  </div>
  <div class="page">
    <p>Dynamic Race Valida,on</p>
    <p>Hive</p>
    <p>P Pod 2</p>
    <p>P Pod 1</p>
    <p>x = 2</p>
    <p>x = 1 x = 2</p>
    <p>x = 1</p>
    <p>Time</p>
    <p>exec uted executed</p>
    <p>RACE</p>
  </div>
  <div class="page">
    <p>Dynamic Race Valida,on</p>
    <p>Hive</p>
    <p>P Pod 2</p>
    <p>P Pod 1</p>
    <p>x = 2</p>
    <p>x = 1 x = 2</p>
    <p>x = 1</p>
    <p>Time</p>
    <p>exec uted executed</p>
    <p>RACE</p>
    <p>dead lock executed</p>
    <p>RACE CAUSES DEADLOCK</p>
  </div>
  <div class="page">
    <p>Dynamic Race Valida,on</p>
    <p>Hive</p>
    <p>P Pod 2</p>
    <p>P Pod 1</p>
    <p>x = 2</p>
    <p>x = 1 x = 2</p>
    <p>x = 1</p>
    <p>Time</p>
    <p>exec uted executed</p>
    <p>RACE</p>
    <p>exec uted crash</p>
    <p>RACE CAUSES CRASH</p>
    <p>dead lock executed</p>
    <p>RACE CAUSES DEADLOCK</p>
  </div>
  <div class="page">
    <p>Dynamic Race Valida,on</p>
    <p>Hive</p>
    <p>P Pod 2</p>
    <p>P Pod 1</p>
    <p>x = 2</p>
    <p>x = 1 x = 2</p>
    <p>x = 1</p>
    <p>Time</p>
    <p>exec uted executed</p>
    <p>RACE</p>
    <p>exec uted</p>
    <p>not executed LIKELY FP</p>
    <p>exec uted crash</p>
    <p>RACE CAUSES CRASH</p>
    <p>dead lock executed</p>
    <p>RACE CAUSES DEADLOCK</p>
  </div>
  <div class="page">
    <p>Dynamic Race Valida,on</p>
    <p>Hive</p>
    <p>P Pod 2</p>
    <p>P Pod 1</p>
    <p>x = 2</p>
    <p>x = 1 x = 2</p>
    <p>x = 1</p>
    <p>Time</p>
    <p>exec uted executed</p>
    <p>RACE</p>
    <p>exec uted</p>
    <p>not executed LIKELY FP</p>
    <p>not e xecu</p>
    <p>ted not executed NOT EXECUTED</p>
    <p>exec uted crash</p>
    <p>RACE CAUSES CRASH</p>
    <p>dead lock executed</p>
    <p>RACE CAUSES DEADLOCK</p>
  </div>
  <div class="page">
    <p>Detec,on Results and Efficiency</p>
    <p>TOTAL</p>
    <p>RUNTIME OVERHEAD</p>
    <p>SQLite Pbzip2</p>
    <p>RACE</p>
    <p>LIKELY FP NOT EXECUTED</p>
    <p>RACE CAUSES CRASH</p>
    <p>RACE CAUSES DEADLOCK</p>
  </div>
  <div class="page">
    <p>Detec,on Results and Efficiency</p>
    <p>TOTAL</p>
    <p>RUNTIME OVERHEAD</p>
    <p>SQLite Pbzip2 88 122</p>
    <p>RACE</p>
    <p>LIKELY FP NOT EXECUTED</p>
    <p>RACE CAUSES CRASH</p>
    <p>RACE CAUSES DEADLOCK</p>
  </div>
  <div class="page">
    <p>Detec,on Results and Efficiency</p>
    <p>TOTAL</p>
    <p>RUNTIME OVERHEAD</p>
    <p>SQLite Pbzip2 88 122 0 1RACE</p>
    <p>LIKELY FP NOT EXECUTED</p>
    <p>RACE CAUSES CRASH</p>
    <p>RACE CAUSES DEADLOCK</p>
  </div>
  <div class="page">
    <p>Detec,on Results and Efficiency</p>
    <p>TOTAL</p>
    <p>RUNTIME OVERHEAD</p>
    <p>SQLite Pbzip2 88 122</p>
    <p>LIKELY FP NOT EXECUTED</p>
    <p>RACE CAUSES CRASH</p>
    <p>RACE CAUSES DEADLOCK</p>
  </div>
  <div class="page">
    <p>Detec,on Results and Efficiency</p>
    <p>TOTAL</p>
    <p>RUNTIME OVERHEAD</p>
    <p>SQLite Pbzip2 88 122</p>
    <p>LIKELY FP NOT EXECUTED</p>
    <p>RACE CAUSES CRASH</p>
    <p>RACE CAUSES DEADLOCK</p>
  </div>
  <div class="page">
    <p>Detec,on Results and Efficiency</p>
    <p>TOTAL</p>
    <p>RUNTIME OVERHEAD</p>
    <p>SQLite Pbzip2 88 122</p>
    <p>RACE</p>
    <p>LIKELY FP NOT EXECUTED</p>
    <p>RACE CAUSES CRASH</p>
    <p>RACE CAUSES DEADLOCK</p>
  </div>
  <div class="page">
    <p>Detec,on Results and Efficiency</p>
    <p>TOTAL</p>
    <p>RUNTIME OVERHEAD</p>
    <p>SQLite Pbzip2 88 122</p>
    <p>RACE</p>
    <p>LIKELY FP NOT EXECUTED</p>
    <p>RACE CAUSES CRASH</p>
    <p>RACE CAUSES DEADLOCK</p>
  </div>
  <div class="page">
    <p>Detec,on Results and Efficiency</p>
    <p>TOTAL</p>
    <p>RUNTIME OVERHEAD</p>
    <p>SQLite Pbzip2 88 122</p>
    <p>RACE</p>
    <p>LIKELY FP NOT EXECUTED</p>
    <p>RACE CAUSES CRASH</p>
    <p>RACE CAUSES DEADLOCK</p>
  </div>
  <div class="page">
    <p>Detec,on Results and Efficiency</p>
    <p>TOTAL</p>
    <p>RUNTIME OVERHEAD</p>
    <p>Effec,ve and low overhead</p>
    <p>SQLite Pbzip2 88 122</p>
    <p>RACE</p>
    <p>LIKELY FP NOT EXECUTED</p>
    <p>RACE CAUSES CRASH</p>
    <p>RACE CAUSES DEADLOCK</p>
  </div>
  <div class="page">
    <p>CoRD</p>
    <p>ThreadSani,zer</p>
    <p>Comparison to Other Detectors</p>
    <p>SQLite Pbzip2</p>
    <p>Dynamic detectors have high overhead</p>
  </div>
  <div class="page">
    <p>CoRD</p>
    <p>ThreadSani,zer</p>
    <p>Comparison to Other Detectors</p>
    <p>SQLite Pbzip2</p>
    <p>Sta,c detectors have false posi,ves and dont provide any classifica,on</p>
    <p>Dynamic detectors have high overhead</p>
  </div>
  <div class="page">
    <p>Summary</p>
    <p>Collabora,ve race detec,on  Sta3cally detect races  Dynamically validate them  Effec,ve  Detected 8 real races in 2 real programs  Efficient  Has &lt; 1% overhead</p>
  </div>
  <div class="page">
    <p>Roadmap</p>
    <p>Synthesizing fixes  Privacy implica,ons  Extension to other types of bugs</p>
  </div>
</Presentation>
