<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Mochi: Visual Log-Analysis Based Tools for Debugging</p>
    <p>Hadoop Jiaqi Tan</p>
    <p>Xinghao Pan, Soila Kavulya, Rajeev Gandhi, Priya Narasimhan</p>
    <p>PARALLEL DATA LABORATORY Carnegie Mellon University</p>
  </div>
  <div class="page">
    <p>Jiaqi Tan  June 09 http://www.pdl.cmu.edu/ 2</p>
    <p>Motivation  Debugging cloud computing programs is hard</p>
    <p>Involves both computation and data movement  Large-scale, distributed, many interdependencies  Focus: debugging MapReduce programs</p>
    <p>Current tools (traditional debuggers) lacking  Too fine-grained, too much information</p>
    <p>e.g., jstack, jprof  Do not show higher-level MapReduce abstractions</p>
    <p>i.e., information not at level of maps, reduces  Need to expose all factors affecting</p>
    <p>MapReduce program performance</p>
  </div>
  <div class="page">
    <p>Architecture of Hadoop  Runtime and Distributed Filesystem (HDFS)  Master/Slave: one Master, many Slaves  Runs arbitrary MapReduce user code  Daemons natively generate activity logs</p>
    <p>Jiaqi Tan  June 09 http://www.pdl.cmu.edu/ 3</p>
    <p>NameNode JobTracker</p>
    <p>DataNode TaskTracker</p>
    <p>Slave nodes</p>
    <p>Master node</p>
    <p>Legend</p>
    <p>Cluster nodes</p>
    <p>Runtime daemon</p>
    <p>Distrib. FS daemon</p>
    <p>DataNode TaskTracker</p>
    <p>DataNode TaskTracker</p>
  </div>
  <div class="page">
    <p>Mochi: Approach  Log analysis</p>
    <p>Extract views of node-local execution: SALSA [USENIX WASL 08]</p>
    <p>Correlate execution across nodes: distributed control-flow, distributed data-flow</p>
    <p>Correlate execution and filesystem layers: Job-centric Data-flow (JCDF)</p>
    <p>Visualization of behavior  Show behavior along three dimensions:</p>
    <p>Time, space, and (data) volume</p>
    <p>Jiaqi Tan  June 09 http://www.pdl.cmu.edu/ 4</p>
  </div>
  <div class="page">
    <p>Goals  Extract program behavior at MapReduce level</p>
    <p>of abstraction  Factors affecting program performance  Aspects of framework not visible to user code</p>
    <p>e.g. task scheduling, data distribution</p>
    <p>Expose different perspectives of performance  Present different levels of aggregation</p>
    <p>e.g. time-aggregates, space-aggregates  Remain transparent to Hadoop</p>
    <p>No added instrumentation, work in production environments</p>
    <p>Jiaqi Tan  June 09 http://www.pdl.cmu.edu/ 5</p>
  </div>
  <div class="page">
    <p>Outline  State-machine extraction from logs  Abstraction of MapReduce Execution:</p>
    <p>Job-centric Data-flow (JCDF)  Visualization  Case-studies  Future Work</p>
    <p>Jiaqi Tan  June 09 http://www.pdl.cmu.edu/ 6</p>
  </div>
  <div class="page">
    <p>State-machine Extraction</p>
    <p>http://www.pdl.cmu.edu/</p>
    <p>Reduce Idle</p>
    <p>TaskTracker Log</p>
    <p>Records events for all Maps and Reduce tasks on</p>
    <p>its node</p>
    <p>Each Map tasks control flow</p>
    <p>Each Reduce tasks control flow</p>
    <p>Map</p>
    <p>Map outputs</p>
    <p>to Reduce tasks on</p>
    <p>this or other nodes</p>
    <p>Reduce Copy</p>
    <p>Reduce Sort</p>
    <p>Reduce Merge Copy</p>
    <p>User Reduce</p>
    <p>c a n</p>
    <p>b e</p>
    <p>in te</p>
    <p>rl e a v e d</p>
    <p>[t] Launch Reduce Task : : [t] Reduce is idling, waiting for Map outputs : : [t] Repeat until all Map outputs copied</p>
    <p>[t] Start Reduce Copy (of completed Map output) : : [t] Finish Reduce Copy</p>
    <p>[t] Reduce Merge Copy : : [t] Reduce Merge Sort : : [t] Reduce Reduce (User Reduce) : : [t] Reduce Task Done</p>
    <p>[t] Launch Map Task : : [t] Copy Map outputs : : [t] Map Task Done</p>
    <p>Incoming Map</p>
    <p>outputs for this Reduce</p>
    <p>task</p>
    <p>Reduce Idle</p>
    <p>TaskTracker Log</p>
    <p>Records events for all Maps and Reduce tasks on</p>
    <p>its node</p>
    <p>Each Map tasks control flow</p>
    <p>Each Reduce tasks control flow</p>
    <p>Map</p>
    <p>Map outputs</p>
    <p>to Reduce tasks on</p>
    <p>this or other nodes</p>
    <p>Reduce Copy</p>
    <p>Reduce Sort</p>
    <p>Reduce Merge Copy</p>
    <p>User Reduce</p>
    <p>c a n</p>
    <p>b e</p>
    <p>in te</p>
    <p>rl e a v e d</p>
    <p>[t] Launch Reduce Task : : [t] Reduce is idling, waiting for Map outputs : : [t] Repeat until all Map outputs copied</p>
    <p>[t] Start Reduce Copy (of completed Map output) : : [t] Finish Reduce Copy</p>
    <p>[t] Reduce Merge Copy : : [t] Reduce Merge Sort : : [t] Reduce Reduce (User Reduce) : : [t] Reduce Task Done</p>
    <p>[t] Launch Map Task : : [t] Copy Map outputs : : [t] Map Task Done</p>
    <p>Incoming Map</p>
    <p>outputs for this Reduce</p>
    <p>task</p>
    <p>Reduce Idle</p>
    <p>TaskTracker Log</p>
    <p>Records events for all Maps and Reduce tasks on</p>
    <p>its node</p>
    <p>Each Map tasks control flow</p>
    <p>Each Reduce tasks control flow</p>
    <p>Map</p>
    <p>Map outputs</p>
    <p>to Reduce tasks on</p>
    <p>this or other nodes</p>
    <p>Reduce Copy</p>
    <p>Reduce Sort</p>
    <p>Reduce Merge Copy</p>
    <p>User Reduce</p>
    <p>c a</p>
    <p>n b</p>
    <p>e in</p>
    <p>te rl e</p>
    <p>a v e</p>
    <p>d</p>
    <p>[t] Launch Reduce Task : : [t] Reduce is idling, waiting for Map outputs : : [t] Repeat until all Map outputs copied</p>
    <p>[t] Start Reduce Copy (of completed Map output) : : [t] Finish Reduce Copy</p>
    <p>[t] Reduce Merge Copy : : [t] Reduce Merge Sort : : [t] Reduce Reduce (User Reduce) : : [t] Reduce Task Done</p>
    <p>[t] Launch Map Task : : [t] Copy Map outputs : : [t] Map Task Done</p>
    <p>Incoming Map</p>
    <p>outputs for this Reduce</p>
    <p>task</p>
    <p>Reduce Idle</p>
    <p>TaskTracker Log</p>
    <p>Records events for all Maps and Reduce tasks on</p>
    <p>its node</p>
    <p>Each Map tasks control flow</p>
    <p>Each Reduce tasks control flow</p>
    <p>Map</p>
    <p>Map outputs</p>
    <p>to Reduce tasks on</p>
    <p>this or other nodes</p>
    <p>Reduce Copy</p>
    <p>Reduce Sort</p>
    <p>Reduce Merge Copy</p>
    <p>User Reduce</p>
    <p>c a n</p>
    <p>b e</p>
    <p>in te</p>
    <p>rl e a v e d</p>
    <p>[t] Launch Reduce Task : : [t] Reduce is idling, waiting for Map outputs : : [t] Repeat until all Map outputs copied</p>
    <p>[t] Start Reduce Copy (of completed Map output) : : [t] Finish Reduce Copy</p>
    <p>[t] Reduce Merge Copy : : [t] Reduce Merge Sort : : [t] Reduce Reduce (User Reduce) : : [t] Reduce Task Done</p>
    <p>[t] Launch Map Task : : [t] Copy Map outputs : : [t] Map Task Done</p>
    <p>Incoming Map</p>
    <p>outputs for this Reduce</p>
    <p>task</p>
    <p>Reduce Idle</p>
    <p>TaskTracker Log</p>
    <p>Records events for all Maps and Reduce tasks on</p>
    <p>its node</p>
    <p>Each Map tasks control flow</p>
    <p>Each Reduce tasks control flow</p>
    <p>Map</p>
    <p>Map outputs</p>
    <p>to Reduce tasks on</p>
    <p>this or other nodes</p>
    <p>Reduce Copy</p>
    <p>Reduce Sort</p>
    <p>Reduce Merge Copy</p>
    <p>User Reduce</p>
    <p>c a n</p>
    <p>b e</p>
    <p>in te</p>
    <p>rl e a v e d</p>
    <p>[t] Launch Reduce Task : : [t] Reduce is idling, waiting for Map outputs : : [t] Repeat until all Map outputs copied</p>
    <p>[t] Start Reduce Copy (of completed Map output) : : [t] Finish Reduce Copy</p>
    <p>[t] Reduce Merge Copy : : [t] Reduce Merge Sort : : [t] Reduce Reduce (User Reduce) : : [t] Reduce Task Done</p>
    <p>[t] Launch Map Task : : [t] Copy Map outputs : : [t] Map Task Done</p>
    <p>Incoming Map</p>
    <p>outputs for this Reduce</p>
    <p>task</p>
    <p>Reduce Idle</p>
    <p>TaskTracker Log</p>
    <p>Records events for all Maps and Reduce tasks on</p>
    <p>its node</p>
    <p>Each Map tasks control flow</p>
    <p>Each Reduce tasks control flow</p>
    <p>Map</p>
    <p>Map outputs</p>
    <p>to Reduce tasks on</p>
    <p>this or other nodes</p>
    <p>Reduce Copy</p>
    <p>Reduce Sort</p>
    <p>Reduce Merge Copy</p>
    <p>User Reduce</p>
    <p>c a</p>
    <p>n b</p>
    <p>e in</p>
    <p>te rl e</p>
    <p>a v e</p>
    <p>d</p>
    <p>[t] Launch Reduce Task : : [t] Reduce is idling, waiting for Map outputs : : [t] Repeat until all Map outputs copied</p>
    <p>[t] Start Reduce Copy (of completed Map output) : : [t] Finish Reduce Copy</p>
    <p>[t] Reduce Merge Copy : : [t] Reduce Merge Sort : : [t] Reduce Reduce (User Reduce) : : [t] Reduce Task Done</p>
    <p>[t] Launch Map Task : : [t] Copy Map outputs : : [t] Map Task Done</p>
    <p>Incoming Map</p>
    <p>outputs for this Reduce</p>
    <p>task</p>
    <p>Reduce Idle</p>
    <p>TaskTracker Log</p>
    <p>Records events for all Maps and Reduce tasks on</p>
    <p>its node</p>
    <p>Each Map tasks control flow</p>
    <p>Each Reduce tasks control flow</p>
    <p>Map</p>
    <p>Map outputs</p>
    <p>to Reduce tasks on</p>
    <p>this or other nodes</p>
    <p>Reduce Copy</p>
    <p>Reduce Sort</p>
    <p>Reduce Merge Copy</p>
    <p>User Reduce</p>
    <p>c a</p>
    <p>n b</p>
    <p>e in</p>
    <p>te rl e</p>
    <p>a v e</p>
    <p>d</p>
    <p>[t] Launch Reduce Task : : [t] Reduce is idling, waiting for Map outputs : : [t] Repeat until all Map outputs copied</p>
    <p>[t] Start Reduce Copy (of completed Map output) : : [t] Finish Reduce Copy</p>
    <p>[t] Reduce Merge Copy : : [t] Reduce Merge Sort : : [t] Reduce Reduce (User Reduce) : : [t] Reduce Task Done</p>
    <p>[t] Launch Map Task : : [t] Copy Map outputs : : [t] Map Task Done</p>
    <p>Incoming Map</p>
    <p>outputs for this Reduce</p>
    <p>task</p>
    <p>Reduce Idle</p>
    <p>TaskTracker Log</p>
    <p>Records events for all Maps and Reduce tasks on</p>
    <p>its node</p>
    <p>Each Map tasks control flow</p>
    <p>Each Reduce tasks control flow</p>
    <p>Map</p>
    <p>Map outputs</p>
    <p>to Reduce tasks on</p>
    <p>this or other nodes</p>
    <p>Reduce Copy</p>
    <p>Reduce Sort</p>
    <p>Reduce Merge Copy</p>
    <p>User Reduce</p>
    <p>c a n</p>
    <p>b e</p>
    <p>in te</p>
    <p>rl e a v e d</p>
    <p>[t] Launch Reduce Task : : [t] Reduce is idling, waiting for Map outputs : : [t] Repeat until all Map outputs copied</p>
    <p>[t] Start Reduce Copy (of completed Map output) : : [t] Finish Reduce Copy</p>
    <p>[t] Reduce Merge Copy : : [t] Reduce Merge Sort : : [t] Reduce Reduce (User Reduce) : : [t] Reduce Task Done</p>
    <p>[t] Launch Map Task : : [t] Copy Map outputs : : [t] Map Task Done</p>
    <p>Incoming Map</p>
    <p>outputs for this Reduce</p>
    <p>task</p>
    <p>Reduce Idle</p>
    <p>TaskTracker Log</p>
    <p>Records events for all Maps and Reduce tasks on</p>
    <p>its node</p>
    <p>Each Map tasks control flow</p>
    <p>Each Reduce tasks control flow</p>
    <p>Map</p>
    <p>Map outputs</p>
    <p>to Reduce tasks on</p>
    <p>this or other nodes</p>
    <p>Reduce Copy</p>
    <p>Reduce Sort</p>
    <p>Reduce Merge Copy</p>
    <p>User Reduce</p>
    <p>c a n</p>
    <p>b e</p>
    <p>in te</p>
    <p>rl e a v e d</p>
    <p>[t] Launch Reduce Task : : [t] Reduce is idling, waiting for Map outputs : : [t] Repeat until all Map outputs copied</p>
    <p>[t] Start Reduce Copy (of completed Map output) : : [t] Finish Reduce Copy</p>
    <p>[t] Reduce Merge Copy : : [t] Reduce Merge Sort : : [t] Reduce Reduce (User Reduce) : : [t] Reduce Task Done</p>
    <p>[t] Launch Map Task : : [t] Copy Map outputs : : [t] Map Task Done</p>
    <p>Incoming Map</p>
    <p>outputs for this Reduce</p>
    <p>task</p>
    <p>Reduce Idle</p>
    <p>TaskTracker Log</p>
    <p>Records events for all Maps and Reduce tasks on</p>
    <p>its node</p>
    <p>Each Map tasks control flow</p>
    <p>Each Reduce tasks control flow</p>
    <p>Map</p>
    <p>Map outputs</p>
    <p>to Reduce tasks on</p>
    <p>this or other nodes</p>
    <p>Reduce Copy</p>
    <p>Reduce Sort</p>
    <p>Reduce Merge Copy</p>
    <p>User Reduce</p>
    <p>c a n</p>
    <p>b e</p>
    <p>in te</p>
    <p>rl e a v e d</p>
    <p>[t] Launch Reduce Task : : [t] Reduce is idling, waiting for Map outputs : : [t] Repeat until all Map outputs copied</p>
    <p>[t] Start Reduce Copy (of completed Map output) : : [t] Finish Reduce Copy</p>
    <p>[t] Reduce Merge Copy : : [t] Reduce Merge Sort : : [t] Reduce Reduce (User Reduce) : : [t] Reduce Task Done</p>
    <p>[t] Launch Map Task : : [t] Copy Map outputs : : [t] Map Task Done</p>
    <p>Incoming Map</p>
    <p>outputs for this Reduce</p>
    <p>taskReduce Idle</p>
    <p>TaskTracker Log</p>
    <p>Records events for all Maps and Reduce tasks on</p>
    <p>its node</p>
    <p>Each Map tasks control flow</p>
    <p>Each Reduce tasks control flow</p>
    <p>Map</p>
    <p>Map outputs</p>
    <p>to Reduce tasks on</p>
    <p>this or other nodes</p>
    <p>Reduce Copy</p>
    <p>Reduce Sort</p>
    <p>Reduce Merge Copy</p>
    <p>User Reduce</p>
    <p>c a</p>
    <p>n b</p>
    <p>e in</p>
    <p>te rl e</p>
    <p>a v e</p>
    <p>d</p>
    <p>[t] Launch Reduce Task : : [t] Reduce is idling, waiting for Map outputs : : [t] Repeat until all Map outputs copied</p>
    <p>[t] Start Reduce Copy (of completed Map output) : : [t] Finish Reduce Copy</p>
    <p>[t] Reduce Merge Copy : : [t] Reduce Merge Sort : : [t] Reduce Reduce (User Reduce) : : [t] Reduce Task Done</p>
    <p>[t] Launch Map Task : : [t] Copy Map outputs : : [t] Map Task Done</p>
    <p>Incoming Map</p>
    <p>outputs for this Reduce</p>
    <p>task</p>
    <p>Reduce Idle</p>
    <p>TaskTracker Log</p>
    <p>Records events for all Maps and Reduce tasks on</p>
    <p>its node</p>
    <p>Each Map tasks control flow</p>
    <p>Each Reduce tasks control flow</p>
    <p>Map</p>
    <p>Map outputs</p>
    <p>to Reduce tasks on</p>
    <p>this or other nodes</p>
    <p>Reduce Copy</p>
    <p>Reduce Sort</p>
    <p>Reduce Merge Copy</p>
    <p>User Reduce</p>
    <p>c a</p>
    <p>n b</p>
    <p>e in</p>
    <p>te rl e</p>
    <p>a v e</p>
    <p>d</p>
    <p>[t] Launch Reduce Task : : [t] Reduce is idling, waiting for Map outputs : : [t] Repeat until all Map outputs copied</p>
    <p>[t] Start Reduce Copy (of completed Map output) : : [t] Finish Reduce Copy</p>
    <p>[t] Reduce Merge Copy : : [t] Reduce Merge Sort : : [t] Reduce Reduce (User Reduce) : : [t] Reduce Task Done</p>
    <p>[t] Launch Map Task : : [t] Copy Map outputs : : [t] Map Task Done</p>
    <p>Incoming Map</p>
    <p>outputs for this Reduce</p>
    <p>task</p>
    <p>Reduce Idle</p>
    <p>TaskTracker Log</p>
    <p>Records events for all Maps and Reduce tasks on</p>
    <p>its node</p>
    <p>Each Map tasks control flow</p>
    <p>Each Reduce tasks control flow</p>
    <p>Map</p>
    <p>Map outputs</p>
    <p>to Reduce tasks on</p>
    <p>this or other nodes</p>
    <p>Reduce Copy</p>
    <p>Reduce Sort</p>
    <p>Reduce Merge Copy</p>
    <p>User Reduce</p>
    <p>c a n</p>
    <p>b e</p>
    <p>in te</p>
    <p>rl e a v e d</p>
    <p>[t] Launch Reduce Task : : [t] Reduce is idling, waiting for Map outputs : : [t] Repeat until all Map outputs copied</p>
    <p>[t] Start Reduce Copy (of completed Map output) : : [t] Finish Reduce Copy</p>
    <p>[t] Reduce Merge Copy : : [t] Reduce Merge Sort : : [t] Reduce Reduce (User Reduce) : : [t] Reduce Task Done</p>
    <p>[t] Launch Map Task : : [t] Copy Map outputs : : [t] Map Task Done</p>
    <p>Incoming Map</p>
    <p>outputs for this Reduce</p>
    <p>task</p>
    <p>Reduce Idle</p>
    <p>TaskTracker Log</p>
    <p>Records events for all Maps and Reduce tasks on</p>
    <p>its node</p>
    <p>Each Map tasks control flow</p>
    <p>Each Reduce tasks control flow</p>
    <p>Map</p>
    <p>Map outputs</p>
    <p>to Reduce tasks on</p>
    <p>this or other nodes</p>
    <p>Reduce Copy</p>
    <p>Reduce Sort</p>
    <p>Reduce Merge Copy</p>
    <p>User Reduce</p>
    <p>c a</p>
    <p>n b</p>
    <p>e in</p>
    <p>te rl e</p>
    <p>a v e</p>
    <p>d</p>
    <p>[t] Launch Reduce Task : : [t] Reduce is idling, waiting for Map outputs : : [t] Repeat until all Map outputs copied</p>
    <p>[t] Start Reduce Copy (of completed Map output) : : [t] Finish Reduce Copy</p>
    <p>[t] Reduce Merge Copy : : [t] Reduce Merge Sort : : [t] Reduce Reduce (User Reduce) : : [t] Reduce Task Done</p>
    <p>[t] Launch Map Task : : [t] Copy Map outputs : : [t] Map Task Done</p>
    <p>Incoming Map</p>
    <p>outputs for this Reduce</p>
    <p>task</p>
    <p>Reduce Idle</p>
    <p>TaskTracker Log</p>
    <p>Records events for all Maps and Reduce tasks on</p>
    <p>its node</p>
    <p>Each Map tasks control flow</p>
    <p>Each Reduce tasks control flow</p>
    <p>Map</p>
    <p>Map outputs</p>
    <p>to Reduce tasks on</p>
    <p>this or other nodes</p>
    <p>Reduce Copy</p>
    <p>Reduce Sort</p>
    <p>Reduce Merge Copy</p>
    <p>User Reduce</p>
    <p>c a n</p>
    <p>b e</p>
    <p>in te</p>
    <p>rl e a v e d</p>
    <p>[t] Launch Reduce Task : : [t] Reduce is idling, waiting for Map outputs : : [t] Repeat until all Map outputs copied</p>
    <p>[t] Start Reduce Copy (of completed Map output) : : [t] Finish Reduce Copy</p>
    <p>[t] Reduce Merge Copy : : [t] Reduce Merge Sort : : [t] Reduce Reduce (User Reduce) : : [t] Reduce Task Done</p>
    <p>[t] Launch Map Task : : [t] Copy Map outputs : : [t] Map Task Done</p>
    <p>Incoming Map</p>
    <p>outputs for this Reduce</p>
    <p>task</p>
    <p>Control-flow view: state orders, durations</p>
    <p>Data-flow view: transfer of data to other nodes</p>
    <p>Jiaqi Tan  June 09 7</p>
    <p>Mochi: Piecing together SALSA</p>
    <p>states for conjoined Control Flow+Data Flow</p>
    <p>view of MapReduce</p>
  </div>
  <div class="page">
    <p>Mochi</p>
    <p>Jiaqi Tan  June 09 http://www.pdl.cmu.edu/ 8</p>
    <p>Execution (MapReduce) layer state-machine view (per-node)</p>
    <p>Distributed FileSystem (HDFS) state-machine view (per-node)</p>
    <p>Conjoined Control-flow + Data-flow: Job-Centric Data-Flow (JCDF) (across all nodes)</p>
    <p>Causal flows of data and processing: Realized Execution Paths (REP)</p>
    <p>S A</p>
    <p>LS A</p>
    <p>M</p>
    <p>oc hi</p>
    <p>: Lo</p>
    <p>g A</p>
    <p>na ly</p>
    <p>si s</p>
    <p>M oc</p>
    <p>hi :</p>
    <p>V is</p>
    <p>ua liz</p>
    <p>at io</p>
    <p>n</p>
    <p>Map inputs, outputs</p>
    <p>grit1206 grit1204 grit1202 grit1203</p>
    <p>M ap</p>
    <p>O ut</p>
    <p>pu t</p>
    <p>M ap</p>
    <p>In pu</p>
    <p>t</p>
    <p>Src Host (From Mappers)</p>
    <p>D es</p>
    <p>t H os</p>
    <p>t ( T</p>
    <p>ow ar</p>
    <p>ds R</p>
    <p>ed uc</p>
    <p>er s)</p>
    <p>Shuffles</p>
    <p>grit1206 grit1204 grit1202 grit1203</p>
    <p>grit1202</p>
    <p>grit1203</p>
    <p>grit1206</p>
    <p>grit1204</p>
    <p>Reduce inputs, outputs</p>
    <p>grit1202 grit1203 grit1206 grit1204</p>
    <p>R ed</p>
    <p>uc e</p>
    <p>O ut</p>
    <p>pu t</p>
    <p>R ed</p>
    <p>uc e</p>
    <p>In pu</p>
    <p>t</p>
    <p>P rior w</p>
    <p>ork N</p>
    <p>ew C</p>
    <p>ontributions</p>
  </div>
  <div class="page">
    <p>Control-Flows, Data-Flows  Control-flow</p>
    <p>Distributed flow of execution across nodes: Map  Reduce via Shuffles</p>
    <p>Distributed data-flow  Data paths of Map</p>
    <p>outputs shuffled to Reduces</p>
    <p>HDFS data blocks read into and written out of jobs</p>
    <p>Jiaqi Tan  June 09 http://www.pdl.cmu.edu/ 9</p>
    <p>HDFS data block</p>
    <p>HDFS data block</p>
    <p>Map output split</p>
    <p>Reduce</p>
    <p>Map</p>
    <p>Shuffle</p>
    <p>Reduce Input</p>
  </div>
  <div class="page">
    <p>Job-Centric Data-Flows (JCDF)  Control+Data Flows</p>
    <p>= JCDF  Correlate data and</p>
    <p>execution paths in time: co-occurring:  Block-reads, maps;  Block-writes,</p>
    <p>reduces  Create conjoined</p>
    <p>causal paths (REP)</p>
    <p>Jiaqi Tan  June 09 http://www.pdl.cmu.edu/ 10</p>
    <p>HDFS data block</p>
    <p>HDFS data block</p>
    <p>Map output split</p>
    <p>Reduce</p>
    <p>Map</p>
    <p>Shuffle</p>
    <p>Reduce Input</p>
  </div>
  <div class="page">
    <p>Realized Execution Paths (REP)  JCDF (Job-centric Data-Flows)</p>
    <p>Large graph of all causal flows</p>
    <p>Contains all causal flows distributed through system</p>
    <p>REP  Single causal path</p>
    <p>through execution  Extract every REP</p>
    <p>from JCDF using Depth-First Search</p>
    <p>Jiaqi Tan  June 09 http://www.pdl.cmu.edu/ 11</p>
    <p>HDFS data block</p>
    <p>HDFS data block</p>
    <p>Map output split</p>
    <p>Reduce</p>
    <p>Map</p>
    <p>Shuffle</p>
    <p>Reduce Input</p>
  </div>
  <div class="page">
    <p>Validation: Visualizations  Testbed</p>
    <p>Yahoo! M45 4000-processor cluster  Production environment: no added instrumentation  Hadoop 0.18.3 with Hadoop-on-Demand</p>
    <p>Workloads:  Real CMU user workloads:</p>
    <p>Matrix-Vector Multiplication [CMU-ML-08-117]  Benchmarks: SleepJob (No-op), Sort</p>
    <p>Processing C++ Log parsing + GNU R graph generation</p>
    <p>Jiaqi Tan  June 09 http://www.pdl.cmu.edu/ 12</p>
  </div>
  <div class="page">
    <p>Swimlanes (Space-Time)  Task-execution</p>
    <p>in time, across nodes</p>
    <p>Each task gets a line for its duration</p>
    <p>Shows where Hadoop job and nodes spend their time</p>
    <p>Jiaqi Tan  June 09 http://www.pdl.cmu.edu/ 13</p>
    <p>Time/s</p>
    <p>P er</p>
    <p>-t as</p>
    <p>k</p>
    <p>Task durations (Matrix-Vector Multiplication): Per-node JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce JT_Map JT_Reduce</p>
    <p>Time/s</p>
    <p>P er</p>
    <p>-t as</p>
    <p>k Task durations (Matrix-Vector Multiplication: 49 hosts): All nodes</p>
    <p>JT_Map JT_Reduce</p>
  </div>
  <div class="page">
    <p>MIROS  MIROS (Map Inputs,</p>
    <p>Reduce Outputs, Shuffles)</p>
    <p>Aggregates data volumes across:  All tasks per node  Entire job</p>
    <p>Shows skewed data flows, bottlenecks</p>
    <p>Map inputs, outputs</p>
    <p>grit1206 grit1204 grit1202 grit1203</p>
    <p>M ap</p>
    <p>O ut</p>
    <p>pu t</p>
    <p>M ap</p>
    <p>In pu</p>
    <p>t</p>
    <p>Src Host (From Mappers)</p>
    <p>D es</p>
    <p>t H os</p>
    <p>t ( T</p>
    <p>ow ar</p>
    <p>ds R</p>
    <p>ed uc</p>
    <p>er s)</p>
    <p>Shuffles</p>
    <p>grit1206 grit1204 grit1202 grit1203</p>
    <p>grit1202</p>
    <p>grit1203</p>
    <p>grit1206</p>
    <p>grit1204</p>
    <p>Reduce inputs, outputs</p>
    <p>grit1202 grit1203 grit1206 grit1204</p>
    <p>R ed</p>
    <p>uc e</p>
    <p>O ut</p>
    <p>pu t</p>
    <p>R ed</p>
    <p>uc e</p>
    <p>In pu</p>
    <p>t</p>
    <p>Jiaqi Tan  June 09 http://www.pdl.cmu.edu/ 14</p>
  </div>
  <div class="page">
    <p>Realized Execution Paths (REP)  Per-flow Volume</p>
    <p>Duration correlation  Flows clustered for</p>
    <p>scalable visualization  For each stage in</p>
    <p>flow, shows:  Duration spent  Input+output volumes</p>
    <p>Compares time taken vs. volume processed</p>
    <p>Jiaqi Tan  June 09 http://www.pdl.cmu.edu/ 15</p>
  </div>
  <div class="page">
    <p>Opportunities for Optimization  User M45 workload:</p>
    <p>Matrix-Vector Multiplication</p>
    <p>5-node cluster  Before: Some nodes</p>
    <p>idle during reduce  Adjusted # reducers  After: All nodes had</p>
    <p>reducers; 15% faster</p>
    <p>Jiaqi Tan  June 09 http://www.pdl.cmu.edu/ 16</p>
    <p>Before</p>
    <p>After</p>
  </div>
  <div class="page">
    <p>Debugging: Delayed Socket Creation  M45 workload: No</p>
    <p>op Sleep job  Each Map/Reduce</p>
    <p>sleeps for 100 ms  Tasks had unusually</p>
    <p>long durations: exactly 3 minutes</p>
    <p>Identified to be bad routing interaction</p>
    <p>Disabled Java IPv6</p>
    <p>Jiaqi Tan  June 09 http://www.pdl.cmu.edu/ 17</p>
    <p>Before</p>
    <p>After</p>
  </div>
  <div class="page">
    <p>Characterizing Jobs using REPs</p>
    <p>Each REP: instantiation of the generic execution</p>
    <p>Plot of Sort workload: Significant time spent waiting on shuffles</p>
    <p>Jiaqi Tan  June 09 http://www.pdl.cmu.edu/ 18</p>
  </div>
  <div class="page">
    <p>Next Steps  Collaboration with</p>
    <p>Yahoo!  we are implementing Mochi for the Hadoop Chukwa project</p>
    <p>Web-based visualization widgets for Hadoop Infrastructure Care Center</p>
    <p>Swimlanes currently available in Chukwa 0.2 (CHUKWA-279)</p>
    <p>Jiaqi Tan  June 09 http://www.pdl.cmu.edu/ 19</p>
  </div>
  <div class="page">
    <p>Conclusion  Extracting program behavior with log analysis</p>
    <p>Distributed Control+Data-Flow  Job-centric Data-flows (JCDF), Realized</p>
    <p>Execution Paths (REP)  Visualizations</p>
    <p>Swimlanes  Task execution in time and space  MIROS  Aggregate data-flows across cluster  REP  Volume-Duration correlation</p>
    <p>Case-studies  Performance debugging and optimization  Job characterization: Bottleneck stages</p>
    <p>Jiaqi Tan  June 09 http://www.pdl.cmu.edu/ 20</p>
  </div>
  <div class="page">
    <p>References  [CMU-ML-08-117] U. Kang, C. Tsourakakis, A. P. Appel, C.</p>
    <p>Faloutsos, J. Leskovec. HADI: Fast Diameter Estimation and Mining in Massive Graphs with Hadoop. CMU ML Tech Report, CMU-ML-08-117, 2008.</p>
    <p>[USENIX WASL 08] J. Tan, X. Pan, S. Kavulya, R. Gandhi, P. Narasimhan. SALSA: Analyzing Logs as StAte Machines. First USENIX Workshop on Analysis of System Logs (WASL), San Diego, CA, Dec 2008.</p>
    <p>Other work:  X. Pan, S. Kavulya, J. Tan, R. Gandhi, P. Narasimhan. Ganesha:</p>
    <p>Black-Box Diagnosis for MapReduce Systems. Second Workshop on Hot Topics in Measurement &amp; Modeling of Computer Systems (HotMetrics), Seattle, WA, Jun 2009.</p>
    <p>Jiaqi Tan  June 09 http://www.pdl.cmu.edu/ 21</p>
  </div>
</Presentation>
