<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>2013 IBM Corporation</p>
    <p>Practical Comprehensive Bounds on Surreptitious Communication Over DNS Vern Paxson12 Mihai Christodorescu3 Mobin Javed1 Josyula Rao4 Reiner Sailer4</p>
    <p>Douglas Schales4 Marc Ph Stoecklin4 Kurt Thomas1 Wietse Venema4 Nicholas Weaver25 1UC Berkeley 2ICSI 3Qualcomm Research 4IBM research 5UC San Diego</p>
    <p>Presenting: Wietse Venema  IBM Research, Yorktown Heights, USA</p>
  </div>
  <div class="page">
    <p>2013 IBM Corporation2</p>
    <p>DNS resolver</p>
    <p>HTTP, FTP, etc .</p>
    <p>DNS resolver</p>
    <p>DNS requ ests</p>
    <p>Hijacked system</p>
    <p>Hijacked system</p>
    <p>DNS responses</p>
    <p>DNS server controlled by attacker</p>
    <p>D A</p>
    <p>T A</p>
    <p>E X</p>
    <p>F IL</p>
    <p>T R</p>
    <p>A T</p>
    <p>IO N</p>
    <p>R E</p>
    <p>M O</p>
    <p>T E</p>
    <p>A C</p>
    <p>C E</p>
    <p>S S</p>
    <p>ENTERPRISE INTERNET</p>
    <p>ENTERPRISE INTERNET</p>
    <p>SSH</p>
    <p>DNS requ ests</p>
  </div>
  <div class="page">
    <p>2013 IBM Corporation3</p>
    <p>Our work in a nutshell</p>
    <p>Bound information content of DNS query sequences.</p>
    <p>4 kB/day per client and domain (site.com, site.co.uk).</p>
    <p>Lossless (reversible) compression: no false negatives.</p>
    <p>1-2 Alerts/week for enterprise-scale networks.</p>
    <p>59 Confirmed DNS tunnels in 230B lookups.</p>
    <p>One query per day, www.example.com to send 0 mail.example.com to send 1</p>
  </div>
  <div class="page">
    <p>2013 IBM Corporation4</p>
    <p>Next: information embedding examples.</p>
    <p>- Query content.</p>
    <p>- Query timing.</p>
    <p>DNS resolver</p>
    <p>Hijacked system example.com DNS server (controlled by attacker)</p>
    <p>ENTERPRISE INTERNET</p>
    <p>DNS query names ending in example.com</p>
  </div>
  <div class="page">
    <p>2013 IBM Corporation5</p>
    <p>Information vector: DNS query name content Actual queries, slightly altered for privacy</p>
    <p>Tunnel: SSH over Iodine (TCP/IP over DNS).</p>
    <p>Non-tunnel: software installer.</p>
    <p>Capacity: up to 255 bytes/query.</p>
    <p>59 Confirmed name-content tunnel detections.</p>
    <p>x--00453809-004d-0046-00523-004e-0051-0034004243-0 051-0055-.00583-0051-0053-0050-0056.val.linux.10-2 0-191-136.9_5-3532-6097.sn.msgserv.ZeroG.com</p>
  </div>
  <div class="page">
    <p>2013 IBM Corporation6</p>
    <p>Information vector: DNS query name codebook Actual queries, slightly altered for privacy</p>
    <p>Capacity: up to log2(codebook size) bits/query.</p>
    <p>No confirmed tunnel detections.</p>
    <p>query name type time (UTC) a0.twimg.com A 1286949054.503602 a3.twimg.com A 1286949216.242019 a3.twimg.com A 1286949251.387366 a1.twimg.com A 1286949277.589322 a2.twimg.com A 1286949295.694136 a3.twimg.com A 1286949310.772878 a1.twimg.com A 1286949310.816623 a3.twimg.com A 1286949418.455759 a1.twimg.com A 1286949418.627365 a3.twimg.com A 1286949448.813207 a0.twimg.com A 1286949461.172023</p>
    <p>Is this a name tunnel? e.g., 00  a0 01  a1 10  a2 11  a3</p>
  </div>
  <div class="page">
    <p>2013 IBM Corporation7</p>
    <p>Information vector: DNS query type Actual queries, slightly altered for privacy</p>
    <p>Capacity: up to 16 bits/query (IANA defines 79 types).</p>
    <p>No confirmed tunnel detections.</p>
    <p>query name type time (UTC) www.e-port.ru AAAA 1363620228.803181 www.e-port.ru A 1363620228.837213 www.e-port.ru AAAA 1363620228.862057 www.e-port.ru A 1363620228.878191 www.e-port.ru A 1363620229.149720 www.e-port.ru AAAA 1363620229.239968 www.e-port.ru A 1363620229.269800 www.e-port.ru AAAA 1363620229.319941 www.e-port.ru AAAA 1363620229.377394 www.e-port.ru A 1363620229.406241 www.e-port.ru AAAA 1363620229.412821</p>
    <p>Is this a type tunnel? e.g., 0  A 1  AAAA</p>
  </div>
  <div class="page">
    <p>2013 IBM Corporation8</p>
    <p>Capacity: O(100) bits/second at 10 msec resolution1.</p>
    <p>No confirmed detections, but source of most alerts. 1Conservative resolution based on median 23msec DNS timing variations observed with Netalyzr.</p>
    <p>Information vector: DNS query timing Actual queries</p>
    <p>Inter-query time interval (msec)</p>
    <p>N u m</p>
    <p>b e r</p>
    <p>o f</p>
    <p>q u</p>
    <p>e ri e s</p>
    <p>people.bu.edu query time-interval distribution</p>
    <p>Is this a timing tunnel?</p>
  </div>
  <div class="page">
    <p>2013 IBM Corporation9</p>
    <p>Next: measuring all information content in DNS queries.</p>
    <p>- Regardless of encoding in names, types or timing.</p>
    <p>- First, focus on query names.</p>
    <p>DNS resolver</p>
    <p>Hijacked system example.com DNS server (controlled by attacker)</p>
    <p>ENTERPRISE INTERNET</p>
    <p>DNS query names ending in example.com</p>
  </div>
  <div class="page">
    <p>2013 IBM Corporation10</p>
    <p>Measuring information in DNS query names, step 1 Result: 2174 alerts for IndLab dataset</p>
    <p>Naive approach: concatenate all query names.</p>
    <p>- Problem: too many alerts.</p>
    <p>foo.example.com + bar.example.com +</p>
  </div>
  <div class="page">
    <p>2013 IBM Corporation11</p>
    <p>Measuring information in DNS query names, step 2 Result: 2174145 alerts for IndLab dataset</p>
    <p>Use lossless (reversible) data compression.</p>
    <p>- Output length  information content. No false negatives.</p>
    <p>Insensitive to encoding details (8-bit, base64, etc.).</p>
    <p>- Append .. to names, for reversible compression.</p>
    <p>gzip(foo.example.com.. + bar.example.com.. +)</p>
  </div>
  <div class="page">
    <p>2013 IBM Corporation12</p>
    <p>Use smallest result from different lossless compressors.</p>
    <p>- Different compressors, different worst cases.</p>
    <p>Measuring information in DNS query names, step 3 Result: 145106 alerts for IndLab dataset</p>
    <p>mincompr(A)</p>
    <p>A = All query names</p>
    <p>mincompr(x) = min( gzip(x), bzip2(x), ppmd(x) )</p>
    <p>Suffix: example.com, Client: 10.9.8.7</p>
    <p>result</p>
  </div>
  <div class="page">
    <p>2013 IBM Corporation13</p>
    <p>Use codepoints (besides straight compression):</p>
    <p>- Transform names A  table of distinct names D + sequence of table indices I (codepoints). Then compress D and I.</p>
    <p>Exploit repetition at the granularity of entire query names.</p>
    <p>- Minor benefit for time-interval and query-type results (small symbols).</p>
    <p>Measuring information in DNS query names, step 4 Result: 10699 alerts for IndLab dataset</p>
    <p>min</p>
    <p>mincompr(D)</p>
    <p>+ mincompr(I)</p>
    <p>mincompr(A)</p>
    <p>query</p>
    <p>names</p>
    <p>mincompr(x) = min( gzip(x), bzip2(x), ppmd(x) )</p>
    <p>A: All Symbols D: Distinct Symbols I: Index of Distinct Symbols</p>
    <p>Suffix: example.com, Client: 10.9.8.7</p>
  </div>
  <div class="page">
    <p>2013 IBM Corporation14</p>
    <p>Use same procedure to separately measure:</p>
    <p>- Sequence of query names; sequence of query types;</p>
    <p>- sequence of inter-query time intervals (10 msec units1).</p>
    <p>Combined DNS query information measurement</p>
    <p>sum</p>
    <p>name</p>
    <p>time</p>
    <p>type</p>
    <p>Suffix: example.com, Client: 10.9.8.7</p>
    <p>min</p>
    <p>mincompr(D)</p>
    <p>+ mincompr(I)</p>
    <p>mincompr(A)</p>
    <p>mincompr(x) = min( gzip(x), bzip2(x), ppmd(x) )</p>
    <p>A: All Symbols D: Distinct Symbols I: Index of Distinct Symbols</p>
    <p>queries</p>
  </div>
  <div class="page">
    <p>2013 IBM Corporation15</p>
    <p>Validation with synthetic traffic</p>
    <p>Name</p>
    <p>Time Type</p>
    <p>Name</p>
    <p>Time Type Name</p>
    <p>Time</p>
    <p>Type Name Time</p>
    <p>Type</p>
    <p>P e</p>
    <p>rc e</p>
    <p>n ta</p>
    <p>g e</p>
    <p>o f</p>
    <p>b y</p>
    <p>te s</p>
    <p>re</p>
    <p>p o</p>
    <p>rt e</p>
    <p>d</p>
    <p>Name content (scp+iodine)</p>
    <p>Name codebook (size=16)</p>
    <p>Interval codebook (size=16)</p>
    <p>Type codebook (size=16)</p>
    <p>Exfiltration scenario</p>
  </div>
  <div class="page">
    <p>2013 IBM Corporation16</p>
    <p>Next: detecting DNS tunnels in mostly-benign traffic.</p>
    <p>- From 45M4089 queries without introducing false negatives.</p>
    <p>DNS resolver</p>
    <p>Hijacked system example.com DNS server (controlled by attacker)</p>
    <p>ENTERPRISE INTERNET</p>
    <p>DNS query names ending in example.com</p>
  </div>
  <div class="page">
    <p>2013 IBM Corporation17</p>
    <p>Searching a haystack of 230B lookups</p>
    <p>Clients</p>
    <p>Lookups (daily)DaysVantage pointSite</p>
  </div>
  <div class="page">
    <p>2013 IBM Corporation18</p>
    <p>1: Eliminate queries that hit the local DNS resolver cache.</p>
    <p>- Model local DNS resolver cache (requires reply TTLs).</p>
    <p>2: Eliminate uninteresting queries.</p>
    <p>- Non-existent top-level domains (Mozilla effective TLD list).</p>
    <p>- Local/sister/reserved domains and (PTR) address ranges.</p>
    <p>Input filters Numbers for 1 day of IndLab traffic</p>
    <p>queries</p>
  </div>
  <div class="page">
    <p>2013 IBM Corporation19</p>
    <p>3: Aggregate queries by (client, query name suffix).</p>
    <p>- 1 Query name suffix  1 organization.</p>
    <p>site.com, site.co.uk (Mozilla effective TLD list).</p>
    <p>in-addr.arpa at /16 and /24 boundaries, ip6.arpa at /48.</p>
    <p>Query aggregation by client and organization Numbers for 1 day of IndLab traffic</p>
  </div>
  <div class="page">
    <p>2013 IBM Corporation20</p>
    <p>4: Eliminate (client, name suffix) based on per-day totals.</p>
    <p>- Worst-case Shannon entropies: assume uniform distributions over distinct inter-query time intervals, names, and types.</p>
    <p>- Plus length of distinct query names and types.</p>
    <p>Quick information estimate before data compression Numbers for 1 day of IndLab traffic</p>
  </div>
  <div class="page">
    <p>2013 IBM Corporation21</p>
    <p>5: Eliminate (client, suffix) with too little information.</p>
    <p>- Compressor and codepoint bakeoff.</p>
    <p>- 4 kB bound for targeted environments (individual clients).</p>
    <p>10 kB bound for aggregated query streams.</p>
    <p>Precise information measurement Numbers for 1 day of IndLab traffic</p>
  </div>
  <div class="page">
    <p>2013 IBM Corporation22</p>
    <p>6: Eliminate already-inspected domains.</p>
    <p>- Each flagged query name suffix is inspected only once.</p>
    <p>If a benign domain becomes malicious after inspection:</p>
    <p>- It is a major site (Google, etc.)  we have worse problems. - It keeps mimicking benign behavior  it remains undetected.</p>
    <p>- It exposes itself to signature-based detection.</p>
    <p>Inspected domains list Numbers for 1 day of IndLab traffic</p>
    <p>Investigate</p>
  </div>
  <div class="page">
    <p>2013 IBM Corporation23</p>
    <p>Line 1</p>
    <p>Combined result</p>
    <p>Query timing only</p>
    <p>Query names only</p>
    <p>Query types only</p>
    <p>resolution = 10 msecbound = 4 kB</p>
    <p>A le</p>
    <p>rt s</p>
    <p>/w e</p>
    <p>e k</p>
    <p>Information bound (bytes) Time resolution (msec)</p>
    <p>Alert rate sensitivity to parameter settings IndLab data set, 1212 days</p>
  </div>
  <div class="page">
    <p>2013 IBM Corporation24</p>
    <p>Detection breakdown</p>
    <p>N/A01050IPv6 PTR</p>
    <p>AggregatesIndividual clientsDominant source</p>
    <p>N/A32642911IPv4 PTR</p>
    <p>SIEChinaUCBNERSCLBLIndLabSite</p>
  </div>
  <div class="page">
    <p>2013 IBM Corporation25</p>
    <p>Conclusion</p>
    <p>Novel procedure to measure the information content of DNS query streams.</p>
    <p>1-2 Alerts/week for enterprise-scale networks.</p>
    <p>- 4 kbytes/day threshold per local client and remote domain.</p>
    <p>- Lossless compression, no false negatives.</p>
    <p>59 Confirmed DNS tunnels in 230B queries.</p>
    <p>- All conventional name-content based.</p>
  </div>
</Presentation>
