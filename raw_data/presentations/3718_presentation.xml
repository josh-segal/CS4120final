<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>National Security Institute</p>
    <p>Radu Sion</p>
    <p>Horizontal Privilege Escalation in Trusted Applications</p>
    <p>Darius Suciu Stephen McLaughlin Laurent Simon</p>
  </div>
  <div class="page">
    <p>Hooper</p>
    <p>National Security Institute</p>
    <p>Background: Bugs over time</p>
    <p>Linux lines of code over time Linux vulnerabilities over time</p>
    <p>Source: Meng, Dan, et al. &quot;Security-first architecture: deploying physically isolated active security processors for safeguarding the future of computing.&quot;</p>
    <p>Source: https://commons.wikimedia.org/wiki/File:Lines_of_Code_Linux_Kernel.svg</p>
  </div>
  <div class="page">
    <p>Hooper</p>
    <p>National Security Institute</p>
    <p>Normal World</p>
    <p>Applications</p>
    <p>App App</p>
    <p>App</p>
    <p>Background: TrustZone</p>
    <p>Secure World</p>
    <p>Secure OS</p>
    <p>Rich Operating</p>
    <p>System</p>
    <p>ARM Cortex Processor</p>
    <p>Monitor</p>
    <p>Trusted Applications</p>
    <p>TATAApp</p>
  </div>
  <div class="page">
    <p>Hooper</p>
    <p>National Security Institute</p>
    <p>Background: TrustZone Attacks</p>
    <p>Secure World</p>
    <p>Secure OS</p>
    <p>Normal World</p>
    <p>Rich Operating</p>
    <p>System</p>
    <p>Applications</p>
    <p>ARM Cortex Processor</p>
    <p>Monitor</p>
    <p>Trusted Applications</p>
    <p>TAApp</p>
    <p>App App</p>
    <p>TAAppApp</p>
    <p>Privilege escalation</p>
  </div>
  <div class="page">
    <p>Hooper</p>
    <p>National Security Institute</p>
    <p>Background: Boomerang[1] attack</p>
    <p>Secure World</p>
    <p>Secure OS</p>
    <p>Normal World</p>
    <p>Rich Operating</p>
    <p>System</p>
    <p>Applications</p>
    <p>ARM Cortex Processor</p>
    <p>App App</p>
    <p>Monitor</p>
    <p>Trusted Applications</p>
    <p>TAApp</p>
    <p>App</p>
    <p>App</p>
    <p>App</p>
    <p>TA</p>
    <p>Privilege escalation</p>
    <p>[1] Machiry, Aravind, et al. &quot;BOOMERANG: Exploiting the Semantic Gap in Trusted Execution Environments.&quot; NDSS. 2017.</p>
  </div>
  <div class="page">
    <p>Hooper</p>
    <p>National Security Institute</p>
    <p>Background: Privilege escalation</p>
    <p>Rich Operating System</p>
    <p>Applications</p>
    <p>AppApp AppApp</p>
    <p>Secure Operating System</p>
    <p>Monitor</p>
    <p>Horizontal privilege escalation (HPE)</p>
    <p>V e</p>
    <p>rtica l p</p>
    <p>rivile g</p>
    <p>e e</p>
    <p>sca la</p>
    <p>tio n</p>
  </div>
  <div class="page">
    <p>Hooper</p>
    <p>National Security Institute</p>
    <p>HPE attack using TA</p>
    <p>Secure World</p>
    <p>Secure OS</p>
    <p>Normal World</p>
    <p>Rich Operating</p>
    <p>System</p>
    <p>Applications</p>
    <p>ARM Cortex Processor</p>
    <p>App App</p>
    <p>Monitor</p>
    <p>Trusted Applications</p>
    <p>TAApp</p>
    <p>App</p>
    <p>App</p>
    <p>App</p>
    <p>TA</p>
    <p>Privilege escalation</p>
  </div>
  <div class="page">
    <p>Hooper</p>
    <p>National Security Institute</p>
    <p>Storing data in Secure World</p>
    <p>Secure World</p>
    <p>TA</p>
    <p>Normal World</p>
    <p>App</p>
    <p>A: Write (data)</p>
    <p>B: Store (data)</p>
    <p>Global</p>
    <p>Storage</p>
  </div>
  <div class="page">
    <p>Hooper</p>
    <p>National Security Institute</p>
    <p>Global data attack examples</p>
    <p>Secure World</p>
    <p>TA</p>
    <p>Normal World</p>
    <p>Victim</p>
    <p>App</p>
    <p>Malicious</p>
    <p>App</p>
    <p>Data leakage Data compromise Decryption oracle</p>
    <p>Global</p>
    <p>Secure World</p>
    <p>TA</p>
    <p>Normal World</p>
    <p>Victim</p>
    <p>App</p>
    <p>Malicious</p>
    <p>App</p>
    <p>Global</p>
    <p>Secure World</p>
    <p>TA</p>
    <p>Normal World</p>
    <p>Victim</p>
    <p>App</p>
    <p>Malicious</p>
    <p>App 2: Modify</p>
    <p>(data)</p>
    <p>Global</p>
  </div>
  <div class="page">
    <p>Hooper</p>
    <p>National Security Institute</p>
    <p>Stored data attack examples</p>
    <p>Secure World</p>
    <p>TA1</p>
    <p>Normal World</p>
    <p>Victim</p>
    <p>App</p>
    <p>Malicious</p>
    <p>App</p>
    <p>Data leakage Data compromise Decryption oracle</p>
    <p>Global</p>
    <p>TA2</p>
    <p>Global</p>
    <p>Storage</p>
    <p>Secure World</p>
    <p>TA1</p>
    <p>Normal World</p>
    <p>Victim</p>
    <p>App</p>
    <p>Malicious</p>
    <p>App</p>
    <p>Global</p>
    <p>TA2</p>
    <p>Global</p>
    <p>Storage</p>
    <p>Secure World</p>
    <p>TA1</p>
    <p>Normal World</p>
    <p>Victim</p>
    <p>App</p>
    <p>Malicious</p>
    <p>App</p>
    <p>Global</p>
    <p>TA2</p>
    <p>Global</p>
    <p>Storage</p>
  </div>
  <div class="page">
    <p>Hooper</p>
    <p>National Security Institute</p>
    <p>HPE manual analysis</p>
    <p>HPE enabling vulnerabilities discovered (3 types)</p>
  </div>
  <div class="page">
    <p>Hooper</p>
    <p>National Security Institute</p>
    <p>Findings: vulnerable TAs</p>
    <p>TA group</p>
    <p>N u</p>
    <p>m b</p>
    <p>e r</p>
    <p>in e</p>
    <p>a ch</p>
    <p>g ro</p>
    <p>u p</p>
    <p>Vulnerable Investigated</p>
    <p>Kinibi QSEE Teegris</p>
  </div>
  <div class="page">
    <p>Hooper</p>
    <p>National Security Institute</p>
    <p>Findings: vulnerable TAs</p>
    <p>DRM Key management Attestation Hardware drivers Device integrity Authentication Utility 0</p>
    <p>TA group</p>
    <p>N u</p>
    <p>m b</p>
    <p>e r</p>
    <p>In e</p>
    <p>a ch</p>
    <p>g ro</p>
    <p>u p</p>
    <p>Vulnerable Investigated</p>
    <p>Teegris</p>
    <p>Manual analysis: two engineers, four weeks</p>
  </div>
  <div class="page">
    <p>Hooper</p>
    <p>National Security Institute</p>
    <p>HPE vulnerability impact Data leakage</p>
    <p>Example: Encryption key leaked to attacker</p>
    <p>Data compromise</p>
    <p>Example: Encryption key replaced with attacker data</p>
    <p>Decryption oracle</p>
    <p>Example: DRM content decrypted for malicious app</p>
    <p>Encryption oracle</p>
    <p>Example: Encrypted keys replaced with attacker data</p>
    <p>Signing oracle</p>
    <p>Example: TA signs forged attestation data</p>
  </div>
  <div class="page">
    <p>Hooper</p>
    <p>National Security Institute</p>
    <p>Findings: HPE attack vectors</p>
    <p>HPE attack vectors</p>
    <p>N u</p>
    <p>m b</p>
    <p>e r</p>
    <p>id e</p>
    <p>n ti</p>
    <p>fi e</p>
    <p>d in</p>
    <p>e a</p>
    <p>ch g</p>
    <p>ro u</p>
    <p>p</p>
    <p>DRM Key management Attestation</p>
    <p>Kinibi QSEE Teegris</p>
  </div>
  <div class="page">
    <p>Hooper</p>
    <p>National Security Institute</p>
    <p>Findings: HPE attack vectors</p>
    <p>Key leakage Data compromise Decryption oracle Encryption oracle Signing oracle Total 0</p>
    <p>HPE attack vectors</p>
    <p>N u</p>
    <p>m b</p>
    <p>e r</p>
    <p>id e</p>
    <p>n ti</p>
    <p>fi e</p>
    <p>d in</p>
    <p>e a</p>
    <p>ch g</p>
    <p>ro u</p>
    <p>p</p>
    <p>DRM Key management Attestation</p>
    <p>Teegris</p>
  </div>
  <div class="page">
    <p>Hooper</p>
    <p>National Security Institute</p>
    <p>Hooper: Automatic HPE detection</p>
    <p>Symbolic execution</p>
    <p>State matching</p>
    <p>Vulnerability checking</p>
    <p>Phase 1 Phase 2 Phase 3</p>
    <p>TA binary</p>
    <p>Path semantics</p>
    <p>State inspection</p>
    <p>Bugs found</p>
  </div>
  <div class="page">
    <p>Hooper</p>
    <p>National Security Institute</p>
    <p>Hooper: Cross-invocation tracking SimProceduresTA execution paths</p>
    <p>Basic blocks</p>
    <p>Paired paths using X</p>
    <p>Paired paths using Storage[Y]</p>
    <p>Cross-invocation data flows</p>
    <p>Match global</p>
    <p>variable</p>
    <p>Match storage</p>
    <p>locations</p>
    <p>X = input output = X</p>
    <p>Storage[Y] = input</p>
    <p>output = Storage[Y]</p>
    <p>Entry</p>
    <p>Send output</p>
  </div>
  <div class="page">
    <p>Hooper</p>
    <p>National Security Institute</p>
    <p>Automatic analysis results</p>
    <p>HPE attack vector</p>
    <p>N u</p>
    <p>m b</p>
    <p>e r</p>
    <p>o f</p>
    <p>a tt</p>
    <p>a ck</p>
    <p>v e</p>
    <p>ct o</p>
    <p>rs</p>
    <p>id e</p>
    <p>n ti</p>
    <p>fi e</p>
    <p>dTeegris</p>
    <p>Identified False negatives</p>
    <p>DRM Key management Attestation</p>
  </div>
  <div class="page">
    <p>Hooper</p>
    <p>National Security Institute</p>
    <p>Automatic analysis results</p>
    <p>Data leakage Data compromise Decryption oracle Encryption oracle Signing oracle Total 0</p>
    <p>HPE attack vector</p>
    <p>N u</p>
    <p>m b</p>
    <p>e r</p>
    <p>o f</p>
    <p>a tt</p>
    <p>a ck</p>
    <p>v e</p>
    <p>ct o</p>
    <p>rs</p>
    <p>id e</p>
    <p>n ti</p>
    <p>fi e</p>
    <p>d</p>
    <p>Teegris</p>
    <p>Identified False negatives</p>
    <p>Vulnerabilities found in 24 hours vs 4 weeks of manual analysis</p>
  </div>
  <div class="page">
    <p>Hooper</p>
    <p>National Security Institute</p>
    <p>Mitigations</p>
    <p>Resolve TA multi-tenant interference</p>
    <p>Introduce session management inside all multi-tenant TAs</p>
    <p>Standardized TA session management</p>
    <p>Introduce a library for managing sessions inside TAs</p>
    <p>Fine-grained access to Secure World storage</p>
    <p>Partition Secure World storage and enforce fine-grained access control</p>
    <p>Minimize access to TAs</p>
    <p>Use fine-grained access policies to prevent unauthorized access to TAs</p>
  </div>
  <div class="page">
    <p>Hooper</p>
    <p>National Security Institute</p>
    <p>Conclusion</p>
    <p>Some TAs store data from multiple applications across invocations</p>
    <p>Insufficient access control exposes TA-managed data to attackers</p>
    <p>Three type of HPE-enabling vulnerabilities found in 23 TAs</p>
    <p>Automatic binary analysis can help identify HPE vulnerabilities</p>
    <p>Platform-wide fine-grained access control would help mitigate HPE</p>
  </div>
  <div class="page">
    <p>Hooper</p>
    <p>National Security Institute</p>
    <p>Thank you! Contact information:</p>
    <p>Darius Suciu dsuciu@cs.stonybrook.edu</p>
    <p>Stephen McLaughlin s.mclaughlin@samsung.com</p>
    <p>Laurent Simon cam.lmrs2@gmail.com</p>
    <p>Radu Sion sion@cs.stonybrook.edu</p>
    <p>Questions?</p>
  </div>
</Presentation>
