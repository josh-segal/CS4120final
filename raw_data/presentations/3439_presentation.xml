<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Return Of Bleichenbachers Oracle Threat (ROBOT)</p>
    <p>Hanno Bck</p>
    <p>Juraj Somorovsky (Ruhr University Bochum / Hackmanit)</p>
    <p>Craig Young (Tripwire VERT)</p>
  </div>
  <div class="page">
    <p>Recent Attacks on TLS</p>
    <p>CRIME, BEAST, Lucky 13, Heartbleed, Early CCS</p>
    <p>20 years ago: Bleichenbachers attack  Applied to RSA PKCS#1 v1.5 in SSL/TLS  Decrypt SSL/TLS traffic  Implementations applied ad-hoc fixes  Everything is secure, right?</p>
    <p>Return of Bleichenbachers Oracle Threat  ROBOT*</p>
    <p>* Name idea shamelessly stolen from ROCA</p>
    <p>Return Of Bleichenbachers Oracle Threat (ROBOT). USENIX Security 2018 2</p>
  </div>
  <div class="page">
    <p>Overview</p>
    <p>Designed by Ange Albertini</p>
    <p>Return Of Bleichenbachers Oracle Threat (ROBOT). USENIX Security 2018 3</p>
  </div>
  <div class="page">
    <p>TLS Protocol (High Level Overview)</p>
    <p>Key exchange: RSA, (EC)DH, (EC)DHE</p>
    <p>Return Of Bleichenbachers Oracle Threat (ROBOT). USENIX Security 2018 4</p>
  </div>
  <div class="page">
    <p>TLS RSA Handshake</p>
    <p>Return Of Bleichenbachers Oracle Threat (ROBOT). USENIX Security 2018 5</p>
    <p>ClientHello</p>
    <p>ServerHello</p>
    <p>Certificate</p>
    <p>ServerHelloDone</p>
    <p>ChangeCipherSpec</p>
    <p>(Client-) Finished</p>
    <p>ChangeCipherSpec</p>
    <p>(Server-) Finished</p>
    <p>ClientKeyExchange</p>
    <p>RSA encrypted premaster secret</p>
    <p>ClientKeyExchange</p>
  </div>
  <div class="page">
    <p>RSA PKCS#1 v1.5</p>
    <p>Used to pad and encrypt the premaster secret:  To pad it to the RSA key length</p>
    <p>To add randomization</p>
    <p>Example for TLS 1.2:</p>
    <p>Return Of Bleichenbachers Oracle Threat (ROBOT). USENIX Security 2018 6</p>
    <p>Encryption block type</p>
    <p>TLS 1.2 version (Dont ask why, a different story)</p>
    <p>[non-zero padding] [secret]</p>
  </div>
  <div class="page">
    <p>Bleichenbachers Attack</p>
    <p>1998: Adaptive chosen-ciphertext attack</p>
    <p>Exploits strict RSA PKCS#1 v1.5 padding validation</p>
    <p>Return Of Bleichenbachers Oracle Threat (ROBOT). USENIX Security 2018 7</p>
    <p>C1</p>
    <p>valid/invalid</p>
    <p>M = Dec(C)</p>
    <p>C2</p>
    <p>valid/invalid</p>
    <p>Ciphertext C</p>
    <p>Starts with 00 02 ?</p>
  </div>
  <div class="page">
    <p>Bleichenbachers Attack</p>
    <p>The attack needs some math (Not going into details here)</p>
    <p>Million message attack</p>
    <p>(In general performance depends on the oracle properties)</p>
    <p>Return Of Bleichenbachers Oracle Threat (ROBOT). USENIX Security 2018 8</p>
  </div>
  <div class="page">
    <p>Creating Bleichenbachers Oracle</p>
    <p>Return Of Bleichenbachers Oracle Threat (ROBOT). USENIX Security 2018 9</p>
    <p>ClientHello</p>
    <p>ServerHello</p>
    <p>Certificate</p>
    <p>ServerHelloDone</p>
    <p>ClientKeyExchange</p>
    <p>Server</p>
    <p>Decrypt</p>
    <p>Error</p>
    <p>ChangeCipherSpec</p>
    <p>(Client-) Finished:</p>
    <p>Bad Record</p>
    <p>MAC Alert /</p>
    <p>Modified ciphertext</p>
  </div>
  <div class="page">
    <p>TLS Countermeasure</p>
    <p>Return Of Bleichenbachers Oracle Threat (ROBOT). USENIX Security 2018 10</p>
    <p>ClientHello</p>
    <p>ServerHello</p>
    <p>Certificate</p>
    <p>ServerHelloDone</p>
    <p>Alert</p>
    <p>ChangeCipherSpec</p>
    <p>(Client-) Finished:</p>
    <p>If the attacker can distinguish valid / invalid PKCS#1 messages, he wins</p>
    <p>ClientKeyExchange</p>
  </div>
  <div class="page">
    <p>Overview</p>
    <p>Designed by Ange Albertini</p>
    <p>Return Of Bleichenbachers Oracle Threat (ROBOT). USENIX Security 2018 11</p>
  </div>
  <div class="page">
    <p>Hanno Found a Weird Behavior of Facebook</p>
    <p>Return Of Bleichenbachers Oracle Threat (ROBOT). USENIX Security 2018 12</p>
    <p>ClientHello</p>
    <p>ServerHello</p>
    <p>Certificate</p>
    <p>ServerHelloDone</p>
    <p>Server</p>
    <p>Illegal</p>
    <p>Parameter</p>
    <p>ChangeCipherSpec</p>
    <p>(Client-) Finished:</p>
    <p>Bad Record</p>
    <p>MAC Alert /</p>
    <p>ClientKeyExchange</p>
  </div>
  <div class="page">
    <p>Can We Exploit It?</p>
    <p>Idea: It would be funny to sign a message with Facebooks private key  Yes, signing is possible as well</p>
    <p>Millions of queries neededwould Facebook block us?</p>
    <p>Successful after several tries:</p>
    <p>We hacked Facebook with a</p>
    <p>Bleichenbacher Oracle (JS/HB).</p>
    <p>Facebook fixed</p>
    <p>Return Of Bleichenbachers Oracle Threat (ROBOT). USENIX Security 2018 13</p>
  </div>
  <div class="page">
    <p>Facebook: New Attempt</p>
    <p>Return Of Bleichenbachers Oracle Threat (ROBOT). USENIX Security 2018 14</p>
    <p>ClientHello</p>
    <p>ServerHello</p>
    <p>Certificate</p>
    <p>ServerHelloDone</p>
    <p>Server</p>
    <p>ChangeCipherSpec</p>
    <p>(Client-) Finished:</p>
    <p>/</p>
    <p>ClientKeyExchange</p>
  </div>
  <div class="page">
    <p>Facebook Fixed Again</p>
    <p>This is interesting. So how about other servers?</p>
    <p>Return Of Bleichenbachers Oracle Threat (ROBOT). USENIX Security 2018 15</p>
  </div>
  <div class="page">
    <p>Overview</p>
    <p>Designed by Ange Albertini</p>
    <p>Return Of Bleichenbachers Oracle Threat (ROBOT). USENIX Security 2018 16</p>
  </div>
  <div class="page">
    <p>Lets Start Scanning</p>
    <p>Careful selection of ClientKeyExchange messages:  Wrong TLS version</p>
    <p>Wrong padding length</p>
    <p>Not starting with 0x00 02</p>
    <p>Full / Shortened TLS handshakes:</p>
    <p>Return Of Bleichenbachers Oracle Threat (ROBOT). USENIX Security 2018 17</p>
    <p>ClientHello</p>
    <p>ServerHello</p>
    <p>Certificate</p>
    <p>ServerHelloDone</p>
    <p>ChangeCipherSpec</p>
    <p>(Client-) Finished:</p>
    <p>ClientKeyExchange</p>
    <p>ClientHello</p>
    <p>ServerHello</p>
    <p>Certificate</p>
    <p>ServerHelloDone</p>
    <p>ChangeCipherSpec</p>
    <p>(Client-) Finished:</p>
    <p>ClientKeyExchange</p>
  </div>
  <div class="page">
    <p>Alexa Top 1 Million Scan</p>
    <p>2,8 % vulnerable</p>
    <p>PayPal, Apple, ebay, Cisco,</p>
    <p>Different behaviorsdifferent combinations:</p>
    <p>Return Of Bleichenbachers Oracle Threat (ROBOT). USENIX Security 2018 18</p>
    <p>Illegal</p>
    <p>Parameter</p>
    <p>Bad Record</p>
    <p>MAC Alert /</p>
    <p>TCP connection resets Timeouts</p>
    <p>Different alerts</p>
    <p>Duplicate alerts Alert/Alert Alert</p>
    <p>Handshake</p>
    <p>Failure / Internal</p>
    <p>Error / /..</p>
  </div>
  <div class="page">
    <p>Overview</p>
    <p>Designed by Ange Albertini</p>
    <p>Return Of Bleichenbachers Oracle Threat (ROBOT). USENIX Security 2018 19</p>
  </div>
  <div class="page">
    <p>Who Is Responsible for These Mistakes?</p>
    <p>Reporting is not always that easy</p>
    <p>Return Of Bleichenbachers Oracle Threat (ROBOT). USENIX Security 2018 20</p>
    <p>Your server is vulnerable to Bleichenbachers attack.</p>
    <p>No worries, we use millitary grade encryption.</p>
  </div>
  <div class="page">
    <p>Dont Fix for Some Vendors  Cisco ACE</p>
    <p>Supports only TLS RSA</p>
    <p>Cisco: We won't fix it, it's out of support for several years</p>
    <p>But there were plenty of webpages still running with these devices</p>
    <p>Like cisco.com</p>
    <p>Return Of Bleichenbachers Oracle Threat (ROBOT). USENIX Security 2018 21</p>
  </div>
  <div class="page">
    <p>Identified (Most of) Them</p>
    <p>Return Of Bleichenbachers Oracle Threat (ROBOT). USENIX Security 2018 22</p>
  </div>
  <div class="page">
    <p>Test Tools</p>
    <p>No easily usable test tool for Bleichenbacher attacks available</p>
    <p>Currently implemented in SSL Labs, testssl.sh, TLS-Attacker, tlsfuzzer</p>
    <p>Return Of Bleichenbachers Oracle Threat (ROBOT). USENIX Security 2018 23</p>
  </div>
  <div class="page">
    <p>Overview</p>
    <p>Designed by Ange Albertini</p>
    <p>Return Of Bleichenbachers Oracle Threat (ROBOT). USENIX Security 2018 24</p>
  </div>
  <div class="page">
    <p>Future Work</p>
    <p>Timing attacks</p>
    <p>Fingerprinting</p>
    <p>Some servers send certificates or &quot;garbage bytes&quot;  Bleedinbacher? There could be a Heartbleed-style memory disclosure waiting</p>
    <p>to be found</p>
    <p>Return Of Bleichenbachers Oracle Threat (ROBOT). USENIX Security 2018 25</p>
    <p>Illegal</p>
    <p>Parameter</p>
    <p>Bad Record</p>
    <p>MAC Alert / /..</p>
  </div>
  <div class="page">
    <p>Conclusions</p>
    <p>Old 20 year attacks still work</p>
    <p>New side-channels (timeouts, TCP resets, )</p>
    <p>Crypto attack countermeasures are hard to apply</p>
    <p>Disable TLS_RSA cipher suites (not used in TLS 1.3)</p>
    <p>Stop using RSA PKCS#1 v1.5, use elliptic curves</p>
    <p>(or RSA-OAEP if RSA needed)</p>
    <p>https://robotattack.org/</p>
    <p>Return Of Bleichenbachers Oracle Threat (ROBOT). USENIX Security 2018 26</p>
  </div>
</Presentation>
