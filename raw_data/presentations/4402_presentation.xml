<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Characterizing the Internet Hierarchy Characterizing the Internet Hierarchy from Multiple Vantage Pointsfrom Multiple Vantage Points</p>
    <p>Jennifer Rexford Internet and Networking Systems</p>
    <p>AT&amp;T Labs - Research; Florham Park, NJ</p>
    <p>http://www.research.att.com/~jrex</p>
    <p>Work with L. Subramanian, S. Agarwal, and R. Katz http://www.cs.berkeley.edu/~sagarwal/research/BGP-hierarchy/</p>
  </div>
  <div class="page">
    <p>OutlineOutline  Internet architecture</p>
    <p>ASes, IP addressing, BGP routing, and AS relationships  Type-of-relationship problem</p>
    <p>Motivation, formulation, and practical challenges  Analyzing partial views of the AS graph</p>
    <p>Assigning a rank to each AS from a single vantage point  Comparing ranks of ASes across multiple vantage points</p>
    <p>Analysis results  BGP routing data and inferred AS relationships  AS paths that are inconsistent with the inferences  Five-level classification of the Internet hierarchy</p>
    <p>Conclusions</p>
  </div>
  <div class="page">
    <p>Internet ArchitectureInternet Architecture  Divided into Autonomous Systems</p>
    <p>Distinct regions of administrative control (~11,000)  Set of routers and links managed by a single institution  Service provider, company, university,</p>
    <p>Hierarchy of Autonomous Systems  Large, tier-1 provider with a nationwide backbone  Medium-sized regional provider with smaller backbone  Small stub network run by a company or university</p>
    <p>Interaction between Autonomous Systems  Internal topology is not shared between ASes   but, neighboring ASes interact to coordinate routing</p>
  </div>
  <div class="page">
    <p>Autonomous Systems (ASes)Autonomous Systems (ASes)</p>
    <p>Client Web server</p>
    <p>Path: 6, 5, 4, 3, 2, 1</p>
  </div>
  <div class="page">
    <p>IP Addressing and PrefixesIP Addressing and Prefixes</p>
    <p>32 bits in dotted-quad notation (12.34.158.5)</p>
    <p>Divided into network and host portions</p>
    <p>12.34.158.0/23 is a 23-bit prefix with 29 addresses</p>
    <p>Network (23 bits) Host (9 bits)</p>
  </div>
  <div class="page">
    <p>Interdomain Routing with BGP (Between ASes)Interdomain Routing with BGP (Between ASes)</p>
    <p>ASes announce info about prefixes they can reach  Local policies for path selection (which to use?)  Local policies for route propagation (who to tell?)  Policies configured by the ASs network operator</p>
    <p>I can reach 12.34.158.0/23</p>
    <p>I can reach 12.34.158.0/23 via AS 1</p>
  </div>
  <div class="page">
    <p>Customer-Provider RelationshipCustomer-Provider Relationship</p>
    <p>Customer pays provider for access to the Internet  AS exports customers routes to all neighbors  AS exports providers routes only to its customers</p>
    <p>d customer</p>
    <p>provider</p>
    <p>Traffic to the customer</p>
    <p>d provider</p>
    <p>customer</p>
    <p>Traffic from the customer</p>
    <p>advertisements</p>
    <p>traffic</p>
  </div>
  <div class="page">
    <p>Peer-Peer RelationshipPeer-Peer Relationship</p>
    <p>Peers exchange traffic between their customers  Free of charge (assumption of even traffic load)  AS exports a peers routes only to its customers</p>
    <p>peerpeer</p>
    <p>Traffic to/from the peer and its customers</p>
    <p>d</p>
    <p>advertisements</p>
    <p>traffic</p>
  </div>
  <div class="page">
    <p>AS Relationships MatterAS Relationships Matter  Motivating problems</p>
    <p>Placement of servers for content distribution network  Selection of new peers or providers for an AS  Analyzing the convergence properties of the BGP protocol  Installing route filters to protect against misconfiguration  Understanding of the basic structure of the Internet</p>
    <p>Knowing the AS graph is not enough  Interdomain routing is not shortest-path routing  Some paths not allowed (e.g., transit through a peer)  Local preference of paths (e.g., prefer customer path)  Node degree does not define the Internet hierarchy</p>
    <p>Need to know the relationship between AS pairs</p>
  </div>
  <div class="page">
    <p>Inferring Relationships from Routing DataInferring Relationships from Routing Data</p>
    <p>Practical realities of the Internet  AS graph is not known  AS relationships are proprietary   at least some routing data is publicly available!</p>
    <p>Exploiting routing data  Available via traceroute experiments or BGP tables  Provides a set of AS paths, such as 701 7018 46  Implies existence of edges (701, 7018) and (7018, 46)  Implies that 7018 (AT&amp;T) allows AS 701 (UUNet) to</p>
    <p>transit to AS 46 (Rutgers)</p>
  </div>
  <div class="page">
    <p>Valid and Invalid PathsValid and Invalid Paths</p>
    <p>AS relationships limit the kinds of valid paths  Uphill portion: customer-provider relationships</p>
    <p>Plateau: zero or one peer-peer edge</p>
    <p>Downhill portion: provider-customer relationships</p>
    <p>Valid Invalid</p>
    <p>Invalid</p>
    <p>Lixin Gao, On inferring Autonomous System relationships in the Internet, IEEE/ACM Transactions on Networking, December 2001.</p>
  </div>
  <div class="page">
    <p>Type-of-Relationship ProblemType-of-Relationship Problem</p>
    <p>Given the inputs  AS graph G(V,E) with vertices V and edges E  Set of paths P on the graph G</p>
    <p>Find a solution that  Labels each edge with an AS relationship  Minimizes the number of invalid paths in P</p>
    <p>Properties of the problem  NP complete (?)  May have multiple solutions  We propose a heuristic algorithm</p>
  </div>
  <div class="page">
    <p>Practical ChallengesPractical Challenges  Peer-peer relationships are hard to infer</p>
    <p>Mislabeling a peer-peer edge as provider-customer does not change a valid path into an invalid path</p>
    <p>We use heuristics to detect the peer-peer edges</p>
    <p>Some AS pairs have unusual relationships  Sibling ASes that provide transit service for each other</p>
    <p>Backup relationship for connectivity under failure</p>
    <p>Misconfiguration of a conventional AS relationship</p>
    <p>We detect these cases by analyzing the invalid paths</p>
    <p>Getting access to a large path set P is hard  We exploit BGP routing tables from multiple vantage points</p>
  </div>
  <div class="page">
    <p>Validation ApproachesValidation Approaches  Quantify the number of invalid paths</p>
    <p>Small number suggests better results  still, this doesnt mean that inferences are correct</p>
    <p>Compare results with other inference algorithms  Higher confidence if inferences are the same   still, both algorithms could give wrong answers</p>
    <p>Compare results with Routing Arbiter Database  Higher confidence if consistent with RADB routing policies   still, RADB information is incomplete and out-of-date</p>
    <p>Compare results with proprietary ISP data  Higher confidence if answers are correct for this AS   still, answers may be wrong for other ASes</p>
  </div>
  <div class="page">
    <p>Partial View of the AS GraphPartial View of the AS Graph</p>
    <p>Routing data from a single source AS  Collection of paths starting from the source</p>
    <p>Directed graph from union of all edges in these paths</p>
    <p>Actual graph</p>
    <p>A</p>
    <p>B</p>
    <p>C D</p>
    <p>E</p>
    <p>F</p>
    <p>E</p>
    <p>FD</p>
    <p>C</p>
    <p>B</p>
    <p>A</p>
    <p>B</p>
    <p>AC</p>
    <p>D</p>
    <p>E</p>
    <p>F</p>
  </div>
  <div class="page">
    <p>Assigning Rank to AS in a Partial ViewAssigning Rank to AS in a Partial View  Reverse pruning algorithm to assign rank</p>
    <p>Rank 1 to the leaves, then remove leaves</p>
    <p>Rank 2 to the leaves, then remove leaves</p>
    <p>Single (largest) rank to nodes in connected component, if any E</p>
    <p>FD</p>
    <p>C</p>
    <p>B</p>
    <p>A</p>
    <p>B</p>
    <p>AC</p>
    <p>D</p>
    <p>E</p>
    <p>F1</p>
  </div>
  <div class="page">
    <p>Combining Information From Multiple ViewsCombining Information From Multiple Views</p>
    <p>Vector of ranks for each AS  A single element for each of the n views</p>
    <p>Dominance: provider-customer relationship  Provider has higher ranks than customer in most views  For example, B has (2,5) and A has (1,1)</p>
    <p>Equivalence: peer-peer relationship  Peers have equal ranks in or inconsistent ranks  For example, C has (3,4) and D has (4,3)</p>
    <p>Probabilistic inference  Thresholds to tolerate some variations across the views  E.g., an AS dominates in n-1 views and dominated in 1</p>
  </div>
  <div class="page">
    <p>Applying Our AlgorithmApplying Our Algorithm</p>
    <p>Applying the algorithm to ten public BGP tables  RouteViews table and nine Looking Glass servers  Extracted set of unique paths P for each view  Applied reverse pruning algorithm to each view  Applied inference rules to the vectors of ranks</p>
    <p>Results of the analysis on data from April 2001  AS graph with 10,698 ASes and 23,935 edges  Inferences were made for 99.2% of the edges  94.5% provider-customer and 4.7% peer-peer edges  Most inferences do not require the probabilistic rules</p>
  </div>
  <div class="page">
    <p>Advantage of Multiple Vantage PointsAdvantage of Multiple Vantage Points  A single vantage point is not enough</p>
    <p>15% of the edges appear in exactly one BGP table</p>
    <p>Only 25% of the edges appear in all ten BGP tables</p>
  </div>
  <div class="page">
    <p>Analyzing Invalid PathsAnalyzing Invalid Paths</p>
    <p>Checking the validity of inferences  Assume the relationship inferences are correct  Identify paths that are invalid under these inferences  Compute the number of invalid paths  Investigate common anomaly triples (A, B, C)</p>
    <p>Results of our analysis  Applied to paths in 2 of the original 10 BGP tables  Applied to paths in 4 other BGP tables  0.5-3% of paths are invalid for five of the six tables  8.7% of paths are invalid for the KDDI table</p>
  </div>
  <div class="page">
    <p>Common Anomaly PatternsCommon Anomaly Patterns</p>
    <p>Misconfiguration  (1, 65112, 6461): 65112 is a private AS that should not</p>
    <p>appear between Genuity and AboveNet</p>
    <p>Sibling relationships  (7018, 6841, 3300): Infonet Europe merged with AUCS  (1239, 1740, 7018): Cerfnet was acquired by AT&amp;T  (1239, 8043, 6395): IXC Communications acquired</p>
    <p>SmartNAP and renamed Broadwing</p>
    <p>Heuristic for identifying sibling relationships  AS pair that appears in a large number of invalid paths  Our analysis identified 22 possible sibling relationships</p>
  </div>
  <div class="page">
    <p>Digression: Really Weird Invalid PathsDigression: Really Weird Invalid Paths</p>
    <p>Properties of the path  Two tier-1 U.S. providers (Genuity and UUNet)  One service provider in Hong Kong (Hutchinson)  Another tier-1 U.S. provider (AT&amp;T) at the end of the path</p>
    <p>Looking at internal AT&amp;T configuration data  AT&amp;T does not have a BGP session with AS 9304  AT&amp;T does not originate the prefixes (e.g., 152.141.116.0/24)</p>
    <p>Explanation  Another AS was using the AT&amp;T AS number (for over a year!)  We sent them an e-mail and asked them to stop, and they did</p>
    <p>Genuity UUNet Hutchinson AT&amp;T</p>
  </div>
  <div class="page">
    <p>Digression: How Could This Happen, and Persist?Digression: How Could This Happen, and Persist?  BGP configuration is done locally by neighbors</p>
    <p>Customer configures its router with AS number 7018  Provider configures its router with neighbor of 7018</p>
    <p>The misconfiguration didnt necessarily cause a problem  Hop-by-hop routing took the traffic to the right place  Most BGP policies dont look at the identity of the ASes</p>
    <p>Could have caused a problem: route filtering  Large providers might applying filtering to customer routers  Discard routes with other large providers in the path</p>
    <p>Could have caused a problem: loop detection  The bogus routes did not appear in AT&amp;Ts routing tables  AT&amp;T router saw 7018 in the path and discarded the route  AT&amp;T router did have a route for the supernet (152.141.0.0/16)</p>
  </div>
  <div class="page">
    <p>AS ClassificationAS Classification  Directed AS graph</p>
    <p>Directed edge from provider to customer  Bidirectional edge between two peers</p>
    <p>Lowest level: Stubs  Leaf nodes: no peers or downstream customers  8898 of the 10915 ASes (82.5% of ASes)  Ex: UC Berkeley (25), AT&amp;T Labs (6431), and INRIA (1300)</p>
    <p>Next lowest level: Regional ISPs  Leaf nodes after successive pruning of leaf nodes  971 ASes of the 10915 ASes (8.9% of ASes)  Ex: PacBell (5676), US West (6223), and UUNET Canada (815)</p>
    <p>Remaining 1046 ASes: Core</p>
  </div>
  <div class="page">
    <p>Dense CoreDense Core  Ways to classify so-called tier-1 ASes</p>
    <p>Any AS with no upstream provider (98 such nodes)  AS set that forms the largest clique of peer edges (13 nodes)</p>
    <p>Relaxing the definition  Tolerate some missing or misclassified edges  Tolerate some ASes with sibling relationships</p>
    <p>Almost a clique  Subgraph of m nodes with in and out degree at least m/2  Greedy algorithm for locating the largest near-clique</p>
    <p>20 ASes in the near-clique  15 of the ASes form a subgraph just 3 edges short of a clique  Genuity, Sprint, UUNET, AT&amp;T, Verio, Level3, C&amp;W,</p>
  </div>
  <div class="page">
    <p>Transit and Outer CoreTransit and Outer Core</p>
    <p>Transit core  ASes that peer with the dense core and each other  Notion of a weak in-way cut to isolate these ASes  Algorithm for identifying the ASes in transit core  129 ASes, including top providers in Europe and Asia  Ex: UUNET Europe, KDDI, and Singapore Telecom</p>
    <p>Outer core  All of the remaining ASes in the core  897 ASes, including large regional and national ISPs  Ex: Turkish Telecom and Minnesota Regional Network</p>
  </div>
  <div class="page">
    <p>Node Degree is Not EnoughNode Degree is Not Enough  Node degree ignores relationships</p>
    <p>A stub AS may have many upstream providers  A core AS may have a small number of peers  Some ASes have customers that dont have AS numbers</p>
  </div>
  <div class="page">
    <p>Related WorkRelated Work  AS graph characterization</p>
    <p>Constructing graph from BGP tables or traceroute experiments</p>
    <p>Characterizing the topological properties of the graph</p>
    <p>Inferring AS relationships (Lixin Gao)  Identifies the key properties of paths (uphill, downhill, etc.)</p>
    <p>Heuristic using node degree to infer boundary point between the uphill and downhill portions of the path</p>
    <p>Application of the algorithm using RouteViews routing table</p>
    <p>Characterization of the hierarchy of ASes  Early work by Govindan/Reddy based on node degree</p>
    <p>Recent work by Ge et al based on AS relationships</p>
  </div>
  <div class="page">
    <p>ConclusionsConclusions</p>
    <p>Inferring AS relationships  Reverse pruning to assign rank to each AS  Comparison of ranks from different vantage points</p>
    <p>Performance evaluation  Application of algorithm to collection of ten BGP tables  Exploration of the anomalies that cause invalid paths</p>
    <p>Characterization of Internet hierarchy  Stub, regional ISP, outer core, transit core, &amp; dense core  Algorithms for identifying the three parts of the core  Application to AS graph inferred from the BGP tables</p>
  </div>
  <div class="page">
    <p>Ongoing WorkOngoing Work</p>
    <p>Classification of siblings  Use anomalous triples (A, B, C) to identify siblings  Group siblings into a single node (with union of edges)  Repeat classification of the AS hierarchy on new graph</p>
    <p>Longitudinal study  Repeat the study over a period of time with new data  Study how AS relationships and hierarchy changes</p>
    <p>Validation of our inference results  Compare to RADB, Lixins results, AT&amp;T data, etc.</p>
    <p>http://www.cs.berkeley.edu/~sagarwal/research/BGP-hierarchy/</p>
  </div>
</Presentation>
