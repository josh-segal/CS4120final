<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>NEEDLES IN A HAYSTACK: MINING INFORMATION FROM PUBLIC DYNAMIC SANDBOXES FOR MALWARE</p>
    <p>INTELLIGENCE</p>
    <p>Mariano Graziano, Davide Canali, Leyla Bilge, Andrea Lanzi and Davide Balzarotti</p>
    <p>Eurecom Symantec Research Labs</p>
    <p>Universit degli Studi di Milano</p>
    <p>USENIX Security 15 - Washington DC, USA</p>
  </div>
  <div class="page">
    <p>A PILE OF MALWARE SAMPLES</p>
  </div>
  <div class="page">
    <p>CAMPAIGN TIME BEFORE PUBLIC DISCLOSURE SUBMITTED BY</p>
    <p>Operation Aurora 4 months US</p>
    <p>Red October 8 months Romania</p>
    <p>APT1 43 months US</p>
    <p>Stuxnet 1 month US</p>
    <p>Beebus 22 months Germany</p>
    <p>LuckyCat 3 months US</p>
    <p>BrutePOS 5 months France</p>
    <p>NetTraveller 14 months US</p>
    <p>Pacific PluX 12 months US</p>
    <p>Pitty Tiger 42 months US</p>
    <p>Regin 44 months UK</p>
    <p>Equation 23 months US</p>
  </div>
  <div class="page">
    <p>Constant interaction criminals vs sandbox</p>
  </div>
  <div class="page">
    <p>GOAL</p>
    <p>Observation: Malware authors use public sandboxes to test their developments</p>
    <p>Design data mining techniques to automatically discover malware developments</p>
  </div>
  <div class="page">
    <p>SYSTEM OVERVIEW</p>
  </div>
  <div class="page">
    <p>SYSTEM OVERVIEW</p>
  </div>
  <div class="page">
    <p>DATA REDUCTION</p>
    <p>Initial Dataset</p>
  </div>
  <div class="page">
    <p>DATA REDUCTION</p>
    <p>Submitted by regular users</p>
  </div>
  <div class="page">
    <p>DATA REDUCTION</p>
    <p>Not already part of large submissions</p>
  </div>
  <div class="page">
    <p>DATA REDUCTION</p>
    <p>Previously unknown by Symantec &amp; VirusTotal</p>
  </div>
  <div class="page">
    <p>DATA REDUCTION</p>
    <p>Final (not packed binary)</p>
  </div>
  <div class="page">
    <p>SYSTEM OVERVIEW</p>
  </div>
  <div class="page">
    <p>CLUSTERING  Agglomerative clustering (similarity threshold: 70%):</p>
    <p>Binary similarity (ssdeep)</p>
    <p>Submissions metadata</p>
    <p>Sliding window of seven days:</p>
    <p>Reduce comparisons</p>
    <p>Ensure binary similarity</p>
    <p>5972 clusters 4.5 elements each</p>
  </div>
  <div class="page">
    <p>SYSTEM OVERVIEW</p>
  </div>
  <div class="page">
    <p>FINE-GRAINED ANALYSIS</p>
    <p>Binary code normalisation</p>
    <p>Call graph comparison [Flake04,Gao08]</p>
    <p>Control flow graph comparison [Flake04,Kruegel06,Jang13]</p>
  </div>
  <div class="page">
    <p>SYSTEM OVERVIEW</p>
  </div>
  <div class="page">
    <p>FEATURE EXTRACTION</p>
    <p>Comprise two phases:</p>
    <p>Per sample (25 features in 6 groups)</p>
    <p>Per cluster (48 features in 5 groups)</p>
  </div>
  <div class="page">
    <p>SAMPLE FEATURES</p>
  </div>
  <div class="page">
    <p>CLUSTER FEATURES</p>
  </div>
  <div class="page">
    <p>CLUSTER FEATURES</p>
  </div>
  <div class="page">
    <p>CLUSTER FEATURES</p>
    <p>UNKOWN UNKOWN</p>
    <p>MALICIOUS</p>
  </div>
  <div class="page">
    <p>CLUSTER FEATURES</p>
    <p>COMPLEX BEHAVIOR</p>
    <p>COMPLEX BEHAVIOR</p>
    <p>NO BEHAVIOR</p>
  </div>
  <div class="page">
    <p>SYSTEM OVERVIEW</p>
  </div>
  <div class="page">
    <p>MACHINE LEARNING</p>
    <p>Logistic Model Tree (LMT)</p>
    <p>Training Set (157 clusters):</p>
    <p>Non development: 91 clusters</p>
    <p>Development: 66 clusters</p>
  </div>
  <div class="page">
    <p>RESULTS  3038 potential development clusters  1474 malicious clusters  135 days on average for the detection  Thousands of computers infected in 13 countries</p>
    <p>CLUSTERS TYPE 1082 Trojans</p>
  </div>
  <div class="page">
    <p>EXAMPLES</p>
  </div>
  <div class="page">
    <p>ANTI-SANDBOX</p>
    <p>t</p>
    <p>Submission time</p>
    <p>Compile time</p>
    <p>Sample 1Sample 1 Sample 2 Sample 3</p>
    <p>Un kn</p>
    <p>ow n</p>
    <p>Un kn</p>
    <p>ow n</p>
    <p>M ali</p>
    <p>cio us</p>
  </div>
  <div class="page">
    <p>ANTI-SANDBOX</p>
    <p>t</p>
    <p>Submission time</p>
    <p>Compile time</p>
    <p>Sample 1Sample 1 Sample 2 Sample 3</p>
    <p>Un kn</p>
    <p>ow n</p>
    <p>Un kn</p>
    <p>ow n</p>
    <p>M ali</p>
    <p>cio us</p>
  </div>
  <div class="page">
    <p>TROJAN DROPPER</p>
    <p>SUBMISSION TIME</p>
    <p>COMPILE TIME</p>
    <p>DELPHI VB</p>
  </div>
  <div class="page">
    <p>TROJAN DROPPER</p>
    <p>SUBMISSION TIME</p>
    <p>COMPILE TIME</p>
    <p>DELPHI VB</p>
    <p>VirusTotal: 37/50 (trojan dropper)</p>
    <p>Two IP addresses:</p>
    <p>Dynamic DNS service (no-ip)</p>
    <p>Connect-back behavior overall 1817 clusters</p>
  </div>
  <div class="page">
    <p>LIMITATIONS</p>
    <p>No packed binaries</p>
    <p>Evasions:</p>
    <p>Sandbox interaction still required to develop evasion techniques</p>
    <p>Most sophisticated analysis techniques require to link a probe to the final malware</p>
  </div>
  <div class="page">
    <p>CONCLUSION</p>
  </div>
  <div class="page">
    <p>THE END</p>
    <p>THANK YOU graziano@eurecom.fr</p>
    <p>magrazia@cisco.com</p>
    <p>@emd3l</p>
  </div>
</Presentation>
