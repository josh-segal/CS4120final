<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Lock It and S,ll Lose It - On the (In)Security of Automo,ve Remote</p>
    <p>Keyless Entry Systems</p>
    <p>Flavio D. Garcia1, David Oswald1, Timo Kasper2 and Pierre Pavlids1</p>
  </div>
  <div class="page">
    <p>Remote Keyless Entry (RKE)  AcGve UHF transmiHer</p>
    <p>(315 / 433 / 868 MHz)  UnidirecGonal  SomeGmes integrated</p>
    <p>with immobilizer chip (hybrid), someGmes separate</p>
    <p>Immobilizer (Immo)  Passive RFID at 125 kHz  Many broken systems</p>
    <p>(DST40, Hitag2, Megamos)</p>
  </div>
  <div class="page">
    <p>History of RKE: Fix Codes</p>
    <p>uid, btn</p>
    <p>Eavesdropping and replay from 10  100 m</p>
  </div>
  <div class="page">
    <p>History of RKE: Rolling Codes</p>
    <p>uid, encK(ctr, btn)</p>
    <p>uid, encK(ctr + 1, btn)</p>
    <p>uid, encK(ctr + 2, btn)</p>
    <p>ctr</p>
    <p>Decrypt ctr if (ctr &lt; ctr &lt; ctr + )</p>
    <p>ctr := ctr open / close</p>
    <p>ctr +</p>
    <p>validity window</p>
  </div>
  <div class="page">
    <p>History of RKE: Rolling Codes</p>
    <p>ctr incremented on each buHon press, replay fails</p>
    <p>uid, encK(ctr, btn)</p>
  </div>
  <div class="page">
    <p>History of RKE: Rolling Codes</p>
    <p>OpGon 1: AHack key management OpGon 2: AHack crypto</p>
    <p>uid, encK(ctr, btn)</p>
  </div>
  <div class="page">
    <p>Previous AHacks on RKE</p>
    <p>2007: Cryptanalysis of KeeLoq garage door openers (216 plaintext/ciphertext pairs) by Biham et al.</p>
    <p>2008: Side-channel aHack on KeeLoq key diversificaGon (Eisenbarth et al.)</p>
    <p>2010: Relay aHacks on passive keyless entry systems (Francillon et al.)</p>
    <p>2014: Cesare: aHack on 2000  05 vehicle  2015: RollJam by Spencerwhyte / Kamkar</p>
    <p>(had been proposed before, does not apply to most modern vehicles since buHon is authenGcated)</p>
  </div>
  <div class="page">
    <p>Part 1: The VW Group System</p>
  </div>
  <div class="page">
    <p>VW Group RKE</p>
    <p>&gt; 10% worldwide market share  Immobilizer (Megamos) and RKE separate for most vehicles</p>
    <p>Proprietary RKE system, mostly 434.4 MHz  We analyzed vehicles between ~2000 and today  Four main schemes (VW-1  VW-4) studied</p>
  </div>
  <div class="page">
    <p>VW Group RKE: Analysis</p>
    <p>Step 1: Eavesdropping &amp; decoding</p>
  </div>
  <div class="page">
    <p>VW Group RKE: Analysis</p>
    <p>Step 2: Reverse-engineering ECUs</p>
  </div>
  <div class="page">
    <p>Example: VW-3</p>
    <p>AUT64 is a proprietary block cipher, no trivial aHacks known</p>
    <p>but key K3 is the same in all VW-3 vehicles  VW-2: Same cipher, different key  VW-1: Weak crypto (LFSR)</p>
    <p>AUT64K3(uid, ctr, btn), btn</p>
    <p>a0 a1 a2 a3 a4 a5 a6 a7</p>
    <p>Byte permutation</p>
    <p>a0 a1 a2 a3 a4 a5 a6 a7</p>
    <p>a0 a1 a2 a3 a4 a5 a6 a7</p>
    <p>g</p>
  </div>
  <div class="page">
    <p>Example: VW-4</p>
    <p>Used from ~ 2010 onwards  Secure standard cipher: XTEA   but again one worldwide key K4  Adversary can clone remote by eavesdropping a single rolling code</p>
    <p>XTEAK4(uid, ctr, btn), btn</p>
  </div>
  <div class="page">
    <p>VW RKE Demo</p>
  </div>
  <div class="page">
    <p>Affected Vehicles  Audi: A1, Q3, R8, S3, TT, other types of Audi cars</p>
    <p>(e.g. remote control 4D0 837 231)  VW: Amarok, (New) Beetle, Bora, Caddy, Craver, e-Up,</p>
    <p>Eos, Fox, Golf 4, Golf 5, Golf 6, Golf Plus, JeHa, Lupo, Passat, Polo, T4, T5, Scirocco, Sharan, Tiguan, Touran, Up</p>
    <p>Seat: Alhambra, Altea, Arosa, Cordoba, Ibiza, Leon, MII, Toledo</p>
    <p>koda: City Go, Roomster, Fabia 1, Fabia 2, Octavia, Superb, YeG</p>
    <p>In summary: probably most VW group vehicles between 2000 and today not using Golf 7 (MQB) plaxorm</p>
  </div>
  <div class="page">
    <p>Intermezzo</p>
    <p>Cryptographic algorithms improving over Gme  But: Secure crypto  secure system  Reverse engineering ECU firmware yields a few worldwide keys</p>
    <p>AHack highly pracGcal and scalable  New VW group system (MQB / Golf 7) allegedly uses diversified keys + good crypto</p>
  </div>
  <div class="page">
    <p>Part 2: The Hitag2 System</p>
  </div>
  <div class="page">
    <p>Hitag2 Usage in RKE</p>
  </div>
  <div class="page">
    <p>Our previous work on Hitag2</p>
    <p>At Usenix Security12 we presented a secret key recovery aHack against Hitag2 immobilizer requiring:  Immobilizer transponder uid  136 authenGcaGon aHempts from the car  5 minutes computaGon</p>
    <p>This aHack was not considered car-only due to the first requirement.</p>
  </div>
  <div class="page">
    <p>In the RKE context</p>
    <p>Hybrid chip (Immo+RKE) uses a different secret key but the same uid  This can be eavesdropped from 100 m/300 v</p>
    <p>136 traces is not pracGcal in a RKE context, so we needed to improve the aHack</p>
    <p>The cipher was known so we did a black-box reverse engineering of the protocol</p>
  </div>
  <div class="page">
    <p>RKE Protocol (simplified)</p>
    <p>State:</p>
    <p>id1 k1 ctr1</p>
    <p>id2 k2 ctr2</p>
    <p>id3 k3 ctr3</p>
    <p>uid, btn, ctr, MACk, crc</p>
    <p>ctr1</p>
    <p>If (ctr1 &lt; ctr1 &lt; ctr1 + ) then ctr1 := ctr1 ; open</p>
    <p>MACk is just 32 bits of keystream</p>
  </div>
  <div class="page">
    <p>Our RKE aHack requires</p>
    <p>4 to 8 traces (key presses)  Our $40 Arduino board can collect them  Speeding up trace collecGon  Our device also implements reacGve jamming:</p>
    <p>uid, btn, ctr, MACk, crc</p>
  </div>
  <div class="page">
    <p>Hitag2 Cipher</p>
    <p>IniGalized LFSR = a32a79</p>
  </div>
  <div class="page">
    <p>Score guess as raGo of unknown input bits with correct output</p>
    <p>A fast correlaGon aHack on Hitag2 (simplified)</p>
    <p>Guess a 16-bit window value</p>
    <p>keystream</p>
  </div>
  <div class="page">
    <p>keystream Score guess as raGo of unknown input bits with correct output</p>
    <p>A fast correlaGon aHack on Hitag2 (simplified)</p>
  </div>
  <div class="page">
    <p>keystream Score guess as raGo of unknown input bits with correct output</p>
    <p>A fast correlaGon aHack on Hitag2 (simplified)</p>
  </div>
  <div class="page">
    <p>keystream Score guess as raGo of unknown input bits with correct output</p>
    <p>A fast correlaGon aHack on Hitag2 (simplified)</p>
  </div>
  <div class="page">
    <p>Discard overall low scoring guesses  Increase window size by one  Repeat  Takes ~1 minute on a laptop to recover the key</p>
    <p>keystream Score guess as raGo of unknown input bits with correct output</p>
    <p>A fast correlaGon aHack on Hitag2 (simplified)</p>
  </div>
  <div class="page">
    <p>PracGcal limitaGons</p>
    <p>Only the 10 LSBs of the counter are sent over the air, but all 28 bits are used  we need to guess 18 MSBs -&gt; surprisingly easy as they start from zero</p>
    <p>AHack works with 4 traces for Immo, as it uses a random challenge. RKE traces give out less informaGon so we need more, usually 8.</p>
    <p>UID |btn | ctr |challenge| MAC |crc | -----------------------------------------------5ad40e29 | 08 | 0294 | 0000e948| 27ee2032 | 1e | 5ad40e29 | 08 | 0295 | 0000e958| 2dee2f1e | be |</p>
  </div>
  <div class="page">
    <p>Hitag2 RKE AHack Demo</p>
  </div>
  <div class="page">
    <p>Vehicles we tested using Hitag2 RKE</p>
    <p>Opel | Astra H | 2008 Opel | Corsa D | 2009 Fiat | Grande Punto | 2009 31</p>
  </div>
  <div class="page">
    <p>Conclusions</p>
    <p>We informed VW Group of our findings in back in Dec 2015 and NXP Semiconductors in Jan 2016.</p>
    <p>Weaknesses in the Hitag2 cipher known for many years but sGll used in new (2016) vehicles</p>
    <p>Poor crypto is bad, but poor key management is worse</p>
    <p>This research may explain several mysterious thev cases without signs of forced entry</p>
  </div>
</Presentation>
