<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Thoth: Comprehensive Policy Compliance in Data Retrieval Systems</p>
    <p>Eslam Elnikety, Aastha Mehta, Anjo Vahldiek-Oberwagner, Deepak Garg, and Peter Druschel</p>
    <p>Max Planck Institute for Software Systems</p>
  </div>
  <div class="page">
    <p>collect, process, and serve data</p>
    <p>Searching, browsing, advertising</p>
    <p>Social networking</p>
    <p>Blogging, publishing, news</p>
    <p>Data retrieval systems</p>
  </div>
  <div class="page">
    <p>WWW</p>
    <p>click history</p>
    <p>streams Indexer</p>
    <p>Ad exchange</p>
    <p>Search engine</p>
    <p>Personalization</p>
    <p>social net.</p>
    <p>user profile</p>
    <p>msgs &amp; emails</p>
    <p>index</p>
    <p>Data retrieval systems: many data sources</p>
  </div>
  <div class="page">
    <p>Many policies</p>
    <p>WWW</p>
    <p>click history</p>
    <p>streams Indexer</p>
    <p>Ad exchange</p>
    <p>Search engine</p>
    <p>Personalization</p>
    <p>social net.</p>
    <p>user profile</p>
    <p>msgs &amp; emails</p>
    <p>index Public Public</p>
    <p>Private</p>
    <p>Friends</p>
    <p>Friends of friends</p>
    <p>Clients privacy preferences</p>
  </div>
  <div class="page">
    <p>Many policies</p>
    <p>WWW</p>
    <p>click history</p>
    <p>streams Indexer</p>
    <p>Ad exchange</p>
    <p>Search engine</p>
    <p>Personalization</p>
    <p>social net.</p>
    <p>user profile</p>
    <p>msgs &amp; emails</p>
    <p>index</p>
    <p>Personalization only; expire after 2 days</p>
    <p>Audit staff access to client data</p>
    <p>Audit staff access to client data</p>
    <p>Audit staff access to client data</p>
    <p>Clients privacy preferences</p>
    <p>Providers privacy choices</p>
  </div>
  <div class="page">
    <p>Many policies</p>
    <p>WWW</p>
    <p>click history</p>
    <p>streams Indexer</p>
    <p>Ad exchange</p>
    <p>Search engine</p>
    <p>Personalization</p>
    <p>social net.</p>
    <p>user profile</p>
    <p>msgs &amp; emails</p>
    <p>index</p>
    <p>Content banned in certain jurisdictions</p>
    <p>Other legal mandates: logging, retention</p>
    <p>Content banned in certain jurisdictions</p>
    <p>Content banned in certain jurisdictions</p>
    <p>Clients privacy preferences</p>
    <p>Providers privacy choices</p>
    <p>Legal requirements</p>
  </div>
  <div class="page">
    <p>WWW</p>
    <p>click history</p>
    <p>streams Indexer</p>
    <p>Ad exchange</p>
    <p>Search engine</p>
    <p>Personalization</p>
    <p>social net.</p>
    <p>user profile</p>
    <p>msgs &amp; emails</p>
    <p>index</p>
    <p>Policy compliance challenges</p>
    <p>Many data items and complex policies</p>
    <p>Policy implicit in configuration files, code</p>
    <p>Enforcement spread over many components, layers</p>
    <p>Complex, fast evolving applications</p>
    <p>Goal: Prevent inadvertent policy violations due to application bugs and misconfigurations</p>
  </div>
  <div class="page">
    <p>Motivation</p>
    <p>Data retrieval systems, policies</p>
    <p>Challenges and goals</p>
    <p>Thoth: policy compliance layer</p>
    <p>Overview, threat model</p>
    <p>Policy language and examples</p>
    <p>Typed declassification</p>
    <p>Runtime enforcement</p>
    <p>Prototype and evaluation</p>
    <p>Outline</p>
  </div>
  <div class="page">
    <p>Thoth: overview</p>
    <p>WWW</p>
    <p>click history</p>
    <p>streams Indexer</p>
    <p>Ad exchange</p>
    <p>Search engine</p>
    <p>Personalization</p>
    <p>social net.</p>
    <p>user profile</p>
    <p>msgs &amp; emails</p>
    <p>index</p>
    <p>Policies attached to content</p>
    <p>Policies attached to internal content Policies attached to internal content attached to internal content</p>
    <p>attached to sources and external connections attached to sources and external connections attached to sources and external connections attached to sources and external connections</p>
  </div>
  <div class="page">
    <p>Thoth: overview</p>
    <p>WWW</p>
    <p>click history</p>
    <p>streams Indexer</p>
    <p>Ad exchange</p>
    <p>Search engine</p>
    <p>Personalization</p>
    <p>social net.</p>
    <p>user profile</p>
    <p>msgs &amp; emails</p>
    <p>index</p>
    <p>Process-level information flow control</p>
    <p>Policies-as-taint</p>
    <p>Track data flows that cross process boundary</p>
    <p>Policies attached to content</p>
  </div>
  <div class="page">
    <p>Thoth: overview</p>
    <p>WWW</p>
    <p>click history</p>
    <p>streams Indexer</p>
    <p>Ad exchange</p>
    <p>Search engine</p>
    <p>Personalization</p>
    <p>social net.</p>
    <p>user profile</p>
    <p>msgs &amp; emails</p>
    <p>index</p>
    <p>Process-level information flow control Policies attached to content</p>
  </div>
  <div class="page">
    <p>Thoth: overview</p>
    <p>WWW</p>
    <p>click history</p>
    <p>streams Indexer</p>
    <p>Ad exchange</p>
    <p>Search engine</p>
    <p>Personalization</p>
    <p>social net.</p>
    <p>user profile</p>
    <p>msgs &amp; emails</p>
    <p>index</p>
    <p>Process-level information flow control Policies attached to content</p>
  </div>
  <div class="page">
    <p>Thoth: overview</p>
    <p>WWW</p>
    <p>click history</p>
    <p>streams Indexer</p>
    <p>Ad exchange</p>
    <p>Search engine</p>
    <p>Personalization</p>
    <p>social net.</p>
    <p>user profile</p>
    <p>msgs &amp; emails</p>
    <p>index</p>
    <p>Process-level information flow control</p>
    <p>policy check</p>
    <p>Policies attached to content</p>
  </div>
  <div class="page">
    <p>Thoth: overview</p>
    <p>WWW</p>
    <p>click history</p>
    <p>streams Indexer</p>
    <p>Ad exchange</p>
    <p>Search engine</p>
    <p>Personalization</p>
    <p>social net.</p>
    <p>user profile</p>
    <p>msgs &amp; emails</p>
    <p>index</p>
    <p>Process-level information flow control</p>
    <p>policy check</p>
    <p>Policies attached to content</p>
  </div>
  <div class="page">
    <p>Thoth: overview</p>
    <p>WWW</p>
    <p>click history</p>
    <p>streams Indexer</p>
    <p>Ad exchange</p>
    <p>Search engine</p>
    <p>Personalization</p>
    <p>social net.</p>
    <p>user profile</p>
    <p>msgs &amp; emails</p>
    <p>index</p>
    <p>Process-level information flow control</p>
    <p>policy check</p>
    <p>policy check</p>
    <p>Policies attached to content</p>
  </div>
  <div class="page">
    <p>Thoth: overview</p>
    <p>WWW</p>
    <p>click history</p>
    <p>streams Indexer</p>
    <p>Ad exchange</p>
    <p>Search engine</p>
    <p>Personalization</p>
    <p>social net.</p>
    <p>user profile</p>
    <p>msgs &amp; emails</p>
    <p>index</p>
    <p>Process-level information flow control</p>
    <p>policy check</p>
    <p>policy check</p>
    <p>Policies attached to content</p>
    <p>Regardless of the internal complexity, correct source policies ensure policy compliance</p>
  </div>
  <div class="page">
    <p>Thoth: threat model</p>
    <p>Thoth, OS, storage are trusted (but not applications)</p>
    <p>Covert and side channels are not a concern</p>
    <p>Pragmatic:</p>
    <p>Provider is interested in policy compliance</p>
    <p>Goal is preventing inadvertent policy violations</p>
    <p>Guarantees:</p>
    <p>Application bugs and misconfigurations will not violate source policies</p>
  </div>
  <div class="page">
    <p>Declarative data flow policy language</p>
    <p>Thoth policies</p>
    <p>can express confidentiality, integrity, declassification</p>
    <p>are attached to source content</p>
    <p>Thoth policy language overview</p>
    <p>read/update access</p>
    <p>data flow content</p>
    <p>Who can access? when? which state?</p>
    <p>How can access conditions change along a data flow?</p>
  </div>
  <div class="page">
    <p>Alices post accessible by herself, friends, friends of friends</p>
    <p>read :</p>
    <p>sessionIs(Alice) /* Alice */</p>
    <p>/* Alices friends:</p>
    <p>x can access when in Alices friend list */</p>
    <p>OR</p>
    <p>sessionIs(x) AND friend_listAlice, offsetx says x</p>
    <p>/* Alices friends of friends:</p>
    <p>y can access when in xs friend list,</p>
    <p>and x is in Alices friend list */</p>
    <p>OR</p>
    <p>sessionIs(y) AND friend_listx, offsety says y AND friend_listAlice, offsety says x</p>
    <p>Example: client access control</p>
    <p>Only authorized users, as specified by Alice, can access the post.</p>
  </div>
  <div class="page">
    <p>Alices post accessible by herself, friends, friends of friends</p>
    <p>read :</p>
    <p>sessionIs(Alice) /* Alice */</p>
    <p>/* Alices friends:</p>
    <p>x can access when in Alices friend list */</p>
    <p>OR</p>
    <p>sessionIs(x) AND friend_listAlice, offsetx says x</p>
    <p>/* Alices friends of friends:</p>
    <p>y can access when in xs friend list,</p>
    <p>and x is in Alices friend list */</p>
    <p>OR</p>
    <p>sessionIs(y) AND friend_listx, offsety says y AND friend_listAlice, offsety says x</p>
    <p>Example: client access control</p>
    <p>Only authorized users, as specified by Alice, can access the post.</p>
    <p>Applications are responsible for finding the entries in the friend lists Applications are responsible for finding the entries in the friend lists Applications are responsible for finding the entries in the friend lists</p>
  </div>
  <div class="page">
    <p>More example policies</p>
    <p>WWW</p>
    <p>click history</p>
    <p>streams Indexer</p>
    <p>Ad exchange</p>
    <p>Search engine</p>
    <p>Personalization</p>
    <p>social net.</p>
    <p>user profile</p>
    <p>msgs &amp; emails</p>
    <p>index</p>
    <p>Personalization only; expire after 2 days</p>
    <p>Audit staff access to client data</p>
    <p>Audit staff access to client data</p>
    <p>Audit staff access to client data</p>
    <p>Content banned in certain jurisdictions</p>
    <p>Content banned in certain jurisdictions</p>
    <p>Content banned in certain jurisdictions</p>
  </div>
  <div class="page">
    <p>Thoth: Key ideas</p>
    <p>Process-level information flow control</p>
    <p>Language independent, efficient</p>
    <p>Good match for distributed computing frameworks</p>
    <p>Policies-as-taint</p>
    <p>Enables taint reduction via policy comparison, partial evaluation</p>
    <p>Policy-specified declassification</p>
    <p>No trust in application code for declassification</p>
    <p>Typed declassification</p>
  </div>
  <div class="page">
    <p>Allows declassification for data of a specific type</p>
    <p>Example: Declassifying search results</p>
    <p>Typed declassification</p>
    <p>Indexer Search engine</p>
    <p>index</p>
    <p>Search results</p>
    <p>read: no one</p>
    <p>read: Bob read: Alice</p>
  </div>
  <div class="page">
    <p>Allows declassification for data of a specific type</p>
    <p>Example: Declassifying search results</p>
    <p>ONLY_URLS</p>
    <p>Search engine output must be list of urls</p>
    <p>Typed declassification</p>
    <p>Search engine</p>
    <p>index</p>
    <p>Search results</p>
    <p>read: no one declassify: ONLY_URLS</p>
    <p>TYPE: list of urls</p>
    <p>read: anyone who can read the content Other types: floats, integers</p>
  </div>
  <div class="page">
    <p>Algorithm: Process p performs I/O on content with policy pol</p>
    <p>If p is external (access control)</p>
    <p>read: check pol.read</p>
    <p>write: check pol.update</p>
    <p>If p is internal (flow control)</p>
    <p>read: pol is added to p.taint</p>
    <p>write: check pol.update;</p>
    <p>for each policy in the taint; either</p>
    <p>declassification conditions are met, or</p>
    <p>pol is at least as restrictive as the taint policy</p>
    <p>Ensures compliance regardless of internal policies</p>
    <p>End-to-end policy enforcement</p>
    <p>read Process</p>
    <p>write Process</p>
    <p>check update</p>
    <p>check declassification check declassification</p>
  </div>
  <div class="page">
    <p>Motivation</p>
    <p>Data retrieval systems, policies</p>
    <p>Challenges and goals</p>
    <p>Thoth: policy compliance layer</p>
    <p>Overview, threat model</p>
    <p>Policy language and examples</p>
    <p>Typed declassification</p>
    <p>Runtime enforcement</p>
    <p>Prototype and evaluation</p>
    <p>Outline</p>
  </div>
  <div class="page">
    <p>Per-node enforcement</p>
    <p>Linux security module (LSM) (3,500 LoC)</p>
    <p>intercepts system calls (e.g., read, write, .. )</p>
    <p>exposes Thoth API (e.g., set_policy)</p>
    <p>Reference monitor (19,000 LoC + OpenSSL)</p>
    <p>authenticates users</p>
    <p>evaluates policies</p>
    <p>Global policy store</p>
    <p>Thoth Implementation</p>
    <p>Linux OS kernel</p>
    <p>Thoth LSM module</p>
    <p>Thoth Global Policy Store</p>
    <p>Process1 Processm</p>
    <p>Thoth reference monitor</p>
    <p>Linux OS kernel</p>
    <p>Thoth LSM module</p>
    <p>Process1 Processm</p>
    <p>Thoth reference monitor</p>
    <p>node 1 node n</p>
    <p>Linux OS kernel</p>
    <p>Thoth LSM module</p>
    <p>Thoth Global Policy Store</p>
    <p>Process1 Processm</p>
    <p>Thoth reference monitor</p>
    <p>Linux OS kernel</p>
    <p>Thoth LSM module</p>
    <p>Process1 Processm</p>
    <p>Thoth reference monitor</p>
    <p>node 1 node n</p>
    <p>Linux OS kernel</p>
    <p>Thoth LSM module</p>
    <p>Thoth Global Policy Store</p>
    <p>Process1 Processm</p>
    <p>Thoth reference monitor</p>
    <p>Linux OS kernel</p>
    <p>Thoth LSM module</p>
    <p>Process1 Processm</p>
    <p>Thoth reference monitor</p>
    <p>node 1 node n</p>
    <p>Linux OS kernel</p>
    <p>Thoth LSM module</p>
    <p>Thoth Global Policy Store</p>
    <p>Process1 Processm</p>
    <p>Thoth reference monitor</p>
    <p>Linux OS kernel</p>
    <p>Thoth LSM module</p>
    <p>Process1 Processm</p>
    <p>Thoth reference monitor</p>
    <p>node 1 node n</p>
  </div>
  <div class="page">
    <p>Apache Lucene</p>
    <p>memcached</p>
    <p>WWW</p>
    <p>click history</p>
    <p>streams</p>
    <p>Indexer</p>
    <p>Ad exchange</p>
    <p>Search engine1</p>
    <p>Personalization</p>
    <p>social net.</p>
    <p>user profile</p>
    <p>msgs &amp; emails</p>
    <p>Prototype search engine</p>
    <p>index1</p>
    <p>Search enginen</p>
    <p>indexn</p>
    <p>Search engine1</p>
    <p>index1</p>
    <p>Search enginen</p>
    <p>indexn</p>
    <p>Changes: 50 LoC (out of 300,000)</p>
  </div>
  <div class="page">
    <p>Setup</p>
    <p>2-shard index, each shard hosted by a server</p>
    <p>No replication (2 servers), 2x replication (4 servers)</p>
    <p>Dataset</p>
    <p>Wikipedia English articles; 15M documents</p>
    <p>Policies</p>
    <p>30% private; 50% public, 20% friends-only</p>
    <p>Non-public documents allow staff access subject to logging</p>
    <p>All documents have censorship clause</p>
    <p>Workload</p>
    <p>Queries based on Wikipedia popularity access trace</p>
    <p>Performance evaluation</p>
  </div>
  <div class="page">
    <p>Search throughput q</p>
    <p>u e</p>
    <p>ri e</p>
    <p>s/ se</p>
    <p>c</p>
    <p>Baseline Thoth</p>
    <p>overhead:</p>
    <p>I/O interception + IPC to reference monitor</p>
    <p>policy evaluation</p>
    <p>Concurrent queries; clients saturate the search engine. In-memory index and documents to fully expose Thoth overheads.</p>
    <p>No replication</p>
    <p>(2 servers)</p>
    <p>(4 servers)</p>
    <p>Overhead can be reduced significantly with  better I/O mediation  an in-kernel reference monitor</p>
    <p>Overhead can be reduced significantly with  a more efficient I/O interception  an in-kernel reference monitor</p>
  </div>
  <div class="page">
    <p>Enforcing policy adds 6.7 milliseconds</p>
    <p>Search latency</p>
    <p>Average (ms) Overhead</p>
    <p>Baseline 47</p>
    <p>Thoth 53.7 14.2%</p>
    <p>More performance numbers (indexing, microbenchmarks)</p>
    <p>Security evaluation</p>
    <p>Please see the paper!</p>
  </div>
  <div class="page">
    <p>Declarative policies; directly attached to content</p>
    <p>Kernel-level compliance independent of application code</p>
    <p>Correct source policies ensure compliance regardless of the system internal complexity</p>
    <p>Policy compliance with Thoth: Contributions</p>
  </div>
  <div class="page">
    <p>Declarative policies attached to conduits</p>
    <p>Confidentiality, integrity, declassification</p>
    <p>Policy compliance despite application bugs or misconfigurations</p>
    <p>Process-level IFC, policies-as-taint</p>
    <p>Policy-specified/Typed declassification</p>
    <p>Efficient policy compliance</p>
    <p>Low runtime overhead</p>
    <p>Minimal application code changes</p>
    <p>Demonstrated utility with a distributed search engine</p>
    <p>Questions?</p>
    <p>Summary</p>
  </div>
</Presentation>
