<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Virtual Machine Workloads:</p>
    <p>The Case for New Benchmarks for NAS</p>
    <p>T 2 M virtual</p>
    <p>Vasily Tarasov,</p>
    <p>Dean Hildebrand,</p>
    <p>Geoff Kuenning,</p>
    <p>Erez Zadok</p>
    <p>Stony Brook University,</p>
    <p>IBM Research  Almaden,</p>
    <p>Harvey Mudd College</p>
  </div>
  <div class="page">
    <p>Virtual Machine Workloads: The Case for New Benchmarks for NAS 2 2/15/2013</p>
    <p>Overview</p>
    <p>Clients</p>
    <p>Storage Companies</p>
    <p>Benchmark!</p>
    <p>Network</p>
    <p>Attached</p>
    <p>Storage!</p>
    <p>FastStorage Inc.</p>
    <p>NeverFail Corp.</p>
    <p>TroubleFree LLC</p>
  </div>
  <div class="page">
    <p>Virtual Machine Workloads: The Case for New Benchmarks for NAS 3 2/15/2013</p>
    <p>Overview</p>
    <p>Clients</p>
    <p>Storage Companies</p>
    <p>SlowStorage Inc.</p>
    <p>Benchmark!</p>
    <p>Benchmark</p>
    <p>Reality</p>
    <p>Network</p>
    <p>Attached</p>
    <p>Storage!</p>
    <p>EpicFail Corp.</p>
    <p>RestLess LLC</p>
  </div>
  <div class="page">
    <p>Virtual Machine Workloads: The Case for New Benchmarks for NAS 4 2/15/2013</p>
    <p>Overview</p>
    <p>Clients</p>
    <p>Storage Companies</p>
    <p>SlowStorage Inc.</p>
    <p>Benchmark!</p>
    <p>Benchmark</p>
    <p>Reality</p>
    <p>Network</p>
    <p>Attached</p>
    <p>Storage!</p>
    <p>EpicFail Corp.</p>
    <p>FastStorage Inc.</p>
    <p>NeverFail Corp.</p>
    <p>TroubleFree LLC RestLess LLC</p>
    <p>But not the benchmarks!</p>
  </div>
  <div class="page">
    <p>Virtual Machine Workloads: The Case for New Benchmarks for NAS 5 2/15/2013</p>
    <p>Overview</p>
    <p>Clients</p>
    <p>Storage Companies</p>
    <p>SlowStorage Inc.</p>
    <p>Benchmark!</p>
    <p>Benchmark</p>
    <p>Reality</p>
    <p>Network</p>
    <p>Attached</p>
    <p>Storage!</p>
    <p>EpicFail Corp.</p>
    <p>FastStorage Inc.</p>
    <p>NeverFail Corp.</p>
    <p>TroubleFree LLC RestLess LLC</p>
    <p>But not the benchmarks!</p>
    <p>Create benchmarks for NAS that</p>
    <p>accurately generate workloads</p>
    <p>originating in Virtual Environments</p>
  </div>
  <div class="page">
    <p>Virtual Machine Workloads: The Case for New Benchmarks for NAS 6 2/15/2013</p>
    <p>Outline</p>
  </div>
  <div class="page">
    <p>Virtual Machine Workloads: The Case for New Benchmarks for NAS 7 2/15/2013</p>
    <p>VM-NAS</p>
    <p>Data Access Options for VMs</p>
    <p>File system interface in VMs</p>
    <p>Emulated block device +</p>
    <p>Guest OS on-disk FS</p>
    <p>a b c d</p>
    <p>(VDI  Virtual Disk Image)</p>
    <p>Distributed File System</p>
    <p>client in guest OS</p>
    <p>VDI on</p>
    <p>DAS VDI on SAN</p>
    <p>VDI on NAS</p>
    <p>VMWare Workstation</p>
    <p>with VDI on Ext3</p>
    <p>VMWare ESXi</p>
    <p>with VDI on VMFS</p>
    <p>VMWare ESXi</p>
    <p>with VDI on a filer</p>
    <p>Pass-through to DAS/SAN</p>
    <p>VMWare ESXi</p>
    <p>with SAN</p>
  </div>
  <div class="page">
    <p>Virtual Machine Workloads: The Case for New Benchmarks for NAS 8 2/15/2013</p>
    <p>(by 2014)</p>
    <p>(by 2014)</p>
    <p>Shipped storage capacity</p>
    <p>Growth</p>
    <p>NAS  60%</p>
    <p>SAN  23%</p>
    <p>x86 server virtualization</p>
    <p>Trends [IDC 2010]</p>
    <p>[Gartner 2010]</p>
    <p>Direct-attached storage</p>
    <p>Network-based Storage 10%</p>
    <p>Virtualized servers</p>
  </div>
  <div class="page">
    <p>Virtual Machine Workloads: The Case for New Benchmarks for NAS 9 2/15/2013</p>
    <p>(by 2014)</p>
    <p>(by 2014)</p>
    <p>Shipped storage capacity</p>
    <p>Growth</p>
    <p>NAS  60%</p>
    <p>SAN  23%</p>
    <p>x86 server virtualization</p>
    <p>Trends [IDC 2010]</p>
    <p>[Gartner 2010]</p>
    <p>Direct-attached storage</p>
    <p>Network-based Storage 10%</p>
    <p>Virtualized servers</p>
    <p>Virtualization</p>
    <p>Network</p>
    <p>Attached</p>
    <p>Storage</p>
    <p>VMs</p>
    <p>on</p>
    <p>NAS</p>
  </div>
  <div class="page">
    <p>Virtual Machine Workloads: The Case for New Benchmarks for NAS 10 2/15/2013</p>
    <p>VM-NAS I/O Stack Applications</p>
    <p>Virtual File System</p>
    <p>On-Disk File System</p>
    <p>Block Layer</p>
    <p>Controller Driver</p>
    <p>Controller Emulator</p>
    <p>NFS Client</p>
    <p>NFS Server</p>
    <p>Virtual File System</p>
    <p>On-Disk File System</p>
    <p>Block Layer</p>
    <p>Controller Driver</p>
    <p>Guest OS</p>
    <p>Hypervisor &amp; VM</p>
    <p>Host OS</p>
    <p>Reordering,</p>
    <p>Merging,</p>
    <p>Splitting,</p>
    <p>Network</p>
    <p>Mapping, Caching,</p>
    <p>Coalescing, ...</p>
    <p>Various</p>
    <p>Proposed</p>
    <p>Optimizations</p>
    <p>Read/Write</p>
    <p>sizes,</p>
    <p>Attribute</p>
    <p>caching,</p>
  </div>
  <div class="page">
    <p>Virtual Machine Workloads: The Case for New Benchmarks for NAS 11 2/15/2013</p>
    <p>VM-NAS I/O Stack Applications</p>
    <p>Virtual File System</p>
    <p>On-Disk File System</p>
    <p>Block Layer</p>
    <p>Controller Driver</p>
    <p>Controller Emulator</p>
    <p>NFS Client</p>
    <p>NFS Server</p>
    <p>Virtual File System</p>
    <p>On-Disk File System</p>
    <p>Block Layer</p>
    <p>Controller Driver</p>
    <p>Guest OS</p>
    <p>Hypervisor &amp; VM</p>
    <p>Host OS</p>
    <p>Reordering,</p>
    <p>Merging,</p>
    <p>Splitting,</p>
    <p>Network</p>
    <p>Mapping, Caching,</p>
    <p>Coalescing, ...</p>
    <p>Various</p>
    <p>Proposed</p>
    <p>Optimizations</p>
    <p>Read/Write</p>
    <p>sizes,</p>
    <p>Attribute</p>
    <p>caching,</p>
    <p>significantly</p>
  </div>
  <div class="page">
    <p>Virtual Machine Workloads: The Case for New Benchmarks for NAS 12 2/15/2013</p>
    <p>Outline</p>
  </div>
  <div class="page">
    <p>Virtual Machine Workloads: The Case for New Benchmarks for NAS 13 2/15/2013</p>
    <p>Physical vs. Virtual</p>
    <p>W2 W1</p>
    <p>W2 W1</p>
    <p>NAS Appliance</p>
    <p>Physical Machine</p>
    <p>NFS /SMB</p>
    <p>Physical Machine</p>
    <p>Physical Virtual</p>
    <p>GPFS, WAFL, ZFS GPFS, WAFL, ZFS</p>
    <p>NAS Appliance</p>
    <p>Application</p>
    <p>NFS /SMB</p>
    <p>Current NAS Benchmarks</p>
    <p>New NAS Benchmarks</p>
    <p>Physical Machine</p>
    <p>Physical Machine</p>
    <p>Application Application</p>
    <p>Virtual Machine</p>
    <p>Application</p>
    <p>Virtual Machine</p>
    <p>Virtual Machine</p>
    <p>Application Application</p>
  </div>
  <div class="page">
    <p>Virtual Machine Workloads: The Case for New Benchmarks for NAS 14 2/15/2013</p>
    <p>Physical vs. Virtual</p>
    <p>W2 W1</p>
    <p>W2 W1</p>
    <p>NAS Appliance</p>
    <p>Physical Machine</p>
    <p>NFS /SMB</p>
    <p>Physical Machine</p>
    <p>Physical Virtual</p>
    <p>GPFS, WAFL, ZFS GPFS, WAFL, ZFS</p>
    <p>NAS Appliance</p>
    <p>Application</p>
    <p>NFS /SMB</p>
    <p>Current NAS Benchmarks</p>
    <p>New NAS Benchmarks</p>
    <p>Physical Machine</p>
    <p>Physical Machine</p>
    <p>Application Application</p>
    <p>Virtual Machine</p>
    <p>Application</p>
    <p>Virtual Machine</p>
    <p>Virtual Machine</p>
    <p>Application Application</p>
    <p>Meta-data ops</p>
    <p>SPECsfs2008: 72%</p>
    <p>Virtual setup: &lt; 1%</p>
  </div>
  <div class="page">
    <p>Virtual Machine Workloads: The Case for New Benchmarks for NAS 15 2/15/2013</p>
    <p>How to Evaluate VM-NAS?</p>
    <p>Run old benchmarks in VMs</p>
    <p>Cumbersome</p>
    <p>Hypervisors, VMs , OSes, applications</p>
    <p>Inflexible</p>
    <p>Many combinations of different workloads</p>
    <p>Expensive</p>
    <p>Equipment to run hypervisors and VMs</p>
    <p>Create new benchmarks</p>
  </div>
  <div class="page">
    <p>Virtual Machine Workloads: The Case for New Benchmarks for NAS 16 2/15/2013</p>
    <p>Configuration</p>
    <p>Physical Machine</p>
    <p>Virtual</p>
    <p>Machine</p>
    <p>Virtual</p>
    <p>Machine</p>
    <p>Virtual</p>
    <p>Machine</p>
    <p>Back-end File System</p>
    <p>NAS Appliance</p>
    <p>Application Application Application  Filebench: File, Web, Database server</p>
    <p>Jetstress (Mail server)</p>
    <p>Operating System: Linux/Win</p>
    <p>File system: ext3/NTFS</p>
    <p>I/O scheduler: CFQ</p>
    <p>VM parameters: default</p>
    <p>Hypervisor: VMWare ESXi 5</p>
    <p>NFS client: default settings</p>
    <p>Black box</p>
    <p>Linux</p>
    <p>GPFS tracing</p>
    <p>facilities</p>
  </div>
  <div class="page">
    <p>Virtual Machine Workloads: The Case for New Benchmarks for NAS 17 2/15/2013</p>
    <p>Outline</p>
  </div>
  <div class="page">
    <p>Virtual Machine Workloads: The Case for New Benchmarks for NAS 18 2/15/2013</p>
    <p>Observations Workload Property Physical NAS clients Virtual NAS clients</p>
    <p>File and directory count Many files and directories Few files per VM</p>
    <p>Directory tree depth Deep and non-uniform Shallow and uniform</p>
    <p>File size Lean towards small files Multi-gigabyte, but sparse</p>
    <p>Meta-data operations Many Almost none</p>
    <p>I/O synchronization Async and sync All writes are sync</p>
    <p>In-file randomness Workload-dependent Increased randomness</p>
    <p>Cross-file randomness Workload-dependent Predictable</p>
    <p>I/O sizes Workload-dependent Increased and decreased</p>
    <p>Read-modify-write Infrequent More frequent</p>
    <p>Think time Workload-dependent Increased</p>
  </div>
  <div class="page">
    <p>Virtual Machine Workloads: The Case for New Benchmarks for NAS 19 2/15/2013</p>
    <p>Workload Features</p>
    <p>Read/write ratio</p>
    <p>I/O Size distribution</p>
    <p>Jump distance distribution</p>
    <p>LBA distance between two consecutive requests</p>
    <p>Offset reuse</p>
    <p>File-server Web-server Database-server Mail-server (Win)</p>
    <p>Percent read</p>
    <p>write</p>
  </div>
  <div class="page">
    <p>Virtual Machine Workloads: The Case for New Benchmarks for NAS 20 2/15/2013</p>
    <p>Percent</p>
    <p>I/O Size (KB)</p>
    <p>Reads</p>
    <p>Writes</p>
    <p>-16 -14 -12 -10 -8 -6 -4 -2 0 2 4 6 8 10 12 14 16</p>
    <p>Percent</p>
    <p>Jump Distance (GB)</p>
    <p>Web Server</p>
    <p>Database Server</p>
    <p>Percent</p>
    <p>Number of accesses</p>
    <p>Reads</p>
    <p>Writes JetStress</p>
    <p>I/O Size, Jump Distance, Offset Popularity</p>
    <p>&gt;15</p>
  </div>
  <div class="page">
    <p>Virtual Machine Workloads: The Case for New Benchmarks for NAS 21 2/15/2013</p>
    <p>Outline</p>
  </div>
  <div class="page">
    <p>Virtual Machine Workloads: The Case for New Benchmarks for NAS 22 2/15/2013</p>
    <p>T2M Converter</p>
    <p>T</p>
    <p>R</p>
    <p>A</p>
    <p>C</p>
    <p>E</p>
    <p>Chunking</p>
    <p>Per-chunk</p>
    <p>model</p>
    <p>collection Duplicate</p>
    <p>elimination</p>
    <p>Benchmark</p>
    <p>plugin Workload description in</p>
    <p>Benchmarks</p>
    <p>language</p>
    <p>Benchmark Workload Features</p>
  </div>
  <div class="page">
    <p>Virtual Machine Workloads: The Case for New Benchmarks for NAS 23 2/15/2013</p>
    <p>T2M Converter</p>
    <p>T</p>
    <p>R</p>
    <p>A</p>
    <p>C</p>
    <p>E</p>
    <p>Chunking</p>
    <p>Per-chunk</p>
    <p>model</p>
    <p>collection Duplicate</p>
    <p>elimination</p>
    <p>Benchmark</p>
    <p>plugin Workload description in</p>
    <p>Benchmarks</p>
    <p>language</p>
    <p>Benchmark Workload Features 1. Benchmarks generate stationary</p>
    <p>workloads  almost no chunking</p>
    <p>But block-on-file.</p>
  </div>
  <div class="page">
    <p>Virtual Machine Workloads: The Case for New Benchmarks for NAS 24 2/15/2013</p>
    <p>Multi-VM Declarations  Define hypervisors and VM:</p>
    <p>define hypervisor type=esx51 {</p>
    <p>define vm type=fileserver,instances=5 {</p>
    <p>}</p>
    <p>define vm type=webserver,instances=2 {</p>
    <p>}</p>
    <p>}</p>
  </div>
  <div class="page">
    <p>Virtual Machine Workloads: The Case for New Benchmarks for NAS 25 2/15/2013</p>
    <p>Outline</p>
  </div>
  <div class="page">
    <p>Virtual Machine Workloads: The Case for New Benchmarks for NAS 26 2/15/2013</p>
    <p>Accuracy Metrics</p>
    <p>Reads/Sec</p>
    <p>Writes/Sec</p>
    <p>Latency</p>
    <p>I/O Utilization</p>
    <p>Queue length</p>
    <p>Request size</p>
    <p>CPU Utilization</p>
    <p>Memory usage</p>
    <p>Interrupts</p>
    <p>Context switches</p>
    <p>Waiting processes</p>
    <p>Virtualized</p>
    <p>Benchmark</p>
    <p>Non-virtualized</p>
    <p>Benchmark</p>
    <p>in VM</p>
    <p>Monitored NAS parameters: Compare</p>
  </div>
  <div class="page">
    <p>Virtual Machine Workloads: The Case for New Benchmarks for NAS 27 2/15/2013</p>
    <p>Single VM Accuracy (Web-Server)</p>
    <p>Error (%)</p>
    <p>RMS</p>
    <p>Maximum</p>
  </div>
  <div class="page">
    <p>Virtual Machine Workloads: The Case for New Benchmarks for NAS 28 2/15/2013</p>
    <p>Multi-VM Accuracy</p>
    <p>Max Error (%)</p>
    <p>Number of VMs</p>
    <p>Reads/Sec</p>
    <p>Writes/Sec</p>
    <p>Latency</p>
    <p>I/O Utillization</p>
    <p>Queue Length</p>
    <p>Request Size</p>
    <p>CPU Utilization</p>
    <p>Memory Usage</p>
    <p>Interrupts</p>
    <p>Context switchesh</p>
    <p>Waiting processes</p>
  </div>
  <div class="page">
    <p>Virtual Machine Workloads: The Case for New Benchmarks for NAS 29 2/15/2013</p>
    <p>Outline</p>
  </div>
  <div class="page">
    <p>Virtual Machine Workloads: The Case for New Benchmarks for NAS 30 2/15/2013</p>
    <p>Conclusions</p>
    <p>Virtualization causes NAS workloads to change</p>
    <p>Current benchmarks are no longer representative</p>
    <p>Need for VM-oriented benchmarks</p>
    <p>Trace-based analysis of VM-NAS workloads</p>
    <p>Trace2Model for NFS traces</p>
    <p>Created a set of VM-benchmarks</p>
    <p>Accuracy within 10% on average</p>
  </div>
  <div class="page">
    <p>Virtual Machine Workloads: The Case for New Benchmarks for NAS 31 2/15/2013</p>
    <p>Future Work</p>
    <p>Explore other configurations</p>
    <p>The impact of VM-NAS parameters</p>
    <p>VM workload classification</p>
    <p>VM-specific workloads</p>
    <p>snapshotting, boot and update storms</p>
    <p>Emulate I/O request transformations</p>
    <p>Multi-level trace analysis</p>
    <p>Higher flexibility</p>
  </div>
  <div class="page">
    <p>Virtual Machine Workloads: The Case for New Benchmarks for NAS 32 2/15/2013</p>
    <p>Virtual Machine Workloads:</p>
    <p>The Case for New Benchmarks for NAS</p>
    <p>Vasily Tarasov,</p>
    <p>Dean Hildebrand,</p>
    <p>Geoff Kuenning,</p>
    <p>Erez Zadok</p>
    <p>Stony Brook University,</p>
    <p>IBM Research  Almaden,</p>
    <p>Harvey Mudd College</p>
    <p>Q&amp;A Google it: t2mpublic</p>
  </div>
</Presentation>
