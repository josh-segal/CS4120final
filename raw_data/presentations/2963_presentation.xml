<?xml version="1.0" ?>
<Presentation>
  <div class="page"/>
  <div class="page">
    <p>f4: Facebooks Warm BLOB Storage System</p>
    <p>Subramanian Muralidhar*, Wyatt Lloyd*, Sabyasachi Roy*, Cory Hill*, Ernest Lin*, Weiwen Liu*, Satadru Pan*, Shiva Shankar*, Viswanath Sivakumar*, Linpeng Tang*,</p>
    <p>Sanjeev Kumar*</p>
    <p>*Facebook Inc., University of Southern California, Princeton University</p>
  </div>
  <div class="page">
    <p>Profile Photo</p>
    <p>BLOBs@FB</p>
    <p>Feed Photo</p>
    <p>Feed Video</p>
    <p>Cover Photo</p>
    <p>Immutable &amp; Unstructured</p>
    <p>Diverse</p>
    <p>A LOT of them!!</p>
  </div>
  <div class="page">
    <p>N o</p>
    <p>rm a</p>
    <p>li ze</p>
    <p>d R</p>
    <p>e a</p>
    <p>d R</p>
    <p>a te</p>
    <p>s</p>
    <p>Photo</p>
    <p>Video</p>
    <p>&lt; 1 Days 1 Day 1 Week 1 Month 1 Year 1X</p>
    <p>Data cools off rapidly</p>
    <p>HOT DATA WARM DATA</p>
  </div>
  <div class="page">
    <p>Handling failures</p>
    <p>HOST</p>
    <p>RACKS DATACENTER</p>
    <p>HOST</p>
    <p>RACKS DATACENTER</p>
    <p>HOST</p>
    <p>RACKS DATACENTER</p>
    <p>* 3 = 3.6 Replication: 4</p>
  </div>
  <div class="page">
    <p>Handling load</p>
    <p>HOST HOST HOST HOST HOST HOST HOST</p>
    <p>Reduce space usage AND</p>
    <p>Not compromise reliability</p>
  </div>
  <div class="page">
    <p>Background: Data serving</p>
    <p>CDN protects storage</p>
    <p>Router abstracts storage</p>
    <p>Web tier adds business logic</p>
    <p>User Requests</p>
    <p>Web Servers CDN</p>
    <p>BLOB Storage</p>
    <p>Router</p>
    <p>Writes Reads</p>
  </div>
  <div class="page">
    <p>Background: Haystack [OSDI2010]</p>
    <p>Header</p>
    <p>Footer</p>
    <p>BLOB1</p>
    <p>BID1: Off</p>
    <p>Volume</p>
    <p>In-Memory Index</p>
    <p>Volume is a series of BLOBs</p>
    <p>In-memory index</p>
    <p>Header</p>
    <p>Footer</p>
    <p>BLOB1</p>
    <p>Header</p>
    <p>Footer</p>
    <p>BLOB1</p>
    <p>BID2: Off</p>
    <p>BIDN: Off</p>
  </div>
  <div class="page">
    <p>Introducing f4: Haystack on cells</p>
    <p>Rack Rack Rack</p>
    <p>Cell</p>
    <p>Data+Index</p>
    <p>Compute</p>
  </div>
  <div class="page">
    <p>Data splitting</p>
    <p>Stripe1 Stripe2</p>
    <p>RS =&gt; BLOB2</p>
    <p>RS =&gt;</p>
    <p>Reed Solomon Encoding</p>
    <p>BLOB1</p>
    <p>BLOB2</p>
    <p>BLOB3</p>
    <p>BLOB4 BLOB5 BLOB5</p>
    <p>BLOB6</p>
    <p>BLOB7</p>
    <p>BLOB8</p>
    <p>BLOB9</p>
    <p>BLOB10</p>
    <p>BLOB11</p>
    <p>BLOB4</p>
    <p>BLOB2</p>
    <p>BLOB4</p>
  </div>
  <div class="page">
    <p>Data placement</p>
    <p>Cell with 7 Racks</p>
    <p>Reed Solomon (10, 4) is used in practice (1.4X)</p>
    <p>Tolerates 4 racks ( 4 disk/host ) failures</p>
    <p>Stripe1 Stripe2</p>
    <p>RS RS</p>
  </div>
  <div class="page">
    <p>Reads</p>
    <p>Compute</p>
    <p>Storage Nodes</p>
    <p>Cell</p>
    <p>Router Index</p>
    <p>User Request</p>
    <p>Index Read</p>
    <p>Data Read</p>
    <p>2-phase: Index read returns the exact physical location of the BLOB</p>
  </div>
  <div class="page">
    <p>Reads under cell-local failures</p>
    <p>Router Index Read</p>
    <p>Decode Read</p>
    <p>Cell-Local failures (disks/hosts/racks) handled locally</p>
    <p>Compute (Decoders)</p>
    <p>Storage Nodes Index</p>
    <p>User Request</p>
    <p>Cell</p>
    <p>Data Read</p>
  </div>
  <div class="page">
    <p>Reads under datacenter failures (2.8X)</p>
    <p>Compute (Decoders) Cell in Datacenter1</p>
    <p>User Request</p>
    <p>Compute (Decoders) Mirror Cell in Datacenter2</p>
    <p>Proxying</p>
    <p>Router</p>
  </div>
  <div class="page">
    <p>Cross datacenter XOR</p>
    <p>Cell in Datacenter1</p>
    <p>Cell in Datacenter2</p>
    <p>Cell in Datacenter3</p>
    <p>(1.5 * 1.4 = 2.1X)</p>
    <p>Index</p>
    <p>Index</p>
    <p>Index</p>
    <p>Cross DC index copy</p>
  </div>
  <div class="page">
    <p>Reads with datacenter failures (2.1X)</p>
    <p>Index Router</p>
    <p>User Request</p>
    <p>Index Read</p>
    <p>Router</p>
    <p>Router</p>
    <p>Data Read</p>
    <p>Data Read</p>
    <p>XOR</p>
    <p>Index</p>
    <p>Index Index</p>
  </div>
  <div class="page">
    <p>Haystack v/s f4 2.8 v/s f4 2.1 Haystack with 3</p>
    <p>copies f4 2.8 f4 2.1</p>
    <p>Replication 3.6X 2.8X 2.1X</p>
    <p>Irrecoverable Disk Failures 9 10 10</p>
    <p>Irrecoverable Host Failures 3 10 10</p>
    <p>Irrecoverable Rack failures 3 10 10</p>
    <p>Irrecoverable Datacenter failures</p>
    <p>Load split 3X 2X 1X</p>
  </div>
  <div class="page">
    <p>Evaluation</p>
    <p>What and how much data is warm?</p>
    <p>Can f4 satisfy throughput and latency requirements?</p>
    <p>How much space does f4 save</p>
    <p>f4 failure resilience</p>
  </div>
  <div class="page">
    <p>Methodology</p>
    <p>CDN data: 1 day, 0.5% sampling</p>
    <p>BLOB store data: 2 week, 0.1%</p>
    <p>Random distribution of BLOBs assumed</p>
    <p>The worst case rates reported</p>
  </div>
  <div class="page">
    <p>Hot and warm divide</p>
    <p>R e</p>
    <p>a d</p>
    <p>s/ S</p>
    <p>e c</p>
    <p>p e</p>
    <p>r d</p>
    <p>is k</p>
    <p>Age</p>
    <p>Photo</p>
    <p>HOT DATA WARM DATA</p>
    <p>&lt; 3 months  Haystack &gt; 3 months  f4</p>
  </div>
  <div class="page">
    <p>It is warm, not cold</p>
    <p>HOT DATA WARM DATA</p>
    <p>Haystack (50%) F4 (50%)</p>
  </div>
  <div class="page">
    <p>f4 Performance: Most loaded disk in cluster</p>
    <p>Peak load on disk: 35 Reads/Sec</p>
    <p>R e</p>
    <p>a d</p>
    <p>s/ S</p>
    <p>e c</p>
  </div>
  <div class="page">
    <p>f4 Performance: Latency</p>
    <p>P80 = 30ms P99 = 80ms</p>
  </div>
  <div class="page">
    <p>Concluding Remarks</p>
    <p>Facebooks BLOB storage is big and growing</p>
    <p>BLOBs cool down with age</p>
    <p>~100X drop in read requests in 60 days</p>
    <p>Haystacks 3.6X replication over provisioning for old, warm data.</p>
    <p>f4 encodes data to lower replication to 2.1X 23</p>
  </div>
  <div class="page">
    <p>(c) 2009 Facebook, Inc. or its licensors. &quot;Facebook&quot; is a registered trademark of Facebook, Inc.. All rights reserved. 1.0</p>
  </div>
</Presentation>
