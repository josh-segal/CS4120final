<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>M i c ro -V i r t u a l i z a t i o n M e m o r y Tr a c i n g t o D e t e c t a n d P re v e n t S p r a y i n g At t a c k s</p>
    <p>Stefano Cristalli, Mattia Pagnozzi, Mariano Graziano, Andrea Lanzi, Davide Balzarotti</p>
    <p>Universita degli Studi di Milano Cisco Systems, Inc.</p>
    <p>Eurecom</p>
    <p>USENIX Security 2016 - Austin, USA</p>
  </div>
  <div class="page">
    <p>S P R AY I N G</p>
    <p>Traditional code based spraying</p>
    <p>JIT spraying</p>
    <p>Data spraying and stack pivoting</p>
  </div>
  <div class="page">
    <p>R E L AT E D W O R K</p>
    <p>Egele et al. - DIMVA 09 Nozzle - USENIX Security 09 BuBBLE - ESSoS 10</p>
    <p>HEAP SPRAYING</p>
  </div>
  <div class="page">
    <p>R E L AT E D W O R K</p>
    <p>Egele et al. - DIMVA 09 Nozzle - USENIX Security 09 BuBBLE - ESSoS 10</p>
    <p>JITsec - VEE 06 Bania - Whitepaper 10 JITDefender - IFIP 11 Lobotomy - Ares 14</p>
    <p>JIT SPRAYING</p>
    <p>HEAP SPRAYING</p>
  </div>
  <div class="page">
    <p>R E L AT E D W O R K</p>
    <p>Egele et al. - DIMVA 09 Nozzle - USENIX Security 09 BuBBLE - ESSoS 10</p>
    <p>JITsec - VEE 06 Bania - Whitepaper 10 JITDefender - IFIP 11 Lobotomy - Ares 14</p>
    <p>EMET - Microsoft 09 Browser solutions</p>
    <p>HEAP SPRAYING</p>
    <p>JIT SPRAYING</p>
    <p>DATA SPRAYING</p>
  </div>
  <div class="page">
    <p>Egele et al. - DIMVA 09 Nozzle - USENIX Security 09 BuBBLE - ESSoS 10</p>
    <p>EMET - Microsoft 09 Browser solutions</p>
    <p>JITsec - VEE 06 Bania - Whitepaper 10 JITDefender - IFIP 11 Lobotomy - Ares 14</p>
    <p>R E L AT E D W O R K</p>
    <p>HEAP SPRAYING</p>
    <p>JIT SPRAYING</p>
    <p>DATA SPRAYING</p>
    <p>- No comprehensive and scalable solutions vs spraying - No OS agnostic solutions</p>
  </div>
  <div class="page">
    <p>M E M O R Y F O O T P R I N T</p>
  </div>
  <div class="page">
    <p>M E M O R Y F O O T P R I N T</p>
  </div>
  <div class="page">
    <p>G O A L S</p>
    <p>The system should be completely independent from the memory allocator used by the protected application</p>
    <p>The system should not require any OS dependent information</p>
    <p>The overhead introduced by our system should be reasonable</p>
    <p>Modular framework based on plugins</p>
  </div>
  <div class="page">
    <p>A R C H I T E C T U R E O V E R V I E W</p>
  </div>
  <div class="page">
    <p>A R C H I T E C T U R E O V E R V I E W</p>
  </div>
  <div class="page">
    <p>M E M O R Y T R A C E R</p>
    <p>Creation/Modification/Removal of the page: Detected by looking at the PTE Creation/Modification/Removal of the page table: Detected by looking at the PDE</p>
  </div>
  <div class="page">
    <p>I N T E R F E R E N C E P R O B L E M</p>
    <p>Overhead issues:</p>
    <p>A modification of the memory page of the running process creates a side effect modification of a memory page in another process</p>
    <p>Due to kernel memory operations optimizations</p>
  </div>
  <div class="page">
    <p>I N T E R F E R E N C E P R O B L E M</p>
    <p>Overhead for Internet Explorer 10 (IE): 22%</p>
    <p>Overhead for Acrobat Reader and Firefox on top of IE: 63%</p>
    <p>IEs overhead increases from 22% to 63%</p>
  </div>
  <div class="page">
    <p>M I C R O - V I R T U A L I Z AT I O N</p>
    <p>Each monitored process runs inside its own virtual memory sandbox</p>
    <p>Graffiti enables the memory protection only for the actual running and monitored process</p>
  </div>
  <div class="page">
    <p>M I C R O - V I R T U A L I Z AT I O N : D E TA I L S</p>
    <p>Micro-virtualization is based on EPT:</p>
    <p>Select a set of physical pages to monitor the target process</p>
    <p>One EPT pointer (EPTP) per process</p>
  </div>
  <div class="page">
    <p>A R C H I T E C T U R E O V E R V I E W</p>
  </div>
  <div class="page">
    <p>S TAT I C A N A LY Z E R</p>
    <p>Set of heuristics to detect the different spraying techniques:</p>
    <p>Malicious code detector [ACSAC10, SEC11]</p>
  </div>
  <div class="page">
    <p>S TAT I C A N A LY Z E R</p>
    <p>Set of heuristics to detect the different spraying techniques:</p>
    <p>Malicious code detector [ACSAC10, SEC11]</p>
    <p>Self-unpacking shellcode detector [ACSAC07]</p>
  </div>
  <div class="page">
    <p>S TAT I C A N A LY Z E R</p>
    <p>Set of heuristics to detect the different spraying techniques:</p>
    <p>Malicious code detector [ACSAC10, SEC11]</p>
    <p>Self-unpacking shellcode detector [ACSAC07]</p>
    <p>Data spraying detector [RAID13,RAID15]</p>
  </div>
  <div class="page">
    <p>E X P E R I M E N T S : O V E R H E A D</p>
    <p>The memory tracer is always active</p>
    <p>Stress suite results (8MB every 2s):</p>
    <p>Windows 7: 24%</p>
    <p>Linux 3.2: 25%</p>
  </div>
  <div class="page">
    <p>E X P E R I M E N T S : O V E R H E A D</p>
  </div>
  <div class="page">
    <p>D E T E C T I O N A C C U R A C Y</p>
  </div>
  <div class="page">
    <p>D E T E C T I O N A C C U R A C Y</p>
    <p>System tested also with 1000 malicious PDF, 1000 benign PDF documents and top 1000 Alexa websites</p>
    <p>Conservative threshold (150MB)</p>
    <p>Graffiti detected all the attacks with zero false alarms</p>
  </div>
  <div class="page">
    <p>G L O B A L E X P E R I M E N T S</p>
    <p>Final global test in which real users use Graffiti during their everyday activities for a total of 8-10 hours per day in a period of 7 days</p>
    <p>Conservative threshold of 150MB on IE8 for Windows 7 machines</p>
  </div>
  <div class="page">
    <p>G L O B A L E X P E R I M E N T S</p>
    <p>492 distinct web pages visited</p>
    <p>Detectors activated 55 times (~8 times per day)</p>
    <p>12 alerts on pages that seemed to be benign. A closer inspection of the false positive shows the data spraying detector to be the only responsible</p>
  </div>
  <div class="page">
    <p>C O N C L U S I O N S</p>
    <p>First efficient and comprehensive solution to defeat spraying</p>
    <p>Micro-virtualization</p>
    <p>Open source</p>
  </div>
  <div class="page">
    <p>S O U R C E C O D E</p>
    <p>Code available at</p>
    <p>https://github.com/graffiti-hypervisor/graffiti-hypervisor</p>
  </div>
  <div class="page">
    <p>Mariano Graziano magrazia@cisco.com</p>
    <p>@emd3l</p>
    <p>QUESTIONS?</p>
  </div>
</Presentation>
