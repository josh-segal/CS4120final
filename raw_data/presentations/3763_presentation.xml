<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Prophecy: Using History for High Throughput Fault Tolerance</p>
    <p>Siddhartha Sen</p>
    <p>Joint work with Wyatt Lloyd and Mike Freedman</p>
    <p>Princeton University</p>
  </div>
  <div class="page">
    <p>Noncrash failures happenNon crash failures happen</p>
  </div>
  <div class="page">
    <p>Noncrash failures happenNon crash failures happen</p>
    <p>Model as Byzantine (malicious)(malicious)</p>
  </div>
  <div class="page">
    <p>Mask Byzantine faultsMask Byzantine faults</p>
    <p>Clients Service</p>
  </div>
  <div class="page">
    <p>Mask Byzantine faultsMask Byzantine faults</p>
    <p>ThroughputThroughput</p>
    <p>R li t d i</p>
    <p>Clients</p>
    <p>Replicated service</p>
  </div>
  <div class="page">
    <p>Mask Byzantine faultsMask Byzantine faults</p>
    <p>ThroughputThroughput</p>
    <p>R li t d i</p>
    <p>Clients</p>
    <p>Replicated service</p>
  </div>
  <div class="page">
    <p>Mask Byzantine faultsMask Byzantine faults</p>
    <p>ThroughputThroughput</p>
    <p>R li t d i</p>
    <p>Clients</p>
    <p>Replicated service</p>
  </div>
  <div class="page">
    <p>Mask Byzantine faultsMask Byzantine faults</p>
    <p>ThroughputThroughput</p>
    <p>R li t d i</p>
    <p>Clients</p>
    <p>Replicated service</p>
  </div>
  <div class="page">
    <p>Mask Byzantine faultsMask Byzantine faults</p>
    <p>ThroughputThroughput</p>
    <p>Linearizability ( t i t )(strong consistency)</p>
    <p>R li t d i</p>
    <p>Clients</p>
    <p>Replicated service</p>
  </div>
  <div class="page">
    <p>Byzantine fault tolerance (BFT)Byzantine fault tolerance (BFT)</p>
    <p>Low throughputLow throughput</p>
    <p>difi li Modifies clients</p>
    <p>Longlived sessions</p>
  </div>
  <div class="page">
    <p>ProphecyProphecy</p>
    <p>High throughput + good consistencyHigh throughput + good consistency</p>
    <p>f l h No free lunch:  Readmostly workloads  Slightly weakened consistency</p>
  </div>
  <div class="page">
    <p>Byzantine fault tolerance (BFT)Byzantine fault tolerance (BFT)</p>
    <p>Low throughput D ProphecyLow throughput</p>
    <p>difi li</p>
    <p>DProphecy</p>
    <p>Modifies clients Prophecy</p>
    <p>Longlived sessions</p>
  </div>
  <div class="page">
    <p>Traditional BFT readsTraditional BFT reads</p>
    <p>applicationapplication</p>
    <p>Clients</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>Traditional BFT readsTraditional BFT reads</p>
    <p>applicationapplication</p>
    <p>Agree?</p>
    <p>Clients</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>A cache solutionA cache solution</p>
    <p>applicationcache application</p>
    <p>Clients</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>A cache solutionA cache solution</p>
    <p>applicationcache application</p>
    <p>Agree?</p>
    <p>Clients</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>A cache solutionA cache solution</p>
    <p>applicationcache application</p>
    <p>Problems: Agree?</p>
    <p>Huge cache  Invalidation</p>
    <p>Clients</p>
    <p>Invalidation</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>A compact cacheA compact cache</p>
    <p>applicationcache application</p>
    <p>Requests Responses</p>
    <p>req1 resp1</p>
    <p>req2 resp2</p>
    <p>Clients</p>
    <p>req3 resp3</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>A compact cacheA compact cache</p>
    <p>applicationcache application</p>
    <p>Requests Responses</p>
    <p>sketch(req1) sketch(resp1)</p>
    <p>sketch(req2) sketch(resp2)</p>
    <p>Clients</p>
    <p>sketch(req3) sketch(resp3)</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>A sketcherA sketcher</p>
    <p>applicationsketcher application</p>
    <p>Clients</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>Executing a readExecuting a read sketch webpage</p>
    <p>Clients</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>Executing a readExecuting a read sketch webpage</p>
    <p>Clients</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>Executing a readExecuting a read sketch webpage</p>
    <p>Clients</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>Executing a readExecuting a read sketch webpage</p>
    <p>Agree?</p>
    <p>Clients</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>Executing a readExecuting a read sketch webpage</p>
    <p>Agree?</p>
    <p>Fast, loadbalanced reads</p>
    <p>Clients</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>Executing a readExecuting a read sketch webpage</p>
    <p>Agree?</p>
    <p>Clients</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>Executing a readExecuting a read sketch webpage</p>
    <p>Clients</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>Executing a readExecuting a read sketch webpage</p>
    <p>keyvalue store</p>
    <p>replicated state machine</p>
    <p>Clients</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>Executing a readExecuting a read sketch webpage</p>
    <p>Clients</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>Executing a readExecuting a read sketch webpage</p>
    <p>Clients</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>Executing a readExecuting a read sketch webpage</p>
    <p>Clients</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>Executing a readExecuting a read sketch webpage</p>
    <p>Agree?</p>
    <p>Clients</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>Executing a readExecuting a read sketch webpage</p>
    <p>Agree?</p>
    <p>Maintain a fresh cache</p>
    <p>Clients</p>
    <p>fresh cache</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>Did hi li i bilit ?Did we achieve linearizability?</p>
    <p>NO!</p>
  </div>
  <div class="page">
    <p>Executing a readExecuting a read sketch webpage</p>
    <p>Clients</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>Executing a readExecuting a read sketch webpage</p>
    <p>Clients</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>Executing a readExecuting a read sketch webpage</p>
    <p>Agree?</p>
    <p>Clients</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>Executing a readExecuting a read sketch webpage</p>
    <p>Clients</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>Executing a readExecuting a read sketch webpage</p>
    <p>Agree?</p>
    <p>Clients</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>Executing a readExecuting a read sketch webpage</p>
    <p>Agree?</p>
    <p>Fast reads may be stale</p>
    <p>Clients</p>
    <p>may be stale</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>Load balancingLoad balancing sketch webpage</p>
    <p>Clients</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>Load balancingLoad balancing sketch webpage</p>
    <p>Agree?</p>
    <p>Clients</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>Load balancingLoad balancing sketch webpage</p>
    <p>Agree?</p>
    <p>Pr(k stale) = gk</p>
    <p>Clients</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>DProphecy vs. BFTD Prophecy vs. BFT</p>
    <p>Traditional BFT:  Each replica executes readp  Linearizability</p>
    <p>DProphecy:  One replica executes read</p>
    <p>Clients</p>
    <p>Delayonce linearizability Replica Group</p>
  </div>
  <div class="page">
    <p>Byzantine fault tolerance (BFT)Byzantine fault tolerance (BFT)</p>
    <p>Low throughput D ProphecyLow throughput</p>
    <p>difi li</p>
    <p>DProphecy</p>
    <p>Modifies clients Prophecy</p>
    <p>Longlived sessions</p>
  </div>
  <div class="page">
    <p>Keyexchange overheadKey exchange overhead</p>
  </div>
  <div class="page">
    <p>Keyexchange overheadKey exchange overhead</p>
  </div>
  <div class="page">
    <p>Keyexchange overheadKey exchange overhead</p>
  </div>
  <div class="page">
    <p>Internet servicesInternet services</p>
    <p>CliClients</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>A proxy solutionA proxy solution</p>
    <p>Sketcher</p>
    <p>Cli</p>
    <p>Proxy</p>
    <p>Clients</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>A proxy solutionA proxy solution</p>
    <p>C lid tConsolidate sketchers</p>
    <p>Sketcher</p>
    <p>Cli</p>
    <p>Proxy</p>
    <p>Clients</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>A proxy solutionA proxy solution</p>
    <p>C lid tConsolidate sketchers</p>
    <p>Sketcher</p>
    <p>CliClients</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>A proxy solutionA proxy solution</p>
    <p>Sk t h tSketcher must be failstop</p>
    <p>Sketcher</p>
    <p>Cli dClients Trusted</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>A proxy solution</p>
    <p>Sketcher must be failstop</p>
    <p>A proxy solution</p>
    <p>iddl b l dSketcher must be fail stop Trust middlebox already  Small and simple</p>
    <p>Sketcher</p>
    <p>Cli dClients Trusted</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>Executing a readExecuting a read</p>
    <p>q</p>
    <p>Sketcher</p>
    <p>Cli d</p>
    <p>q</p>
    <p>Clients Trusted</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>Executing a readExecuting a read</p>
    <p>Sketcher</p>
    <p>Cli dClients Trusted</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>Executing a readExecuting a read</p>
    <p>Sketcher</p>
    <p>Cli d</p>
    <p>Clients Trusted</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>Executing a readExecuting a read</p>
    <p>Sketcher</p>
    <p>Cli d</p>
    <p>Req Resp</p>
    <p>( )</p>
    <p>Clients Trusted</p>
    <p>s(q)</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>Executing a readExecuting a read</p>
    <p>Sketcher</p>
    <p>Cli dClients Trusted</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>Executing a readExecuting a read</p>
    <p>Sketcher</p>
    <p>Cli dClients Trusted</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>Executing a readExecuting a read</p>
    <p>Sketcher</p>
    <p>Cli d</p>
    <p>Clients Trusted</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>Executing a readExecuting a read</p>
    <p>Sketcher</p>
    <p>Cli d</p>
    <p>Clients Trusted</p>
    <p>Req Resp</p>
    <p>( )</p>
    <p>Replica Group s(q)</p>
  </div>
  <div class="page">
    <p>Executing a readExecuting a read</p>
    <p>Sketcher</p>
    <p>Cli d</p>
    <p>Clients Trusted</p>
    <p>Req Resp</p>
    <p>( )</p>
    <p>Replica Group s(q)</p>
  </div>
  <div class="page">
    <p>ProphecyProphecy</p>
    <p>Sketcher</p>
    <p>Cli d</p>
    <p>Clients Trusted</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>ProphecyProphecy</p>
    <p>Fast, loadbalanced reads</p>
    <p>Sketcher</p>
    <p>Cli d</p>
    <p>Clients Trusted</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>ProphecyProphecy</p>
    <p>Fast reads may be stale</p>
    <p>Sketcher</p>
    <p>Cli d</p>
    <p>Clients Trusted</p>
    <p>Req Resp</p>
    <p>( )</p>
    <p>Replica Group s(q)</p>
  </div>
  <div class="page">
    <p>Delayonce linearizabilityDelay once linearizability</p>
  </div>
  <div class="page">
    <p>Delayonce linearizabilityDelay once linearizability</p>
  </div>
  <div class="page">
    <p>Delayonce linearizabilityDelay once linearizability</p>
    <p>W, R, W, W, R, R, W, R</p>
  </div>
  <div class="page">
    <p>Delayonce linearizabilityDelay once linearizability</p>
    <p>Readafterwrite property</p>
    <p>W, R, W, W, R, R, W, R</p>
  </div>
  <div class="page">
    <p>Delayonce linearizabilityDelay once linearizability</p>
    <p>Readafterwrite property</p>
    <p>W, R, W, W, R, R, W, R</p>
  </div>
  <div class="page">
    <p>Example applicationExample application</p>
    <p>Upload embarrassing photosUpload embarrassing photos 1. Remove colleagues from ACL</p>
    <p>Weak may reorder</p>
    <p>Delayonce preserves order</p>
  </div>
  <div class="page">
    <p>Byzantine fault tolerance (BFT)Byzantine fault tolerance (BFT)</p>
    <p>Low throughput D ProphecyLow throughput</p>
    <p>difi li</p>
    <p>DProphecy</p>
    <p>Modifies clients Prophecy</p>
    <p>Longlived sessions</p>
  </div>
  <div class="page">
    <p>ImplementationImplementation</p>
    <p>Modified PBFTModified PBFT  PBFT is stable, complete Competitive with Zyzzyva et al Competitive with Zyzzyva et. al.</p>
    <p>C++, Tamer async I/O  Sketcher: 2000 LOC  PBFT library: 1140 LOC  PBFT client: 1000 LOC</p>
  </div>
  <div class="page">
    <p>EvaluationEvaluation</p>
    <p>Prophecy vs proxiedPBFTProphecy vs. proxied PBFT  Proxied systems</p>
    <p>DProphecy vs. PBFT  Nonproxied systems</p>
  </div>
  <div class="page">
    <p>EvaluationEvaluation</p>
    <p>Prophecy vs proxiedPBFTProphecy vs. proxied PBFT  Proxied systems</p>
    <p>We will study:  Performance on null workloads Performance on null workloads  Performance with real replicated service Where system bottlenecks how to scale Where system bottlenecks, how to scale</p>
  </div>
  <div class="page">
    <p>Basic setupBasic setup</p>
    <p>Sk t hSketcher</p>
    <p>Clients (concurrent)Clients (100)</p>
    <p>Replica Group (PBFT)</p>
  </div>
  <div class="page"/>
  <div class="page">
    <p>Fraction of failedFraction of failed fast reads</p>
  </div>
  <div class="page">
    <p>Fraction of failedAlexa top sites: Fraction of failed fast reads</p>
    <p>Alexa top sites: &lt; 15%</p>
  </div>
  <div class="page">
    <p>Small benefit on null readsSmall benefit on null reads</p>
  </div>
  <div class="page">
    <p>Small benefit on null readsSmall benefit on null reads</p>
  </div>
  <div class="page">
    <p>Apache webserver setupApache webserver setup</p>
    <p>Sk t hSketcher</p>
    <p>ClientsClients</p>
    <p>Replica Group</p>
  </div>
  <div class="page">
    <p>Large benefit on real workloadLarge benefit on real workload</p>
  </div>
  <div class="page">
    <p>Large benefit on real workloadLarge benefit on real workload</p>
  </div>
  <div class="page">
    <p>Large benefit on real workloadLarge benefit on real workload</p>
  </div>
  <div class="page">
    <p>Large benefit on real workloadLarge benefit on real workload</p>
  </div>
  <div class="page">
    <p>Benefit grows with workBenefit grows with work</p>
  </div>
  <div class="page">
    <p>Benefit grows with workBenefit grows with work</p>
  </div>
  <div class="page">
    <p>Benefit grows with workBenefit grows with work</p>
  </div>
  <div class="page">
    <p>Benefit grows with workBenefit grows with work 94s (Apache)</p>
  </div>
  <div class="page">
    <p>Benefit grows with workBenefit grows with work 94s (Apache)</p>
    <p>Null workloads are misleading!are misleading!</p>
  </div>
  <div class="page">
    <p>Benefit grows with workBenefit grows with work</p>
  </div>
  <div class="page">
    <p>Single sketcher bottlenecksSingle sketcher bottlenecks</p>
  </div>
  <div class="page">
    <p>Single sketcher bottlenecksSingle sketcher bottlenecks</p>
  </div>
  <div class="page">
    <p>Scaling outScaling out</p>
  </div>
  <div class="page">
    <p>Scales linearly with replicasScales linearly with replicas</p>
  </div>
  <div class="page">
    <p>SummarySummary</p>
    <p>Prophecy good for Internet servicesp y g  Fast, loadbalanced reads</p>
    <p>D Prophecy good for traditional services DProphecy good for traditional services</p>
    <p>Prophecy scales linearly while PBFT stays flatProphecy scales linearly while PBFT stays flat</p>
    <p>Limitations:  Readmostly workloads (meas. study corroborates)  Delayonce linearizability (useful for many apps)</p>
  </div>
  <div class="page">
    <p>Thank You</p>
  </div>
  <div class="page">
    <p>Additional slides</p>
  </div>
  <div class="page">
    <p>TransitionsTransitions</p>
    <p>Prophecy good for readmostly workloadsProphecy good for read mostly workloads</p>
    <p>i i i i ? Are transitions rare in practice?</p>
  </div>
  <div class="page">
    <p>Measurement studyMeasurement study</p>
    <p>Alexa top sitesAlexa top sites</p>
    <p>Access main page every 20 sec for 24 hrs</p>
  </div>
  <div class="page">
    <p>Mostly static contentMostly static content</p>
  </div>
  <div class="page">
    <p>Mostly static contentMostly static content</p>
  </div>
  <div class="page">
    <p>Mostly static contentMostly static content 15%</p>
  </div>
  <div class="page">
    <p>Dynamic contentDynamic content</p>
    <p>Rabin fingerprinting on transitionsRabin fingerprinting on transitions</p>
    <p>43% differ by single contiguous change 43% differ by single contiguous change</p>
    <p>Sampled 4000 of them, over half due to:  Load balancing directives  Random IDs in links, function parameters</p>
  </div>
</Presentation>
