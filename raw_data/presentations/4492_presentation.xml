<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Improving Online Gaming Quality</p>
    <p>using Detour Paths</p>
    <p>Cong Ly, Cheng-Hsin Hsu, and Mohamed Hefeeda</p>
    <p>Simon Fraser University, Canada</p>
    <p>Deutsche Telekom Labs, USA</p>
  </div>
  <div class="page">
    <p>Online Multiplayer Games</p>
    <p>37% of the US population played online games in 2009 [Nielsen]</p>
    <p>World of Warcraft (WoW) has 11.5 million subscribers [Blizzard]</p>
    <p>Market research forecasts [NPD]</p>
    <p>- $48.9 billion revenue by 2011</p>
  </div>
  <div class="page">
    <p>Gaming traffic - Highly periodic</p>
    <p>- Low bit rates (25  100 bytes/packet) [Feng]</p>
    <p>- Less sensitive to bandwidth and packet loss</p>
    <p>- Sensitive to high latency</p>
    <p>Network latency in the Internet - Geographical locations</p>
    <p>- Link congestion (failure)</p>
    <p>- Types of network technology, e.g., 3G data networks</p>
    <p>Online Gaming over the Internet</p>
  </div>
  <div class="page">
    <p>Different types of games can tolerate different amount of quality degradation caused by network latency [Claypool]</p>
    <p>Higher than these thresholds would lead to significant drops in gaming quality  Players will leave the game</p>
    <p>Network Latency</p>
    <p>Game Type Example Genre Latency Threshold</p>
    <p>Avatar First-person shooter (FPS), Racing 100 msec</p>
    <p>Sports, Role-playing games (RPG) 500 msec</p>
    <p>Omnipresent Real-time strategy (RTS), Simulations 1,000 msec</p>
    <p>More efficient routing is needed for game traffic!</p>
  </div>
  <div class="page">
    <p>Motivation</p>
    <p>Problem Statement</p>
    <p>Related Work</p>
    <p>Design and Implementation</p>
    <p>Real Deployments and Experimental Results</p>
    <p>Simulation Results</p>
    <p>Conclusions</p>
    <p>Outline</p>
  </div>
  <div class="page">
    <p>Problem Statement</p>
    <p>Players form game sessions  Problem: design an efficient system to reduce the</p>
    <p>network latency among players in each game session</p>
  </div>
  <div class="page">
    <p>Latency compensation mechanisms - Lockstep and event-locking, controls consistency [Baughman 01]</p>
    <p>- Dead reckoning (DR), extrapolate the behavior [Bernierr 01]</p>
    <p>- Matchmaking, prevents high latency peers from playing together [Agarwal 09]</p>
    <p>- Hide network latency</p>
    <p>Detour routing for latency reduction - RON (resilient overlay network) [Andersen 01]</p>
    <p>- OverQoS uses overlay routing for QoS enhancements [Subramanian 04]</p>
    <p>- PeerWise searches for faster detour paths [Lumezanu 07]</p>
    <p>- Not for online multiplayer games</p>
    <p>We use detour paths in online gaming networks to directly reduce end-to-end network latency</p>
    <p>Related Work</p>
  </div>
  <div class="page">
    <p>Detour paths: indirect paths that lead to smaller RTTs</p>
    <p>Exist because of triangle inequality violations (TIVs) in Internet [Savage 99]</p>
    <p>Inter-domain policy routing</p>
    <p>By routing game-state updates over detour paths, we can reduce end-to-end RTTs</p>
    <p>Detour Paths</p>
    <p>How many hops should we consider when identifying detour paths?</p>
  </div>
  <div class="page">
    <p>We conducted RTT measurements among more than 28,000 IPs from online game players</p>
    <p>We quantify the potential of detour routing in online games</p>
    <p>Number of Hops</p>
    <p>Average RTT of detour paths  Reduced from 156</p>
    <p>msec to 53 msec with just 1-hop</p>
    <p>Optimal k*-hop is 46 msec</p>
  </div>
  <div class="page">
    <p>We propose the Indirect Relay System (IRS) to identify 1-hop detour paths</p>
    <p>Straightforward approach: construct a graph - May take prohibitively long time to measure RTTs</p>
    <p>A better solution: evaluate the likelihood for a client r to be the best relay client based on estimation errors of network coordinates  Higher estimation error results in higher likelihood of detour</p>
    <p>paths [Lumezanu 09]</p>
    <p>Actual relay node evaluations are distributed to the clients</p>
    <p>Indirect Relay System (IRS)</p>
  </div>
  <div class="page">
    <p>Integration  Lobby server or Standalone</p>
    <p>Shortest RTT (SRTT) Algorithm  Compute estimate errors</p>
    <p>Select K potential relay clients</p>
    <p>IRS Server Design</p>
  </div>
  <div class="page">
    <p>IRS Client Design</p>
    <p>Integration  Game client</p>
    <p>Shortest RTT (SRTT) Algorithm  Conduct actual RTT measurements to the K potential relay</p>
    <p>clients</p>
  </div>
  <div class="page">
    <p>About 3,700 lines of Java code.  Client &amp; Server components</p>
    <p>Network coordinates system  Uses Vivaldi, a decentralized network coordinate</p>
    <p>system  Based on open source Pyxida project [Ledlie]</p>
    <p>Simulate real gaming traffic  Randomly send packets between 25-100 bytes  Relay overhead are embedded in the Proxy-Ping</p>
    <p>Implementation</p>
  </div>
  <div class="page">
    <p>Planetlab Deployment</p>
    <p>On 500+ nodes  K potential relay clients and N neighbors are set to 32  More than 3,000 game sessions with length between 3</p>
    <p>and 10 mins  Five experiments to rule out the time-of-day variations  9+ hours each run  Results from the experiments are consistent, and we</p>
    <p>report the results from the experiment conducted on Jan 07, 2010</p>
  </div>
  <div class="page">
    <p>RTT Reduction</p>
    <p>Some sessions are reduced from &gt; 3 sec to &lt; 0.3 sec</p>
    <p>More than 60% player pairs achieve more than 100 msec reduction</p>
  </div>
  <div class="page">
    <p>Gaming Performance Improvement</p>
    <p>Better QoE  better gaming performance  30% of players can increase their hit fractions by more</p>
    <p>than 10%</p>
  </div>
  <div class="page">
    <p>Existence of Backup Detour Paths</p>
    <p>Number of detour paths found by IRS  55% of the clients have at least one detour path</p>
    <p>24% of the clients have two or more</p>
  </div>
  <div class="page">
    <p>Network Overhead</p>
    <p>Server: up to 307 updates per minute for 500+ nodes</p>
    <p>Client: sends one packet every 16 sec</p>
  </div>
  <div class="page">
    <p>Residential Deployment</p>
    <p>Home computers with DSL and cable modem access links</p>
    <p>17 nodes, 7 cities around the world  Experiment ran for 1 week  K potential relay clients and N neighbors are set to 8  Users are allowed to join and leave the experiment at any</p>
    <p>time</p>
  </div>
  <div class="page">
    <p>Latency Reduction</p>
    <p>Despite with only 17 nodes, IRS identified 8 detour paths</p>
    <p>50% reduction for Vancouver to Linkoping (199 msec to 101 msec)</p>
    <p>A backup detour path through another Vancouver node leads to 162 msec</p>
  </div>
  <div class="page">
    <p>Simulation Setups</p>
    <p>Evaluate the IRS system with wider ranges of parameters - Results are in the papers</p>
    <p>Study the matchability improvement of different RTT threshold - Compute the number of other players each player can connect</p>
    <p>to while maintaining acceptable gaming quality</p>
    <p>- Calculate the difference with and without the ISR system</p>
  </div>
  <div class="page">
    <p>Matchability Improvement</p>
    <p>With a 100 msec threshold, more than half of the player can connect to 20% more players with the ISR system</p>
  </div>
  <div class="page">
    <p>We proposed to reduce latency by leveraging on detour paths</p>
    <p>We designed and implemented IRS system to locate detour paths</p>
    <p>We deployed this actual implementation on PlanetLab and home computers, and conducted experiments</p>
    <p>We used simulations to exercise the IRS system with wider ranges of parameters</p>
    <p>Evaluation results indicate that our system - (i) reduces RTT, (ii) increases matchability, (iii) incurs low</p>
    <p>network overhead, and (iv) improves gaming quality (performance)</p>
    <p>Conclusions</p>
  </div>
  <div class="page">
    <p>Questions and Comments</p>
    <p>Thank you!</p>
  </div>
  <div class="page">
    <p>Embedding Errors</p>
    <p>Identifying TIV - Network coordinates are in Euclidian space</p>
    <p>- Calculated as Estimates  Measured</p>
    <p>- +40 and +30 indicate excess estimates. -30 under estimated</p>
  </div>
  <div class="page">
    <p>Likelihood Function</p>
    <p>),(),( ),(),('),(</p>
    <p>),(),('),(</p>
    <p>)( ^</p>
    <p>trErsE trDxxDtrE</p>
    <p>rsDxxDrsE</p>
    <p>rE tr</p>
    <p>rs if D(s,r) is known;</p>
    <p>if D(r,t) is known;</p>
    <p>if D(s,r) and D(r,t) are known</p>
  </div>
  <div class="page">
    <p>Measuring Relay Overhead</p>
    <p>Relay Overhead - Commodity PC with 2.8Ghz Intel CPU</p>
    <p>- 6.2 msec with Starcraft 2, real-time strategy game</p>
    <p>- 6.5 msec with Counter Strike: Source, first-person shooter</p>
  </div>
  <div class="page">
    <p>Expected Impact</p>
    <p>First-person shooter game - Significant drop in hit ratio when latency is greater than 200 msec.</p>
    <p>Latency (msec) Hit Ratio Kill Count Death Count</p>
  </div>
  <div class="page">
    <p>37% of the US population played online games in 2009 [Nielsen]</p>
    <p>World of Warcraft (WoW) have 11.5 million subscribers [Blizzard]</p>
    <p>5 million players for the Halo franchise [Microsoft]</p>
    <p>Market research forecasts [NPD]</p>
    <p>- $48.9 billion revenue by 2011</p>
    <p>Internet gaming traffic forecasts [Cisco]</p>
    <p>- 239 PB/month world wide by 2013!</p>
    <p>Market Demand and Potential</p>
  </div>
  <div class="page">
    <p>Using RTT measurements, we quantify the potential of detour routing in online multiplayer games.</p>
    <p>We analyze the expected impact of 1,2,3 and k*-hop detour routing on player performance in different online games.</p>
    <p>We propose a 1-hop overlay routing system called Indirect Relay System (IRS).</p>
    <p>Using results from Planetlab and residential deployments we show that IRS reduces RTT (roundtrip time) among players in online games.</p>
    <p>Thesis Contributions</p>
  </div>
  <div class="page">
    <p>We conducted measurements study  RTT measurements from more than 28,000 IPs from online</p>
    <p>game players.</p>
    <p>18.8 million pair-wise RTT measurements</p>
    <p>We quantify the potential of detour routing in online games.  Impact of detour routing in online games</p>
    <p>Potential of 1, 2, 3, and k* relay clients</p>
    <p>Measurements Study</p>
  </div>
  <div class="page">
    <p>Average RTT  Reduced from 156 msec to 53 msec with just 1-hop</p>
    <p>Optimal k*-hop is 46 msec.</p>
    <p>Average RTT</p>
  </div>
  <div class="page">
    <p>Hit Ratio improvements  60% of players gain at least 10% just 1-hop</p>
    <p>Impact On Actual Games</p>
  </div>
</Presentation>
