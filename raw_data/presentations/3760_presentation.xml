<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>An Off-Chip Attack on Hardware Enclaves via the Memory Bus</p>
    <p>Dayeol Lee1, Dongha Jung3, Ian T. Fang1, Chia-Che Tsai1,2, Raluca Ada Popa1</p>
  </div>
  <div class="page">
    <p>Trusted Execution Environments (TEEs)</p>
    <p>Sensitive App Other Apps</p>
    <p>DRAM Enclave</p>
    <p>OS / Hypervisor</p>
    <p>Trusted Processor</p>
    <p>SW</p>
    <p>HW</p>
    <p>Integrity</p>
    <p>Confidentiality</p>
    <p>Remote Attestation</p>
  </div>
  <div class="page">
    <p>Memory Encryption of Intel SGX</p>
    <p>DRAM Enclave</p>
    <p>Processor Cores</p>
    <p>Trusted</p>
    <p>Untrusted</p>
    <p>Memory Encryption</p>
    <p>Engine</p>
  </div>
  <div class="page">
    <p>Dictionary (Hash Table):</p>
    <p>Spell Checker:</p>
    <p>Access Pattern Leakage via Side Channel</p>
    <p>Input Text</p>
    <p>for each word in input text: ... dictionary.search(word) ...</p>
    <p>casktable[0] book ...</p>
    <p>crytable[1] rich ... ...</p>
    <p>Hunspell [Xu et al., 17]</p>
  </div>
  <div class="page">
    <p>Dictionary (Hash Table):</p>
    <p>Spell Checker:</p>
    <p>Access Pattern Leakage via Side Channel</p>
    <p>Input Text</p>
    <p>for each word in input text: ... dictionary.search(word) ...</p>
    <p>casktable[0] book ...</p>
    <p>crytable[1] rich ... ...</p>
    <p>Access Pattern:</p>
    <p>book</p>
    <p>Hunspell [Xu et al., 17]</p>
    <p>The book was written by</p>
  </div>
  <div class="page">
    <p>B us</p>
    <p>Side-Channel Attacks on SGX Enclaves</p>
    <p>Victim Attacker</p>
    <p>MMU</p>
    <p>Cache</p>
    <p>DRAM</p>
    <p>Cache Side-Channel Attacks  Brasser17, Schwarz17, Moghimi17,</p>
    <p>VanBulck18</p>
    <p>Page Table-Based Attacks  Controlled-Channel'15, VanBulck17</p>
    <p>Side Channel</p>
    <p>Side Channel</p>
  </div>
  <div class="page">
    <p>B u</p>
    <p>s</p>
    <p>Side-Channel Attacks on SGX Enclaves</p>
    <p>Victim Attacker</p>
    <p>MMU</p>
    <p>Cache</p>
    <p>DRAM</p>
    <p>Cache Side-Channel Attacks  Brasser17, Schwarz17, Moghimi17,</p>
    <p>VanBulck18</p>
    <p>Page Table-Based Attacks  Controlled-Channel'15, VanBulck17</p>
    <p>Mitigations  Varys 18, Chen et al.18, Gruss et al.</p>
    <p>17, T-SGX17, DJ Vu 17</p>
    <p>TEEs from Academia  Keystone20, Sanctum16</p>
  </div>
  <div class="page">
    <p>B u</p>
    <p>s</p>
    <p>MEMBUSTER: Demonstrating Off-Chip Attack</p>
    <p>Victim Attacker</p>
    <p>MMU</p>
    <p>Cache</p>
    <p>DRAM</p>
    <p>Attacker</p>
    <p>Cache Side-Channel Attacks  Brasser17, Schwarz17, Moghimi17,</p>
    <p>VanBulck18</p>
    <p>Page Table-Based Attacks  Controlled-Channel'15, VanBulck17</p>
    <p>Mitigations  Varys 18, Chen et al.18, Gruss et al.</p>
    <p>17, T-SGX17, DJ Vu 17</p>
    <p>TEEs from Academia  Keystone20, Sanctum16</p>
  </div>
  <div class="page">
    <p>Cache Side-Channel Attacks  Brasser17, Schwarz17, Moghimi17,</p>
    <p>VanBulck18</p>
    <p>Page Table-Based Attacks  Controlled-Channel'15, VanBulck17</p>
    <p>Mitigations  Varys 18, Chen et al.18, Gruss et al.</p>
    <p>17, T-SGX17, DJ Vu 17</p>
    <p>TEEs from Academia  Keystone20, Sanctum16</p>
    <p>B us</p>
    <p>MEMBUSTER: Demonstrating Off-Chip Attack</p>
    <p>Victim Attacker</p>
    <p>MMU</p>
    <p>Cache</p>
    <p>DRAM</p>
    <p>Attacker</p>
    <p>None of these can mitigate</p>
  </div>
  <div class="page">
    <p>MEMBUSTER: Demonstrating Off-Chip Attack</p>
    <p>B us</p>
    <p>Victim Attacker</p>
    <p>MMU</p>
    <p>Cache</p>
    <p>DRAM</p>
    <p>Attacker</p>
    <p>Hard to detect or mitigate on chip  No interference with SW  Resource partitioning does not work</p>
    <p>Oblivious memory access  Performance impact</p>
    <p>Address bus encryption  Infeasible in commodity DRAM</p>
  </div>
  <div class="page">
    <p>B us</p>
    <p>Challenges of the Off-Chip Attack</p>
    <p>Victim (Enclave)</p>
    <p>MMU</p>
    <p>Cache</p>
    <p>DRAM</p>
    <p>Address Translation and Synchronization</p>
    <p>Attacker</p>
    <p>VA PA</p>
    <p>C M</p>
    <p>D</p>
  </div>
  <div class="page">
    <p>B us</p>
    <p>Challenges of the Off-Chip Attack</p>
    <p>Victim (Enclave)</p>
    <p>Attacker</p>
    <p>MMU</p>
    <p>Cache</p>
    <p>DRAM</p>
    <p>Address Translation and Synchronization</p>
    <p>Lossy Channel due to Cache Hierarchy</p>
    <p>M is</p>
    <p>s</p>
    <p>A cc</p>
    <p>es s</p>
    <p>H it</p>
  </div>
  <div class="page">
    <p>B us</p>
    <p>Challenges of the Off-Chip Attack</p>
    <p>Victim (Enclave)</p>
    <p>Attacker</p>
    <p>MMU</p>
    <p>Cache</p>
    <p>DRAM</p>
    <p>Address Translation and Synchronization</p>
    <p>Lossy Channel due to Cache Hierarchy</p>
    <p>Unusual Behavior in SGX</p>
  </div>
  <div class="page">
    <p>B us</p>
    <p>Challenges of the Off-Chip Attack</p>
    <p>Victim (Enclave)</p>
    <p>Attacker</p>
    <p>MMU</p>
    <p>Cache</p>
    <p>DRAM</p>
    <p>Address Translation and Synchronization</p>
    <p>Lossy Channel due to Cache Hierarchy</p>
    <p>Unusual Behavior in SGX</p>
  </div>
  <div class="page">
    <p>Maximizing Side-Channel Information</p>
    <p>Victim</p>
    <p>Cache</p>
    <p>PRIME  Goal:  Increase cache misses</p>
    <p>Avoid detectable interference</p>
    <p>Cross-core cache priming  Cache eviction in PRIME+PROBE Attack</p>
    <p>Problems</p>
    <p>Insufficient memory access bandwidth</p>
    <p>Large last-level cache</p>
    <p>Hundreds of milliseconds to evict all</p>
    <p>M is</p>
    <p>s</p>
    <p>A cc</p>
    <p>es s</p>
    <p>A cc</p>
    <p>es s</p>
    <p>Attacker</p>
  </div>
  <div class="page">
    <p>Maximizing Side-Channel Information</p>
    <p>Victim</p>
    <p>Cache</p>
    <p>PRIME  Observation 1 The address mapping is untrusted</p>
    <p>M is</p>
    <p>s</p>
    <p>A cc</p>
    <p>es s</p>
    <p>A cc</p>
    <p>es s</p>
    <p>Attacker</p>
    <p>Untrusted OS</p>
  </div>
  <div class="page">
    <p>Cache</p>
    <p>Maximizing Side-Channel Information</p>
    <p>Victim PRIME  Observation 1 The address mapping is untrusted</p>
    <p>Observation 2 The attacker only needs to observe critical memory accesses</p>
    <p>M is</p>
    <p>s</p>
    <p>Attacker</p>
    <p>Untrusted OS</p>
    <p>A cc</p>
    <p>es s</p>
    <p>A cc</p>
    <p>es s</p>
    <p>Idea: Squeeze the Cache!</p>
    <p>A cc</p>
    <p>es s</p>
  </div>
  <div class="page">
    <p>Cache Squeezing in a Nutshell</p>
    <p>Critical Pages</p>
    <p>Virtual Pages (Victim) EPC Pages LLC Sets OS Pages</p>
    <p>No interrupt nor fault Small slowdown</p>
  </div>
  <div class="page">
    <p>Evaluation  Hardware</p>
    <p>Intel i5-8400 (Coffee Lake)  LLC: 9MB, 6-slice, 12-way set associative, 2048 sets</p>
    <p>DRAM: Non-ECC DDR4-2400 UDIMM 8GB  Interposer/signal analyzer from SK Hynix</p>
    <p>Software  Two attack examples: Hunspell and Memcached</p>
    <p>Graphene-SGX with unmodified victim application  Modified SGX driver for cache squeezing</p>
  </div>
  <div class="page">
    <p>Hunspell Attack Results  Randomly-generated words (Random) and Wizard of Oz (Wizard)</p>
    <p>Squeezing+Priming recovers most of the data</p>
    <p>RaQdRP Wizard 0.8</p>
    <p>P al</p>
    <p>iz ed</p>
    <p>Ex ec</p>
    <p>uW iR</p>
    <p>Q Ti</p>
    <p>P e</p>
    <p>RaQdRP WLzard WLzard (w/R 1/TK)</p>
    <p>R ec</p>
    <p>Rv er</p>
    <p>y (%</p>
    <p>)</p>
    <p>No interference: hard to detect with on-chip techniques 99% 85% 1.36x</p>
    <p>RaQdRP WLzard WLzard (w/R 1/TK)</p>
    <p>R ec</p>
    <p>Rv er</p>
    <p>y (%</p>
    <p>) 1RQe 64 64+PR</p>
    <p>RaQdRP WLzard WLzard (w/R 1/TK)</p>
    <p>R ec</p>
    <p>Rv er</p>
    <p>y (%</p>
    <p>) 1RQe 64 64+PR</p>
    <p>RaQdRP WLzard WLzard (w/R 1/TK)</p>
    <p>R ec</p>
    <p>Rv er</p>
    <p>y (%</p>
    <p>)</p>
  </div>
  <div class="page">
    <p>Conclusion  Membuster: an off-chip attack via the memory bus</p>
    <p>Performed on commodity CPU and DRAM</p>
    <p>Non-interfering with victim application</p>
    <p>Previous on-chip solutions or other TEEs do not defeat the attack</p>
    <p>Costly mitigation techniques</p>
    <p>Oblivious memory access</p>
    <p>Alternative TEE architecture (e.g., memory bus encryption)</p>
    <p>Thank You!</p>
  </div>
  <div class="page">
    <p>Thank You!</p>
    <p>Dayeol Lee (dayeol@berkeley.edu) Chia-Che Tsai (chiache@tamu.edu) Raluca Ada Popa (raluca.popa@berkeley.edu)</p>
  </div>
</Presentation>
