<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Performance Pathologies in Hardware Transactional Memory</p>
    <p>Jayaram Bobba, Kevin E. Moore, Haris Volos, Luke Yen, Mark D. Hill, Michael M. Swift, and David A. Wood</p>
    <p>Multifacet Project (www.cs.wisc.edu/multifacet)</p>
    <p>Computer Sciences Dept., University of Wisconsin Madison</p>
  </div>
  <div class="page">
    <p>2007 Multifacet Project</p>
    <p>Multiple Hardware Transactional Memory Designs  Best Performance ?</p>
    <p>Depends !</p>
    <p>Executive Summary (1/2)</p>
    <p>L iv</p>
    <p>e lo</p>
    <p>c k</p>
  </div>
  <div class="page">
    <p>2007 Multifacet Project</p>
    <p>Executive Summary (2/2)</p>
    <p>Why?</p>
    <p>Performance Pathologies</p>
    <p>What to do?  Better Conflict Resolution</p>
    <p>Performance Pathologies Performance</p>
    <p>L iv</p>
    <p>e lo</p>
    <p>c k</p>
    <p>pathology: any deviation from a normal, healthy or efficient condition</p>
  </div>
  <div class="page">
    <p>2007 Multifacet Project</p>
    <p>Talk Outline</p>
    <p>Motivation</p>
    <p>Base HTM Results</p>
    <p>Performance Pathologies</p>
    <p>Enhanced HTM Systems</p>
  </div>
  <div class="page">
    <p>2007 Multifacet Project</p>
    <p>Motivation</p>
    <p>Which HTM system performs best?</p>
    <p>Different Assumptions  Hardware</p>
    <p>Broadcast vs Directory Based</p>
    <p>Software:</p>
    <p>Continuous Transactions vs Critical Section Transactions</p>
    <p>How to compare?</p>
  </div>
  <div class="page">
    <p>2007 Multifacet Project</p>
    <p>HTM Design Space</p>
    <p>Version ManagementVersion Management</p>
    <p>C o</p>
    <p>n flic</p>
    <p>t D e</p>
    <p>te c</p>
    <p>tio n</p>
    <p>C o</p>
    <p>n flic</p>
    <p>t D e</p>
    <p>te c</p>
    <p>tio n</p>
    <p>Lazy Eager</p>
    <p>Lazy</p>
    <p>Eager</p>
    <p>Herlihy/Moss TM</p>
    <p>MIT LTM</p>
    <p>Intel/Brown VTM</p>
    <p>Stanford TCC</p>
    <p>Illinois Bulk</p>
    <p>MIT UTM</p>
    <p>Wisconsin LogTM</p>
    <p>No HTMs (yet)</p>
    <p>Conflict ResolutionConflict Resolution: Adhoc</p>
    <p>Better By Design ?</p>
  </div>
  <div class="page">
    <p>2007 Multifacet Project</p>
    <p>Experimental Setup</p>
    <p>Base HTM Systems</p>
    <p>Common Hardware Platform  32 core CMP</p>
    <p>Directory-Based Coherence</p>
    <p>Common TM Programming Model  Critical Section Based Transactions</p>
    <p>Common Workloads  5 SPLASH + 2 Microbenchmarks (Btree, LFUCache)</p>
  </div>
  <div class="page">
    <p>2007 Multifacet Project</p>
    <p>And the winner is</p>
    <p>Low Contention: Similar  High Contention: Depends</p>
    <p>L iv</p>
    <p>e lo</p>
    <p>c k</p>
  </div>
  <div class="page">
    <p>2007 Multifacet Project</p>
    <p>Talk Outline</p>
    <p>Motivation</p>
    <p>Base HTM Results</p>
    <p>Performance Pathologies</p>
    <p>Enhanced HTM Systems</p>
  </div>
  <div class="page">
    <p>2007 Multifacet Project</p>
    <p>Performance Pathologies</p>
    <p>StarvingElder</p>
    <p>SerializedCommit</p>
    <p>RestartConvoy</p>
    <p>FriendlyFire</p>
    <p>DuelingUpgrades</p>
    <p>FutileStall</p>
    <p>StarvingWriter</p>
  </div>
  <div class="page">
    <p>2007 Multifacet Project</p>
    <p>System</p>
    <p>Conflict Detection: Lazy Detect conflicts at commit time (Validation)</p>
    <p>Version Management: Lazy New value elsewhere, Update on commit</p>
    <p>+ Abort</p>
    <p>- Commit</p>
    <p>Conflict Resolution: Committer Wins</p>
    <p>compare with TCC, Bulk</p>
  </div>
  <div class="page">
    <p>2007 Multifacet Project</p>
    <p>COMMITING</p>
    <p>STALLED</p>
    <p>ABORTING</p>
    <p>CAUSE</p>
    <p>Committer Wins</p>
    <p>EFFECT(S)</p>
    <p>Starvation</p>
    <p>Load Imbalance</p>
    <p>FIX</p>
    <p>Elder gets Priority ?</p>
    <p>StarvingElder</p>
    <p>store A</p>
    <p>load A</p>
    <p>ABORT</p>
    <p>store A</p>
    <p>load A</p>
    <p>ABORT</p>
    <p>store A</p>
    <p>load A</p>
    <p>ABORT</p>
    <p>T im</p>
    <p>e</p>
  </div>
  <div class="page">
    <p>2007 Multifacet Project</p>
    <p>RestartConvoy</p>
    <p>load A load A load A</p>
    <p>CAUSE</p>
    <p>Fast Abort +</p>
    <p>Immediate Restart</p>
    <p>EFFECT(S)</p>
    <p>Resource Contention</p>
    <p>Serialized Execution</p>
    <p>Lock Convoys</p>
    <p>FIX</p>
    <p>Stagger Restarts ?</p>
    <p>load A load A load A</p>
    <p>load A store A</p>
    <p>ABORTABORTABORT</p>
    <p>load A</p>
    <p>load A load A load A</p>
    <p>store A</p>
    <p>ABORT ABORT ABORT</p>
  </div>
  <div class="page">
    <p>2007 Multifacet Project</p>
    <p>Pathologies</p>
    <p>Pathology (% ExecutionTime)</p>
    <p>Enhancement  Linear Backoff on Abort  Eliminate RestartConvoys</p>
    <p>Starving Elder</p>
    <p>Serialized Commit</p>
    <p>Restart Convoy</p>
    <p>Starving Elder</p>
    <p>Serialized Commit</p>
    <p>Restart Convoy</p>
    <p>Raytrace 45 27 5.2 0.1 0.3 1.0</p>
  </div>
  <div class="page">
    <p>2007 Multifacet Project</p>
    <p>Enhanced LL ( )</p>
    <p>Pathology (% ExecutionTime)</p>
    <p>Performance</p>
    <p>Starving Elder</p>
    <p>Serialized Commit</p>
    <p>Restart Convoy</p>
    <p>Starving Elder</p>
    <p>Serialized Commit</p>
    <p>Restart Convoy</p>
    <p>Raytrace 45 27 5.2 0.1 0.3 1.0</p>
  </div>
  <div class="page">
    <p>2007 Multifacet Project</p>
    <p>Performance Pathologies</p>
    <p>StarvingElder</p>
    <p>SerializedCommit</p>
    <p>RestartConvoy</p>
    <p>FriendlyFire</p>
    <p>DuelingUpgrades</p>
    <p>FutileStall</p>
    <p>StarvingWriter</p>
  </div>
  <div class="page">
    <p>2007 Multifacet Project</p>
    <p>System</p>
    <p>Conflict Detection: Eager  Detect conflicts immediately</p>
    <p>Version Management: Lazy  New Value elsewhere, Update on commit</p>
    <p>+ Abort</p>
    <p>- Commit</p>
    <p>Conflict Resolution:  Requester Wins  Exponential Backoff on Abort</p>
    <p>compare with HMTM, LTM</p>
  </div>
  <div class="page">
    <p>2007 Multifacet Project</p>
    <p>FriendlyFire</p>
    <p>load A store A</p>
    <p>load A</p>
    <p>store A</p>
    <p>ABORT</p>
    <p>ABORT</p>
    <p>load A</p>
    <p>store A</p>
    <p>load A</p>
    <p>store A</p>
    <p>ABORT</p>
    <p>ABORT</p>
    <p>ABORT</p>
    <p>CAUSE</p>
    <p>Requester Wins</p>
    <p>EFFECT(S)</p>
    <p>Unnecessary Aborts</p>
    <p>Livelock</p>
    <p>FIX</p>
    <p>Priority Based Conflict Resolution ?</p>
  </div>
  <div class="page">
    <p>2007 Multifacet Project</p>
    <p>Pathologies</p>
    <p>Pathology (% ExecutionTime)</p>
    <p>Enhancement  Timestamp Based Conflict Resolution  Eliminate FriendlyFire</p>
    <p>Friendly Fire</p>
    <p>Friendly Fire</p>
    <p>Raytrace 73 0.2</p>
  </div>
  <div class="page">
    <p>2007 Multifacet Project</p>
    <p>Enhanced EL ( )</p>
    <p>Pathology (% ExecutionTime)</p>
    <p>Performance</p>
    <p>Friendly Fire</p>
    <p>Friendly Fire</p>
    <p>Raytrace 73 0.2</p>
  </div>
  <div class="page">
    <p>2007 Multifacet Project</p>
    <p>Performance Pathologies</p>
    <p>StarvingElder</p>
    <p>SerializedCommit</p>
    <p>RestartConvoy</p>
    <p>FriendlyFire</p>
    <p>DuelingUpgrades</p>
    <p>FutileStall</p>
    <p>StarvingWriter</p>
  </div>
  <div class="page">
    <p>2007 Multifacet Project</p>
    <p>System</p>
    <p>Conflict Detection: Eager  Detect conflicts immediately</p>
    <p>Version Management: Eager  New Value in-place, Restore on Abort - Abort + Commit</p>
    <p>Conflict Resolution  Stall Requester  Abort Requester on possible deadlock (Conservative Deadlock Avoidance)</p>
    <p>compare with LogTM</p>
  </div>
  <div class="page">
    <p>2007 Multifacet Project</p>
    <p>DuelingUpgrades</p>
    <p>load A</p>
    <p>load A store A</p>
    <p>store A</p>
    <p>load A</p>
    <p>store A</p>
    <p>STALL</p>
    <p>ABORT</p>
    <p>CAUSE</p>
    <p>Conservative Deadlock Avoidance</p>
    <p>EFFECT(S)</p>
    <p>Unnecessary Stall</p>
    <p>Unnecessary Abort</p>
    <p>FIX</p>
    <p>Acquire Store Permissions Early ?</p>
  </div>
  <div class="page">
    <p>2007 Multifacet Project</p>
    <p>StarvingWriter</p>
    <p>store A load A</p>
    <p>load A</p>
    <p>load A load A</p>
    <p>load A</p>
    <p>CAUSE</p>
    <p>Stall Requester</p>
    <p>EFFECT(S)</p>
    <p>Starvation</p>
    <p>Load Imbalance</p>
    <p>Reader/Writer Locks</p>
    <p>FIX</p>
    <p>Writer Priority ?</p>
  </div>
  <div class="page">
    <p>2007 Multifacet Project</p>
    <p>Pathologies</p>
    <p>Pathology (% ExecutionTime)</p>
    <p>Enhancements  DuelingUpgrades: Store-Set Predictor</p>
    <p>StarvingWriter: Writer Aborts Readers immediately</p>
    <p>% Execution Time Aborts /Transaction</p>
    <p>% Execution Time Aborts /Transaction</p>
    <p>FutileStall Starving Writer</p>
    <p>Dueling Upgrades</p>
    <p>Futile Stall</p>
    <p>Starving Writer</p>
    <p>Dueling Upgrades</p>
    <p>Raytrace 1.0 4.6 4.2 &lt;0.1 0.3 &lt;0.1</p>
  </div>
  <div class="page">
    <p>2007 Multifacet Project</p>
    <p>Enhanced EE ( )</p>
    <p>Pathology (% ExecutionTime)</p>
    <p>Performance</p>
    <p>% Execution Time Aborts /Transaction</p>
    <p>% Execution Time Aborts /Transaction</p>
    <p>FutileStall Starving Writer</p>
    <p>Dueling Upgrades</p>
    <p>Futile Stall</p>
    <p>Starving Writer</p>
    <p>Dueling Upgrades</p>
    <p>Raytrace 1.0 4.6 4.2 &lt;0.1 0.3 &lt;0.1</p>
  </div>
  <div class="page">
    <p>2007 Multifacet Project</p>
    <p>Caveats / FutureWork</p>
    <p>High Contention Scenarios  Better Conflict Resolution</p>
    <p>Unidentified Pathologies</p>
    <p>Better TM Workloads</p>
    <p>Restart Convoy</p>
    <p>Starving Elder</p>
    <p>Serialized Commit</p>
    <p>Restart Convoy</p>
    <p>Starving Elder</p>
    <p>Serialized Commit</p>
    <p>Mp3d 21 36 30 9.0 28 25</p>
  </div>
  <div class="page">
    <p>2007 Multifacet Project</p>
    <p>Executive Summary</p>
    <p>Performance Pathologies</p>
    <p>Enhanced HTM systems L</p>
    <p>iv e</p>
    <p>lo c</p>
    <p>k</p>
  </div>
  <div class="page">
    <p>DuelingUpgrades</p>
    <p>SerializedCommit StarvingElder</p>
    <p>StarvingWriter</p>
    <p>FriendlyFire</p>
    <p>FutileStall</p>
    <p>RestartConvoy</p>
  </div>
</Presentation>
