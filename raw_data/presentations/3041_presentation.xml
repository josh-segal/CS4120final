<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>REPT: Reverse Debugging of Failures in Deployed Software</p>
    <p>Weidong Cui1, Xinyang Ge1, Baris Kasikci2, Ben Niu1, Upamanyu Sharma2, Ruoyu Wang3, and Insu Yun4</p>
    <p>Microsoft Research1</p>
    <p>University of Michigan2</p>
    <p>Arizona State University3</p>
    <p>Georgia Institute of Technology4</p>
    <p>OSDI 2018, Carlsbad, CA</p>
  </div>
  <div class="page">
    <p>What happened before the crash?</p>
  </div>
  <div class="page"/>
  <div class="page"/>
  <div class="page"/>
  <div class="page">
    <p>REPT: Reverse Execution with Processor Trace</p>
  </div>
  <div class="page">
    <p>REPT: Reverse Execution with Processor Trace</p>
    <p>Online hardware tracing (e.g., Intel Processor Trace)  Log the control flow with timestamps</p>
    <p>Low runtime overhead (1  5%)</p>
    <p>No data!</p>
    <p>Offline binary analysis  Recovers data flow from the control flow</p>
  </div>
  <div class="page"/>
  <div class="page">
    <p>REPT Data Recovery</p>
    <p>Single-threaded execution reconstruction</p>
    <p>Multi-threaded execution reconstruction Multi-threaded execution reconstruction</p>
  </div>
  <div class="page">
    <p>Core Dump Instruction Sequence</p>
    <p>+ = ?</p>
    <p>Execution History</p>
    <p>How to recover overwritten states</p>
  </div>
  <div class="page">
    <p>lea rbx, [g]</p>
    <p>mov rax, 1</p>
    <p>add rax, [rbx]</p>
    <p>mov [rbx], rax</p>
    <p>xor rbx, rbx</p>
  </div>
  <div class="page">
    <p>lea rbx, [g]</p>
    <p>mov rax, 1</p>
    <p>add rax, [rbx]</p>
    <p>mov [rbx], rax</p>
    <p>xor rbx, rbx rax=3, rbx=0, [g]=3</p>
    <p>rax=3, rbx=?, [g]=3</p>
    <p>rax=3, rbx=?, [g]=3</p>
    <p>rax=?, rbx=?, [g]=3</p>
    <p>rax=?, rbx=?, [g]=3</p>
    <p>rax=?, rbx=?, [g]=3</p>
    <p>rax=3, rbx=?, [g]=3</p>
    <p>rax=?, rbx=?, [g]=3</p>
  </div>
  <div class="page">
    <p>lea rbx, [g]</p>
    <p>mov rax, 1</p>
    <p>add rax, [rbx]</p>
    <p>mov [rbx], rax</p>
    <p>xor rbx, rbx rax=3, rbx=0, [g]=3</p>
    <p>rax=3, rbx=?, [g]=3</p>
    <p>rax=3, rbx=?, [g]=3</p>
    <p>rax=?, rbx=?, [g]=3</p>
    <p>rax=?, rbx=?, [g]=3</p>
    <p>rax=?, rbx=?, [g]=3</p>
    <p>rax=?, rbx=g, [g]=3</p>
    <p>rax=1, rbx=g, [g]=3</p>
    <p>rax=?, rbx=g, [g]=3</p>
    <p>rax=1, rbx=g, [g]=3</p>
  </div>
  <div class="page">
    <p>rax=3, rbx=g, [g]=?</p>
    <p>rax=1, rbx=g, [g]=?</p>
    <p>rax=?, rbx=g, [g]=? lea rbx, [g]</p>
    <p>mov rax, 1</p>
    <p>add rax, [rbx]</p>
    <p>mov [rbx], rax</p>
    <p>xor rbx, rbx rax=3, rbx=0, [g]=3</p>
    <p>rax=3, rbx=?, [g]=3</p>
    <p>rax=?, rbx=?, [g]=?</p>
    <p>rax=3, rbx=g, [g]=3</p>
    <p>rax=?, rbx=?, [g]=?</p>
    <p>rax=?, rbx=g, [g]=?</p>
    <p>rax=1, rbx=g, [g]=?</p>
    <p>rax=3, rbx=g, [g]=?</p>
  </div>
  <div class="page">
    <p>lea rbx, [g]</p>
    <p>mov rax, 1</p>
    <p>add rax, [rbx]</p>
    <p>mov [rbx], rax</p>
    <p>xor rbx, rbx rax=3, rbx=0, [g]=3</p>
    <p>rax=3, rbx=g, [g]=3</p>
    <p>rax=3, rbx=g, [g]=?</p>
    <p>rax=1, rbx=g, [g]=?</p>
    <p>rax=?, rbx=g, [g]=?</p>
    <p>rax=?, rbx=?, [g]=?</p>
    <p>rax=1, rbx=g, [g]=2</p>
    <p>rax=?, rbx=g, [g]=2</p>
    <p>rax=?, rbx=?, [g]=2</p>
    <p>rax=1, rbx=g, [g]=2</p>
  </div>
  <div class="page">
    <p>lea rbx, [g]</p>
    <p>mov rax, 1</p>
    <p>add rax, [rbx]</p>
    <p>mov [rbx], rax</p>
    <p>xor rbx, rbx rax=3, rbx=0, [g]=3</p>
    <p>rax=3, rbx=g, [g]=3</p>
    <p>rax=3, rbx=g, [g]=?</p>
    <p>rax=1, rbx=g, [g]=2</p>
    <p>rax=?, rbx=g, [g]=2</p>
    <p>rax=?, rbx=?, [g]=2</p>
    <p>rax=3, rbx=g, [g]=2</p>
  </div>
  <div class="page">
    <p>rax=3, rbx=g, [g]=2</p>
    <p>rax=1, rbx=g, [g]=2</p>
    <p>rax=?, rbx=g, [g]=2 lea rbx, [g]</p>
    <p>mov rax, 1</p>
    <p>add rax, [rbx]</p>
    <p>mov [rbx], rax</p>
    <p>xor rbx, rbx rax=3, rbx=0, [g]=3</p>
    <p>rax=3, rbx=g, [g]=3</p>
    <p>rax=?, rbx=?, [g]=2</p>
  </div>
  <div class="page">
    <p>Key Techniques</p>
    <p>Forward Execution  Recovers states before irreversible instructions</p>
    <p>Error Correction  Handles errors introduced by missing memory writes</p>
  </div>
  <div class="page">
    <p>REPT Data Recovery</p>
    <p>Single-threaded execution reconstruction</p>
    <p>Multi-threaded execution reconstruction</p>
  </div>
  <div class="page">
    <p>Core Dump Instruction Sequence #1</p>
    <p>+ = ?</p>
    <p>Execution History</p>
    <p>How to determine the thread interleavings?</p>
    <p>+</p>
    <p>Instruction Sequence #2</p>
  </div>
  <div class="page">
    <p>A D</p>
    <p>Time</p>
    <p>B</p>
    <p>C</p>
    <p>E</p>
    <p>F</p>
    <p>G</p>
  </div>
  <div class="page">
    <p>A</p>
    <p>B</p>
    <p>C</p>
    <p>D</p>
    <p>E</p>
    <p>F</p>
    <p>G</p>
    <p>Time</p>
    <p>A</p>
    <p>B</p>
    <p>C</p>
    <p>D</p>
    <p>E</p>
    <p>F</p>
    <p>G</p>
  </div>
  <div class="page">
    <p>A</p>
    <p>B</p>
    <p>C</p>
    <p>D</p>
    <p>E</p>
    <p>F</p>
    <p>G</p>
    <p>Time A</p>
    <p>D E</p>
    <p>B</p>
    <p>F</p>
    <p>G</p>
    <p>C</p>
  </div>
  <div class="page">
    <p>A</p>
    <p>B</p>
    <p>C</p>
    <p>D</p>
    <p>E</p>
    <p>F</p>
    <p>G</p>
    <p>Time A</p>
    <p>D E</p>
    <p>B</p>
    <p>F</p>
    <p>G</p>
    <p>C</p>
  </div>
  <div class="page">
    <p>A</p>
    <p>B</p>
    <p>C</p>
    <p>D</p>
    <p>E</p>
    <p>F</p>
    <p>G</p>
    <p>Time A</p>
    <p>D E</p>
    <p>B</p>
    <p>F</p>
    <p>G</p>
    <p>C</p>
  </div>
  <div class="page">
    <p>Key Techniques</p>
    <p>Hardware Timestamps  Constructs a partial order</p>
    <p>Concurrent memory write detection  Constrains their usage to avoid propagating a wrong value</p>
  </div>
  <div class="page">
    <p>With REPT,</p>
  </div>
  <div class="page">
    <p>Hey, client, turn on tracing next time.</p>
    <p>I want history information!</p>
  </div>
  <div class="page">
    <p>Demo</p>
  </div>
  <div class="page"/>
  <div class="page">
    <p>Conclusion</p>
    <p>Debugging production failures is important but hard</p>
    <p>REPT is a practical reverse debugging solution for production failures  Online hardware tracing to log the control flow with timestamps</p>
    <p>Offline binary analysis to recover the data flow with high accuracy</p>
    <p>REPT has been deployed on Microsoft Windows</p>
  </div>
</Presentation>
