<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>High Performance Tor Experimentation</p>
    <p>from the Magic of Dynamic ELFs</p>
    <p>Justin Tracey 1 Rob Jansen 2 Ian Goldberg 1</p>
    <p>CSET 2018</p>
    <p>Tracey, Jansen, Goldberg High Performance Tor Experimentation from... Magic! 1</p>
  </div>
  <div class="page">
    <p>Tor</p>
    <p>Tracey, Jansen, Goldberg High Performance Tor Experimentation from... Magic! 2</p>
  </div>
  <div class="page">
    <p>Why does Tor matter?</p>
    <p>Tracey, Jansen, Goldberg High Performance Tor Experimentation from... Magic! 3</p>
  </div>
  <div class="page">
    <p>Experimenting on Tor</p>
    <p>Tracey, Jansen, Goldberg High Performance Tor Experimentation from... Magic! 4</p>
  </div>
  <div class="page">
    <p>Experimenting on Tor Safely</p>
    <p>1. Use a test Tor network whenever possible.</p>
    <p>Tor Research Safety Board guidelines</p>
    <p>Tracey, Jansen, Goldberg High Performance Tor Experimentation from... Magic! 5</p>
  </div>
  <div class="page">
    <p>Available Options</p>
    <p>I Deployed Networks (e.g., PlanetLab)</p>
    <p>I Emulators (e.g., NetMirage)</p>
    <p>I Simulators (e.g., ns-3)</p>
    <p>I Hybrids (e.g., DCE, Shadow)</p>
    <p>Tracey, Jansen, Goldberg High Performance Tor Experimentation from... Magic! 6</p>
  </div>
  <div class="page">
    <p>Tracey, Jansen, Goldberg High Performance Tor Experimentation from... Magic! 7</p>
  </div>
  <div class="page">
    <p>Discrete-Event Network Simulation</p>
    <p>simulation time</p>
    <p>Host 1</p>
    <p>Host 2</p>
    <p>...</p>
    <p>Host m</p>
    <p>. . .</p>
    <p>. . .</p>
    <p>. . .</p>
    <p>rounds</p>
    <p>Tracey, Jansen, Goldberg High Performance Tor Experimentation from... Magic! 8</p>
  </div>
  <div class="page">
    <p>Performance Constraints in Shadow</p>
    <p>I Logging</p>
    <p>I Loading and running plugins</p>
    <p>I No compiler optimizations</p>
    <p>I Load Balancing</p>
    <p>Tracey, Jansen, Goldberg High Performance Tor Experimentation from... Magic! 9</p>
  </div>
  <div class="page">
    <p>Performance Constraints in Shadow</p>
    <p>I Logging</p>
    <p>I Loading and running plugins</p>
    <p>I No compiler optimizations</p>
    <p>I Load Balancing</p>
    <p>Tracey, Jansen, Goldberg High Performance Tor Experimentation from... Magic! 10</p>
  </div>
  <div class="page">
    <p>Logging Performance</p>
    <p>Simulation Time (m)</p>
    <p>original</p>
    <p>no logging</p>
    <p>Tracey, Jansen, Goldberg High Performance Tor Experimentation from... Magic! 11</p>
  </div>
  <div class="page">
    <p>Performance Constraints in Shadow</p>
    <p>I Logging</p>
    <p>I Loading and running plugins</p>
    <p>I No compiler optimizations</p>
    <p>I Load Balancing</p>
    <p>Tracey, Jansen, Goldberg High Performance Tor Experimentation from... Magic! 12</p>
  </div>
  <div class="page">
    <p>Changing Hosts</p>
    <p>Plugin Code</p>
    <p>Active Data</p>
    <p>Plugin Data 1</p>
    <p>Plugin Data 2</p>
    <p>Plugin Data 3</p>
    <p>Tracey, Jansen, Goldberg High Performance Tor Experimentation from... Magic! 13</p>
  </div>
  <div class="page">
    <p>Changing Hosts</p>
    <p>Plugin Code</p>
    <p>Active Data</p>
    <p>Plugin Data 1</p>
    <p>Plugin Data 2</p>
    <p>Plugin Data 3</p>
    <p>Tracey, Jansen, Goldberg High Performance Tor Experimentation from... Magic! 14</p>
  </div>
  <div class="page">
    <p>Changing Hosts</p>
    <p>Plugin Code</p>
    <p>Active Data</p>
    <p>Plugin Data 1</p>
    <p>Plugin Data 2</p>
    <p>Plugin Data 3</p>
    <p>Tracey, Jansen, Goldberg High Performance Tor Experimentation from... Magic! 15</p>
  </div>
  <div class="page">
    <p>Lock on Libraries</p>
    <p>Plugin Code</p>
    <p>Active Data</p>
    <p>Library Data</p>
    <p>Library Code</p>
    <p>links to</p>
    <p>Plugin Data 1</p>
    <p>Plugin Data 2</p>
    <p>Plugin Data 3</p>
    <p>Tracey, Jansen, Goldberg High Performance Tor Experimentation from... Magic! 16</p>
  </div>
  <div class="page">
    <p>The New Design: drow-loader Namespace 1</p>
    <p>Plugin Code</p>
    <p>Plugin Data 1</p>
    <p>Library Data 1</p>
    <p>Library Code</p>
    <p>links to</p>
    <p>Namespace 2</p>
    <p>Plugin Code</p>
    <p>Plugin Data 2</p>
    <p>Library Data 2</p>
    <p>Library Code</p>
    <p>links to</p>
    <p>Namespace 3</p>
    <p>Plugin Code</p>
    <p>Plugin Data 3</p>
    <p>Library Data 3</p>
    <p>Library Code</p>
    <p>links to</p>
    <p>Tracey, Jansen, Goldberg High Performance Tor Experimentation from... Magic! 17</p>
  </div>
  <div class="page">
    <p>drow-loader: Memory Overhead Namespace 1</p>
    <p>Plugin Data 1</p>
    <p>Library Data 1</p>
    <p>links to</p>
    <p>Namespace 2</p>
    <p>Plugin Data 2</p>
    <p>Library Data 2</p>
    <p>links to</p>
    <p>Namespace 3</p>
    <p>Plugin Data 3</p>
    <p>Library Data 3</p>
    <p>links to</p>
    <p>Plugin Code</p>
    <p>Library Code</p>
    <p>Tracey, Jansen, Goldberg High Performance Tor Experimentation from... Magic! 18</p>
  </div>
  <div class="page">
    <p>Performance Constraints in Shadow</p>
    <p>I Logging</p>
    <p>I Loading and running plugins</p>
    <p>I No compiler optimizations</p>
    <p>I Load Balancing</p>
    <p>Tracey, Jansen, Goldberg High Performance Tor Experimentation from... Magic! 19</p>
  </div>
  <div class="page">
    <p>Time Spent Blocked Per Thread</p>
    <p>Simulation Time (m)</p>
    <p>R e a</p>
    <p>l T</p>
    <p>im e</p>
    <p>(m )</p>
    <p>elapsed time</p>
    <p>thread 1-6 blocked time</p>
    <p>Tracey, Jansen, Goldberg High Performance Tor Experimentation from... Magic! 20</p>
  </div>
  <div class="page">
    <p>Problems in Shadow: No Host Migration thread1:plugin1</p>
    <p>Code</p>
    <p>thread2:plugin1</p>
    <p>Code</p>
    <p>data</p>
    <p>Tracey, Jansen, Goldberg High Performance Tor Experimentation from... Magic! 21</p>
  </div>
  <div class="page">
    <p>Problems in Shadow: No Host Migration thread1:plugin1</p>
    <p>Code</p>
    <p>int x = 0;</p>
    <p>void* ptr = &amp;x;</p>
    <p>thread2:plugin1</p>
    <p>Code</p>
    <p>? data</p>
    <p>Tracey, Jansen, Goldberg High Performance Tor Experimentation from... Magic! 22</p>
  </div>
  <div class="page">
    <p>Problems in Shadow: No Host Migration thread1:plugin1</p>
    <p>Code</p>
    <p>thread2:plugin1</p>
    <p>Code</p>
    <p>int ? = ?; int x = 0;</p>
    <p>void* ptr = &amp;x; data</p>
    <p>Tracey, Jansen, Goldberg High Performance Tor Experimentation from... Magic! 23</p>
  </div>
  <div class="page">
    <p>drow-loader: Memory Overhead Namespace 1</p>
    <p>Plugin Data 1</p>
    <p>Library Data 1</p>
    <p>links to</p>
    <p>Namespace 2</p>
    <p>Plugin Data 2</p>
    <p>Library Data 2</p>
    <p>links to</p>
    <p>Namespace 3</p>
    <p>Plugin Data 3</p>
    <p>Library Data 3</p>
    <p>links to</p>
    <p>Plugin Code</p>
    <p>Library Code</p>
    <p>Tracey, Jansen, Goldberg High Performance Tor Experimentation from... Magic! 24</p>
  </div>
  <div class="page">
    <p>Time Spent Blocked Per Thread</p>
    <p>Simulation Time (m)</p>
    <p>R e a</p>
    <p>l T</p>
    <p>im e</p>
    <p>(m )</p>
    <p>elapsed time</p>
    <p>thread 1-6 blocked time</p>
    <p>Tracey, Jansen, Goldberg High Performance Tor Experimentation from... Magic! 25</p>
  </div>
  <div class="page">
    <p>Time Spent Blocked Per Thread</p>
    <p>Simulation Time (m)</p>
    <p>R e a</p>
    <p>l T</p>
    <p>im e</p>
    <p>(m )</p>
    <p>elapsed time</p>
    <p>thread 1-6 blocked time</p>
    <p>Tracey, Jansen, Goldberg High Performance Tor Experimentation from... Magic! 26</p>
  </div>
  <div class="page">
    <p>Small Tor Experiment: 268 Hosts</p>
    <p>Number of Threads</p>
    <p>ea l</p>
    <p>T im</p>
    <p>e (m</p>
    <p>in u</p>
    <p>te s)</p>
    <p>original</p>
    <p>logging</p>
    <p>loading</p>
    <p>scheduling</p>
    <p>Tracey, Jansen, Goldberg High Performance Tor Experimentation from... Magic! 27</p>
  </div>
  <div class="page">
    <p>Small Tor Experiment: 268 Hosts</p>
    <p>Simulation Time (hh:mm:ss)</p>
    <p>ea l</p>
    <p>T im</p>
    <p>e (m</p>
    <p>in u</p>
    <p>te s)</p>
    <p>original</p>
    <p>logging</p>
    <p>loading</p>
    <p>scheduling</p>
    <p>Tracey, Jansen, Goldberg High Performance Tor Experimentation from... Magic! 28</p>
  </div>
  <div class="page">
    <p>Large Tor Experiment: 22,499 Hosts</p>
    <p>Simulation Time (hh:mm:ss)</p>
    <p>R ea</p>
    <p>l T</p>
    <p>im e</p>
    <p>(h o</p>
    <p>u rs</p>
    <p>) original</p>
    <p>logging</p>
    <p>loading</p>
    <p>scheduling</p>
    <p>Tracey, Jansen, Goldberg High Performance Tor Experimentation from... Magic! 29</p>
  </div>
  <div class="page">
    <p>Takeaways</p>
    <p>I Tor requires realistic constructed networks for testing</p>
    <p>I Shadow provides this, but suered from performance constraints</p>
    <p>I We were able to analyze and address these constraints I up to 31% improvement in synthetic benchmarks</p>
    <p>I up to 73% improvement in Tor experiments</p>
    <p>I Our changes were merged upstream and are available in Shadow now</p>
    <p>shadow.github.io</p>
    <p>Tracey, Jansen, Goldberg High Performance Tor Experimentation from... Magic! 30</p>
  </div>
</Presentation>
