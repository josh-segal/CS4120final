<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Direct Universal Access: Making Data Center Resources Available to FPGA</p>
    <p>Ran Shu1, Peng Cheng1, Guo Chen2, Zhiyuan Guo1, 3, Lei Qu1, Yongqiang Xiong1,</p>
    <p>Derek Chiou4, Thomas Moscibroda4</p>
    <p>Microsoft Research1, Hunan University2, Beihang University3, Microsoft Azure4</p>
    <p>Microsoft Research Microsoft Azure</p>
  </div>
  <div class="page">
    <p>FPGA Deployment in Data Centers</p>
    <p>Wide deployment  Major cloud service providers</p>
    <p>Microsoft, Amazon, Facebook, Alibaba, Tencent, Baidu, IBM, etc.</p>
    <p>Accelerated applications  Computation</p>
    <p>Web search ranking  Deep neural networks  Big data analytics</p>
    <p>Networking  Network processing</p>
    <p>Database/Storage  SQL  Key-value store</p>
    <p>Image from A. Caulfield et al., Micro 2016</p>
    <p>Image from D. Firestone et al., NSDI 2018</p>
  </div>
  <div class="page">
    <p>Resource Access Requirements</p>
    <p>Heterogeneous resources</p>
    <p>CPU</p>
    <p>Memory</p>
    <p>Other FPGAs</p>
    <p>GPU</p>
    <p>SSD</p>
    <p>Data center network fabric</p>
    <p>CPU Hos t</p>
    <p>DRAM SSDGPU</p>
    <p>NIC</p>
    <p>...</p>
    <p>FPGA On board</p>
    <p>DRAM</p>
    <p>FPGA board</p>
    <p>PCIe fabric</p>
    <p>Server</p>
    <p>FPGA On board</p>
    <p>DRAM</p>
    <p>FPGA board</p>
    <p>CPU Hos t</p>
    <p>DRAM SSDGPU</p>
    <p>NIC</p>
    <p>...</p>
    <p>FPGA On board</p>
    <p>DRAM</p>
    <p>FPGA board</p>
    <p>PCIe fabric</p>
    <p>Server</p>
    <p>FPGA On board</p>
    <p>DRAM</p>
    <p>FPGA board</p>
    <p>...</p>
    <p>Ethernet Ethernet</p>
    <p>... ...</p>
    <p>Image from A. Putnam et al., ISCA 2014 3</p>
  </div>
  <div class="page">
    <p>FPGA Board in Data Center</p>
    <p>FPGA chip</p>
    <p>QSFP</p>
    <p>DDR 4</p>
    <p>PCIe Gen 3</p>
    <p>Image from https://www.cnet.com/news/micro soft-project-brainwave-speeds-aiwith-fpga-chips-on-azure-buildconference/ 4</p>
  </div>
  <div class="page">
    <p>Current FPGA Communication Architecture</p>
    <p>Application Layer</p>
    <p>Physical Layer</p>
    <p>Applicatio n</p>
    <p>Applicatio n</p>
    <p>DDR 4 IP PCIe Gen 3 IP</p>
    <p>DDR Stack LTL NVMe Host DMA</p>
    <p>FPGA Chip</p>
    <p>QSFP IP</p>
    <p>DMA</p>
    <p>PCIe Gen 3QSFP</p>
    <p>DDR 4</p>
    <p>FPGA Board</p>
    <p>DCQCN (in LTL) Transport Layer</p>
    <p>Data Link Layer</p>
  </div>
  <div class="page">
    <p>Current FPGA Communication Architecture</p>
    <p>MAC layer</p>
    <p>Physical layer</p>
    <p>Applicatio n</p>
    <p>Applicatio n</p>
    <p>DDR 4 IP PCIe Gen 3 IP</p>
    <p>DDR Stack LTL NVMe Host DMA</p>
    <p>FPGA Chip</p>
    <p>QSFP IP</p>
    <p>DMA</p>
    <p>PCIe Gen 3QSFP</p>
    <p>DDR 4</p>
    <p>FPGA Board</p>
    <p>???</p>
    <p>Image from L. Zhang et al., CCR 2014</p>
    <p>DCQCN (in LTL)</p>
  </div>
  <div class="page">
    <p>Problem #1  Programming Interface</p>
    <p>Application 1 Application 2</p>
    <p>DDR IP PCIe IPEthernet IP</p>
    <p>DDR Stack LTL NVMe Stack Host DMA</p>
    <p>Lines of code to use each interface Host DRAM: 294</p>
    <p>Host CPU program: 205</p>
    <p>Onboard DRAM: 517</p>
    <p>Remote FPGA: 1356</p>
    <p>FPGA Chip</p>
  </div>
  <div class="page">
    <p>Problem #2  Accessibility</p>
    <p>Application Application</p>
    <p>DDR IP PCIe IPEthernet IP</p>
    <p>DDR Stack LTL NVMe Stack Host DMA</p>
    <p>Data center naming space</p>
    <p>Server-area naming space</p>
    <p>On-board naming space</p>
    <p>FPGA Chip</p>
  </div>
  <div class="page">
    <p>Problem #3  Multiplexing</p>
    <p>Application 1 Application 2</p>
    <p>DDR IP PCIe IPEthernet IP</p>
    <p>Host DMA Mux/Demux</p>
    <p>FPGA Chip</p>
    <p>DDR Stack LTL NVMe Stack Host DMA</p>
  </div>
  <div class="page">
    <p>Problem #3  Multiplexing</p>
    <p>Application 1 Application 2</p>
    <p>DDR IP PCIe IPEthernet IP</p>
    <p>LTL Mux/Demux</p>
    <p>DDR Stack LTL NVMe Stack Host DMA</p>
    <p>FPGA Chip</p>
  </div>
  <div class="page">
    <p>Problem #3  Multiplexing</p>
    <p>Application 1 Application 2</p>
    <p>PCIe Mux/Demux</p>
    <p>DDR IP PCIe IPEthernet IP</p>
    <p>DDR Stack LTL NVMe Stack Host DMA</p>
    <p>FPGA Chip</p>
  </div>
  <div class="page">
    <p>Problem #4  Security</p>
    <p>DDR Stack LTL NVMe Stack Host DMA</p>
    <p>DDR IP PCIe IPEthernet IP</p>
    <p>Malicious Application</p>
    <p>Access unauthorized</p>
    <p>address</p>
    <p>Host Memory</p>
    <p>PCIe Fabric 12</p>
    <p>FPGA Chip</p>
  </div>
  <div class="page">
    <p>Problem #4  Security</p>
    <p>DDR Stack LTL NVMe Stack Host DMA</p>
    <p>DDR IP PCIe IPEthernet IP</p>
    <p>Victim Application</p>
    <p>Attack application</p>
    <p>Malicious CPU</p>
    <p>Program</p>
    <p>PCIe Fabric 13</p>
    <p>FPGA Chip</p>
  </div>
  <div class="page">
    <p>Existing Problems</p>
    <p>Complex programming interface</p>
    <p>Separate naming space</p>
    <p>No general multiplexing</p>
    <p>Security issue</p>
  </div>
  <div class="page">
    <p>Direct Universal Access</p>
    <p>FPGA 1</p>
    <p>Server</p>
    <p>QSFPDDR</p>
    <p>Server</p>
    <p>LTL DDR</p>
    <p>access FPGA</p>
    <p>Connect Host DMA</p>
    <p>PCIe Gen3DDR</p>
    <p>App 2</p>
    <p>LTL DDR</p>
    <p>access FPGA</p>
    <p>Connect Host DMA</p>
    <p>Datacenter networking fabric</p>
    <p>QSFP</p>
    <p>FPGA 2</p>
    <p>DDR</p>
    <p>FPGA Connect</p>
    <p>DDR access</p>
    <p>Host DMA</p>
    <p>PCIe Gen3 PCIe Gen3 CPU</p>
    <p>DUA DUA</p>
    <p>App 1</p>
    <p>DUA</p>
    <p>Intra-server networking fabric</p>
    <p>FPGA 3</p>
  </div>
  <div class="page">
    <p>DUA Overview</p>
    <p>FPGA</p>
    <p>Server</p>
    <p>QSFPDDR</p>
    <p>Server</p>
    <p>AppApp</p>
    <p>LTL DDR</p>
    <p>access FPGA</p>
    <p>Connect Host DMA</p>
    <p>PCIe Gen3DDR</p>
    <p>AppApp</p>
    <p>LTL DDR</p>
    <p>access FPGA</p>
    <p>Connect Host DMA</p>
    <p>Datacenter networking fabric</p>
    <p>QSFP</p>
    <p>FPGA</p>
    <p>DDR</p>
    <p>FPGA Connect</p>
    <p>DDR access</p>
    <p>Host DMA</p>
    <p>PCIe Gen3 PCIe Gen3 CPU</p>
    <p>DUA DUA</p>
    <p>AppApp</p>
    <p>DUA</p>
    <p>Intra-server networking fabric</p>
    <p>DUA is an IP layer An abstract overlay network</p>
    <p>Leverage all existing h/w stacks Hierarchical addressing &amp; routing</p>
  </div>
  <div class="page">
    <p>DUA Overview</p>
    <p>FPGA</p>
    <p>Server</p>
    <p>QSFPDDR</p>
    <p>Server</p>
    <p>AppApp</p>
    <p>LTL DDR</p>
    <p>access FPGA</p>
    <p>Connect Host DMA</p>
    <p>PCIe Gen3DDR</p>
    <p>AppApp</p>
    <p>LTL DDR</p>
    <p>access FPGA</p>
    <p>Connect Host DMA</p>
    <p>Datacenter networking fabric</p>
    <p>QSFP</p>
    <p>FPGA</p>
    <p>DDR</p>
    <p>FPGA Connect</p>
    <p>DDR access</p>
    <p>Host DMA</p>
    <p>PCIe Gen3 PCIe Gen3 CPU</p>
    <p>DUA DUA</p>
    <p>AppApp</p>
    <p>DUA</p>
    <p>Intra-server networking fabric</p>
    <p>DUA is an IP layer</p>
    <p>Efficient Routing</p>
    <p>Direct resource access by FPGA, totally bypass CPU</p>
  </div>
  <div class="page">
    <p>DUA Overview</p>
    <p>FPGA</p>
    <p>Server</p>
    <p>QSFPDDR</p>
    <p>Server</p>
    <p>AppApp</p>
    <p>LTL DDR</p>
    <p>access FPGA</p>
    <p>Connect Host DMA</p>
    <p>PCIe Gen3DDR</p>
    <p>AppApp</p>
    <p>LTL DDR</p>
    <p>access FPGA</p>
    <p>Connect Host DMA</p>
    <p>Datacenter networking fabric</p>
    <p>QSFP</p>
    <p>FPGA</p>
    <p>DDR</p>
    <p>FPGA Connect</p>
    <p>DDR access</p>
    <p>Host DMA</p>
    <p>PCIe Gen3 PCIe Gen3 CPU</p>
    <p>DUA DUA</p>
    <p>AppApp</p>
    <p>DUA</p>
    <p>Intra-server networking fabric</p>
    <p>Compatible BSD-socket Interface for both applications and communication stacks</p>
    <p>Efficient Routing DUA is an IP layer</p>
  </div>
  <div class="page">
    <p>DUA Overview</p>
    <p>FPGA</p>
    <p>Server</p>
    <p>QSFPDDR</p>
    <p>Server</p>
    <p>AppApp</p>
    <p>LTL DDR</p>
    <p>access FPGA</p>
    <p>Connect Host DMA</p>
    <p>PCIe Gen3DDR</p>
    <p>AppApp</p>
    <p>LTL DDR</p>
    <p>access FPGA</p>
    <p>Connect Host DMA</p>
    <p>Datacenter networking fabric</p>
    <p>QSFP</p>
    <p>FPGA</p>
    <p>DDR</p>
    <p>FPGA Connect</p>
    <p>DDR access</p>
    <p>Host DMA</p>
    <p>PCIe Gen3 PCIe Gen3 CPU</p>
    <p>DUA DUA</p>
    <p>AppApp</p>
    <p>DUA</p>
    <p>Intra-server networking fabric</p>
    <p>Efficient Routing Compatible BSD-socket Interface</p>
    <p>General Multiplexing for both applications and communication stacks</p>
    <p>DUA is an IP layer</p>
  </div>
  <div class="page">
    <p>DUA Overview</p>
    <p>FPGA</p>
    <p>Server</p>
    <p>QSFPDDR</p>
    <p>Server</p>
    <p>AppApp</p>
    <p>LTL DDR</p>
    <p>access FPGA</p>
    <p>Connect Host DMA</p>
    <p>PCIe Gen3DDR</p>
    <p>AppApp</p>
    <p>LTL DDR</p>
    <p>access FPGA</p>
    <p>Connect Host DMA</p>
    <p>Datacenter networking fabric</p>
    <p>QSFP</p>
    <p>FPGA</p>
    <p>DDR</p>
    <p>FPGA Connect</p>
    <p>DDR access</p>
    <p>Host DMA</p>
    <p>PCIe Gen3 PCIe Gen3 CPU</p>
    <p>DUA DUA</p>
    <p>AppApp</p>
    <p>DUA</p>
    <p>Intra-server networking fabric</p>
    <p>Efficient Routing Compatible BSD-socket Interface Compatible BSD-socket interface</p>
    <p>DUA is an IP layer</p>
    <p>Unified Multiplexing</p>
    <p>Security Protect against both inside and outside attacks</p>
  </div>
  <div class="page">
    <p>App</p>
    <p>FPGA</p>
    <p>App</p>
    <p>App</p>
    <p>NIC</p>
    <p>FPGA</p>
    <p>CPU</p>
    <p>FPGA</p>
    <p>NIC</p>
    <p>CPU</p>
    <p>Datacenter networking fabric</p>
    <p>Intra-server networking fabric</p>
    <p>QSFP</p>
    <p>DUA Underlay</p>
    <p>PCIe Gen3DDR</p>
    <p>Server</p>
    <p>Server</p>
    <p>CPU Control Agent</p>
    <p>DUA Overlay</p>
    <p>FPGA Control Agent</p>
    <p>FPGA Host Stack</p>
    <p>NVMe Stack</p>
    <p>LTL</p>
    <p>FPGA Connect</p>
    <p>Host DMA</p>
    <p>DDR Controller DUA</p>
    <p>data plane</p>
    <p>System Architecture</p>
    <p>DUA Data Plane</p>
  </div>
  <div class="page">
    <p>App</p>
    <p>FPGA</p>
    <p>App</p>
    <p>App</p>
    <p>NIC</p>
    <p>FPGA</p>
    <p>CPU</p>
    <p>FPGA</p>
    <p>NIC</p>
    <p>CPU</p>
    <p>Datacenter networking fabric</p>
    <p>Intra-server networking fabric</p>
    <p>QSFP</p>
    <p>DUA Underlay</p>
    <p>PCIe Gen3DDR</p>
    <p>Server</p>
    <p>Server</p>
    <p>CPU Control Agent</p>
    <p>DUA Overlay</p>
    <p>FPGA Control Agent</p>
    <p>FPGA Host Stack</p>
    <p>NVMe Stack</p>
    <p>LTL</p>
    <p>FPGA Connect</p>
    <p>Host DMA</p>
    <p>DDR Controller</p>
    <p>System Architecture</p>
    <p>DUA Data Plane DUA control plane</p>
  </div>
  <div class="page">
    <p>DUA Control Plane</p>
    <p>Challenge: large-scale resource and routing info dissemination  Limited h/w resource</p>
    <p>DUA solution  Hierarchical addressing</p>
    <p>Hierarchical routing</p>
    <p>Leverage existing infrastructure</p>
    <p>Fully distributed and lightweight  Need no global synchronization</p>
    <p>Resource table</p>
    <p>Interconnection table</p>
    <p>Src Resource (UID) Dst Resource (UID) / Stack</p>
    <p>FPGA 2 (192.168.0.2:2) / FPGA Connect</p>
    <p>Host DRAM (192.168.0.2:3) / DMA</p>
    <p>Onboard DRAM (192.168.0.2:4) / DDR</p>
    <p>FPGA 1 (192.168.0.2:1) / FPGA Connect</p>
    <p>Host DRAM (192.168.0.2:3) / DMA</p>
    <p>Resources on other servers (*:*) / LTL</p>
    <p>FPGA 1 (192.168.0.2:1)</p>
    <p>FPGA 2 (192.168.0.2:2)</p>
    <p>UID</p>
    <p>(serverID:deviceID) Address /port Resource description</p>
  </div>
  <div class="page">
    <p>DUA Data Plane</p>
    <p>Overlay  Unified interface</p>
    <p>Routing</p>
    <p>Stacks  Leverage all the existing (or</p>
    <p>adopt future) stacks</p>
    <p>Underlay  Efficient multiplexing</p>
    <p>Security</p>
    <p>App</p>
    <p>FPGA</p>
    <p>App</p>
    <p>App</p>
    <p>DUA data plane</p>
    <p>FPGA Host stack</p>
    <p>NVMe Stack</p>
    <p>LTL</p>
    <p>FPGA Connect</p>
    <p>Host DMA</p>
    <p>DDR Access</p>
    <p>QSFP</p>
    <p>DUA underlay</p>
    <p>PCIe Gen3DDR</p>
    <p>DUA overlay</p>
  </div>
  <div class="page">
    <p>DUA Data Plane  Overlay</p>
    <p>Efficient &amp; extensible design  Switch fabric</p>
    <p>High capacity cross-bar switch</p>
    <p>Connector  All cached routing tables</p>
    <p>Translator  Protocol translation</p>
    <p>High performance data path  Line-rate</p>
    <p>Near zero-delay</p>
    <p>DUA overlay</p>
    <p>LTL DDR FPGA</p>
    <p>Connect Host DMA</p>
    <p>Connector Connector Connector Connector</p>
    <p>App App</p>
    <p>Switch Fabric</p>
    <p>Connector Connector</p>
    <p>LTL Translator</p>
    <p>DDR Translator</p>
    <p>Host DMA Translator</p>
    <p>FPGA CA</p>
    <p>App</p>
    <p>Connector</p>
  </div>
  <div class="page">
    <p>Evaluation  efficiency</p>
    <p>Extreme low latency (&lt; 50 ns/fwd)</p>
    <p>FPGA 1 FPGA 4FPGA 2 FPGA 3</p>
    <p>APP APPDUA overlay DUA overlay</p>
    <p>FPGA Connect</p>
    <p>FPGA Connect</p>
    <p>LTL LTL FPGA</p>
    <p>Connect FPGA</p>
    <p>Connect</p>
    <p>La te</p>
    <p>n cy</p>
    <p>( u</p>
    <p>s)</p>
    <p>Packet Size (B)</p>
    <p>DUA LTL FPGA Connect</p>
    <p>Round Trip Time through FPGA Connect and DUA for 4 times, LTL twice</p>
  </div>
  <div class="page">
    <p>Evaluation  Logic Overhead</p>
    <p>DUA Overlay  2 Ports: 4.24%  4 Ports: 9.29%  8 Ports: 19.86%</p>
    <p>DUA Underlay</p>
    <p>4 Stacks and 3 PHY Interfaces: 0.25%</p>
  </div>
  <div class="page">
    <p>Evaluation  Deep Crossing</p>
    <p>SPMV</p>
    <p>SPMV</p>
    <p>SPMV</p>
    <p>D M V</p>
    <p>DMV DMV DMV</p>
    <p>Single FPGA Board: Parall = 32, 2 FPGA Board: Parall = 64</p>
  </div>
  <div class="page">
    <p>Evaluation  Regex Matching</p>
    <p>Up to 105~107 higher than CPU, Up to 105 lower than CPU  Up to 3 times throughput and up to 55% latency reduction compared to</p>
    <p>using CPU to move data between FPGAs</p>
    <p>T h</p>
    <p>ro u</p>
    <p>g h</p>
    <p>p u</p>
    <p>t (G</p>
    <p>B /s</p>
    <p>)</p>
    <p>Input String Length (Byte)</p>
    <p>through FPGA Connect</p>
    <p>through CPU</p>
    <p>Pure CPU</p>
    <p>La te</p>
    <p>n cy</p>
    <p>( u</p>
    <p>s)</p>
    <p>Input String Length (Byte)</p>
    <p>through FPGA Connect through CPU Pure CPU</p>
  </div>
  <div class="page">
    <p>Conclusion</p>
    <p>Current FPGA communication architecture  No universal access</p>
    <p>DUA: build the IP layer for FPGA in data center  Leverage existing data center network</p>
    <p>Efficient routing</p>
    <p>Compatible BSD socket interface</p>
    <p>Unified multiplexing</p>
    <p>Security</p>
    <p>Open source soon</p>
  </div>
  <div class="page">
    <p>Thank you! Questions?</p>
  </div>
</Presentation>
