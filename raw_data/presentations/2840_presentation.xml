<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Re-architecting Congestion Management in</p>
    <p>Lossless Ethernet Wenxue Cheng, Kun Qian, Wanchun Jiang(CSU), Tong Zhang, Fengyuan Ren</p>
    <p>NNS group @ Department of Computer Science and Technology, Tsinghua University</p>
  </div>
  <div class="page">
    <p>Data Center Networks</p>
    <p>Large Scales &gt; 10000 machines</p>
    <p>Short Messages &lt; 1 KB</p>
    <p>Special Protocols RDMA</p>
    <p>Small RTT &lt; 100</p>
    <p>High Bandwidth 10/40~100/400 Gbps</p>
    <p>Shallow Buffer &lt; 30 MB for ToR</p>
    <p>Packets Loss</p>
    <p>Performance</p>
  </div>
  <div class="page">
    <p>Data Center Networks</p>
    <p>Small RTT &lt; 100</p>
    <p>High Bandwidth 10/40~100/400 Gbps</p>
    <p>Shallow Buffer &lt; 30 MB for ToR</p>
    <p>Large Scales &gt; 10000 machines</p>
    <p>Short Messages &lt; 1 KB</p>
    <p>Special Protocols RDMA</p>
    <p>Lossless Ethernet</p>
  </div>
  <div class="page">
    <p>Priority-based Flow Control (PFC)</p>
    <p>XOFF XON</p>
    <p>Upstream Port (Sender)</p>
    <p>Downstream Port (Receiver)</p>
  </div>
  <div class="page">
    <p>PAUSE</p>
    <p>Priority-based Flow Control (PFC)</p>
    <p>PAUSE</p>
    <p>XOFF XON</p>
    <p>Upstream Port (Sender)</p>
    <p>Downstream Port (Receiver)</p>
  </div>
  <div class="page">
    <p>Priority-based Flow Control (PFC)</p>
    <p>PAUSE</p>
    <p>XOFF XON</p>
    <p>Upstream Port (Sender)</p>
    <p>Downstream Port (Receiver)</p>
    <p>Congestion Spreading</p>
  </div>
  <div class="page">
    <p>RESUMERESUME</p>
    <p>Priority-based Flow Control (PFC)</p>
    <p>XOFF XON</p>
    <p>Upstream Port (Sender)</p>
    <p>Downstream Port (Receiver)</p>
  </div>
  <div class="page">
    <p>PFC Issues Congestion Spreading &amp; Head-of-Line Blocking</p>
    <p>F0 F1</p>
    <p>Burst</p>
    <p>H0</p>
    <p>H1</p>
    <p>H2</p>
    <p>R0</p>
    <p>R1</p>
    <p>S0 S1</p>
    <p>H15</p>
    <p>P2 P1</p>
    <p>P0</p>
    <p>Congestion tree from P2 to H0 and H1.</p>
    <p>F0 is a victim flow.</p>
  </div>
  <div class="page">
    <p>Congestion Control Schemes</p>
    <p>F0 F1</p>
    <p>Burst</p>
    <p>H0</p>
    <p>H1</p>
    <p>H2</p>
    <p>R0</p>
    <p>R1</p>
    <p>S0 S1</p>
    <p>H15</p>
    <p>P2 P1</p>
    <p>P0</p>
    <p>Congestion control schemes are needed e.g. QCN[IEEE 802.1], DCQCN[RoCEv2] and TIMELY[SIGCOMM 2015].</p>
    <p>Congestion Notification Rate Adjustment</p>
    <p>Time</p>
    <p>R at e</p>
  </div>
  <div class="page">
    <p>Experimental Observation</p>
    <p>Time (ms) 0 3</p>
    <p>H0 H1 H2</p>
    <p>H15</p>
  </div>
  <div class="page">
    <p>Experimental Observation</p>
    <p>(1) Congestion spreading still exists.</p>
    <p>Sending Rate of F1</p>
    <p>Evolution-based rate decrease is slower than PFCs effect.</p>
  </div>
  <div class="page">
    <p>Experimental Observation</p>
    <p>Sending Rate of F0 (Gbps)</p>
    <p>(1) Congestion spreading still exists. (2) F0 is also victimized by CC.</p>
    <p>PFC infects congestion detection of congestion control schemes.</p>
  </div>
  <div class="page">
    <p>Experimental Observation</p>
    <p>(1) Congestion spreading still exists. (2) F0 is also victimized by CC. (3) Rate recovery is inadaptable to</p>
    <p>dynamic network conditions.</p>
    <p>Liner rate increase method and tuning parameters.</p>
  </div>
  <div class="page">
    <p>Basic Idea</p>
    <p>Re-architecting Congestion Management</p>
    <p>Congestion Flows  Victim Flows</p>
    <p>Congestion Detection</p>
    <p>Fast Rate Decrease  Automatic Rate Increase</p>
    <p>Rate Adjustment</p>
  </div>
  <div class="page">
    <p>Congestion Detection</p>
    <p>Real-Congestion (P2)</p>
    <p>&gt;</p>
    <p>Non-Congestion (P3)</p>
    <p>&lt;</p>
    <p>Quasi-Congestion (P0)</p>
    <p>RESUME RESUMEPAUSE</p>
    <p>?</p>
  </div>
  <div class="page">
    <p>Congestion Detection</p>
    <p>Quasi-Congestion (P0) 1 1 1 1</p>
    <p>RESUME RESUMEPAUSE</p>
    <p>Real-Congestion (P2) 1 1 1 11 1</p>
    <p>Explicit Congestion Notification (ECN)  Only based on queue length  Fail to distinguish quasi-congestion and</p>
    <p>real-congestion</p>
  </div>
  <div class="page">
    <p>Congestion Detection</p>
    <p>Non-Paused ECN (NP-ECN)  Dont change ECN for packets that has</p>
    <p>been paused  Counter PN: number of packets that</p>
    <p>has been paused</p>
  </div>
  <div class="page">
    <p>Congestion Detection</p>
    <p>Quasi-Congestion (P0)</p>
    <p>Real-Congestion (P2) Non-Paused ECN (NP-ECN)  Dont change ECN for packets that has</p>
    <p>been paused  Counter PN: number of packets that</p>
    <p>has been paused</p>
    <p>PAUSERESUME PN=3</p>
  </div>
  <div class="page">
    <p>Congestion Detection</p>
    <p>Quasi-Congestion (P0)</p>
    <p>Real-Congestion (P2) Non-Paused ECN (NP-ECN)  Dont change ECN for packets that has</p>
    <p>been paused  Counter PN: number of packets that</p>
    <p>has been paused</p>
    <p>PAUSERESUME PN=3PN=2PN=1PN=0</p>
  </div>
  <div class="page">
    <p>Congestion Detection</p>
    <p>Quasi-Congestion (P0)</p>
    <p>Real-Congestion (P2) Non-Paused ECN (NP-ECN)  Dont change ECN for packets that has</p>
    <p>been paused  Counter PN: number of packets that</p>
    <p>has been paused</p>
    <p>PAUSERESUME PN=3</p>
  </div>
  <div class="page">
    <p>Congestion Detection</p>
    <p>Quasi-Congestion (P0) 0 0 1 0</p>
    <p>RESUME RESUMEPAUSE</p>
    <p>Real-Congestion (P2) 1 1 1 11 1</p>
    <p>Partially marked with ECN</p>
    <p>Non-Paused ECN (NP-ECN)  Dont change ECN for packets that has</p>
    <p>been paused  Counter PN: number of packets that</p>
    <p>has been paused</p>
  </div>
  <div class="page">
    <p>Congestion Detection</p>
    <p>Quasi-Congestion (P0) 0 0 1 0</p>
    <p>RESUME RESUMEPAUSE</p>
    <p>Real-Congestion (P2) 111111</p>
    <p>Non-Paused ECN (NP-ECN)  Dont change ECN for packets that has</p>
    <p>been paused  Counter PN: number of packets that</p>
    <p>has been paused PN=0</p>
  </div>
  <div class="page">
    <p>Congestion Detection</p>
    <p>Quasi-Congestion (P0) 0 0 1 0</p>
    <p>RESUME RESUMEPAUSE</p>
    <p>Real-Congestion (P2) 1 1 1 11 1</p>
    <p>Continuously marked with ECN</p>
    <p>Non-Paused ECN (NP-ECN)  Dont change ECN for packets that has</p>
    <p>been paused  Counter PN: number of packets that</p>
    <p>has been paused</p>
  </div>
  <div class="page">
    <p>Congestion Detection</p>
    <p>Quasi-Congestion (P0) 0 0 1 0</p>
    <p>RESUME RESUMEPAUSE</p>
    <p>Real-Congestion (P2) 1 1 1 11 1</p>
    <p>Continuously marked with ECN</p>
    <p>Partially marked with ECN Non-Paused ECN (NP-ECN)  Dont change ECN for packets that has</p>
    <p>been paused  Counter PN: number of packets that</p>
    <p>has been paused</p>
    <p>Victim Flows</p>
    <p>Congested Flows</p>
  </div>
  <div class="page">
    <p>Rate Adjustment</p>
    <p>How to adjust the rates of  Congested Flows --&gt; target?  Victim Flows --&gt; no decrease?  Non-congested Flows</p>
    <p>Burst = 40, F0 = 20, Reduce F1s rate</p>
    <p>H4</p>
  </div>
  <div class="page">
    <p>F0 = 20, Reduce F1s rate</p>
    <p>Rate Adjustment</p>
    <p>How to adjust the rates of  Congested Flows  reduce to receiving rate immediately  Victim Flows &amp; Uncongested Flows  rate increase</p>
  </div>
  <div class="page">
    <p>Rate Adjustment</p>
    <p>How to adjust the rates of  Congested Flows  reduce to receiving rate immediately  Victim Flows &amp; Uncongested Flows  rate increase</p>
    <p>Receiver-Driven Rate Decrease    min , 1  IJK   No PFC &amp; no serious throughput loss &amp; 1 control loop</p>
  </div>
  <div class="page">
    <p>Rate Adjustment</p>
    <p>How to adjust the rates of  Congested Flows  reduce to receiving rate immediately  Victim Flows &amp; Non-congested Flows  rate increase</p>
    <p>Receiver-Driven Rate Decrease    min , 1  IJK   No congestion &amp; No PFC triggers in one control loop</p>
    <p>Self-weighted Rate increase</p>
    <p>N    1   +  R     1   + IST R</p>
    <p>Automatic gentle-to-aggressive</p>
  </div>
  <div class="page">
    <p>Photonic Congestion Notification (PCN)</p>
    <p>Receiver-driven Rate Decrease</p>
    <p>Self-weighted Rate increase</p>
    <p>NP-ECN  Identify</p>
    <p>Congested Flows  Rate Estimator</p>
    <p>Sender Switches</p>
    <p>Receiver</p>
    <p>Congestion Notification Packet (CNP)</p>
    <p>Period T</p>
  </div>
  <div class="page">
    <p>PCNs Benefit</p>
    <p>Time (ms) 0 3</p>
    <p>H0 H1 H2</p>
    <p>H15</p>
    <p>No congestion tree</p>
    <p>No serious throughput loss</p>
  </div>
  <div class="page">
    <p>Benefit</p>
    <p>Time (ms) 0 3</p>
    <p>H0 H1 H2</p>
    <p>H15</p>
    <p>Sending Rate of F0 (Gbps)</p>
    <p>Sending Rate of F1 (Gbps)</p>
    <p>F1 is reduced in one loop</p>
    <p>F0 is not victimized by PCN</p>
  </div>
  <div class="page">
    <p>Evaluation Setup Testbed Setup</p>
    <p>Dumbbell topology  Implementation on DPDK (Intel 82599)  4 hosts (PowerEdge R530) connected to single ToR  10Gbps</p>
    <p>NS-3 Simulation Setup  Clos topology  512 hosts / 32 ToRs / 16 Leafs / 8 Spines  10Gbps / 40Gbps</p>
  </div>
  <div class="page">
    <p>Evaluations</p>
    <p>Basic Prosperities</p>
    <p>Convergence  Fairness  Stability</p>
    <p>Workbench</p>
    <p>Burst Tolerance  Parameter</p>
    <p>sensitivity  Realistic</p>
    <p>Workloads</p>
    <p>Special Cases</p>
    <p>Flow Scalability  Adversarial Traffic  Multiple</p>
    <p>Bottlenecks  Multiple Priorities  DeadlockTestbed</p>
    <p>NS-3 Simulations</p>
  </div>
  <div class="page">
    <p>Evaluation: Large-Scale Simulations Simulation Setup</p>
    <p>W1: Web-server workload W2: Hadoop cluster workload</p>
    <p>Pod 0 Pod 7</p>
  </div>
  <div class="page">
    <p>Evaluation: Large-Scale Simulations</p>
    <p>Web-server Workload</p>
    <p>PAUSE Rate (Mbps) Flow Complete Time (ms) Flow Complete Rate (Kps)</p>
  </div>
  <div class="page">
    <p>Evaluation: Large-Scale Simulations</p>
    <p>Hadoop Workload</p>
    <p>PAUSE Rate (Mbps) Flow Complete Time (ms) Flow Complete Rate (Kps)</p>
  </div>
  <div class="page">
    <p>Conclusion</p>
    <p>Evaluations on testbed and ns-3 simulation show, PCN triggers fewer PFC and achieves lower flow completion time.</p>
    <p>Re-architecting congestion management</p>
    <p>Proposing Photonic Congestion Notification (PCN)  NP-ECN  victim flows/congested flows  Receiver-driven rate decrease  no PFC in 1 loop  Automatic rate increase</p>
  </div>
  <div class="page">
    <p>Thanks !</p>
    <p>pyscwx@126.com renfy@tsinghua.edu.cn</p>
  </div>
</Presentation>
