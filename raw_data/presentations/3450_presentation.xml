<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Off-Path TCP Exploit: How Wireless Routers Can Jeopardize</p>
    <p>Your Secrets Weiteng Chen, Zhiyun Qian</p>
    <p>University of California, Riverside</p>
  </div>
  <div class="page">
    <p>Generic Threat Model</p>
    <p>Internet</p>
    <p>C S</p>
    <p>Mallory</p>
    <p>Probing Packets</p>
    <p>FeedbackSandboxed script OR</p>
    <p>Un-priviledged App</p>
    <p>[1]</p>
    <p>[2]</p>
    <p>[1] Gilad, Yossi, and Amir Herzberg. &quot;Off-path TCP injection attacks.&quot; [2]Qian, Zhiyun, Z. Morley Mao, and Yinglian Xie. &quot;Collaborative TCP sequence number inference attack: how to crack sequence number under a second.&quot;</p>
    <p>(Not Man-in-the-Middle)</p>
  </div>
  <div class="page">
    <p>An attack using packet counter side channel</p>
  </div>
  <div class="page">
    <p>Building Blocks of Side Channels</p>
    <p>Shared resources  e.g., Global IP-ID counter, Packet counter, Global challenge ACK rate limit</p>
    <p>Shared state changes observable to attackers  e.g., Javascript, Un-priviledged Malware</p>
  </div>
  <div class="page">
    <p>A Time-Line of TCP Injection Attacks</p>
    <p>[Morris 1985] [Bellovin 1989]</p>
    <p>Unpredictable ISN [RFC1948 1996]</p>
    <p>Exploit Predictable ISNs (Initial Sequence Number)</p>
    <p>[Watson 2004] Blind Reset Attacks</p>
    <p>Minimize ACK window</p>
    <p>[RFC5961 2010]</p>
    <p>[Gilad 2014] Blind Data Injection</p>
  </div>
  <div class="page">
    <p>A Time-Line of TCP Injection Attacks (Cont)</p>
    <p>[[lkm 2007] [Amir 2012] IP-ID Counter Side Channel</p>
    <p>[Qian 2012] Packet Counter Side Channel</p>
    <p>CVE-2017-13810 MacOS provides dummy packet counters Linux adopts namespace</p>
    <p>[This Work 2018] Timing Side Channel</p>
    <p>[Cao 2016] Challenge ACK Rate Limit</p>
    <p>Side Channel</p>
    <p>CVE-2016-5696 Randomize the count of Challenge ACK</p>
    <p>Per-socket rate limit</p>
    <p>Windows finally eliminates global IP-ID counter</p>
  </div>
  <div class="page">
    <p>Off-Path TCP Injection Attacks</p>
    <p>Side Channel Requirement Affected OS Patch/Mitigation Global IP-ID counter N/A Windows Global IPID counter eliminated</p>
    <p>Global challenge ACK rate limit N/A Linux Global rate limit eliminated</p>
    <p>Packet counter Malware Linux, MacOS Namespace/dummy counter</p>
    <p>Wireless contention (this work) Javascript Any N/A</p>
  </div>
  <div class="page">
    <p>RFC 793: TCP Packet Receiving Basics</p>
    <p>Conn match</p>
    <p>Seq # check</p>
    <p>Ack # check</p>
    <p>Drop</p>
    <p>Reply</p>
    <p>Drop</p>
    <p>Reply</p>
    <p>Client Server</p>
    <p>Attacker8 Simplified Processing Logic</p>
  </div>
  <div class="page">
    <p>Port Number Inference</p>
    <p>Client Server</p>
    <p>Attacker</p>
    <p>Has connection No connection</p>
    <p>Client Server</p>
    <p>Attacker</p>
    <p>How can the attacker see the difference?</p>
  </div>
  <div class="page">
    <p>Mallory Router Client</p>
    <p>RTT</p>
    <p>Router Mallory Server</p>
    <p>RTT</p>
    <p>No connection</p>
    <p>Active connection</p>
    <p>Probe</p>
    <p>Query &amp; Corresponding</p>
    <p>Response</p>
    <p>Dup ACK</p>
    <p>One Plausible Idea</p>
  </div>
  <div class="page">
    <p>Wireless Timing Channel</p>
    <p>Full-duplex:</p>
    <p>Half-duplex:</p>
    <p>Half-duplex: A fundamental design of wireless protocol  Shared Resource: The half-duplex wireless channel</p>
  </div>
  <div class="page">
    <p>Probing Strategy</p>
    <p>Client</p>
    <p>Router</p>
    <p>Attacker</p>
    <p>Server</p>
    <p>Half Duplex</p>
    <p>Full Duplex</p>
    <p>X</p>
    <p>Not trigger ACK Round Trip Time</p>
    <p>Legitimate Packets</p>
    <p>Spoofed Packets</p>
  </div>
  <div class="page">
    <p>Probing Strategy (Cont)</p>
    <p>Client</p>
    <p>Router</p>
    <p>Attacker</p>
    <p>Server</p>
    <p>Half Duplex</p>
    <p>Full Duplex</p>
    <p>X</p>
    <p>trigger ACK Round Trip Time</p>
    <p>X</p>
    <p>Legitimate Packets</p>
    <p>Spoofed Packets</p>
  </div>
  <div class="page">
    <p>Timing Difference</p>
    <p>RTT_1 RTT_2</p>
    <p>Half Duplex</p>
    <p>Client</p>
    <p>Router</p>
    <p>Attacker</p>
    <p>X</p>
    <p>Pr e</p>
    <p>Pr ob</p>
    <p>e Q ue</p>
    <p>ry</p>
    <p>Po st</p>
    <p>Pr ob</p>
    <p>e Q ue</p>
    <p>ry</p>
    <p>No ACKs Triggering ACKs</p>
    <p>X X</p>
    <p>Pr e</p>
    <p>Pr ob</p>
    <p>e Q ue</p>
    <p>ry</p>
    <p>Po st</p>
    <p>Pr ob</p>
    <p>e Q ue</p>
    <p>ry</p>
    <p>Not Trigger ACK Trigger ACK</p>
    <p>Delayed</p>
    <p>Corresponding Response</p>
    <p>Failed Transmission</p>
    <p>Probe</p>
    <p>Server</p>
    <p>Full Duplex</p>
    <p>Larger RTT  Trigger ACK  Correct Port Number ?</p>
  </div>
  <div class="page">
    <p>Timing Difference (Cont)</p>
    <p>Half Duplex</p>
    <p>Client</p>
    <p>Router</p>
    <p>Attacker</p>
    <p>X</p>
    <p>Pr e</p>
    <p>Pr ob</p>
    <p>e Q ue</p>
    <p>ry</p>
    <p>RTT_1</p>
    <p>Full Duplex</p>
    <p>RTT_2</p>
    <p>No ACK Multiple ACKs</p>
    <p>Not Trigger ACK Trigger ACK</p>
    <p>Delayed</p>
    <p>Corresponding Response</p>
    <p>Failed Transmission</p>
    <p>Probe</p>
    <p>Po st</p>
    <p>Pr ob</p>
    <p>e Q ue</p>
    <p>ry</p>
    <p>Pr e</p>
    <p>Pr ob</p>
    <p>e Q ue</p>
    <p>ry</p>
    <p>Po st</p>
    <p>Pr ob</p>
    <p>e Q ue</p>
    <p>ry</p>
    <p>X</p>
    <p>X</p>
    <p>X</p>
    <p>X</p>
    <p>Server</p>
    <p>More Probing Packets  More Contention  Larger RTTS</p>
  </div>
  <div class="page">
    <p>Empirical Test Results</p>
    <p>Setup:</p>
    <p>4 wireless routers: from Linksys, Huawei, Xiaomi, and Gee  2 machines: 2017 Macbook and 2017 Dell Desktop (Linux)  2.4GHz and 5GHz Wi-Fi</p>
    <p>Internet</p>
    <p>C S</p>
    <p>Mallory Sandboxed</p>
    <p>script</p>
  </div>
  <div class="page">
    <p>Empirical Test Results (Cont)</p>
    <p>(c) RTT measurement of macOS using 5GHz network of a Huawei router</p>
    <p>(b) RTT measurement of macOS using 2.4GHz network of a Xiaomi router</p>
    <p>(a) RTT measurement of Linux using 5GHz network of a Linksys router</p>
  </div>
  <div class="page">
    <p>Ti m</p>
    <p>e( m</p>
    <p>s)</p>
    <p>Number of Packets</p>
    <p>m e(</p>
    <p>m s)</p>
    <p>Number of Packets RTT measurement of macOS using 5GHz network of a Xiaomi router</p>
    <p>at two different locations with RTTs over 20ms</p>
    <p>Empirical Test Results (Cont)</p>
  </div>
  <div class="page">
    <p>Port Number Inference</p>
    <p>Client Server</p>
    <p>Attacker</p>
    <p>Has connection No connection</p>
    <p>Client Server</p>
    <p>Attacker</p>
    <p>How can the attacker see the difference?</p>
  </div>
  <div class="page">
    <p>Sequence Number Inference</p>
    <p>Client Server</p>
    <p>Attacker</p>
    <p>Seq in-window Seq out-of-window</p>
    <p>Client Server</p>
    <p>Attacker</p>
  </div>
  <div class="page">
    <p>TCP Stack Implementations</p>
    <p>Table. Behaviors on different OSes when processing 10 identical packets*</p>
    <p>*:See the complete table in our paper</p>
    <p>No. OS FLAG SEQ ACK PAYLOAD #Responses</p>
  </div>
  <div class="page">
    <p>ACK Number Inference</p>
    <p>Implementations of ACK number check varies</p>
    <p>significantly from one OS to another</p>
    <p>Exploit HTTP specifications and behaviors of</p>
    <p>tolerant browsers</p>
    <p>Brute-force ACK number</p>
    <p>Only takes a couple of seconds</p>
  </div>
  <div class="page">
    <p>Evaluation</p>
    <p>OS Browser Success Rate Avg time cost (s)</p>
    <p>Linux Chrome/Firefox 10/10 188.80</p>
    <p>MacOS Chrome/Firefox 10/10 48.91</p>
    <p>Windows Chrome/Firefox 10/10 43.42</p>
    <p>OS Browser Success Rate Avg time cost (s)</p>
    <p>MacOS Chrome/Firefox 9/10 304.18</p>
    <p>Remote result (RTT = 20ms)</p>
    <p>Local result</p>
  </div>
  <div class="page">
    <p>Demo: Web Cache Poisoning</p>
    <p>W ireless</p>
    <p>Internet</p>
    <p>CNN</p>
  </div>
  <div class="page">
    <p>How bad?</p>
    <p>Teleconference with IEEE 802.11 working group  Its not possible to be fixed at physical and MAC layers!</p>
  </div>
  <div class="page">
    <p>Defenses/Mitigations</p>
    <p>Wireless Layer: Full-duplex Wi-Fi Technology  E.g., Frequency-division duplexing, different frequency sub-bands</p>
    <p>TCP Stack: Revisit TCP Specifications  E.g., Rate limit responses for incoming packets with out-of-window SEQ</p>
    <p>Application Layer: Deploy HSTS (HTTP Strict Transport Security)  Preventing access via the insecure HTTP protocol</p>
  </div>
  <div class="page">
    <p>Conclusion</p>
    <p>A new timing side channel inherent in all generations of IEEE 802.11 or Wi-Fi technology  Comprehensive analysis of TCP stack implementations in macOS, Windows, and Linux  Implement practical TCP injection attacks  Propose possible defenses  https://github.com/seclab-ucr/tcp_exploit</p>
  </div>
  <div class="page">
    <p>Q&amp;A</p>
    <p>Thanks for your attention!</p>
  </div>
</Presentation>
