<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Confidential  2020 VMware, Inc.</p>
    <p>Challenges and Experiences with MLOps for Performance Diagnostics</p>
    <p>in Hybrid-Cloud Enterprise Software Deployments</p>
    <p>Amitabha Banerjee</p>
    <p>Chien-Chia Chen</p>
    <p>Chien-Chun Hung</p>
    <p>Xiaobo Huang, Yifan Wang, Razvan Chevesaran</p>
    <p>VMware, Inc. @2020 USENIX Conference on Operational Machine Learning</p>
    <p>July 27  August 3, 2020</p>
  </div>
  <div class="page">
    <p>Confidential  2020 VMware, Inc. 2</p>
    <p>VMware has the most large-enterprise customers who deploy our Software-Defined Datacenter (SDDC) stack in both their on-premises datacenters (private cloud) as well as VMware managed public clouds (VMC).</p>
    <p>Detect and root-cause performance issues at scale is extremely challenging.</p>
    <p>Traditional rule-based approach has limitations.</p>
    <p>Performance Troubleshooting for Hybrid-Cloud Deployments</p>
    <p>Private Cloud</p>
    <p>VMware SDDC Stack</p>
    <p>Public Cloud</p>
    <p>VMware SDDC Stack</p>
    <p>?</p>
    <p>? ?</p>
    <p>? ? ?? ?</p>
    <p>Rule-based Troubleshooting</p>
    <p>SRE / TSECustomer / Cloud Admin</p>
  </div>
  <div class="page">
    <p>Confidential  2020 VMware, Inc. 3</p>
    <p>Performance Diagnostics Service</p>
    <p>Data-driven, ML-based</p>
    <p>Detection and RCA</p>
    <p>Unified UX for both on-prem and VMC</p>
    <p>Decouple intelligence from product releases</p>
    <p>Proactive: Reduce MTTD and MTTR</p>
    <p>ML-Based Performance Diagnostics Service</p>
    <p>Private Cloud</p>
    <p>VMware SDDC Stack</p>
    <p>Public Cloud</p>
    <p>VMware SDDC StackVMware Analytics Cloud</p>
    <p>Performance Diagnostics ServiceTelemetry Data Telemetry Data</p>
    <p>R e</p>
    <p>su lts</p>
    <p>SRE / TSECustomer / Cloud Admin</p>
  </div>
  <div class="page">
    <p>Confidential  2020 VMware, Inc. 4</p>
    <p>Building Performance Diagnostics Service</p>
    <p>Engineer Feedback</p>
    <p>Result Reference</p>
    <p>Data Lake</p>
    <p>(1) VMware Analytics Cloud</p>
    <p>Performance Diagnostics Service</p>
    <p>Hybrid Cloud</p>
    <p>VMware SDDC Stack</p>
    <p>Model Store</p>
    <p>Feedback DB</p>
    <p>(3) Ops (Automated &amp; Continuous)</p>
    <p>(2) ML (Manual / Semi-Automated)</p>
    <p>Data Science Experiments</p>
    <p>New Models</p>
    <p>Feature Selection</p>
    <p>Data Curation Data Pre-processing</p>
    <p>Model (Re-)Training</p>
    <p>Model Updates</p>
    <p>Data</p>
    <p>Results</p>
    <p>CEIP</p>
    <p>Anonymous User Feedback</p>
    <p>VMware Support Insight</p>
    <p>VMware Engineers</p>
    <p>(4) Application / Feedback</p>
  </div>
  <div class="page">
    <p>Confidential  2020 VMware, Inc. 5</p>
    <p>Governed by VMware CEIP</p>
    <p>Privacy: Customers agree to send anonymized data</p>
    <p>Telemetry data streamed from all product deployments (under CEIP)</p>
    <p>Usage, hardware/software configurations, performance counter readings</p>
    <p>NO contents and NO logs</p>
    <p>ACL: Data only available for VMware internal purposes</p>
    <p>Other data compliance (GDPR/CCPA)</p>
    <p>Consumed by a cloud service designed using Apache Spark</p>
    <p>Performance Diagnostics Service runs as a job in VAC</p>
    <p>(1) VMware Analytics Cloud</p>
    <p>Data Lake</p>
    <p>(1) VMware Analytics Cloud</p>
    <p>Performance Diagnostics Service</p>
    <p>Hybrid Cloud</p>
    <p>VMware SDDC Stack</p>
    <p>Data</p>
    <p>Results</p>
    <p>CEIP</p>
  </div>
  <div class="page">
    <p>Confidential  2020 VMware, Inc. 6</p>
    <p>Input: performance counter readings</p>
    <p>IOPS, I/O throughput, CPU utilization, queue utilization, etc</p>
    <p>Thousands of counters across SDDC stack</p>
    <p>Problem (1): Detect performance anomalies</p>
    <p>Does the SDDC perform normally?</p>
    <p>E.g., disk I/O latency is normal, memory usage is normal</p>
    <p>Data scientists experiment and develop ML models</p>
    <p>Problem (2): Root Cause Analysis (RCA)</p>
    <p>RCA:</p>
    <p>What is the cause of the anomaly?</p>
    <p>How to remediate?</p>
    <p>Explain the anomaly and provide recommendation</p>
    <p>Statistical learning / unsupervised learning</p>
    <p>Decision trees, RCA rules, clustering, correlations</p>
    <p>E.g., if packet drops are abnormally high and I/O latency is also abnormally high, Root cause: packet drops -&gt; latency anomaly Remediation: Examine physical links/switches and network utilization</p>
    <p>(2) MLPerformance Issue Detection and RCA</p>
    <p>ML (Manual / Semi-Automated)</p>
    <p>Data Science Experiments</p>
    <p>New Models</p>
  </div>
  <div class="page">
    <p>Confidential  2020 VMware, Inc. 7</p>
    <p>Labels</p>
    <p>Anomaly labels</p>
    <p>RCA labels</p>
    <p>Manual label</p>
    <p>Highly depend on product experts</p>
    <p>Synthesized label</p>
    <p>Inject controlled performance perturbation</p>
    <p>Artificial packet drops, artificial I/O latency, etc</p>
    <p>Run various synthetic workload on internal testbeds</p>
    <p>(2) MLValidation</p>
    <p>ML (Manual / Semi-Automated)</p>
    <p>Data Science Experiments</p>
    <p>New Models</p>
  </div>
  <div class="page">
    <p>Confidential  2020 VMware, Inc. 8</p>
    <p>Fully automated and continuous Ops pipeline</p>
    <p>Feature selection</p>
    <p>Extremely high dimension</p>
    <p>Product experts provide candidates sets of features</p>
    <p>Feature selection pipeline to train models with every feature set</p>
    <p>Automatic retrain once feature sets change</p>
    <p>Why not all feature combinations?</p>
    <p>Too many of them  too much resource consumption</p>
    <p>Why not dimension reduction?</p>
    <p>Doesnt work; statistical relations  consequential relations</p>
    <p>Why not dimension reduction + some feature engineering?</p>
    <p>Performance gain doesnt justify engineering cost</p>
    <p>(3) OpsFeature Selection</p>
    <p>Ops (Automated &amp; Continuous)</p>
    <p>Feature Selection</p>
  </div>
  <div class="page">
    <p>Confidential  2020 VMware, Inc. 9</p>
    <p>Some models are sensitive to data distribution</p>
    <p>Data Pre-processing methods</p>
    <p>Normalization (standardization, Box-Cox transform, etc)</p>
    <p>Band pass filter  remove outlier</p>
    <p>Other curation  avoid dividing by zero</p>
    <p>Pre-processing chain</p>
    <p>Series of data transformation</p>
    <p>Multiple chains according to permutation</p>
    <p>Automatic selection of the best pre-processing chain</p>
    <p>(3) OpsData Curation and Pre-processing</p>
    <p>Ops (Automated &amp; Continuous)</p>
    <p>Feature Selection</p>
    <p>Data Curation Data Pre-processing</p>
  </div>
  <div class="page">
    <p>Confidential  2020 VMware, Inc. 10</p>
    <p>Model offering</p>
    <p>Regression, autoencoder, isolation forest, principal component analysis</p>
    <p>Ensemble</p>
    <p>Hyper-parameters: models, feature sets, pre-processing chains</p>
    <p>Determine hyper-parameters with labeled dataset</p>
    <p>Aggregation of model predictions: boosting, majority vote</p>
    <p>Custom accuracy metric: percentage of correct predictions</p>
    <p>Balance false positives and false negatives</p>
    <p>F1-score does not work well in anomaly detection scenario (i.e., skewed distribution)</p>
    <p>(3) OpsModel (Re-)Training</p>
    <p>Ops (Automated &amp; Continuous)</p>
    <p>Feature Selection</p>
    <p>Data Curation Data Pre-processing</p>
    <p>Model (Re-)Training</p>
  </div>
  <div class="page">
    <p>Confidential  2020 VMware, Inc. 11</p>
    <p>Model store for trained models</p>
    <p>Model instance</p>
    <p>Active</p>
    <p>Version</p>
    <p>Timestamp</p>
    <p>Feature set</p>
    <p>Pre-processing chain</p>
    <p>Measured accuracy</p>
    <p>Training dataset</p>
    <p>Performance Diagnostics Service chooses a model for inference</p>
    <p>Most recent</p>
    <p>Most accurate</p>
    <p>Specific version (e.g., rollback)</p>
    <p>(3) OpsModel Serving</p>
    <p>Model Store</p>
    <p>Ops (Automated &amp; Continuous)</p>
    <p>Feature Selection</p>
    <p>Data Curation Data Pre-processing</p>
    <p>Model (Re-)Training</p>
    <p>Model Updates</p>
    <p>Performance Analytics Service</p>
  </div>
  <div class="page">
    <p>Confidential  2020 VMware, Inc. 12</p>
    <p>*********************************</p>
    <p>*********************************</p>
    <p>*********************************</p>
    <p>*********************************</p>
    <p>(4) Application / Feedback</p>
    <p>Engineer Feedback</p>
    <p>Result Reference</p>
    <p>Hybrid Cloud</p>
    <p>VMware SDDC Stack</p>
    <p>Feedback DB</p>
    <p>Data</p>
    <p>Results</p>
    <p>CEIP</p>
    <p>Anonymous User Feedback</p>
    <p>VMware Support Insight</p>
    <p>VMware Engineers</p>
    <p>ML Ops</p>
  </div>
  <div class="page">
    <p>Confidential  2020 VMware, Inc. 13</p>
    <p>Performance Drift Monitoring</p>
    <p>Monitor changes in accuracy and anomaly detection rate</p>
    <p>Spikes or dips imply performance changes</p>
    <p>Good drifts: thumb-up label to reinforce model training</p>
  </div>
  <div class="page">
    <p>Confidential  2020 VMware, Inc. 14</p>
    <p>Handling New Performance Issues</p>
    <p>*********************************</p>
    <p>********************************</p>
    <p>************</p>
    <p>Bad drifts: might indicate new, unseen performance issues</p>
    <p>Require manual RCA to determine actions</p>
    <p>Either fix product or change model</p>
  </div>
  <div class="page">
    <p>Confidential  2020 VMware, Inc. 15</p>
    <p>Put Everything in Production!</p>
  </div>
  <div class="page">
    <p>Confidential  2020 VMware, Inc. 16</p>
    <p>Continuous and automated training and serving</p>
    <p>Automatic feedback consumption</p>
    <p>Keep the production models up-to-date without human intervention</p>
    <p>Monitoring dashboard in production</p>
    <p>Visualize the deployment performance for easier tracking and alerting</p>
    <p>Orchestrated experiment environment</p>
    <p>Validate model behavior with synthesized setup and data</p>
    <p>Takeaways</p>
  </div>
  <div class="page">
    <p>Confidential  2020 VMware, Inc.</p>
    <p>Thank You</p>
    <p>{banerjeea,chien-chiachen,hchienchun}@vmware.com</p>
    <p>ACKNOWLEDGEMENT</p>
    <p>VMware Analytics Cloud Team VMware Support Insight Team</p>
    <p>VMware Research Group Parikshit Gopalan</p>
    <p>Udi Wieder</p>
    <p>VMware Performance Group Rajesh Somasundaran</p>
    <p>Bruce Herndon Chuck Lintell</p>
  </div>
</Presentation>
