<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>TPM-Fail: TPM meets Timing and Lattice Attacks</p>
    <p>Daniel Moghimi</p>
    <p>Berk Sunar</p>
    <p>Thomas Eisenbarth</p>
    <p>Nadia Heninger</p>
  </div>
  <div class="page">
    <p>Trusted Platform Module (TPM)</p>
    <p>Security Chip for Computers?</p>
    <p>Tamper Resistant</p>
    <p>Side-Channel Resistant</p>
    <p>Crypto Co-processor</p>
    <p>Software is</p>
    <p>insecure.</p>
    <p>Heartbleed?</p>
    <p>Computers</p>
    <p>are just</p>
    <p>Evil?!</p>
    <p>Hardware-based</p>
    <p>Root of Trust?!</p>
    <p>Rootkits?</p>
    <p>Ransomware?</p>
    <p>Untrusted</p>
    <p>Org.?</p>
  </div>
  <div class="page">
    <p>Trusted Platform Module (TPM)</p>
    <p>Security Chip for Computers?</p>
    <p>Tamper Resistant</p>
    <p>Side-Channel Resistant</p>
    <p>Crypto Co-processor</p>
    <p>Root of Trust</p>
    <p>Software is</p>
    <p>insecure.</p>
    <p>Heartbleed?</p>
    <p>Computers</p>
    <p>are just</p>
    <p>Evil?!</p>
    <p>Hardware-based</p>
    <p>Root of Trust?!</p>
    <p>Rootkits?</p>
    <p>Ransomware?</p>
    <p>Untrusted</p>
    <p>Org.?</p>
  </div>
  <div class="page">
    <p>Trusted Platform Module (TPM)</p>
    <p>Cryptographic Co-processor, specified by Trusted Computing Group  Secure Storage</p>
    <p>Integrity Measurement</p>
    <p>TRNG</p>
    <p>Hash Functions</p>
    <p>Encryption</p>
    <p>Digital Signatures</p>
  </div>
  <div class="page">
    <p>TPM  Digital Signatures</p>
    <p>Applications  Trusted Execution of Signing Operations</p>
    <p>Remote Attestation</p>
    <p>TPM 2.0 supports Elliptic-Curve Digital Signature  ECDSA</p>
    <p>ECSchnorr</p>
    <p>ECDAA (Anonymous Remote Attestation)</p>
  </div>
  <div class="page">
    <p>https://trustedcomputinggroup.org/members hip/certification/</p>
    <p>https://trustedcomputinggroup.org/members hip/certification/tpm-certified-products/</p>
    <p>Trusted Computing Group  EAL 4+ Moderate</p>
    <p>ST33TPHF2ESPI Data Brief: https://www.st.com/resource/en/data_brief/st33 tphf2espi.pdf</p>
    <p>ST33TPHF2ESPI CC Evaluation: https://www.ssi.gouv.fr/uploads/2018/10/an ssi-cible-cc-2018_41en.pdf</p>
  </div>
  <div class="page">
    <p>Are TPMs really side-channel resistant?</p>
  </div>
  <div class="page">
    <p>High-resolution Timing Test</p>
    <p>TPM frequency ~= 32-120 MHz</p>
    <p>CPU Frequency is more than 2 GHz</p>
  </div>
  <div class="page">
    <p>High-resolution Timing Test  Intel PTT (fTPM)</p>
    <p>H is</p>
    <p>to g ra</p>
    <p>m</p>
    <p>CPU PCH</p>
    <p>CSME</p>
    <p>fTPM</p>
    <p>Intel Platform Trust Technology (PTT)  Integrated firmware-TPM inside the CPU package</p>
    <p>Runs on top of Converged Security and Management Engine (CSME)</p>
  </div>
  <div class="page">
    <p>High-resolution Timing Test  Intel PTT (fTPM)</p>
    <p>CPU PCH</p>
    <p>CSME</p>
    <p>fTPM</p>
    <p>Linux TPM Command Response Buffer (CRB) driver</p>
    <p>Kernel Driver to increase the Resolution</p>
  </div>
  <div class="page">
    <p>High-resolution Timing Test  ECDSA Nonce Leakage</p>
    <p>t 4.8 4.844.764.724.67</p>
    <p>Nonce</p>
    <p>Intel fTPM: 4-bit Window Nonce Length Leakage  ECDSA</p>
    <p>ECSChnorr</p>
    <p>BN-256 (ECDAA)</p>
    <p>: 1, 1 =     = 1</p>
    <p>=  1</p>
    <p>+</p>
  </div>
  <div class="page">
    <p>High-resolution Timing Test  ECDSA Nonce Leakage</p>
    <p>t 4.8 4.844.764.724.67</p>
    <p>Nonce</p>
    <p>Intel fTPM: 4-bit Window Nonce Length Leakage  ECDSA</p>
    <p>ECSChnorr</p>
    <p>BN-256 (ECDAA)</p>
    <p>: 1, 1 =     = 1</p>
    <p>=  1</p>
    <p>+</p>
  </div>
  <div class="page">
    <p>High-resolution Timing Test  ECDSA Nonce Leakage</p>
    <p>t 4.8 4.844.764.724.67</p>
    <p>Nonce</p>
    <p>Intel fTPM: 4-bit Window Nonce Length Leakage  ECDSA</p>
    <p>ECSChnorr</p>
    <p>BN-256 (ECDAA)</p>
    <p>: 1, 1 =     = 1</p>
    <p>=  1</p>
    <p>+</p>
  </div>
  <div class="page">
    <p>High-resolution Timing Test  ECDSA Nonce Leakage</p>
    <p>t 4.8 4.844.764.724.67</p>
    <p>Nonce</p>
    <p>Intel fTPM: 4-bit Window Nonce Length Leakage  ECDSA</p>
    <p>ECSChnorr</p>
    <p>BN-256 (ECDAA)</p>
    <p>: 1, 1 =     = 1</p>
    <p>=  1</p>
    <p>+</p>
  </div>
  <div class="page">
    <p>High-resolution Timing Test  ECDSA Nonce Leakage</p>
    <p>t 4.8 4.844.764.724.67</p>
    <p>Nonce</p>
    <p>Intel fTPM: 4-bit Window Nonce Length Leakage  ECDSA</p>
    <p>ECSChnorr</p>
    <p>BN-256 (ECDAA)</p>
    <p>: 1, 1 =     = 1</p>
    <p>=  1</p>
    <p>+</p>
  </div>
  <div class="page">
    <p>High-resolution Timing Test  ECDSA Nonce Leakage</p>
    <p>t 4.8 4.844.764.724.67</p>
    <p>Nonce</p>
    <p>Intel fTPM: 4-bit Window Nonce Length Leakage  ECDSA</p>
    <p>ECSChnorr</p>
    <p>BN-256 (ECDAA)</p>
    <p>: 1, 1 =     = 1</p>
    <p>=  1</p>
    <p>+</p>
  </div>
  <div class="page">
    <p>High-resolution Timing Test  Analysis Of Devices</p>
    <p>RSA and ECDSA timing test on 3 dedicated TPM and Intel fTPM</p>
    <p>Various non-constant behaviour for both RSA and ECDSA</p>
  </div>
  <div class="page"/>
  <div class="page">
    <p>High-resolution Timing Test  ECDSA Nonce Leakage (STM)</p>
    <p>STMicroelectronics TPM: Bit-by-Bit Nonce Length Leakage</p>
  </div>
  <div class="page">
    <p>TPM-Fail  Recovering Private ECDSA Key</p>
    <p>TPM is programmed with an unknown key</p>
    <p>We already have a template for .</p>
  </div>
  <div class="page">
    <p>Lattice and Hidden Number Problem</p>
    <p>= 1  +      1</p>
    <p>1   1  0</p>
  </div>
  <div class="page">
    <p>Lattice and Hidden Number Problem</p>
    <p>= 1  +      1</p>
    <p>1   1  0</p>
    <p>=  1,  =</p>
    <p>1   +  +  = 0</p>
  </div>
  <div class="page">
    <p>Lattice and Hidden Number Problem</p>
    <p>= 1  +      1</p>
    <p>1   1  0</p>
    <p>=  1,  =</p>
    <p>1   +  +  = 0</p>
    <p>Let  be the upper bound on ki and (, 0, 1 , ) is unknown</p>
    <p>[1] Boneh D, Venkatesan R. Hardness of computing the most significant bits of secret keys in Diffie</p>
    <p>Hellman and related schemes. InAnnual International Cryptology Conference 1996 Aug 18 (pp. 129-142).</p>
    <p>Springer, Berlin, Heidelberg.</p>
  </div>
  <div class="page">
    <p>Lattice and Hidden Number Problem</p>
    <p>= 1  +      1</p>
    <p>1   1  0</p>
    <p>=  1,  =</p>
    <p>1   +  +  = 0</p>
    <p>Let  be the upper bound on ki and (, 0, 1 , ) is unknown</p>
    <p>Lattice Construction:</p>
    <p>1 2</p>
    <p>1 2</p>
    <p>LLL/BKZ</p>
  </div>
  <div class="page">
    <p>TPM-Fail  Key Recovery Results</p>
    <p>Intel fTPM  ECDSA, ECSchnorr and BN-256 (ECDAA)</p>
    <p>Three different threat model System, User, Network</p>
    <p>STMicroelectronics TPM  CC EAL4+ Certified</p>
    <p>Give you the key in 80 minutes</p>
  </div>
  <div class="page">
    <p>Timing difference for each</p>
    <p>window</p>
    <p>(4.76e8 - 4.72e8)/3600e6 *</p>
    <p>ping 192.168.1.x average rtt 0.713 ms</p>
    <p>ping 1.1.1.1 (Cloudflare DNS) average rtt 19.312 ms</p>
    <p>Brumley D, Boneh D. Remote timing attacks are practical. Computer Networks. 2005 Aug 5;48(5):701-16.iv</p>
  </div>
  <div class="page">
    <p>TPM-Fail Case Study: StrongSwan VPN</p>
    <p>VPN Client VPN Server TPM Device</p>
  </div>
  <div class="page">
    <p>TPM-Fail Case Study: StrongSwan VPN</p>
    <p>_[ , ,,  ]</p>
    <p>VPN Client VPN Server TPM Device</p>
  </div>
  <div class="page">
    <p>TPM-Fail Case Study: StrongSwan VPN</p>
    <p>_[ , ,,  ]</p>
    <p>VPN Client VPN Server TPM Device</p>
    <p>_[ ,  , ,  ]</p>
    <p>= ( )</p>
  </div>
  <div class="page">
    <p>TPM-Fail Case Study: StrongSwan VPN</p>
    <p>_[ , ,,  ]</p>
    <p>VPN Client VPN Server TPM Device</p>
    <p>_[ ,  , ,  ]</p>
    <p>= ( )</p>
    <p>_[ , (, ) ]</p>
  </div>
  <div class="page">
    <p>TPM-Fail Case Study: StrongSwan VPN</p>
    <p>_[ , ,,  ]</p>
    <p>VPN Client VPN Server TPM Device</p>
    <p>_[ ,  , ,  ]</p>
    <p>= ( )</p>
    <p>_[ , (, ) ]</p>
    <p>_[ , (,  ) ]</p>
  </div>
  <div class="page">
    <p>TPM-Fail Case Study: StrongSwan VPN</p>
    <p>_[ , ,,  ]</p>
    <p>VPN Client VPN Server TPM Device</p>
    <p>_[ ,  , ,  ]</p>
    <p>= ( )</p>
    <p>_[ , (, ) ]</p>
  </div>
  <div class="page">
    <p>TPM-Fail Case Study: StrongSwan VPN</p>
    <p>_[ , ,,  ]</p>
    <p>VPN Client VPN Server TPM Device</p>
    <p>_[ ,  , ,  ]</p>
    <p>= ( )</p>
    <p>_[ , (, ) ]</p>
    <p>_[ , (,  ) ]</p>
  </div>
  <div class="page">
    <p>TPM-Fail Case Study: StrongSwan VPN</p>
    <p>Remote Key Recovery after about 44,000 handshake ~= 5 hours</p>
  </div>
  <div class="page">
    <p>User Adversary</p>
    <p>Remote Sample UDP App</p>
    <p>Remote StrongSwan VPN</p>
  </div>
  <div class="page">
    <p>Coordinated Disclosure - STMicroelectronics</p>
    <p>STMicroelectronics (CVE-2019-16863)  05/15/2019: Reported to ST  05/17/2019: Acknowledged  Lots of calls/emails to clarify the disclosure process  09/12/2019: Verified new version of STM TPM firmware  After 11/12/2019:</p>
    <p>HP and Lenovo have issued firmware updates.</p>
    <p>ST released a list of affected devices.</p>
    <p>Intel (CVE-2019-11090)  02/01/2019: Reported to IPSIRT  02/12/2019: Acknowledged (Outdated Intel IPP Crypto library)  11/12/2019: Firmware Update for Intel Management Engine</p>
  </div>
  <div class="page">
    <p>Questions?!</p>
    <p>https://tpm.fail/</p>
    <p>TPM-FAIL</p>
    <p>https://github.com/</p>
    <p>VernamLab/TPM-Fail</p>
  </div>
  <div class="page">
    <p>Coordinated Disclosure - STMicroelectronics</p>
    <p>of STM TPM</p>
    <p>Post 11/12/2019: HP, Lenovo and Dell issued</p>
    <p>firmware update</p>
    <p>STMicroelectronics (CVE-2019-16863)  05/15/2019: Reported to ST</p>
    <p>05/17/2019: Acknowledged</p>
    <p>Lots of calls/emails to clarify the disclosure process</p>
    <p>09/12/2019: Verified new version of STM TPM firmware</p>
    <p>After 11/12/2019:  HP and Lenovo have issued firmware updates.</p>
    <p>ST released a list of affected devices.</p>
  </div>
  <div class="page">
    <p>Coordinated Disclosure - Intel</p>
    <p>Library</p>
    <p>for CSME</p>
    <p>Intel (CVE-2019-11090)  02/01/2019: Reported to IPSIRT</p>
    <p>02/12/2019: Acknowledged (Outdated Intel IPP Crypto library)</p>
    <p>11/12/2019: Firmware Update for Intel Management Engine</p>
  </div>
  <div class="page">
    <p>Coordinated Disclosure - Intel</p>
    <p>Intel (CVE-2019-11090)  02/01/2019: Reported to IPSIRT</p>
    <p>02/12/2019: Acknowledged (Outdated Intel IPP Crypto library)</p>
    <p>11/12/2019: Firmware Update for Intel Management Engine</p>
    <p>Intel IPP CVEs (MicroWalk)  CVE-2018-12155</p>
    <p>CVE-2018-12156</p>
    <p>Vulns to IPSIRT</p>
    <p>the Receipt</p>
    <p>Vulns to IPSIRT</p>
    <p>Library</p>
    <p>for CSME</p>
  </div>
</Presentation>
