<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Backpropagating through Structured Argmax using a SPIGOT</p>
    <p>Hao Peng, Sam Thomson, Noah A. Smith</p>
    <p>@ACL July 17, 2018</p>
  </div>
  <div class="page">
    <p>Overview</p>
    <p>Shareholders theirtook money</p>
    <p>Shareholders theirtook money</p>
    <p>Downstream task</p>
    <p>Loss L</p>
    <p>Parser arg max</p>
  </div>
  <div class="page">
    <p>Overview</p>
    <p>Shareholders theirtook money</p>
    <p>Shareholders theirtook money</p>
    <p>Downstream task</p>
    <p>Loss L</p>
    <p>Parser arg max</p>
    <p>Head token Yang and Mitchell, 2017</p>
    <p>Tree-RNN Tai et al., 2015</p>
    <p>Graph CNN Kipf and Welling, 2017</p>
  </div>
  <div class="page">
    <p>Overview</p>
    <p>Shareholders theirtook money</p>
    <p>Shareholders theirtook money</p>
    <p>Downstream task</p>
    <p>Loss L</p>
    <p>Parser arg max</p>
    <p>A layer in the computation graph?</p>
  </div>
  <div class="page">
    <p>Overview</p>
    <p>Shareholders theirtook money</p>
    <p>Shareholders theirtook money</p>
    <p>Downstream task</p>
    <p>Loss L</p>
    <p>Parser arg max</p>
    <p>Non-differentiable</p>
    <p>A layer in the computation graph?</p>
  </div>
  <div class="page">
    <p>Aim  Structured prediction as a layer.</p>
    <p>Overview</p>
    <p>Shareholders theirtook money</p>
    <p>Intermediate parser  arg max</p>
    <p>Shareholders theirtook money Downstream task</p>
    <p>Loss L</p>
    <p>?rL</p>
    <p>Motivation  Structures help.</p>
    <p>Ji and Smith, 2017; Oepen et al., 2017</p>
    <p>Linguistic structures may not be universally optimal.</p>
    <p>Williams, 2017</p>
  </div>
  <div class="page">
    <p>Aim  Structured prediction as a layer.</p>
    <p>Overview</p>
    <p>Shareholders theirtook money</p>
    <p>Intermediate parser  arg max</p>
    <p>Shareholders theirtook money Downstream task</p>
    <p>Loss L</p>
    <p>?rL</p>
    <p>Motivation  Structures help.</p>
    <p>Ji and Smith, 2017; Oepen et al., 2017</p>
    <p>Linguistic structures may not be universally optimal.</p>
    <p>Williams, 2017</p>
    <p>Challenges  argmax is non-differentiable.</p>
  </div>
  <div class="page">
    <p>Aim  Structured prediction as a layer.</p>
    <p>Overview</p>
    <p>Shareholders theirtook money</p>
    <p>Intermediate parser  arg max</p>
    <p>Shareholders theirtook money Downstream task</p>
    <p>Loss L</p>
    <p>?rL</p>
    <p>Motivation  Structures help.</p>
    <p>Ji and Smith, 2017; Oepen et al., 2017</p>
    <p>Linguistic structures may not be universally optimal.</p>
    <p>Williams, 2017</p>
    <p>Challenges  argmax is non-differentiable.</p>
    <p>Structured Prediction Intermediate Gradients Optimization Technique</p>
    <p>SPIGOT</p>
    <p>A proxy</p>
    <p>Method</p>
  </div>
  <div class="page">
    <p>Background: structured prediction as linear programs</p>
    <p>Method: SPIGOT algorithm</p>
    <p>Experiments</p>
    <p>Outline</p>
  </div>
  <div class="page">
    <p>Input</p>
    <p>Structured Prediction Reviewed</p>
    <p>Output</p>
    <p>Shareholders theirtook money</p>
    <p>Shareholders theirtook money</p>
  </div>
  <div class="page">
    <p>Input</p>
    <p>Shareholders theirtook money</p>
    <p>Structured Prediction Reviewed</p>
    <p>Score</p>
    <p>Shareholders theirtook moneyS ( )</p>
    <p>X s ( )head mod</p>
    <p>arcs</p>
    <p>=</p>
  </div>
  <div class="page">
    <p>Output</p>
    <p>z</p>
    <p>Structured Prediction Reviewed</p>
    <p>arg max z forms a trees.t.</p>
    <p>z&gt;s</p>
    <p>Input Shareholders theirtook money</p>
    <p>Score took their took money their tooktheir moneys =</p>
    <p>s ( ) , s ( ) , s ( ) , . . . , s ( )</p>
    <p>&gt;</p>
    <p>z = [ 1?, 0?, 1?, . . . , 0? ]&gt;</p>
    <p>Shareholders theirtook money</p>
  </div>
  <div class="page">
    <p>their money took their</p>
    <p>took money</p>
    <p>their took</p>
    <p>s ( ) s ( ) s ( )</p>
    <p>... s ( )</p>
    <p>arg max z&gt; z forms a trees.t.</p>
    <p>Az  b</p>
    <p>=</p>
    <p>Shareholders theirtook moneyz</p>
    <p>Linear Programming Formulation</p>
    <p>Roth and Yih, 2004; Martins et al., 2009</p>
  </div>
  <div class="page">
    <p>their money took their</p>
    <p>took money</p>
    <p>their took</p>
    <p>s ( ) s ( ) s ( )</p>
    <p>... s ( )</p>
    <p>arg max z&gt; z forms a trees.t.</p>
    <p>Az  b</p>
    <p>=</p>
    <p>Shareholders theirtook moneyz</p>
    <p>Linear Programming Formulation</p>
    <p>Roth and Yih, 2004; Martins et al., 2009</p>
    <p>relaxation zi 2 {0, 1}</p>
    <p>zi 2 [0, 1]</p>
  </div>
  <div class="page">
    <p>Background: structured prediction as linear programs</p>
    <p>Method: SPIGOT algorithm</p>
    <p>Experiments</p>
    <p>Outline</p>
  </div>
  <div class="page">
    <p>Backprop</p>
    <p>Downstream task</p>
    <p>Loss L</p>
    <p>Shareholders theirtook moneyz</p>
    <p>their money</p>
    <p>took their</p>
    <p>took money</p>
    <p>their took</p>
    <p>s ( ) s ( ) s ( )</p>
    <p>... s ( )</p>
    <p>arg max z&gt; z forms a trees.t.</p>
    <p>z = rL</p>
  </div>
  <div class="page">
    <p>Backprop</p>
    <p>Downstream task</p>
    <p>Loss L</p>
    <p>Shareholders theirtook moneyz</p>
    <p>their money</p>
    <p>took their</p>
    <p>took money</p>
    <p>their took</p>
    <p>s ( ) s ( ) s ( )</p>
    <p>... s ( )</p>
    <p>arg max z&gt; z forms a trees.t.</p>
    <p>z =</p>
    <p>Backprop</p>
    <p>rzL</p>
    <p>rL</p>
  </div>
  <div class="page">
    <p>Backprop</p>
    <p>Downstream task</p>
    <p>Loss L</p>
    <p>Shareholders theirtook moneyz</p>
    <p>their money</p>
    <p>took their</p>
    <p>took money</p>
    <p>their took</p>
    <p>s ( ) s ( ) s ( )</p>
    <p>... s ( )</p>
    <p>arg max z&gt; z forms a trees.t.</p>
    <p>z =</p>
    <p>Backprop</p>
    <p>BackproprL</p>
    <p>rzL</p>
    <p>rsL</p>
  </div>
  <div class="page">
    <p>Backprop</p>
    <p>Downstream task</p>
    <p>Loss L</p>
    <p>Shareholders theirtook moneyz</p>
    <p>their money</p>
    <p>took their</p>
    <p>took money</p>
    <p>their took</p>
    <p>s ( ) s ( ) s ( )</p>
    <p>... s ( )</p>
    <p>arg max z&gt; z forms a trees.t.</p>
    <p>z =</p>
    <p>Backprop</p>
    <p>Proxy</p>
    <p>BackproprL</p>
    <p>rzL</p>
    <p>rsL</p>
  </div>
  <div class="page">
    <p>Backprop We need: rsLWe have: rzL</p>
  </div>
  <div class="page">
    <p>Backprop We need: rsLWe have: rzL</p>
    <p>Leibniz, 1676</p>
    <p>rsL = J rzL</p>
  </div>
  <div class="page">
    <p>Backprop We need: rsLWe have: rzL</p>
    <p>Leibniz, 1676</p>
    <p>rsL = J rzL</p>
    <p>z forms a trees.t. z = arg max z&gt;s</p>
    <p>Jacobian not defined</p>
  </div>
  <div class="page">
    <p>Backprop We need: rsLWe have: rzL</p>
    <p>Straight-through Estimator (STE) Hinton, 2012; Bengio et al., 2013</p>
    <p>Leibniz, 1676</p>
    <p>rsL = J rzL</p>
    <p>rsL , rzL</p>
  </div>
  <div class="page">
    <p>Some Geometry</p>
    <p>Shareholders theirtook money</p>
    <p>z = [1, 0, 1,    , 0]&gt;</p>
    <p>Az  b</p>
    <p>Straight-through Estimator (STE): rsL , rzL</p>
  </div>
  <div class="page">
    <p>Some Geometry</p>
    <p>Shareholders theirtook money</p>
    <p>z = [1, 0, 1,    , 0]&gt;</p>
    <p>Az  b</p>
    <p>Straight-through Estimator (STE): rsL , rzL</p>
    <p>rzL = [0.3, 0.5, 0.4, . . . , 0.2]</p>
  </div>
  <div class="page">
    <p>Some Geometry</p>
    <p>Shareholders theirtook money</p>
    <p>z = [1, 0, 1,    , 0]&gt;</p>
    <p>Shareholders theirtook money</p>
    <p>Az  b</p>
    <p>p = z  rzL</p>
    <p>rzL = [0.3, 0.5, 0.4, . . . , 0.2]</p>
    <p>Straight-through Estimator (STE): rsL , rzL</p>
  </div>
  <div class="page">
    <p>Some Geometry</p>
    <p>Shareholders theirtook money</p>
    <p>z = [1, 0, 1,    , 0]&gt;</p>
    <p>Shareholders theirtook money</p>
    <p>Az  b</p>
    <p>SPIGOT</p>
    <p>q</p>
    <p>p = z  rzL</p>
    <p>rzL = [0.3, 0.5, 0.4, . . . , 0.2]</p>
  </div>
  <div class="page">
    <p>Some Geometry</p>
    <p>Shareholders theirtook money</p>
    <p>z = [1, 0, 1,    , 0]&gt;</p>
    <p>Shareholders theirtook money</p>
    <p>Az  b</p>
    <p>SPIGOT</p>
    <p>q</p>
    <p>p = z  rzL q = proj(p)</p>
    <p>rsL , z  q</p>
    <p>p = z  rzL</p>
    <p>rsL rzL = [0.3, 0.5, 0.4, . . . , 0.2]</p>
  </div>
  <div class="page">
    <p>Some Geometry</p>
    <p>rsL</p>
    <p>SPIGOT</p>
    <p>rsL z z</p>
    <p>z  rzL</p>
    <p>z  rzL</p>
  </div>
  <div class="page">
    <p>Algorithm Input</p>
    <p>z =Parser</p>
    <p>Shareholders theirtook money their money</p>
    <p>took their</p>
    <p>took money</p>
    <p>their took</p>
    <p>s ( ) s ( ) s ( )</p>
    <p>... s ( )</p>
    <p>arg max z&gt; z forms a trees.t.</p>
    <p>Shareholders theirtook moneyz</p>
  </div>
  <div class="page">
    <p>Algorithm Input</p>
    <p>z =Parser</p>
    <p>Downstream task</p>
    <p>Shareholders theirtook money their money</p>
    <p>took their</p>
    <p>took money</p>
    <p>their took</p>
    <p>s ( ) s ( ) s ( )</p>
    <p>... s ( )</p>
    <p>arg max z&gt; z forms a trees.t.</p>
    <p>Shareholders theirtook moneyz</p>
    <p>Loss L</p>
  </div>
  <div class="page">
    <p>Algorithm Input</p>
    <p>z =Parser</p>
    <p>Downstream task</p>
    <p>Shareholders theirtook money their money</p>
    <p>took their</p>
    <p>took money</p>
    <p>their took</p>
    <p>s ( ) s ( ) s ( )</p>
    <p>... s ( )</p>
    <p>arg max z&gt; z forms a trees.t.</p>
    <p>Shareholders theirtook moneyz</p>
    <p>Loss L Backprop</p>
    <p>rzL</p>
  </div>
  <div class="page">
    <p>Algorithm Input</p>
    <p>z =Parser</p>
    <p>Downstream task</p>
    <p>Shareholders theirtook money their money</p>
    <p>took their</p>
    <p>took money</p>
    <p>their took</p>
    <p>s ( ) s ( ) s ( )</p>
    <p>... s ( )</p>
    <p>arg max z&gt; z forms a trees.t.</p>
    <p>Shareholders theirtook moneyz</p>
    <p>Loss L Backprop</p>
    <p>Project onto</p>
    <p>rzL</p>
    <p>rsL p = z  rzL q = proj(p)</p>
    <p>rsL , z  q</p>
  </div>
  <div class="page">
    <p>Algorithm Input</p>
    <p>z =Parser</p>
    <p>Downstream task</p>
    <p>Shareholders theirtook money their money</p>
    <p>took their</p>
    <p>took money</p>
    <p>their took</p>
    <p>s ( ) s ( ) s ( )</p>
    <p>... s ( )</p>
    <p>arg max z&gt; z forms a trees.t.</p>
    <p>Shareholders theirtook moneyz</p>
    <p>Loss L Backprop</p>
    <p>Project onto</p>
    <p>Backprop</p>
    <p>rL</p>
    <p>rzL</p>
    <p>rsL p = z  rzL q = proj(p)</p>
    <p>rsL , z  q</p>
  </div>
  <div class="page">
    <p>Connections to Related Work</p>
    <p>Structured Attention: Kim et al., 2017</p>
    <p>STE</p>
    <p>Pipeline STE Structured Att. SPIGOT</p>
    <p>Hard decision on</p>
    <p>Backprop</p>
    <p>Marginal</p>
    <p>Projection</p>
    <p>z</p>
    <p>SPIGOT z  rzL</p>
    <p>rsL rsL</p>
    <p>z  rzL</p>
    <p>z</p>
  </div>
  <div class="page">
    <p>Connections to Related Work Structured Attention</p>
    <p>z = arg max (. . . )</p>
    <p>z = softmax(. . . )</p>
    <p>Structured Attention: Kim et al., 2017</p>
    <p>Pipeline STE Structured Att. SPIGOT</p>
    <p>Hard decision on</p>
    <p>Backprop</p>
    <p>Marginal</p>
    <p>Projection</p>
    <p>z</p>
    <p>SPIGOT z  rzL</p>
    <p>rsL</p>
  </div>
  <div class="page">
    <p>Joint learning Swayamdipta et al., 2016</p>
    <p>Shareholders theirtook money</p>
    <p>Parser arg max</p>
    <p>Shareholders theirtook money</p>
    <p>rL1</p>
    <p>L1</p>
    <p>Training data</p>
    <p>Applications</p>
  </div>
  <div class="page">
    <p>Joint learning Swayamdipta et al., 2016</p>
    <p>Shareholders theirtook money</p>
    <p>Parser arg max</p>
    <p>Shareholders theirtook money</p>
    <p>Downstream task</p>
    <p>Loss L2</p>
    <p>rL2</p>
    <p>rL2</p>
    <p>rL1</p>
    <p>L1</p>
    <p>Training data</p>
    <p>Applications</p>
  </div>
  <div class="page">
    <p>Joint learning Swayamdipta et al., 2016</p>
    <p>Shareholders theirtook money</p>
    <p>Parser arg max</p>
    <p>Shareholders theirtook money</p>
    <p>Downstream task</p>
    <p>Loss L2</p>
    <p>rL2</p>
    <p>rL2</p>
    <p>rL1</p>
    <p>L1 Shareholders theirtook money Parser arg max</p>
    <p>Shareholders theirtook money</p>
    <p>Downstream task</p>
    <p>Loss L</p>
    <p>rL</p>
    <p>rL</p>
    <p>Training data Training data</p>
    <p>Induce latent structures Yogatama et al., 2017; Williams et al., 2017</p>
    <p>Applications</p>
  </div>
  <div class="page">
    <p>Background: structured prediction as linear programs</p>
    <p>Method: SPIGOT algorithm</p>
    <p>Experiments</p>
    <p>Outline</p>
  </div>
  <div class="page">
    <p>Experiments: Syntactic-then-semantic Parsing</p>
    <p>Shareholders theirtook money</p>
    <p>Syntactic Parserarg max</p>
    <p>Shareholders theirtook money</p>
    <p>Semantic Parser  arg1</p>
    <p>arg2</p>
    <p>poss</p>
    <p>Shareholders theirtook money</p>
    <p>Input</p>
    <p>Syntactic tree</p>
    <p>Semantic graph</p>
  </div>
  <div class="page">
    <p>Experiments: Syntactic-then-semantic Parsing</p>
    <p>Shareholders theirtook money</p>
    <p>Syntactic Parserarg max</p>
    <p>Shareholders theirtook money</p>
    <p>BiLSTM + MLP Kiperwasser and Goldberg, 2016</p>
    <p>Eisner Algorithm Eisner, 1996</p>
    <p>Semantic Parser  arg1</p>
    <p>arg2</p>
    <p>poss</p>
    <p>Shareholders theirtook money</p>
    <p>Input</p>
    <p>Syntactic tree</p>
    <p>Semantic graph</p>
  </div>
  <div class="page">
    <p>Experiments: Syntactic-then-semantic Parsing</p>
    <p>Shareholders theirtook money</p>
    <p>Syntactic Parserarg max</p>
    <p>Shareholders theirtook money</p>
    <p>BiLSTM + MLP Kiperwasser and Goldberg, 2016</p>
    <p>Eisner Algorithm Eisner, 1996</p>
    <p>NeurboParser Peng et al., 2017</p>
    <p>Semantic Parser  arg1</p>
    <p>arg2</p>
    <p>poss</p>
    <p>Shareholders theirtook money</p>
    <p>took tookmoneyroot</p>
    <p>Concat head token embedding</p>
    <p>Input</p>
    <p>Syntactic tree</p>
    <p>Semantic graph</p>
  </div>
  <div class="page">
    <p>SemEval 15. Micro-averaged labeled F1</p>
    <p>Neurbo: Peng et al., 2017</p>
    <p>Neurbo Pipeline STE Structured Att. SPIGOT</p>
    <p>Syntax</p>
    <p>Backprop N/A</p>
    <p>Hard decision N/A</p>
    <p>Projection N/A</p>
    <p>z</p>
    <p>F1</p>
  </div>
  <div class="page">
    <p>F1</p>
    <p>SemEval 15. Micro-averaged labeled F1</p>
    <p>Neurbo Pipeline STE Structured Att. SPIGOT</p>
    <p>Syntax</p>
    <p>Backprop N/A</p>
    <p>Hard decision N/A</p>
    <p>Projection N/A</p>
    <p>Neurbo: Peng et al., 2017</p>
    <p>z</p>
  </div>
  <div class="page">
    <p>SemEval 15. Micro-averaged labeled F1 F1</p>
    <p>Neurbo Pipeline STE Structured Att. SPIGOT</p>
    <p>Syntax</p>
    <p>Backprop N/A</p>
    <p>Hard decision N/A</p>
    <p>Projection N/A</p>
    <p>Neurbo: Peng et al., 2017</p>
    <p>z</p>
  </div>
  <div class="page">
    <p>SemEval 15. Micro-averaged labeled F1 F1</p>
    <p>Neurbo: Peng et al., 2017</p>
    <p>Neurbo Pipeline STE Structured Att. SPIGOT</p>
    <p>Syntax</p>
    <p>Backprop N/A</p>
    <p>Hard decision N/A</p>
    <p>Projection N/A z</p>
  </div>
  <div class="page">
    <p>Semantic Parsing for Sentiment Classification</p>
    <p>Shareholders theirtook money</p>
    <p>Semantic Parserarg max</p>
    <p>Classifier</p>
    <p>arg1 arg2</p>
    <p>poss</p>
    <p>Shareholders theirtook money</p>
    <p>Input</p>
    <p>Semantic graph</p>
    <p>Positive? Negative?</p>
  </div>
  <div class="page">
    <p>Semantic Parsing for Sentiment Classification</p>
    <p>Shareholders theirtook money</p>
    <p>Semantic Parserarg max</p>
    <p>NeurboParser Peng et al., 2017</p>
    <p>AD3 Martins et al., 2011</p>
    <p>BiLSTM+MLP</p>
    <p>Classifier</p>
    <p>arg1 arg2</p>
    <p>poss</p>
    <p>Shareholders theirtook money took: arg1 took:arg2; their:poss</p>
    <p>Concat head token and role</p>
    <p>Input</p>
    <p>Semantic graph</p>
    <p>Positive? Negative?</p>
  </div>
  <div class="page">
    <p>Ac cu</p>
    <p>ra cy</p>
    <p>BiLSTM</p>
    <p>Stanford Sentiment Treebank accuracy</p>
    <p>Pipeline STE SPIGOT</p>
  </div>
  <div class="page">
    <p>Conclusion</p>
    <p>Problem</p>
  </div>
  <div class="page">
    <p>Conclusion</p>
    <p>Problem Method SPIGOT</p>
  </div>
  <div class="page">
    <p>Conclusion</p>
    <p>Problem Method Results SPIGOT</p>
  </div>
  <div class="page">
    <p>Thank you!</p>
  </div>
</Presentation>
