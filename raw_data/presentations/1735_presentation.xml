<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Experiences with CoralCDN</p>
    <p>A FiveYear Opera:onal View</p>
    <p>Michael J. Freedman</p>
    <p>Princeton University</p>
    <p>www.coralcdn.org</p>
  </div>
  <div class="page">
    <p>CoralCDN</p>
    <p>Goal: To make desired content widely available regardless of publishers own resources, by</p>
    <p>organizing and u:lizing any coopera:ve resources</p>
    <p>CoralCDN DNS Server</p>
    <p>CoralCDN HTTP Proxy</p>
    <p>Coral index node</p>
    <p>Coral index node</p>
    <p>CoralCDN HTTP Proxy</p>
    <p>CoralCDN DNS Server</p>
    <p>Coral index node</p>
    <p>CoralCDN HTTP Proxy</p>
    <p>Client Resolver</p>
    <p>CoralCDN DNS Server</p>
    <p>Coral index node</p>
    <p>CoralCDN HTTP Proxy</p>
    <p>A Coopera:ve, SelfOrganizing CDN</p>
  </div>
  <div class="page">
    <p>hPp://example.com/path</p>
    <p>hPp://example.com.nyud.net/path</p>
  </div>
  <div class="page">
    <p>Adopted by:</p>
    <p>Clients</p>
    <p>Servers</p>
    <p>Thirdpar:es</p>
  </div>
  <div class="page">
    <p>Many of you have used CoralCDN</p>
  </div>
  <div class="page">
    <p>Many of you have used CoralCDN</p>
  </div>
  <div class="page">
    <p>Many of you have used CoralCDN</p>
  </div>
  <div class="page">
    <p>Many of you have used CoralCDN</p>
  </div>
  <div class="page">
    <p>Many of you have used CoralCDN</p>
  </div>
  <div class="page">
    <p>Many of you have used CoralCDN</p>
  </div>
  <div class="page">
    <p>Jan05 Jan06 Jan07 Jan08 Jan09 Jan10</p>
    <p>R e</p>
    <p>q u</p>
    <p>e s ts</p>
    <p>p e</p>
    <p>r D</p>
    <p>a y (</p>
    <p>M il li o</p>
    <p>n s ) From Clients</p>
    <p>To Upstream Proxy/Origin</p>
    <p>Daily Request Volume 2M clients  2 TB content  20K origin domains</p>
    <p>From 300400 PlanetLab servers</p>
  </div>
  <div class="page">
    <p>CoralCDN DNS Server</p>
    <p>CoralCDN HTTP Proxy</p>
    <p>Coral index node</p>
    <p>CoralCDN DNS Server</p>
    <p>Coral index node</p>
    <p>CoralCDN HTTP Proxy</p>
    <p>CoralCDN DNS Server</p>
    <p>CoralCDN HTTP Proxy</p>
    <p>CoralCDN</p>
    <p>CoralCDN HTTP Proxy</p>
    <p>Based on peertopeer DHT</p>
    <p>Coral index node</p>
    <p>Coral index node</p>
  </div>
  <div class="page">
    <p>CoralCDN DNS Server</p>
    <p>CoralCDN HTTP Proxy</p>
    <p>Coral index node</p>
    <p>CoralCDN DNS Server</p>
    <p>Coral index node</p>
    <p>CoralCDN HTTP Proxy</p>
    <p>CoralCDN DNS Server</p>
    <p>CoralCDN HTTP Proxy</p>
    <p>CoralCDN</p>
    <p>CoralCDN HTTP Proxy</p>
    <p>Based on peertopeer DHT</p>
    <p>Coral index node</p>
    <p>Coral index node</p>
  </div>
  <div class="page">
    <p>CoralCDN DNS Server</p>
    <p>CoralCDN HTTP Proxy</p>
    <p>Coral index node</p>
    <p>CoralCDN DNS Server</p>
    <p>Coral index node</p>
    <p>CoralCDN HTTP Proxy</p>
    <p>CoralCDN DNS Server CoralCDN</p>
    <p>CoralCDN HTTP Proxy</p>
    <p>Coral index node CoralCDN HTTP Proxy</p>
    <p>Coral index node</p>
    <p>Virtualiza:on Layer</p>
    <p>Clients Origin Domains</p>
    <p>Interac:ons with the External Environment</p>
  </div>
  <div class="page"/>
  <div class="page">
    <p>Naming</p>
    <p>x</p>
    <p>Flexible, open API</p>
    <p>Mismatch with domainbased access control policies</p>
  </div>
  <div class="page">
    <p>Rewrite rules in origin webservers</p>
    <p>RewriteEngine on</p>
    <p>RewriteCond %{HTTP_USER_AGENT} !^CoralWebPrx RewriteCond %{QUERY_STRING} !(^|&amp;)coral-no-serve$</p>
    <p>RewriteRule ^(.*)$ http://%{HTTP_HOST}.nyud.net% {REQUEST_URI} [R,L]</p>
    <p>CoralCDNs PlaaormasaService API</p>
  </div>
  <div class="page">
    <p>Sites integrate with load/bandwidth monitoring</p>
    <p>Elas:c Provisioning</p>
    <p>CoralCDNs PlaaormasaService API</p>
    <p>Rewrite rules in origin webservers</p>
    <p>RewriteEngine on</p>
    <p>RewriteCond %{HTTP_USER_AGENT} !^CoralWebPrx RewriteCond %{QUERY_STRING} !(^|&amp;)coral-no-serve$</p>
    <p>RewriteCond %{HTTP_REFERER} slashdot\.org [NC] RewriteCond %{HTTP_REFERER} digg\.com [NC,OR] RewriteCond %{HTTP_REFERER} blogspot\.com [NC,OR]</p>
    <p>RewriteRule ^(.*)$ http://%{HTTP_HOST}.nyud.net% {REQUEST_URI} [R,L]</p>
  </div>
  <div class="page">
    <p>Naming Confla:on</p>
    <p>x x</p>
    <p>hPp://domain /path .service2 .service1</p>
  </div>
  <div class="page">
    <p>Domainbased Security Policies</p>
    <p>evil.com</p>
    <p>target.com Cookies</p>
    <p>Web Page</p>
    <p>Document Object Model</p>
  </div>
  <div class="page">
    <p>Domainbased Security Policies</p>
    <p>evil.com</p>
    <p>target.com Cookies</p>
    <p>Web Page</p>
    <p>Document Object Model</p>
    <p>Defaults violate least privilege</p>
    <p>.nyud.net</p>
    <p>.nyud.net</p>
  </div>
  <div class="page">
    <p>Fault Tolerance: Failure Decoupling</p>
    <p>x</p>
    <p>Internal failures:  DHT nodes  DNS servers, HTTP proxies  Management service</p>
    <p>External failures:  Decouple IPs from hosts  Interac:ons with origin sites</p>
  </div>
  <div class="page">
    <p>happens!</p>
    <p>Origin Status</p>
    <p>CoralCDN ReacAon</p>
    <p>Cache nega:ve results</p>
    <p>Serve stale content</p>
    <p>Use wholefile overwrites</p>
  </div>
  <div class="page">
    <p>happens!</p>
    <p>Origin Status</p>
    <p>CoralCDN ReacAon</p>
    <p>Cache nega:ve results</p>
    <p>Serve stale content</p>
    <p>Use wholefile overwrites</p>
    <p>Maintain status quo unless improvements are possible</p>
  </div>
  <div class="page">
    <p>What is failure?</p>
    <p>Return values should have failsafe defaults</p>
  </div>
  <div class="page">
    <p>Resource Management</p>
    <p>x</p>
    <p>Control over bandwidth consump:on</p>
    <p>Control and visibility into environments resources</p>
  </div>
  <div class="page">
    <p>Some :meline</p>
    <p>Mar 2004 CoralCDN released on PlanetLab</p>
  </div>
  <div class="page">
    <p>Some :meline</p>
    <p>Mar 2004 CoralCDN released on PlanetLab</p>
    <p>Aug 2004 SlashdoPed</p>
  </div>
  <div class="page">
    <p>Some :meline</p>
    <p>Mar 2004 CoralCDN released on PlanetLab</p>
    <p>Aug 2004 SlashdoPed</p>
    <p>Dec 2004 Asian Tsunami</p>
    <p>resource limits for slices</p>
  </div>
  <div class="page">
    <p>?</p>
    <p>A vg M</p>
    <p>B p er h o u r (d</p>
    <p>i) Demand &gt;&gt; Supply:</p>
    <p>Enter FairSharing Algorithms</p>
    <p>Domains with heaviest consump:on</p>
    <p>i di  S</p>
  </div>
  <div class="page">
    <p>A vg M</p>
    <p>B p er h o u r (d</p>
    <p>i) Demand &gt;&gt; Supply:</p>
    <p>Enter FairSharing Algorithms</p>
    <p>find max , s.t. i min (, di)  S</p>
    <p>Domains with heaviest consump:on</p>
  </div>
  <div class="page">
    <p>Demand &gt;&gt; Supply: Enter FairSharing Algorithms</p>
    <p>find max , s.t. i min (, di)  S</p>
    <p>Domains with heaviest consump:on</p>
  </div>
  <div class="page">
    <p>R e</p>
    <p>q u</p>
    <p>e s ts</p>
    <p>p e</p>
    <p>r D</p>
    <p>o m</p>
    <p>a in</p>
    <p>Unique Domains Ordered by Decreasing Popularity</p>
    <p>All Responses</p>
    <p>R e q u e s ts</p>
    <p>p e r</p>
    <p>D o m</p>
    <p>a in</p>
    <p>Unique Domains Ordered by Decreasing Popularity</p>
    <p>All Responses</p>
    <p>Admission Control under FairSharing</p>
    <p>R e</p>
    <p>q u</p>
    <p>e s ts</p>
    <p>p e</p>
    <p>r D</p>
    <p>o m</p>
    <p>a in</p>
    <p>Unique Domains Ordered by Decreasing Popularity</p>
    <p>All Responses Forbidden Responses</p>
    <p>~10 kB imgs 3.3% rejected</p>
    <p>~5 MB videos 89% rejected</p>
    <p>Demand &gt; 10 TB Supply  2 TB</p>
  </div>
  <div class="page">
    <p>Some :meline</p>
    <p>Mar 2004 CoralCDN released on PlanetLab</p>
    <p>Aug 2004 SlashdoPed</p>
    <p>Dec 2004 Asian Tsunami</p>
    <p>resource limits for slices</p>
    <p>Mar 2006 PL deploys bandwidth throPling</p>
  </div>
  <div class="page">
    <p>Resource Management: Us vs. Them</p>
    <p>ApplicaAon Hammer</p>
    <p>Track HTTP traffic</p>
    <p>If site &gt; fair share rate, reject via HTTP 403</p>
    <p>If total &gt; peak rate, close server socket</p>
    <p>PlaEorm Hammer</p>
    <p>Track all network traffic</p>
    <p>If total &gt; 80% daily rate, BW shaping in kernel</p>
  </div>
  <div class="page">
    <p>Resource Management: Us vs. Them</p>
    <p>Track HTTP traffic</p>
    <p>If site &gt; fair share rate, reject via HTTP 403</p>
    <p>If total &gt; peak rate, close server socket</p>
    <p>Track all network traffic</p>
    <p>If total &gt; 80% daily rate, BW shaping in kernel</p>
    <p>ApplicaAon Hammer PlaEorm Hammer</p>
    <p>Lower layers should expose greater visibility and control over resources</p>
    <p>Result: HTTP traffic is 1/2  2/3 of all traffic</p>
  </div>
  <div class="page"/>
  <div class="page">
    <p>Usage Scenarios</p>
    <p>R e</p>
    <p>q u</p>
    <p>e s ts</p>
    <p>p e</p>
    <p>r U</p>
    <p>R L</p>
    <p>Unique URLs by Popularity</p>
    <p>Aug-9-2005 Aug-9-2007 Aug-9-2009</p>
  </div>
  <div class="page">
    <p>R e</p>
    <p>q u</p>
    <p>e s ts</p>
    <p>p e</p>
    <p>r U</p>
    <p>R L</p>
    <p>Unique URLs by Popularity</p>
    <p>Aug-9-2005 Aug-9-2007 Aug-9-2009</p>
    <p>Usage Scenarios</p>
  </div>
  <div class="page">
    <p>R e</p>
    <p>q u</p>
    <p>e s ts</p>
    <p>p e</p>
    <p>r U</p>
    <p>R L</p>
    <p>Unique URLs by Popularity</p>
    <p>Aug-9-2005 Aug-9-2007 Aug-9-2009</p>
    <p>Usage Scenarios</p>
    <p>R e</p>
    <p>q u</p>
    <p>e s ts</p>
    <p>p e</p>
    <p>r d</p>
    <p>o m</p>
    <p>a in</p>
    <p>Time (Days)</p>
  </div>
  <div class="page">
    <p>Usage Scenarios</p>
    <p>Top URLs % Reqs Agg Size (MB)</p>
    <p>Result Frequency</p>
    <p>Local Cache 70.4 %</p>
    <p>Origin Site 9.9 %</p>
    <p>CoralCDN Proxy 7.1 %</p>
  </div>
  <div class="page">
    <p>R e</p>
    <p>q u</p>
    <p>e st</p>
    <p>s p</p>
    <p>e r</p>
    <p>m in</p>
    <p>u te</p>
    <p>Time (Hours)</p>
    <p>moonbuggy.org redditmirror.cc</p>
    <p>moonbuggy reddit</p>
    <p>Usage Scenarios</p>
  </div>
  <div class="page">
    <p>Usage Scenarios</p>
    <p>R e</p>
    <p>q u</p>
    <p>e st</p>
    <p>s p</p>
    <p>e r</p>
    <p>m in</p>
    <p>u te</p>
    <p>Time (Hours)</p>
    <p>moonbuggy.org redditmirror.cc</p>
    <p>moonbuggy reddit</p>
  </div>
  <div class="page">
    <p>Usage Scenarios</p>
  </div>
  <div class="page">
    <p>Conclusions?</p>
    <p>Most requested content is longterm popular and already cached locally</p>
    <p>Flash crowds occur, but on order of minutes</p>
  </div>
  <div class="page">
    <p>Conclusions?</p>
    <p>Most requested content is longterm popular and already cached locally</p>
    <p>Flash crowds occur, but on order of minutes</p>
    <p>Focus on longterm popular</p>
    <p>LiPle / no HTTP coopera:on</p>
    <p>Global discovery (e.g., DNS)</p>
    <p>Focus on flash crowds</p>
    <p>Regional coop. as default</p>
    <p>Global coop. as failover</p>
  </div>
  <div class="page">
    <p>Reconfiguring CoralCDNs design</p>
    <p>Leverage Coral hierarchy for lookup</p>
    <p>Latency 90% Origin Load 5% Failover to global 0.5%</p>
  </div>
  <div class="page">
    <p>Reconfiguring CoralCDNs design</p>
    <p>Leverage Coral hierarchy for lookup</p>
    <p>During admission control, bias against longterm use</p>
    <p>i min (, di) &lt; S heavily weight history in ewma</p>
  </div>
  <div class="page">
    <p>Fault Tolerance</p>
    <p>Resource management</p>
    <p>Easy changes to promote flashcrowd mi:ga:on</p>
    <p>Conclusions</p>
  </div>
  <div class="page">
    <p>Can we reach Internet scale?</p>
    <p>www.firecoral.net</p>
    <p>Ini:al betarelease</p>
    <p>of browserbased P2P web cache</p>
  </div>
</Presentation>
