<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Who Is Answering My Queries?</p>
    <p>Understanding and Characterizing Hidden Interception of the DNS Resolution Path</p>
    <p>Baojun Liu, Chaoyi Lu, Haixin Duan,</p>
    <p>Ying Liu, Zhou Li, Shuang Hao and Min Yang</p>
  </div>
  <div class="page">
    <p>DNS Resolution  ISP DNS Resolver  Might have security problems [Dagon, NDSS08] [Weaver, SATIN11] [Weaver,</p>
    <p>FOCI11] [Kuhrer, IMC15] [Chung, IMC16]</p>
    <p>Client</p>
    <p>Root NS</p>
    <p>ISP DNS Resolver</p>
    <p>TLD NS</p>
    <p>SLD NS</p>
    <p>request response 2</p>
  </div>
  <div class="page">
    <p>DNS Resolution  Public DNS Resolver  Performance (e.g., load balancing)  Security (e.g., DNSSEC support)  DNS extension (e.g., EDNS Client Subnet)</p>
  </div>
  <div class="page">
    <p>DNS Interception  Who is answering my queries?</p>
    <p>Client</p>
    <p>Google DNS 8.8.8.8</p>
    <p>youtube.com?</p>
    <p>Alternative resolver</p>
    <p>Authoritative nameserver</p>
    <p>Qu eryIm 8.8.8.8,</p>
    <p>youtube.com is at a.b.c.d.</p>
    <p>Spoof the IP address and intercept queries.</p>
  </div>
  <div class="page">
    <p>Potential Interceptors</p>
    <p>Internet Service Provider (ISP)</p>
    <p>Censorship / firewall</p>
    <p>Anti-virus software / malware (E.g., Avast anti-virus)</p>
    <p>Enterprise proxy (E.g., Cisco Umbrella intelligent proxy)</p>
  </div>
  <div class="page">
    <p>Q1: How to globally measure the hidden DNS interception?</p>
    <p>Q2: What are the characteristics of the hidden DNS interception?</p>
  </div>
  <div class="page">
    <p>Motivation</p>
    <p>Threat Model</p>
    <p>Methodology</p>
    <p>Analysis</p>
  </div>
  <div class="page">
    <p>Threat Model</p>
    <p>Root NS</p>
    <p>TLD NS</p>
    <p>SLD NS</p>
    <p>Public DNS Client On-path</p>
    <p>Device</p>
    <p>Alternative resolver</p>
    <p>original path intercepted path Middlebox</p>
  </div>
  <div class="page">
    <p>Threat Model  Taxonomy (request only)  [1] Normal resolution</p>
    <p>Client</p>
    <p>Public DNS 8.8.8.8</p>
    <p>Alternative resolver 1.2.3.4</p>
    <p>On-path Device</p>
    <p>Request to 8.8.8.8</p>
    <p>From 8.8.8.8</p>
    <p>Authoritative nameserver</p>
  </div>
  <div class="page">
    <p>Threat Model  Taxonomy (request only)  [2] Request redirection</p>
    <p>Client</p>
    <p>Public DNS 8.8.8.8</p>
    <p>Alternative resolver 1.2.3.4</p>
    <p>On-path Device</p>
    <p>Request to 8.8.8.8</p>
    <p>Authoritative nameserver</p>
    <p>From 1.2.</p>
  </div>
  <div class="page">
    <p>Threat Model  Taxonomy (request only)  [3] Request replication</p>
    <p>Client</p>
    <p>Public DNS 8.8.8.8</p>
    <p>Alternative resolver 1.2.3.4</p>
    <p>On-path Device</p>
    <p>Request to 8.8.8.8</p>
    <p>Authoritative nameserver</p>
    <p>From 8.8.8.8</p>
    <p>From 1.2.</p>
  </div>
  <div class="page">
    <p>Threat Model  Taxonomy (request only)  [4] Direct responding</p>
    <p>Client</p>
    <p>Public DNS 8.8.8.8</p>
    <p>Alternative resolver 1.2.3.4</p>
    <p>On-path Device</p>
    <p>Request to 8.8.8.8</p>
    <p>Authoritative nameserver</p>
    <p>(No thin</p>
    <p>g)</p>
  </div>
  <div class="page">
    <p>Motivation</p>
    <p>Threat Model</p>
    <p>Methodology</p>
    <p>Analysis</p>
  </div>
  <div class="page">
    <p>At a glance</p>
    <p>How to Detect?</p>
    <p>Client</p>
    <p>Public DNS 8.8.8.8</p>
    <p>Alternative resolver 1.2.3.4</p>
    <p>On-path Device</p>
    <p>Request to 8.8.8.8</p>
    <p>Authoritative nameserver</p>
    <p>From 1.2.</p>
    <p>From 8.8.8.8</p>
    <p>Send DNS requests. Check where they are from.</p>
  </div>
  <div class="page">
    <p>How to Detect?</p>
    <p>[1] Open the refrigerator [2] Put in the elephant [3] Close the door</p>
    <p>[1] Collect vantage points [2] Send DNS requests [3] Collect requests on NS</p>
    <p>* Pic source: cdc.tencent.com</p>
  </div>
  <div class="page">
    <p>Collect vantage points</p>
    <p>Diversify DNS requests</p>
    <p>Identify egress IP</p>
  </div>
  <div class="page">
    <p>Vantage Points  Requirements  Ethical  Large-scale and geo-diverse  Directly send DNS packets to specified IP</p>
  </div>
  <div class="page">
    <p>Measurement frameworks  Advertisement Networks  Flash applet [Huang, W2SP11] [Chen, CCS16]  JavaScript [Burnett, Sigcomm15]</p>
    <p>HTTP Proxy Networks  Luminati [Chung, IMC16] [Tyson, WWW17], [Chung, Security17]</p>
    <p>Internet Scanners  Open DNS resolver [Kuhrer, IMC15] [Pearce, Security17]  Scanners [Zakir, Security13] [Pearce, SP17]</p>
    <p>Can not</p>
    <p>be use</p>
    <p>d in this</p>
    <p>stu dy.</p>
  </div>
  <div class="page">
    <p>Vantage Points  Phase I: Global Analysis  ProxyRack: SOCKS5 residential proxy networks  Limitation: TCP traffic only</p>
  </div>
  <div class="page">
    <p>Vantage Points  Phase I: Global Analysis  ProxyRack: SOCKS5 residential proxy networks  Limitation: TCP traffic only</p>
    <p>Phase II: China-wide Analysis  A network debugger module of security software  Similar to Netalyzr [Kreibich, IMC 10]  Capability: TCP and UDP; Socket level</p>
  </div>
  <div class="page">
    <p>Vantage Points  Ethics considerations</p>
    <p>Global (ProxyRack)</p>
    <p>Pay for access Abide by ToS</p>
    <p>Only query our domain</p>
    <p>China-wide (network debugging tool)</p>
    <p>One-time consent Restrict traffic amount Only query our domain</p>
  </div>
  <div class="page">
    <p>Collect vantage points</p>
    <p>Diversify DNS requests</p>
    <p>Identify egress IP</p>
  </div>
  <div class="page">
    <p>DNS Requests  Requirements  Diverse: triggering interception behaviors  Controlled: allowing fine-grained analysis</p>
    <p>Public DNS Google, OpenDNS, Dynamic DNS, EDU DNS</p>
    <p>Protocol TCP, UDP</p>
    <p>QTYPE A, AAAA, CNAME, MX, NS</p>
    <p>QNAME (TLD) com, net, org, club</p>
    <p>QNAME UUID.[Google].OurDomain. [TLD]</p>
  </div>
  <div class="page">
    <p>Collect vantage points</p>
    <p>Diversify DNS requests</p>
    <p>Identify egress IP</p>
  </div>
  <div class="page">
    <p>To 8.8.8.8</p>
    <p>Egress IP  Ownership of resolver IP  Is a request from public DNS?</p>
    <p>From 74.125.41.1</p>
    <p>Client Authoritative nameserver</p>
    <p>Public DNS 8.8.8.8</p>
    <p>Egress resolver</p>
    <p>Load balancing</p>
    <p>Google?</p>
  </div>
  <div class="page">
    <p>Egress IP  Ownership of resolver IP  Is a request from public DNS?</p>
    <p>Solution  PTR &amp; SOA records of reverse lookups</p>
    <p>$ dig -x 74.125.41.1</p>
    <p>;; AUTHORITY SECTION: 125.74.in-addr.arpa.60 IN SOA ns1.google.com. dns-admin.google.com. 207217296 900 900 1800 60</p>
  </div>
  <div class="page">
    <p>Collected Dataset  DNS requests from vantage points  A wide range of requests collected</p>
    <p>Phase # Request # IP # Country # AS</p>
    <p>ProxyRack 1.6 M 36K 173 2,691</p>
    <p>Debugging tool 4.6 M 112K 87 356</p>
  </div>
  <div class="page">
    <p>Motivation</p>
    <p>Threat Model</p>
    <p>Methodology</p>
    <p>Analysis</p>
  </div>
  <div class="page">
    <p>Q1: Interception Characteristics</p>
    <p>Q2: DNS Lookup Performance</p>
    <p>Q3: Response Manipulation</p>
    <p>Q4: Security Threats</p>
    <p>Q5: Interception Motivations</p>
    <p>Q6: Solutions</p>
  </div>
  <div class="page">
    <p>Interception Characteristics  Magnitude (% of total requests)  Normal resolution Request redirection Request replication</p>
    <p>rare.</p>
    <p>Request redirection &gt; Request replication</p>
  </div>
  <div class="page">
    <p>Interception Characteristics  Magnitude (% of total requests)  Normal resolution Request redirection Request replication</p>
    <p>Requests to popular public DNS services are more likely to be intercepted.</p>
  </div>
  <div class="page">
    <p>Interception Characteristics  ASes (% of total requests)  Sorted by # of total requests</p>
    <p>AS Organization Redirection Replication Alternative Resolver</p>
    <p>AS4134 China Telecom 5.19% 0.2% 116.9.94.* (AS4134)</p>
    <p>AS4837 China Unicom 4.59% 0.51% 202.99.96.* (AS4837)</p>
    <p>AS9808 China Mobile 32.49% 8.85% 112.25.12.* (AS9808)</p>
    <p>AS56040 China Mobile 45.09% 0.04% 120.196.165.* (AS56040)</p>
    <p>Interception strategies can be complex, and vary among ASes.</p>
  </div>
  <div class="page">
    <p>DNS Lookup Performance  RTT of requests  Which requests complete faster?</p>
    <p>Better performance</p>
    <p>Request redirection vs. Request to local resolver:</p>
    <p>Very similar.</p>
    <p>Request replication vs. Normal resolution:</p>
    <p>Better.</p>
  </div>
  <div class="page">
    <p>DNS Lookup Performance  Arrival time of replicated requests  Which requests reach NS faster?</p>
    <p>Replicated is faster In AS4812, ALL replicated requests arrive slower than their original counterparts.</p>
    <p>Replicated is slower</p>
  </div>
  <div class="page">
    <p>Response Manipulation  DNS record values  Which responses are tampered?</p>
    <p>Classification # Response Example Client AS</p>
    <p>Gateway 54 192.168.32.1 AS4134, CN, China Telecom</p>
    <p>Monetization 10 39.130.151.30 AS9808, CN, GD Mobile</p>
    <p>Misconfiguration 26 ::218.207.212.91 AS9808, CN, GD Mobile</p>
    <p>Others 54 fe80::1 AS4837, CN, China Unicom</p>
  </div>
  <div class="page">
    <p>Response Manipulation  Example: traffic monetization</p>
    <p>China Mobile Group of Yunnan: advertisements of an APP.</p>
  </div>
  <div class="page">
    <p>Security Threats  Ethics &amp; privacy  Users may not be aware of the interception behavior</p>
    <p>Alternative resolvers security  An analysis on 205 open alternative resolvers</p>
    <p>Only 43% resolvers support DNSSEC</p>
    <p>ALL BIND versions should be deprecated before 2009</p>
  </div>
  <div class="page">
    <p>Interception Motivations  Vendors  Routers  Software platforms</p>
    <p>Motivations  Improving DNS security ?  Improving DNS lookup performance ?  Reducing traffic financial settlement</p>
  </div>
  <div class="page">
    <p>Solutions  Encrypted DNS  Resolver authentication (RFC8310)  DNS-over-TLS (RFC7858)  DNS-over-DTLS (RFC8094, experimental)  DNS-over-HTTPS</p>
    <p>Online checking tool  Which resolver are you really using?  http://whatismydnsresolver.com/</p>
  </div>
  <div class="page">
    <p>Conclusions  Understanding  A measurement platform to systematically study DNS interception</p>
    <p>Findings  DNS interception exists in 259 ASes we inspected globally  Up to 28% requests from China to Google are intercepted  Brings security concerns</p>
    <p>Motivations  Reducing traffic financial settlement</p>
    <p>Mitigation  Online checking tool</p>
  </div>
  <div class="page">
    <p>Who Is Answering My Queries?</p>
    <p>Understanding and Characterizing Hidden</p>
    <p>Interception of the DNS Resolution Path</p>
    <p>Baojun Liu, Chaoyi Lu, Haixin Duan,</p>
    <p>Ying Liu, Zhou Li, Shuang Hao and Min Yang</p>
    <p>lbj15@mails.tsinghua.edu.cn</p>
  </div>
</Presentation>
