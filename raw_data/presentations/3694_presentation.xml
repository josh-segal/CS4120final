<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Estonian Electronic Identity Card: Security Flaws in Key Management</p>
    <p>Arnis Parsovs1,2</p>
    <p>August 14, 2020</p>
  </div>
  <div class="page">
    <p>Estonian Electronic Identity Card (ID card)</p>
    <p>Nationwide PKI since 2002  Contains two asymmetric keys with the corresponding X.509 certificates:</p>
    <p>Authentication key:  TLS client authentication  Document decryption</p>
    <p>Digital signature key:  Legally binding digital signatures (EU eIDAS regulation)</p>
  </div>
  <div class="page">
    <p>ID card manufacturing</p>
    <p>ID card personalization line of Gemalto (formerly Trub Baltic) 3 / 22</p>
  </div>
  <div class="page">
    <p>Recall of ID cards issued in 2011</p>
    <p>September 2012:</p>
    <p>During a routine ID card analysis process we discovered that one of the electronic security measures of the ID card needs to be renewed.</p>
    <p>ID card users have no reason to be concerned. The card is secure and all transactions made with the card are fully reliable.</p>
    <p>In July 2013 the certificates of the non-renewed cards will be suspended and the cards cannot be used electronically any more.</p>
    <p>http://www.id.ee/?id=35927</p>
    <p>Renewal  reinstalling the JavaCard applet in PPA customer service points  To this day the authorities have not disclosed the details of the flaw</p>
  </div>
  <div class="page">
    <p>ID card certificate repository</p>
    <p>https://www.postimees.ee/1515655/id-kaardi-omanike-isikukoodid-on-jatkuvalt-netis-vabalt-saadaval</p>
  </div>
  <div class="page">
    <p>Certificate pairs with duplicate RSA public keys</p>
    <p>No Time of cert issuance Type Cardholder Issuance Expiry date Revoked Warranty</p>
    <p>Phillip PPA renewal 2016-11-14 2015-05-04 2015-01-06 2013-02-06 15:35:56 sign</p>
    <p>Sandra PPA renewal 2016-01-02 expired not issued 2013-02-07 12:18:37 sign</p>
    <p>Nadiia PPA renewal 2016-11-24 2016-11-08 2014-12-22 2013-02-19 09:10:08 sign</p>
    <p>Moonika PPA renewal 2016-08-22 2014-12-30 2014-12-22 2013-02-25 09:33:29 sign</p>
    <p>Leili initial 2018-03-26 2015-05-14 2014-12-22 2013-03-30 13:40:40 sign</p>
    <p>Jaan initial 2018-03-26 2014-12-30 2014-12-22 2013-03-30 13:42:05 sign</p>
    <p>Liis PPA renewal 2016-05-06 expired 2014-12-22 2013-04-15 09:16:28 sign</p>
    <p>Siim initial 2019-10-07 2017-10-03 not issued 2014-10-08 12:04:31 sign</p>
  </div>
  <div class="page">
    <p>Duplicate keys  Toivo</p>
    <p>Serial Number: 31:a4:3f:20:73:03:4b:cc:50:99:12:32:13:e4:b0:e4 Signature Algorithm: sha1WithRSAEncryption</p>
    <p>Issuer: C=EE, O=AS Sertifitseerimiskeskus, CN=ESTEID-SK 2011/emailAddress=pki@sk.ee Validity</p>
    <p>Not Before: Nov 6 13:35:46 2012 GMT Not After : Jul 3 21:00:00 2016 GMT</p>
    <p>Subject: C=EE, O=ESTEID, OU=authentication, CN=...,TOIVO,... Subject Public Key Info:</p>
    <p>Public Key Algorithm: rsaEncryption Public-Key: (2048 bit) Modulus:</p>
    <p>Exponent: 65537 (0x10001)</p>
  </div>
  <div class="page">
    <p>Duplicate keys  Ulle</p>
    <p>Serial Number: 31:19:01:da:3e:91:9c:c9:50:99:12:0d:0d:6f:d0:f6 Signature Algorithm: sha1WithRSAEncryption</p>
    <p>Issuer: C=EE, O=AS Sertifitseerimiskeskus, CN=ESTEID-SK 2011/emailAddress=pki@sk.ee Validity</p>
    <p>Not Before: Nov 6 13:35:09 2012 GMT Not After : Jul 7 20:59:59 2016 GMT</p>
    <p>Subject: C=EE, O=ESTEID, OU=digital signature, CN=...,ULLE,... Subject Public Key Info:</p>
    <p>Public Key Algorithm: rsaEncryption Public-Key: (2048 bit) Modulus:</p>
    <p>Exponent: 65537 (0x10001)</p>
  </div>
  <div class="page">
    <p>Duplicate keys  signature forgery</p>
  </div>
  <div class="page">
    <p>Duplicate keys  signature forgery</p>
  </div>
  <div class="page">
    <p>Incident response</p>
  </div>
  <div class="page">
    <p>Incident response</p>
  </div>
  <div class="page">
    <p>The Million-Key Question  Investigating the Origins of RSA Public Keys https://crocs.fi.muni.cz/public/papers/usenix2016</p>
    <p>RSA public key modulus N carries a fingerprint that can be used to distinguish between key generation algorithms.</p>
    <p>Range for p and q selection: N = p  q (2048 bits) Observable from the probability distribution of most-significant byte of N</p>
  </div>
  <div class="page">
    <p>Key generation and export</p>
  </div>
  <div class="page">
    <p>PPA renewal (Jul-2012  Jul-2017)</p>
    <p>Figure: Keys from the certificates renewed in PPA</p>
    <p>Figure: Keys generated by the platform</p>
    <p>Keys generated by setting the two most significant bits of p and q to 112  Key import feature had to be programmed into the JavaCard applet  We hope that the intent was to speed up the ID card renewal process  From more than 74 000 ID cards renewed in PPA, only 12 500 were still valid</p>
  </div>
  <div class="page">
    <p>Incident response</p>
    <p>In May 2018, PPA announced the replacement of the affected ID cards</p>
    <p>In the case of the cards in question, keys were generated externally, which means that they could have been copied and could be applied without actually using the</p>
    <p>corresponding ID cards. The PPA has filed a claim against the manufacturer of the ID card for violation of security requirements.</p>
    <p>https://news.err.ee/832236/police-12-500-id-card-certificates-to-be-deleted-due-to-security-issue</p>
    <p>Gemalto has fulfilled the ID-card agreement and the obligations agreed upon in the proper manner. The statements made are a surprise to Gemalto.</p>
    <p>https://tehnika.postimees.ee/4490671/gemalto-eesti-riigi-tehtud-avaldused-on-ullatus</p>
    <p>In September 2018, the state brought Gemalto to court demanding a contractual penalty of 152 million EUR</p>
    <p>Have any lessons been learned?</p>
  </div>
  <div class="page">
    <p>Corrupted RSA public keys</p>
    <p>No Date of cert issuance Cardholder (cert type) N Work N-res Factors (min / max) Date of revocation Corruption of N</p>
  </div>
  <div class="page">
    <p>Corrupted key  Svetlana B.</p>
  </div>
  <div class="page">
    <p>Corrupted key  Svetlana B.</p>
  </div>
  <div class="page">
    <p>Corrupted key  Svetlana B.</p>
  </div>
  <div class="page">
    <p>Corrupted key  Svetlana B.</p>
  </div>
  <div class="page">
    <p>Thank you!</p>
    <p>Questions, comments?</p>
    <p>arnis.parsovs@ut.ee</p>
  </div>
</Presentation>
