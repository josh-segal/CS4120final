<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Ken Yocum, Sean Rowan, Jonathan Lunt  Intuit, Inc.</p>
    <p>&amp; Theodore Wong  23andMe</p>
    <p>May 20, 2019</p>
    <p>Disdat: Bundle Data Management for ML Pipelines</p>
  </div>
  <div class="page">
    <p>ML Pipelines in Practice</p>
    <p>Need access to data artifacts to:  Explore input / output data  Tune by updating features / retrain on</p>
    <p>specific data  Debug / reproduce errors  Deploy models and share predictions</p>
    <p>Simplified ML Pipeline</p>
    <p>Model Selection</p>
    <p>Train</p>
    <p>Predict</p>
    <p>CV scores</p>
    <p>models</p>
    <p>predictions</p>
    <p>Featurize features</p>
    <p>Model Selection</p>
    <p>Train</p>
    <p>Predict</p>
    <p>CV scores</p>
    <p>models</p>
    <p>predictions</p>
    <p>Featurize features</p>
    <p>Model Selection</p>
    <p>Train</p>
    <p>Predict</p>
    <p>CV scores</p>
    <p>models</p>
    <p>predictions</p>
    <p>Featurize features</p>
    <p>Model Selection</p>
    <p>Train</p>
    <p>Predict</p>
    <p>CV scores</p>
    <p>models</p>
    <p>predictions</p>
    <p>Featurize features</p>
    <p>Scenario:  Team needs to create a new ML model  Group of data scientists and engineers  Many laptops, small and full dataset  Agree on general pipeline</p>
  </div>
  <div class="page">
    <p>Instead we get bespoke projects with:</p>
    <p>Ad-hoc naming convolved with versioning</p>
    <p>fin_model becomes fin_model_v1_20190520</p>
    <p>Data scatter from sharing via email, messaging, AirDrop, Box</p>
    <p>Across applications, local FS, DFS, etc.</p>
    <p>Reproduction instead of re-use</p>
    <p>Data management challenges Naming</p>
    <p>Logically identify an output, i.e. fin_model</p>
    <p>Versioning</p>
    <p>Allow humans/pipelines to find latest output</p>
    <p>Sharing</p>
    <p>Mechanism for moving / re-using data</p>
  </div>
  <div class="page">
    <p>Git  Popular, familiar, powerful + share via repos and version history.</p>
    <p>But not all VCS constructs may apply to data versioning</p>
    <p>Humans often checkout individual files, but pipelines?</p>
    <p>Diff / Merge binary or text-based data, merge conflicts on model updates?</p>
    <p>No metadata, e.g., lineage.</p>
    <p>Goal: Enable naming, versioning, sharing with:  Minimal prescription: many file types and processing systems</p>
    <p>Separate naming and versioning</p>
    <p>Simple semantics: Ex. notebook code for get_latest_data(fin_model)</p>
    <p>The VCS option</p>
  </div>
  <div class="page">
    <p>Two practical data abstractions  Data bundle  Named collection of files and literals  Data context  Named repository of bundles</p>
    <p>Disdat API  API for creating and sharing bundles in contexts  Use from notebook or command line</p>
    <p>Disdat pipelines  Instrumented existing system -- Spotifys Luigi  Consumes, produces, and publishes Bundles</p>
    <p>Disdat</p>
    <p>Model Selection</p>
    <p>Train</p>
    <p>Predict</p>
    <p>CV scores</p>
    <p>models</p>
    <p>predictions</p>
    <p>Featurize features</p>
    <p>Model Selection</p>
    <p>Train</p>
    <p>Predict</p>
    <p>CV scores</p>
    <p>models</p>
    <p>predictions</p>
    <p>Featurize features</p>
    <p>Model Selection</p>
    <p>Train</p>
    <p>Predict</p>
    <p>CV scores</p>
    <p>models</p>
    <p>predictions</p>
    <p>Featurize features</p>
    <p>Model Selection</p>
    <p>Train</p>
    <p>Predict</p>
    <p>CV scores</p>
    <p>models</p>
    <p>predictions</p>
    <p>Featurize features</p>
    <p>Disdat Tasks Bundles</p>
  </div>
  <div class="page">
    <p>Bundles: describing data sets</p>
    <p>Need a unit of data organization What is versioned? What is shared?</p>
    <p>Model Training</p>
    <p>Task</p>
    <p>Files Parameters</p>
    <p>Inputs</p>
    <p>N=50 date=2017-3-1 Explored=3301</p>
    <p>Files Parameters</p>
    <p>Success=True Explored=33k</p>
    <p>Outputs</p>
    <p>Input Bundle CV Scores</p>
    <p>Output Bundle Fin_Model</p>
    <p>Bundle: an immutable collection of  Named, typed arrays:</p>
    <p>Links to local files or on cloud systems (S3)  Scalars (int, float, bool, etc.)  Pointers to other bundles</p>
    <p>Lineage and user-defined tags</p>
    <p>Sklearn pipeline, Spark job, etc.</p>
  </div>
  <div class="page">
    <p>Bundle versioning</p>
    <p>Human name  Processing name  UUID</p>
    <p>fin_model</p>
    <p>fin_model_A01</p>
    <p>Training Task</p>
    <p>Parameter 2019-4-1</p>
    <p>fin_model</p>
    <p>fin_model_A01</p>
    <p>Training Task</p>
    <p>Parameter 2019-4-1</p>
    <p>fin_model</p>
    <p>fin_model_F88</p>
    <p>Training Task</p>
    <p>Parameter 2019-4-2</p>
    <p>output bundle</p>
    <p>Human Query: disdat.api.get(human_name=fin_model) - 0x785f</p>
    <p>Pipeline Query: disdat.api.get(proc_name=fin_model_A01) - 0xCA29</p>
    <p>Determine how to name and find the latest bundle</p>
  </div>
  <div class="page">
    <p>Data context: A collection of bundles  Exists as a directory on local or cloud FS  push or pull to/from contexts</p>
    <p>Context on local FS</p>
    <p>fin_model, V1</p>
    <p>Remote Context on AWS s3://disdat-us-west-2/</p>
    <p>fin_model, V0</p>
    <p>Sharing via data contexts</p>
    <p>Training Task</p>
    <p>Name: ds_financial_project Remote URI: s3://disdat-us-west-2/</p>
    <p>Name: ds_financial_project</p>
    <p>fin_model, V0 fin_model, V1</p>
  </div>
  <div class="page">
    <p>Localizing bundles  Pull meta data, but not linked files.</p>
    <p>On localize pull linked files</p>
    <p>Context on local FS</p>
    <p>fin_model, V1</p>
    <p>Remote Context on AWS s3://disdat/</p>
    <p>Optimizing data transfers</p>
    <p>Training Task</p>
    <p>Name: fin_project Remote URI: s3://disdat/</p>
    <p>Name: fin_project</p>
    <p>fin_model, V1</p>
    <p>Bundle Link: s3://...model.pklBundle Link: s3://...model.pklBundle Link: file:///...model.pkl</p>
  </div>
  <div class="page">
    <p>Scenario: ML Pipeline</p>
    <p>User cluster pipeline</p>
    <p>Bundle: Name + data + lineage</p>
    <p>Bundle: data+lineage</p>
    <p>Bundle: data+lineage</p>
    <p>Bundle: data+lineage</p>
    <p>Bundle: data+lineage</p>
    <p>Bundle: data+lineage</p>
    <p>context</p>
    <p>Featurize</p>
    <p>Model Selection DISDAT</p>
    <p>DISDAT</p>
    <p>But model selection is expensive</p>
    <p>Pipeline Container</p>
  </div>
  <div class="page">
    <p>Pipeline cloud execution</p>
    <p>Pipeline as DAG of Disdat tasks # Create container and push to AWS api.dockerize(./setup.py,push=True)</p>
    <p># Run on AWS Batch api.run(module.class, args, backend=AWSBatch)</p>
    <p>Notebook # Pull most recent bundle api.pull(fin_project, fin_model, localize=True)</p>
    <p># Inspect bundle bundle = api.get(fin_project, fin_model) print(bundle data:, bundle.data)</p>
    <p>AWS ECS</p>
    <p>Pipeline Container</p>
    <p>ETL</p>
    <p>Featurize</p>
    <p>Model Discovery</p>
    <p>Train &amp; Predict</p>
    <p>fin_model</p>
    <p>AWS S3</p>
    <p>Disdat S3 Bucket Disdat Context</p>
    <p>Disdat Bundles fin_model</p>
  </div>
  <div class="page">
    <p>Conclusion</p>
    <p>Related work Many examples: Palintir Foundry, FBLearner, Uber Michelangelo, Pachyderm, Datmo, DVC, MLFlow, PyML  Closed and/or monolithic ecosystems  Open-source projects / APIs / collection-oriented file types  But leave naming and data management to user</p>
    <p>Disdat introduces two practical abstractions to help  Bundles the unit for versioning, lineage  Contexts for managing and sharing bundles Status  https://github.com/kyocum/disdat</p>
    <p>Final thanks to Intuit, Inc, and Human Longevity, Inc. (Jason Knight, Amalio Telenti)</p>
  </div>
</Presentation>
