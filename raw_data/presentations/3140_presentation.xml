<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>ExecScent: Mining for New C&amp;C Domains in Live Networks with Adap?ve Control</p>
    <p>Protocol Templates</p>
    <p>Terry Nelms1,2, Roberto Perdisci3,2, Mustaque Ahamad2,4 1Damballa Inc.</p>
  </div>
  <div class="page">
    <p>Modern Malware Networking</p>
    <p>Web Proxy Enterprise Network</p>
    <p>C&amp;C</p>
    <p>badguy.com 192.168.1.2</p>
  </div>
  <div class="page">
    <p>Malware Network Detection Methods</p>
    <p>Anomaly-Based</p>
    <p>Domain-Based</p>
    <p>URL-Regex</p>
  </div>
  <div class="page">
    <p>ExecScent Goals &amp; Observations</p>
    <p>Goals:  Network detec?on domains &amp; hosts.  Malware family aWribu?on.</p>
    <p>Observa?ons:  C&amp;C protocol changes infrequently.  HTTP C&amp;C applica?on layer protocol.</p>
  </div>
  <div class="page">
    <p>Adaptive Control Protocol Templates</p>
    <p>Structure of the protocol.  Self-tuning.</p>
    <p>En?re HTTP request.</p>
  </div>
  <div class="page">
    <p>ExecScent Overview</p>
    <p>ExecScent (learning)</p>
    <p>Malware Traffic Traces Adaptive (self-tuning) Control Protocol Templates</p>
    <p>...</p>
    <p>Background Network Traffic</p>
    <p>Enterprise Network</p>
  </div>
  <div class="page">
    <p>ExecScent Overview</p>
    <p>ExecScent (learning)</p>
    <p>Malware Traffic Traces Adaptive (self-tuning) Control Protocol Templates</p>
    <p>...</p>
    <p>Background Network Traffic</p>
    <p>HTTP(S) Traffic</p>
    <p>Web Proxy Enterprise Network</p>
    <p>template matching</p>
    <p>C&amp;C</p>
  </div>
  <div class="page">
    <p>ExecScent Overview</p>
    <p>ExecScent (learning)</p>
    <p>Malware Traffic Traces Adaptive (self-tuning) Control Protocol Templates</p>
    <p>...</p>
    <p>Background Network Traffic</p>
    <p>HTTP(S) Traffic</p>
    <p>Web Proxy Enterprise Network</p>
    <p>template matching</p>
    <p>C&amp;C</p>
    <p>Specificity</p>
    <p>Similarity</p>
  </div>
  <div class="page">
    <p>ExecScent Overview</p>
    <p>ExecScent (learning)</p>
    <p>Malware Traffic Traces Adaptive (self-tuning) Control Protocol Templates</p>
    <p>...</p>
    <p>Background Network Traffic</p>
    <p>HTTP(S) Traffic</p>
    <p>Web Proxy Enterprise Network</p>
    <p>template matching</p>
    <p>C&amp;C</p>
    <p>C&amp;C Domains</p>
    <p>Infected Hosts</p>
  </div>
  <div class="page">
    <p>Template Learning Process</p>
    <p>Request Clustering</p>
    <p>Malware C&amp;C</p>
    <p>Traces</p>
    <p>Request Generalization</p>
    <p>Generate Control Protocol</p>
    <p>Templates</p>
    <p>Labeled Control Protocol</p>
    <p>Templates</p>
    <p>Labeled C&amp;C</p>
    <p>Domains</p>
    <p>Background Network Traffic</p>
  </div>
  <div class="page">
    <p>Malware C&amp;C Traces</p>
    <p>Request Clustering</p>
    <p>Malware C&amp;C</p>
    <p>Traces</p>
    <p>Request Generalization</p>
    <p>Generate Control Protocol</p>
    <p>Templates</p>
    <p>Labeled Control Protocol</p>
    <p>Templates</p>
    <p>Labeled C&amp;C</p>
    <p>Domains</p>
    <p>Background Network Traffic</p>
  </div>
  <div class="page">
    <p>Request Generalization</p>
    <p>Request Clustering</p>
    <p>Malware C&amp;C</p>
    <p>Traces</p>
    <p>Request Generalization</p>
    <p>Generate Control Protocol</p>
    <p>Templates</p>
    <p>Labeled Control Protocol</p>
    <p>Templates</p>
    <p>Labeled C&amp;C</p>
    <p>Domains</p>
    <p>Background Network Traffic</p>
  </div>
  <div class="page">
    <p>Request Generalization</p>
    <p>Request 1: GET /Ym90bmV0DQo=/cnc.php?v=121&amp;cc=IT Host: www.bot.net User-Agent: 680e4a9a7eb391bc48118baba2dc8e16 ...</p>
    <p>Request 2: GET /bWFsd2FyZQ0KDQo=/cnc.php?v=425&amp;cc=US Host: www.malwa.re User-Agent: dae4a66124940351a65639019b50bf5a ...</p>
    <p>Request 1: GET /&lt;Base64;12&gt;/cnc.php?v=&lt;Int;3&gt;&amp;cc=&lt;Str;2&gt; Host: www.bot.net User-Agent: &lt;Hex;32&gt; ...</p>
    <p>Request 2: GET /&lt;Base64;16&gt;/cnc.php?v=&lt;Int;3&gt;&amp;cc=&lt;Str;2&gt; Host: www.malwa.re User-Agent: &lt;Hex;32&gt; ...</p>
    <p>(a)</p>
    <p>(b)</p>
  </div>
  <div class="page">
    <p>Request Clustering</p>
    <p>Request Clustering</p>
    <p>Malware C&amp;C</p>
    <p>Traces</p>
    <p>Request Generalization</p>
    <p>Generate Control Protocol</p>
    <p>Templates</p>
    <p>Labeled Control Protocol</p>
    <p>Templates</p>
    <p>Labeled C&amp;C</p>
    <p>Domains</p>
    <p>Background Network Traffic</p>
  </div>
  <div class="page">
    <p>Labeled C&amp;C Domains</p>
    <p>Request Clustering</p>
    <p>Malware C&amp;C</p>
    <p>Traces</p>
    <p>Request Generalization</p>
    <p>Generate Control Protocol</p>
    <p>Templates</p>
    <p>Labeled Control Protocol</p>
    <p>Templates</p>
    <p>Labeled C&amp;C</p>
    <p>Domains</p>
    <p>Background Network Traffic</p>
  </div>
  <div class="page">
    <p>Labeled C&amp;C Domains</p>
    <p>Request Clustering</p>
    <p>Malware C&amp;C</p>
    <p>Traces</p>
    <p>Request Generalization</p>
    <p>Generate Control Protocol</p>
    <p>Templates</p>
    <p>Labeled Control Protocol</p>
    <p>Templates</p>
    <p>Labeled C&amp;C</p>
    <p>Domains</p>
    <p>Background Network Traffic</p>
  </div>
  <div class="page">
    <p>Generating CPTs</p>
    <p>Request Clustering</p>
    <p>Malware C&amp;C</p>
    <p>Traces</p>
    <p>Request Generalization</p>
    <p>Generate Control Protocol</p>
    <p>Templates</p>
    <p>Labeled Control Protocol</p>
    <p>Templates</p>
    <p>Labeled C&amp;C</p>
    <p>Domains</p>
    <p>Background Network Traffic</p>
  </div>
  <div class="page">
    <p>Generating CPTs</p>
    <p>Malware-A</p>
    <p>Malware-B</p>
    <p>Malware-E</p>
    <p>Unlabeled</p>
    <p>Unlabeled</p>
    <p>Malware-C</p>
    <p>Unlabeled</p>
    <p>Unlabeled Unlabeled</p>
    <p>Unlabeled</p>
    <p>Malware-D</p>
    <p>Malware-F</p>
  </div>
  <div class="page">
    <p>Labeled CPTs</p>
    <p>Request Clustering</p>
    <p>Malware C&amp;C</p>
    <p>Traces</p>
    <p>Request Generalization</p>
    <p>Generate Control Protocol</p>
    <p>Templates</p>
    <p>Labeled Control Protocol</p>
    <p>Templates</p>
    <p>Labeled C&amp;C</p>
    <p>Domains</p>
    <p>Background Network Traffic</p>
  </div>
  <div class="page">
    <p>Labeled CPT</p>
    <p>URL regex: GET /.*\?(cc|v)= Background traffic profile: specificity scores used to adapt the CPT to the deployment environment</p>
    <p>Malware family: {Trojan-A, BotFamily-1}</p>
  </div>
  <div class="page">
    <p>Template Matching</p>
    <p>Similarity  Measures likeness  Components  Weighted average  Match threshold</p>
    <p>Specificity  Measures uniqueness  Dynamic weights  Self-tuning</p>
    <p>Input: req, CPT Similarity: s(reqi, CPTi), for each component i Specificity: (reqi, CPTi), for each component i Match-Score: f(sim, spec) If Match-Score &gt; : return C&amp;C Request</p>
  </div>
  <div class="page">
    <p>Similarity &amp; Specificity Examples</p>
    <p>Example A (High Similarity, Low Specificity):  /index.html - Request  /index.html - CPT</p>
    <p>Example B (Low Similarity, High Specificity):  /downloads/9908-7623-0098/images - Request  /VGVycnkgTmVsbXMK (&lt;Base64, 16&gt;) - CPT</p>
    <p>Example C (High Similarity, High Specificity)  /Ui4gUGVyZGlzY2kK (&lt;Base64, 16&gt;)- Request  /VGVycnkgTmVsbXMK (&lt;Base64, 16&gt;)- CPT</p>
  </div>
  <div class="page">
    <p>Evaluation Deployment Networks</p>
    <p>UNetA UNetB FNet Distinct Src IPs 7, 893 27, 340 7, 091 HTTP Requests 34, 871, 003 66, 298, 395 58, 019, 718 Distinct Domains 149, 481 238, 014 113, 778</p>
    <p>Evalua?on ran for two weeks.  CPTs updated daily beginning two weeks prior to evalua?on.</p>
  </div>
  <div class="page">
    <p>Ground Truth</p>
    <p>Commercial C&amp;C blacklist.</p>
    <p>Pruned Alexa top 1 million.</p>
    <p>Professional threat analysts.</p>
  </div>
  <div class="page">
    <p>Finding C&amp;C Domains</p>
    <p>C&amp; C D om</p>
    <p>ai ns</p>
    <p>Match Threshold</p>
    <p>UNetA</p>
    <p>UNetB</p>
    <p>Fnet</p>
    <p>FP  .01%</p>
    <p>FP = 0.0%</p>
    <p>FP  .02%</p>
    <p>FP  .015%</p>
  </div>
  <div class="page">
    <p>New vs. Blacklist Domains</p>
    <p>UNetA UNetB Fnet</p>
    <p>Blacklist C&amp;C</p>
    <p>New C&amp;C</p>
  </div>
  <div class="page">
    <p>New vs. Blacklist Infected Hosts</p>
    <p>UNetA UNetB Fnet</p>
    <p>Blacklist Infec?ons</p>
    <p>New Infec?ons</p>
  </div>
  <div class="page">
    <p>ISP Deployment</p>
    <p>Deployed the 65 newly discovered C&amp;C domains on 6 ISP networks for one week.</p>
    <p>Counted the number of dis?nct source IP addresses contac?ng the domains daily.</p>
    <p>Iden?fied 25,584 new poten?al malware infec?ons.</p>
  </div>
  <div class="page">
    <p>Model Comparison - True Positives</p>
  </div>
  <div class="page">
    <p>Model Comparison  False Positives</p>
  </div>
  <div class="page">
    <p>Limitations</p>
    <p>Dependence on malware traces and labeled domains.</p>
    <p>Implement a new protocol when the C&amp;C domain or IP address changes.</p>
    <p>Blend into background traffic.</p>
    <p>Inject noise into the protocol.</p>
  </div>
  <div class="page">
    <p>Conclusion</p>
    <p>Majority of C&amp;C domains and infec?ons discovered were not on a blacklist.</p>
    <p>C&amp;C domains and IP addresses change more frequently than the protocol structure.</p>
    <p>Adap?ve templates yield a beWer trade-off between true and false posi?ves.</p>
    <p>ExecScent is currently deployed.</p>
  </div>
  <div class="page">
    <p>Questions?</p>
  </div>
</Presentation>
