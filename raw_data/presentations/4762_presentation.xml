<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Scalable Flow-Based Networking with DIFANE</p>
    <p>Minlan Yu Princeton University</p>
    <p>Joint work with Mike Freedman, Jennifer Rexford and Jia Wang</p>
    <p>Do It Fast ANd Easy</p>
  </div>
  <div class="page">
    <p>Whats DIFANE?  Traditional enterprise</p>
    <p>Hard to manage  Limited policies  Distributed</p>
    <p>Flow-based networking  Easy to manage  Support fine-grained policy  Scalability remains a challenge</p>
    <p>DIFANE: A scalable way to apply fine-grained</p>
    <p>policies in enterprises</p>
    <p>DIFANE: A scalable way to apply fine-grained</p>
    <p>policies in enterprises</p>
  </div>
  <div class="page">
    <p>HTTP</p>
    <p>Access control  Drop packets from malicious hosts</p>
    <p>Customized routing  Direct Skype calls on a low-latency path</p>
    <p>Measurement  Collect detailed HTTP</p>
    <p>traffic statistics</p>
    <p>Flexible Policies in Enterprises</p>
    <p>HTTP</p>
  </div>
  <div class="page">
    <p>Flow-based Switches</p>
    <p>Install rules in flow-based switches  Store rules in high speed memory (TCAM)</p>
    <p>Perform simple actions based on rules  Rules: Match on bits in the packet header  Actions: Drop, forward, count</p>
    <p>dropdrop</p>
    <p>forward via link 1</p>
    <p>forward via link 1</p>
    <p>Flow space src.</p>
    <p>dst.</p>
  </div>
  <div class="page">
    <p>Challenges of Policy-Based Management</p>
    <p>Policy-based network management  Specify high-level policies in a management system  Enforce low-level rules in the switches</p>
    <p>Challenges  Large number of hosts, switches and policies  Limited TCAM space in switches  Support host mobility  No hardware changes to commodity switches</p>
  </div>
  <div class="page">
    <p>Pre-install Rules in Switches</p>
    <p>Packets hit the rules Forward</p>
    <p>Problems:  No host mobility support  Switches do not have enough memory</p>
    <p>Pre-install rules</p>
    <p>Controller</p>
  </div>
  <div class="page">
    <p>Install Rules on Demand (Ethane, NOX)</p>
    <p>First packet misses the rules</p>
    <p>Buffer and send packet header to the controller</p>
    <p>Install rules</p>
    <p>Forward</p>
    <p>Controller</p>
    <p>Problems:  Delay of going through the controller  Switch complexity  Misbehaving hosts</p>
  </div>
  <div class="page">
    <p>DIFANE: Combining Proactive &amp; Reactive</p>
    <p>Features Proactive</p>
    <p>Reactive( Ethane)</p>
    <p>DIFANE</p>
    <p>Host mobility</p>
    <p>Memory usage</p>
    <p>Keep packet in data plane</p>
    <p>Install</p>
    <p>rules</p>
  </div>
  <div class="page">
    <p>DIFANE Architecture (two stages)</p>
    <p>DIstributed Flow Architecture for Networked Enterprises</p>
  </div>
  <div class="page">
    <p>Stage 1</p>
    <p>The controller proactively generates the rules and distributes them to</p>
    <p>authority switches.</p>
  </div>
  <div class="page">
    <p>Partition and Distribute the Flow Rules</p>
    <p>Ingress Switch</p>
    <p>Egress Switch</p>
    <p>Distribute partition information Authority</p>
    <p>Switch A</p>
    <p>AuthoritySwitch B</p>
    <p>Authority Switch C</p>
    <p>rejectreject</p>
    <p>acceptaccept Flow space</p>
    <p>Controller</p>
    <p>Authority Switch A</p>
    <p>Authority Switch B</p>
    <p>Authority Switch C</p>
  </div>
  <div class="page">
    <p>Stage 2</p>
    <p>The authority switches keep packets always in the data plane and</p>
    <p>reactively cache rules.</p>
  </div>
  <div class="page">
    <p>Following packets</p>
    <p>Packet Redirection and Rule Caching</p>
    <p>Ingress Switch</p>
    <p>Authority Switch</p>
    <p>Egress Switch</p>
    <p>First packet Red</p>
    <p>irec t</p>
    <p>Forward</p>
    <p>Fee dba</p>
    <p>ck:</p>
    <p>Cac he</p>
    <p>rule s</p>
    <p>Hit cached rules and forward</p>
    <p>A slightly longer path in the data plane is faster than going through the control plane A slightly longer path in the data plane is faster than going through the control plane</p>
  </div>
  <div class="page">
    <p>Locate Authority Switches  Partition information in ingress switches</p>
    <p>Using a small set of coarse-grained wildcard rules   to locate the authority switch for each packet</p>
    <p>Distributed directory service but not DHT  Hashing does not work for wildcards  Keys can have wildcards in arbitrary bit positions</p>
    <p>Authority Switch A</p>
    <p>AuthoritySwitch B</p>
    <p>Authority Switch C</p>
    <p>X:0-1 Y:0-3  A X:2-5 Y: 0-1B X:2-5 Y:2-3  C</p>
    <p>X:0-1 Y:0-3  A X:2-5 Y: 0-1B X:2-5 Y:2-3  C</p>
  </div>
  <div class="page">
    <p>Following packets</p>
    <p>Packet Redirection and Rule Caching</p>
    <p>Ingress Switch</p>
    <p>Authority Switch</p>
    <p>Egress Switch</p>
    <p>First packet Red</p>
    <p>irec t</p>
    <p>Forward</p>
    <p>Fee dba</p>
    <p>ck:</p>
    <p>Cac he</p>
    <p>rule s</p>
    <p>Hit cached rules and forward</p>
    <p>Cache Rules</p>
    <p>Partition Rules</p>
    <p>Auth. Rules</p>
  </div>
  <div class="page">
    <p>Three Sets of Rules in TCAM Type Priority Field 1 Field 2 Action Timeout</p>
    <p>Cache Rules</p>
    <p>Authority Rules</p>
    <p>Infinity</p>
    <p>Partition Rules</p>
    <p>In ingress switches reactively installed by authority switches In ingress switches reactively installed by authority switches</p>
    <p>In authority switches proactively installed by controller In authority switches proactively installed by controller</p>
    <p>In every switch proactively installed by controller In every switch proactively installed by controller</p>
  </div>
  <div class="page">
    <p>Cache RulesCache Rules</p>
    <p>DIFANE Switch Prototype Built with OpenFlow switch</p>
    <p>Data Plane</p>
    <p>Control Plane</p>
    <p>Cache Manager</p>
    <p>Cache Manager</p>
    <p>Send Cache Updates</p>
    <p>Recv Cache Updates</p>
    <p>Only in Auth.</p>
    <p>Switches</p>
    <p>Only in Auth.</p>
    <p>Switches</p>
    <p>Authority RulesAuthority Rules</p>
    <p>Partition RulesPartition Rules</p>
    <p>Just software modification for authority switchesJust software modification for authority switches</p>
    <p>Notification</p>
    <p>Cac he</p>
    <p>rule s</p>
  </div>
  <div class="page">
    <p>Caching Wildcard Rules  Overlapping wildcard rules</p>
    <p>Cannot simply cache matching rules</p>
  </div>
  <div class="page">
    <p>Caching Wildcard Rules  Multiple authority switches</p>
    <p>Contain independent sets of rules  Avoid cache conflicts in ingress switch</p>
    <p>Authority switch 1</p>
    <p>Authority switch 2</p>
  </div>
  <div class="page">
    <p>Partition Wildcard Rules  Partition rules</p>
    <p>Minimize the TCAM entries in switches  Decision-tree based rule partition algorithm</p>
    <p>Cut A</p>
    <p>Cut BCut B is better than Cut A</p>
  </div>
  <div class="page">
    <p>Handling Network Dynamics</p>
    <p>Network dynamics Cache rules</p>
    <p>Authority Rules</p>
    <p>Partition Rules</p>
    <p>Policy changes at controller Timeout Change</p>
    <p>Mostly no change</p>
    <p>Topology changes at switches</p>
    <p>No change No change Change</p>
    <p>Host mobility Timeout No change No change</p>
  </div>
  <div class="page">
    <p>Prototype Evaluation</p>
    <p>Evaluation setup  Kernel-level Click-based OpenFlow switch  Traffic generators, switches, controller run on</p>
    <p>separate 3.0GHz 64-bit Intel Xeon machines</p>
    <p>Compare delay and throughput  NOX: Buffer packets and reactively install rules  DIFANE: Forward packets to authority switches</p>
  </div>
  <div class="page">
    <p>Delay Evaluation</p>
    <p>Average delay (RTT) of the first packet  NOX: 10 ms  DIFANE: 0.4 ms</p>
    <p>Reasons for performance improvement  Always keep packets in the data plane  Packets are delivered without waiting for rule</p>
    <p>caching  Easily implemented in hardware to further</p>
    <p>improve performance</p>
  </div>
  <div class="page">
    <p>Peak Throughput</p>
    <p>One authority switch; Single-packet flow</p>
    <p>Sending rate (flows/sec)</p>
    <p>Th ro</p>
    <p>ug hp</p>
    <p>ut (fl</p>
    <p>ow s/</p>
    <p>se c)</p>
    <p>Controller Bottleneck (50K) Controller Bottleneck (50K)</p>
    <p>DIFANE (800K) DIFANE (800K)</p>
    <p>Ingress switch Bottleneck (20K)</p>
    <p>Ingress switch Bottleneck (20K)</p>
    <p>DIFANE further increases the throughput linearly with the number of authority switches.</p>
    <p>DIFANE further increases the throughput linearly with the number of authority switches.</p>
  </div>
  <div class="page">
    <p>Scaling with Many Rules  How many authority switches do we need?</p>
    <p>Depends on total number of rules  and the TCAM space in these authority switches</p>
    <p>Campus IPTV # Rules 30K 5M</p>
    <p># Switches 1.7K 3K</p>
    <p>Assumed Authority Switch TCAM size</p>
    <p>Required # Authority Switches</p>
  </div>
  <div class="page">
    <p>Stepping back</p>
  </div>
  <div class="page">
    <p>Distributed or Centralized?</p>
    <p>logicallycentralized</p>
    <p>in the management</p>
    <p>system</p>
    <p>Distributed amongst the</p>
    <p>network elements</p>
    <p>All functions in switches</p>
    <p>All functions in switches</p>
    <p>OpenFlow/NOXOpenFlow/NOX</p>
    <p>DIFANE Controller is still in charge Switches host a distributed</p>
    <p>directory of the rules</p>
    <p>DIFANE Controller is still in charge Switches host a distributed</p>
    <p>directory of the rules</p>
  </div>
  <div class="page">
    <p>Thanks!</p>
  </div>
</Presentation>
