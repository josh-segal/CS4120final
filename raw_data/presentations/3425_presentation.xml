<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Predicting Replicated Database Scalability</p>
    <p>Sameh Elnikety, Microsoft Research Steven Dropsho, Google Inc. Emmanuel Cecchet, Univ. of Mass. Willy Zwaenepoel, EPFL</p>
  </div>
  <div class="page">
    <p>Environment  E-commerce website</p>
    <p>DB throughput is 500 tps</p>
    <p>Is 5000 tps achievable?  Yes: use 10 replicas</p>
    <p>Yes: use 16 replicas</p>
    <p>No: faster machines needed</p>
    <p>How tx workload scales on replicated db?</p>
    <p>Motivation</p>
    <p>Single DBMS</p>
  </div>
  <div class="page">
    <p>Multi-Master Single-Master</p>
    <p>Replica 2</p>
    <p>Replica 1</p>
    <p>Replica 3</p>
    <p>Slave 1</p>
    <p>Master</p>
    <p>Slave 2</p>
  </div>
  <div class="page">
    <p>Background: Multi-Master</p>
    <p>Replica 2</p>
    <p>Replica 1</p>
    <p>Replica 3</p>
    <p>Standalone DBMS</p>
    <p>Load Balancer</p>
  </div>
  <div class="page">
    <p>Read Tx</p>
    <p>Replica 2</p>
    <p>Replica 1</p>
    <p>Replica 3</p>
    <p>Load Balancer</p>
    <p>T</p>
    <p>Read tx does not change DB state</p>
    <p>Read tx does not change DB state</p>
  </div>
  <div class="page">
    <p>Update Tx</p>
    <p>Replica 2</p>
    <p>Replica 1</p>
    <p>Replica 3</p>
    <p>Cert Load</p>
    <p>Balancer</p>
    <p>TT wsws wswswswswsws</p>
    <p>Update tx changes DB state</p>
    <p>Update tx changes DB state</p>
  </div>
  <div class="page">
    <p>Additional Replica</p>
    <p>Replica 2</p>
    <p>Replica 1</p>
    <p>Replica 3</p>
    <p>Load Balancer T wsws</p>
    <p>Replica 3</p>
    <p>Replica 4</p>
    <p>Cert</p>
    <p>wswswsws</p>
  </div>
  <div class="page">
    <p>Standalone DBMS  Service demands</p>
    <p>Multi-master system  Service demands</p>
    <p>Queuing model</p>
    <p>Experimental validation</p>
    <p>Coming Up</p>
  </div>
  <div class="page">
    <p>Required  readonly tx: R</p>
    <p>update tx: W</p>
    <p>Transaction load  readonly tx: R</p>
    <p>update tx: W / (1 - A1)</p>
    <p>Standalone DBMS</p>
    <p>Single DBMS</p>
    <p>Abort probability is A1 Submit W / (1 - A1) update tx</p>
    <p>Commited tx: W Aborted tx: W  A1 / (1- A1)</p>
    <p>Abort probability is A1 Submit W / (1 - A1) update tx</p>
    <p>Commited tx: W Aborted tx: W  A1 / (1- A1) 9</p>
  </div>
  <div class="page">
    <p>Standalone DBMS</p>
    <p>Single DBMS</p>
    <p>(1) (1 )</p>
    <p>W Load R rc wc</p>
    <p>A</p>
    <p>10</p>
    <p>Required  readonly tx: R  update tx: W</p>
    <p>Transaction load  readonly tx: R</p>
    <p>update tx: W / (1 - A1)</p>
  </div>
  <div class="page">
    <p>Service Demand</p>
    <p>(1) (1 )</p>
    <p>W Load R rc wc</p>
    <p>A</p>
    <p>(1) (1 )</p>
    <p>Pw D Pr rc wc</p>
    <p>A</p>
  </div>
  <div class="page">
    <p>Required (whole system of N replicas)  Readonly tx: N  R</p>
    <p>Update tx: N  W</p>
    <p>Transaction load per replica  Readonly tx: R</p>
    <p>Update tx: W / (1 - AN)</p>
    <p>Writeset: W  (N - 1)</p>
    <p>Multi-Master with N Replicas</p>
    <p>( 1) (1 )</p>
    <p>( ) N</p>
    <p>MM</p>
    <p>W R rc wc W N ws</p>
    <p>A Load N</p>
    <p>12</p>
  </div>
  <div class="page">
    <p>MM Service Demand</p>
    <p>( 1) (1 )</p>
    <p>( ) N</p>
    <p>MM</p>
    <p>W R rc wc W N ws</p>
    <p>A Load N</p>
    <p>( ) (1 )</p>
    <p>MM</p>
    <p>Pw N Pr rc wc Pw ws</p>
    <p>A D N</p>
  </div>
  <div class="page">
    <p>Compare: Standalone vs MM</p>
    <p>( ) (1 )</p>
    <p>MM</p>
    <p>Pw N Pr rc wc Pw ws</p>
    <p>A D N</p>
    <p>Explosive cost!</p>
    <p>(1) (1 )</p>
    <p>Pw D Pr rc wc</p>
    <p>A</p>
    <p>Standalone:</p>
    <p>Multi-Master:</p>
  </div>
  <div class="page">
    <p>Readonly Workload</p>
    <p>( ) (1 )</p>
    <p>MM</p>
    <p>Pw N Pr rc wc Pw ws</p>
    <p>A D N</p>
    <p>Explosive cost!</p>
    <p>(1) (1 )</p>
    <p>Pw D Pr rc wc</p>
    <p>A</p>
    <p>Standalone:</p>
    <p>Multi-Master:</p>
  </div>
  <div class="page">
    <p>Update Workload</p>
    <p>( ) (1 )</p>
    <p>MM</p>
    <p>Pw N Pr rc wc Pw ws</p>
    <p>A D N</p>
    <p>Explosive cost!</p>
    <p>(1) (1 )</p>
    <p>Pw D Pr rc wc</p>
    <p>A</p>
    <p>Standalone:</p>
    <p>Multi-Master:</p>
  </div>
  <div class="page">
    <p>Closed-Loop Queuing Model</p>
  </div>
  <div class="page">
    <p>Standard algorithm</p>
    <p>Iterates over the number of clients</p>
    <p>Inputs:  Number of clients</p>
    <p>Service demand at service centers</p>
    <p>Delay time at delay centers</p>
    <p>Outputs:  Response time</p>
    <p>Throughput</p>
    <p>Mean Value Analysis (MVA)</p>
  </div>
  <div class="page">
    <p>Using the Model</p>
  </div>
  <div class="page">
    <p>Copy of database</p>
    <p>Log all txs, (Pr : Pw)</p>
    <p>Python script replays txs  Readonly (rc)</p>
    <p>Updates (wc)</p>
    <p>Writesets  Instrument db with triggers</p>
    <p>Play txs to log writesets</p>
    <p>Play writesets (ws)</p>
    <p>Standalone Profiling (Offline)</p>
  </div>
  <div class="page">
    <p>MM Service Demand</p>
    <p>( ) (1 )</p>
    <p>MM</p>
    <p>Pw N Pr rc wc Pw ws</p>
    <p>A D N</p>
  </div>
  <div class="page">
    <p>Abort Probability</p>
    <p>( )</p>
    <p>(1)</p>
    <p>CW N</p>
    <p>L N</p>
    <p>NA A</p>
  </div>
  <div class="page">
    <p>Using the Model</p>
    <p># clients, think time</p>
  </div>
  <div class="page">
    <p>Compare  Measured performance vs model predictions</p>
    <p>Environment  Linux cluster running PostgreSQL</p>
    <p>TPC-W workload  Browsing (5% update txs)</p>
    <p>Shopping (20% update txs)</p>
    <p>Ordering (50% update txs)</p>
    <p>RUBiS workload  Browsing (0% update txs)</p>
    <p>Bidding (20% update txs)</p>
    <p>Experimental Validation</p>
  </div>
  <div class="page">
    <p>Multi-Master TPC-W Performance</p>
    <p>Throughput Response time</p>
  </div>
  <div class="page">
    <p>Browsing, 5% u</p>
    <p>Ordering, 50% u 6.7 X15%</p>
  </div>
  <div class="page">
    <p>Multi-Master RUBiS Performance</p>
    <p>Throughput Response time</p>
  </div>
  <div class="page">
    <p>Browsing, 0% u</p>
    <p>bidding, 20% u</p>
  </div>
  <div class="page">
    <p>Database system  Snapshot isolation</p>
    <p>No hotspots</p>
    <p>Low abort rates</p>
    <p>Server system  Scalable server (no thrashing)</p>
    <p>Queuing model &amp; MVA  Exponential distribution for service demands</p>
    <p>Model Assumptions</p>
  </div>
  <div class="page">
    <p>Models  Single-Master</p>
    <p>Multi-Master</p>
    <p>Experimental results  TPC-W</p>
    <p>RUBiS</p>
    <p>Sensitivity analysis  Abort rates  Certifier delay</p>
    <p>Checkout the Paper</p>
  </div>
  <div class="page">
    <p>Urgaonkar, Pacifici, Shenoy, Spreitzer, Tantawi.</p>
    <p>An analytical model for multi-tier internet services and its applications. Sigmetrics 2005.</p>
    <p>Related Work</p>
  </div>
  <div class="page">
    <p>Derived an analytical model  Predicts workload scalability</p>
    <p>Implemented replicated systems  Multi-master</p>
    <p>Single-master</p>
    <p>Experimental validation  TPC-W</p>
    <p>RUBiS  Throughput predictions match within 15%</p>
    <p>Conclusions</p>
  </div>
  <div class="page">
    <p>Questions?</p>
    <p>Danke Schn!</p>
    <p>Predicting Replicated Database Scalability</p>
  </div>
</Presentation>
