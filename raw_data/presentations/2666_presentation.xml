<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Embark: Securely Outsourcing Middleboxes to the Cloud</p>
    <p>Chang Lan, Justine Sherry, Raluca Ada Popa, Sylvia Ratnasamy, Zhi Liu</p>
    <p>UC Berkeley Tsinghua University</p>
  </div>
  <div class="page">
    <p>Background</p>
    <p>Middleboxes are prevalent and problematic</p>
    <p>Number of Middleboxes  Number of Routers (APLOMB [SIGCOMM 12])</p>
    <p>Lots of Problems:</p>
    <p>MB Manifesto [HotNets 11], CoMb [NSDI 12],</p>
    <p>Honda et al. [IMC'11], DOA [OSDI '04], ETTM [NSDI '11],</p>
    <p>A Promising Solution: Outsourcing</p>
    <p>APLOMB [SIGCOMM 12]</p>
    <p>Aryaka, Zscaler</p>
    <p>AT&amp;T NFV/CORD 2</p>
  </div>
  <div class="page">
    <p>New Challenge: Confidentiality and Privacy</p>
    <p>The middleboxes sees the traffic unencrypted.</p>
    <p>Strawman: End-to-end Encryption (e.g. TLS):</p>
    <p>Some middleboxes cannot process traffic (e.g. Deep Packet Inspection).</p>
    <p>Unencrypted packet fields still leak information</p>
  </div>
  <div class="page">
    <p>Enterprise</p>
    <p>Cloud</p>
    <p>Src IP: 169.229.123.170 Src Port: 21453 Dst IP: 172.217.1.36 (Google) Dst Port: 80</p>
    <p>Src IP: 169.229.123.170 Src Port: 24363 Dst IP: Amazon Dst Port: 80</p>
    <p>Src IP: 169.229.123.170 Src Port: 12568 Dst IP: Twitter Dst Port: 80</p>
    <p>Src IP: 169.229.123.170 Src Port: 12568 Dst IP: Twitter Dst Port: 80</p>
    <p>Src IP: 169.229.123.170 Src Port: 12568 Dst IP: Twitter Dst Port: 80</p>
    <p>Src IP: 169.229.123.170 Src Port: 12568 Dst IP: Twitter Dst Port: 80</p>
    <p>Src IP: 169.229.123.170 Src Port: 12568 Dst IP: Twitter Dst Port: 80</p>
    <p>Even with end-to-end encryption, Cloud can</p>
    <p>still infer the user profile.</p>
  </div>
  <div class="page">
    <p>Problem Statement</p>
    <p>Can we outsource middleboxes without compromising privacy?</p>
    <p>Embark</p>
    <p>the first system that allows middlebox outsourcing,</p>
    <p>while keeping traffic confidential.</p>
  </div>
  <div class="page">
    <p>Overview</p>
    <p>Approach</p>
    <p>Middleboxes process encrypted traffic without decrypting it</p>
    <p>Crypto Primitives</p>
    <p>KeywordMatch: For Signature Matching</p>
    <p>BlindBox [SIGCOMM 15]: Prohibitive Setup Time Per Flow</p>
    <p>Contribution: System Design + Implementation without Per-flow Setup Time</p>
    <p>PrefixMatch: Prefix/Range Matching Contribution: A fast, secure encryption scheme for prefix matching</p>
  </div>
  <div class="page">
    <p>Overview</p>
    <p>Approach</p>
    <p>Middleboxes process encrypted traffic without decrypting it</p>
    <p>Crypto Primitives</p>
    <p>KeywordMatch: For Signature Matching</p>
    <p>BlindBox [SIGCOMM 15]: Prohibitive Setup Time Per Flow</p>
    <p>Contribution: System Design + Implementation without Per-flow Setup Time</p>
    <p>PrefixMatch: Prefix/Range Matching Contribution: A fast, secure encryption scheme for prefix matching</p>
  </div>
  <div class="page">
    <p>Outline</p>
    <p>EncryptRanges</p>
    <p>EncryptValue</p>
  </div>
  <div class="page">
    <p>Service Model</p>
    <p>Enterprise</p>
    <p>Cloud</p>
  </div>
  <div class="page">
    <p>Service Model</p>
    <p>Enterprise</p>
    <p>Cloud</p>
    <p>Gateway</p>
    <p>Encrypt / Decrypt traffic to/from the cloud</p>
  </div>
  <div class="page">
    <p>Service Model</p>
    <p>Enterprise</p>
    <p>CloudMiddlebox Rules</p>
    <p>IP firewall rules, IDS signatures, etc.</p>
  </div>
  <div class="page">
    <p>Initialization</p>
    <p>Enterprise</p>
    <p>Cloud</p>
    <p>Enterprise encrypt rules using EncryptRanges.</p>
  </div>
  <div class="page">
    <p>Initialization</p>
    <p>Enterprise</p>
    <p>Cloud</p>
    <p>Middleboxes deploy encrypted rules.</p>
  </div>
  <div class="page">
    <p>Packet Flow</p>
    <p>Enterprise</p>
    <p>Cloud</p>
  </div>
  <div class="page">
    <p>Packet Flow</p>
    <p>Enterprise Internet</p>
    <p>Cloud2. Encrypt the traffic</p>
    <p>Encrypt packet headers field by field</p>
    <p>using EncryptValue</p>
    <p>Encrypt payloads using stream cipher</p>
    <p>Implication: no change to packet structure</p>
  </div>
  <div class="page">
    <p>Packet Flow</p>
    <p>Enterprise</p>
    <p>Cloud 3. Forward to Cloud</p>
  </div>
  <div class="page">
    <p>Packet Flow</p>
    <p>Enterprise</p>
    <p>Cloud</p>
    <p>No change to algorithms: E.g., LPM, multi-dimensional classifiers, etc.</p>
  </div>
  <div class="page">
    <p>Packet Flow</p>
    <p>Enterprise</p>
    <p>Cloud</p>
  </div>
  <div class="page">
    <p>Packet Flow</p>
    <p>Enterprise Internet</p>
    <p>Cloud</p>
  </div>
  <div class="page">
    <p>Outline</p>
    <p>EncryptRanges</p>
    <p>EncryptValue</p>
  </div>
  <div class="page">
    <p>PrefixMatch</p>
    <p>Property</p>
    <p>Answer if a value V matches a range R i from [R</p>
    <p>Security</p>
    <p>Do not reveal the value of V and R i</p>
    <p>If both V 1</p>
    <p>and V 2</p>
    <p>match R i , do not reveal the ordering between V</p>
  </div>
  <div class="page">
    <p>PrefixMatch vs. OPE</p>
    <p>Operation BCLO mOPE PrefixMatch</p>
    <p>Encrypt, 10K rules 9333 us 6640 us 0.53 us</p>
    <p>Encrypt, 100K rules 9333 us 8300 us 0.77 us</p>
    <p>Decrypt 169 us 0.128 us 0.128 us</p>
    <p>Order-preserving Encryption</p>
    <p>Preserve the ordering of values after encryption</p>
    <p>PrefixMatch is better than OPE in this scenario</p>
    <p>More secure (No relative ordering)</p>
    <p>Faster (10000x)</p>
    <p>Compare with the state-of-the-art OPE schemes (BCLO and mOPE)</p>
  </div>
  <div class="page">
    <p>EncryptRanges</p>
    <p>Firewall Rules</p>
    <p>block from 192.168.1.0/24 to 205.203.224.0/19</p>
    <p>block from 192.168.0.0/16 to 223.254.0.0/16</p>
    <p>block from 10.1.0.0/16 to 223.201.0.0/16</p>
  </div>
  <div class="page">
    <p>EncryptRanges</p>
  </div>
  <div class="page">
    <p>EncryptRanges</p>
  </div>
  <div class="page">
    <p>EncryptRanges</p>
    <p>block from 192.168.1.0/24 to 205.203.224.0/19</p>
    <p>block from 192.168.0.0/16 to 223.254.0.0/16</p>
    <p>block from 10.1.0.0/16 to 223.201.0.0/16</p>
    <p>Source IP 192.168.1.0/24 -&gt; 3.0.0.0/8</p>
    <p>Destination IP 205.203.224.0/19 -&gt; 12.0.0.0/8</p>
    <p>block from 3.0.0.0/8 to 12.0.0.0/8</p>
    <p>block from 3.0.0.0/8 to 241.0.0.0/8</p>
    <p>block from 162.0.0.0/8 to 241.0.0.0/8</p>
    <p>block from 62.0.0.0/8 to 163.0.0.0/8</p>
  </div>
  <div class="page">
    <p>Encrypt each field independently</p>
    <p>Source IP, Destination IP, Source Port, Destination Port...</p>
    <p>EncryptValue</p>
  </div>
  <div class="page">
    <p>EncryptValue</p>
    <p>Encrypt each field independently</p>
    <p>Source IP, Destination IP, Source Port, Destination Port...</p>
  </div>
  <div class="page">
    <p>EncryptValue</p>
    <p>Src IP = 10.1.1.1</p>
  </div>
  <div class="page">
    <p>EncryptValue</p>
    <p>Src IP = 10.1.123.123</p>
    <p>Enc (Src IP) = 62.0.0.0 + Rand(0, 2^24)</p>
  </div>
  <div class="page">
    <p>Problem 1: How to support NAT and Load Balancers?</p>
    <p>Deterministic: The value from the same flow will be mapped to the same value</p>
    <p>Injective: Values from different flows will be mapped to different values</p>
    <p>Sufficient condition</p>
    <p>EncryptValue</p>
    <p>Src IP = 10.1.123.123 Enc (Src IP) = 62.0.0.0 + Rand(0, 2^24)</p>
    <p>Sufficient condition:</p>
    <p>Let</p>
    <p>v = (sip, dip, sp, dp, proto)</p>
    <p>v = (sip, dip, sp, dp, proto)</p>
    <p>v = v if and only if</p>
    <p>Enc(v) = Enc(v)</p>
  </div>
  <div class="page">
    <p>Problem 1: How to support NAT and Load Balancers?</p>
    <p>Use pseudorandom function,</p>
    <p>seeded by 5-tuple</p>
    <p>Use IPv6 to avoid collisions</p>
    <p>EncryptValue</p>
    <p>Src IP = 10.1.123.123 Enc (Src IP) = 62.0.0.0 + Rand(0, 2^24)</p>
    <p>Src IP = ::FFFF:10.1.123.123 Enc (Src IP) = 3e00::/8 + PRF(Src IP)</p>
  </div>
  <div class="page">
    <p>Problem 1: How to support NAT and Load Balancers?</p>
    <p>Problem 2: How to decrypt?</p>
    <p>Store AES(Src IP) in IP Options</p>
    <p>Decrypt AES(Src IP)</p>
    <p>EncryptValue</p>
  </div>
  <div class="page">
    <p>Outline</p>
    <p>EncryptRanges</p>
    <p>EncryptValue</p>
  </div>
  <div class="page">
    <p>What kinds of middleboxes does Embark support?</p>
    <p>Performance of each type of middleboxes</p>
    <p>How much does PrefixMatch increase the number of rules?</p>
    <p>Microbenchmarks</p>
    <p>How does PrefixMatch compare with OPE?</p>
    <p>How well does PrefixMatch scale with the number of rules?</p>
    <p>Performance</p>
    <p>How fast is the gateway (with PrefixMatch and with KeywordMatch)</p>
    <p>How much does the service model increase the page load time?</p>
    <p>Evaluation</p>
  </div>
  <div class="page">
    <p>Supported Middleboxes</p>
    <p>IP Firewall Linux iptables</p>
    <p>PrefixMatch NAT Linux iptables</p>
    <p>L3 Load Balancer ECMP</p>
    <p>L4 Load Balancer HAProxy</p>
    <p>HTTP Proxy Embark vs Squid</p>
    <p>KeywordMatch Parental Filter Embark vs Squid</p>
    <p>Intrusion Detection (excluding scripts and other statistical techniques)</p>
    <p>Embark vs Snort</p>
  </div>
  <div class="page">
    <p>Upper bound</p>
    <p>O(nd), d is the number of fields</p>
    <p>Empirically</p>
    <p>Rulesets</p>
    <p>3 firewall rulesets from campus network at UC Berkeley</p>
    <p>1 firewall ruleset from Emerging Threats</p>
    <p>Result</p>
    <p>UCB rulesets: No increase</p>
    <p>Emerging Threats: from 1363 to 1370</p>
    <p>Intuition</p>
    <p>Most firewall rules dont overlap</p>
    <p>How much does PrefixMatch increase Firewall rules?</p>
  </div>
  <div class="page">
    <p>How fast is the gateway (without KeywordMatch)?</p>
    <p>Performance with 1k rules:</p>
    <p>- 1.2 Gbps (min-size)</p>
    <p>- Line rate (other cases)</p>
    <p>With KeywordMatch enabled:</p>
    <p>Baseline PrefixMatch</p>
  </div>
  <div class="page">
    <p>See the paper for ...</p>
    <p>How we design and implement middleboxes</p>
    <p>Formal proof of sufficient conditions for NAT and L3/TCP Load Balancers</p>
    <p>Limitations</p>
    <p>More in-depth evaluation</p>
    <p>...</p>
  </div>
  <div class="page">
    <p>Conclusion Middleboxes can be outsourced in a way that still keeps the traffic confidential with Embark.</p>
    <p>Paper: changlan.org/papers/embark. pdf</p>
    <p>Contact: clan@eecs.berkeley.edu</p>
    <p>Thanks!</p>
  </div>
</Presentation>
