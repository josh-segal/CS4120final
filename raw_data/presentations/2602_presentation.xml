<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Increasing Datacenter Network U2lisa2on with GRIN</p>
    <p>Alexandru Agache, Razvan Deaconescu, Cos2n Raiciu</p>
    <p>University Politehnica of Bucharest</p>
  </div>
  <div class="page">
    <p>High Capacity Networks Switch</p>
    <p>Server</p>
  </div>
  <div class="page">
    <p>Heavy All-to-All Traffic</p>
  </div>
  <div class="page">
    <p>Mixed Traffic</p>
  </div>
  <div class="page">
    <p>Problem</p>
    <p>The network is underu2lised</p>
    <p>Servers are boLlenecked by the use of a single network interface</p>
  </div>
  <div class="page">
    <p>Problem Solu2on</p>
    <p>The network is underu2lised</p>
    <p>Servers are boLlenecked by the use of a single network interface</p>
    <p>Mul2ple NICs !</p>
  </div>
  <div class="page">
    <p>Solu2on</p>
  </div>
  <div class="page">
    <p>Mul2homing</p>
  </div>
  <div class="page">
    <p>Mul2homing</p>
  </div>
  <div class="page">
    <p>Mul2homing</p>
  </div>
  <div class="page">
    <p>Mul2homing</p>
  </div>
  <div class="page">
    <p>Mul2homing</p>
    <p>Can increase performance significantly</p>
    <p>Expensive: - Addi2onal switches - Addi2onal space - Addi2onal maintenance costs</p>
  </div>
  <div class="page">
    <p>GRIN</p>
  </div>
  <div class="page">
    <p>GRIN</p>
  </div>
  <div class="page">
    <p>GRIN</p>
    <p>Horizontal (secondary) link</p>
  </div>
  <div class="page">
    <p>GRIN</p>
    <p>Horizontal (secondary) link Secondary interface</p>
  </div>
  <div class="page">
    <p>GRIN</p>
    <p>Horizontal (secondary) link Secondary interface</p>
    <p>Primary interface</p>
  </div>
  <div class="page">
    <p>GRIN</p>
  </div>
  <div class="page">
    <p>MPTCP</p>
    <p>One connec2on can be split into mul2ple concurrent subflows</p>
    <p>Allows the use mul2ple NICs in a transparent manner toward applica2ons</p>
  </div>
  <div class="page">
    <p>Using Two Addi2onal Ports</p>
  </div>
  <div class="page">
    <p>GRIN2 Topology</p>
  </div>
  <div class="page">
    <p>GRIN2 Topology Original Network</p>
  </div>
  <div class="page">
    <p>GRIN2 Topology</p>
  </div>
  <div class="page">
    <p>Using GRIN - Sender</p>
    <p>A</p>
  </div>
  <div class="page">
    <p>Using GRIN - Sender</p>
    <p>A</p>
  </div>
  <div class="page">
    <p>Using GRIN - Sender</p>
    <p>A</p>
  </div>
  <div class="page">
    <p>Using GRIN - Sender</p>
    <p>A</p>
  </div>
  <div class="page">
    <p>Using GRIN - Sender</p>
    <p>A</p>
  </div>
  <div class="page">
    <p>Using GRIN - Sender</p>
    <p>A</p>
  </div>
  <div class="page">
    <p>Hn Rou2ng</p>
    <p>A</p>
  </div>
  <div class="page">
    <p>H1 Rou2ng</p>
    <p>A</p>
  </div>
  <div class="page">
    <p>How Far Do We Go ?</p>
    <p>Compromise ?</p>
  </div>
  <div class="page">
    <p>How Far Do We Go ?</p>
    <p>Compromise ?  Using mul2ple horizontal hops is not actually beLer than h1 rou2ng at discovering capacity</p>
  </div>
  <div class="page">
    <p>How Far Do We Go ?</p>
    <p>Compromise ?  Using mul2ple horizontal hops is not actually beLer than h1 rou2ng at discovering capacity</p>
    <p>Thus, GRIN only forwards traffic through direct neighbours</p>
  </div>
  <div class="page">
    <p>Rou2ng In a GRIN Topology</p>
    <p>A B C D Des2na2on Source</p>
  </div>
  <div class="page">
    <p>Rou2ng In a GRIN Topology</p>
    <p>A B C D</p>
  </div>
  <div class="page">
    <p>Rou2ng In a GRIN Topology</p>
    <p>A B C D (Direct Connec2on)</p>
  </div>
  <div class="page">
    <p>Rou2ng In a GRIN Topology</p>
    <p>A B C D</p>
    <p>Packet</p>
  </div>
  <div class="page">
    <p>Rou2ng In a GRIN Topology</p>
    <p>A B C D</p>
    <p>R</p>
  </div>
  <div class="page">
    <p>Rou2ng In a GRIN Topology</p>
    <p>A B C D</p>
    <p>R</p>
    <p>Oh, I know that address!a</p>
  </div>
  <div class="page">
    <p>Rou2ng In a GRIN Topology</p>
    <p>A B C D</p>
    <p>R</p>
  </div>
  <div class="page">
    <p>Rou2ng In a GRIN Topology</p>
    <p>A B C D</p>
    <p>R</p>
  </div>
  <div class="page">
    <p>Rou2ng In a GRIN Topology</p>
    <p>A B C D</p>
  </div>
  <div class="page">
    <p>Rou2ng In a GRIN Topology</p>
    <p>A B C D</p>
  </div>
  <div class="page">
    <p>Rou2ng In a GRIN Topology</p>
    <p>A B C D</p>
  </div>
  <div class="page">
    <p>Rou2ng In a GRIN Topology</p>
    <p>A B C D</p>
  </div>
  <div class="page">
    <p>Rou2ng In a GRIN Topology</p>
    <p>A B C D</p>
    <p>R</p>
  </div>
  <div class="page">
    <p>Rou2ng In a GRIN Topology</p>
    <p>A B C D</p>
    <p>R ??!?!</p>
  </div>
  <div class="page">
    <p>The GRIN Rou2ng Problem</p>
    <p>Secondary interfaces should be reachable  We want to rely as much as possible on the rou2ng scheme of the original network</p>
  </div>
  <div class="page">
    <p>The GRIN Rou2ng Problem</p>
    <p>Secondary interfaces should be reachable  We want to rely as much as possible on the rou2ng scheme of the original network</p>
    <p>Unsa2sfactory solu2ons: - source rou2ng - running the rou2ng protocol (OSPF, IS-IS) down to the servers</p>
  </div>
  <div class="page">
    <p>GRIN Addressing Scheme</p>
    <p>We use a custom addressing scheme that also conveys rou2ng informa2on</p>
  </div>
  <div class="page">
    <p>GRIN Addressing Scheme</p>
    <p>A . B . C . D Server ID</p>
    <p>GRIN ID</p>
  </div>
  <div class="page">
    <p>GRIN Addressing Scheme</p>
    <p>A . B . C . D Server ID</p>
    <p>GRIN ID</p>
    <p>Example: Server ID(127.0.0.1) = 127.0.0 GRIN ID(127.0.0.1) = 1</p>
  </div>
  <div class="page">
    <p>Address Assignment</p>
    <p>A B C</p>
  </div>
  <div class="page">
    <p>Primary Addresses</p>
    <p>A B C</p>
  </div>
  <div class="page">
    <p>Secondary Addresses</p>
    <p>A B C</p>
  </div>
  <div class="page">
    <p>Secondary Addresses</p>
    <p>A B C</p>
  </div>
  <div class="page">
    <p>Secondary Addresses</p>
    <p>A B C</p>
  </div>
  <div class="page">
    <p>Secondary Addresses</p>
    <p>A B C</p>
  </div>
  <div class="page">
    <p>Secondary Addresses</p>
    <p>A B C</p>
  </div>
  <div class="page">
    <p>Secondary Addresses</p>
    <p>A B C</p>
  </div>
  <div class="page">
    <p>GRIN Addressing Scheme</p>
    <p>Easy to dis2nguish primary from secondary addresses</p>
    <p>Easy to determine the primary address of the neighbour associated with a secondary link</p>
  </div>
  <div class="page">
    <p>Rou2ng In a GRIN Topology</p>
    <p>A B C D 10.0.2.1</p>
  </div>
  <div class="page">
    <p>Rou2ng In a GRIN Topology</p>
    <p>A B C D 10.0.2.1</p>
    <p>going to 10.0.3.2</p>
  </div>
  <div class="page">
    <p>Rou2ng In a GRIN Topology</p>
    <p>A B C D 10.0.2.1</p>
  </div>
  <div class="page">
    <p>Rou2ng In a GRIN Topology</p>
    <p>A B C D 10.0.2.1</p>
  </div>
  <div class="page">
    <p>Rou2ng In a GRIN Topology</p>
    <p>A B C D 10.0.2.1</p>
    <p>R</p>
  </div>
  <div class="page">
    <p>Rou2ng In a GRIN Topology</p>
    <p>A B C D 10.0.2.1</p>
    <p>R 10.0.3/24 -&gt; C</p>
  </div>
  <div class="page">
    <p>Rou2ng In a GRIN Topology</p>
    <p>A B C D 10.0.2.1</p>
    <p>R</p>
  </div>
  <div class="page">
    <p>Rou2ng In a GRIN Topology</p>
    <p>A B C D 10.0.2.1</p>
    <p>R</p>
  </div>
  <div class="page">
    <p>Rou2ng In a GRIN Topology</p>
    <p>A B C D 10.0.2.1</p>
    <p>R</p>
  </div>
  <div class="page">
    <p>Using GRIN</p>
  </div>
  <div class="page">
    <p>Opportunis2c Usage</p>
    <p>Dont change anything about applica2ons and the way we use them</p>
  </div>
  <div class="page">
    <p>Evalua2on</p>
    <p>Simulated (120 server topology)  Micro cluster (10 servers) - 1Gbps - 10Gbps</p>
    <p>EC2 (1000 c3.large instances) - interfaces limited to 100Mbps</p>
  </div>
  <div class="page">
    <p>Random Traffic</p>
    <p>A certain number of servers are ac2ve</p>
    <p>Each ac2ve server send data flat-out to a des2na2on chosen at random</p>
  </div>
  <div class="page">
    <p>Random Traffic</p>
    <p>B an</p>
    <p>dw id</p>
    <p>th p</p>
    <p>er c</p>
    <p>on ne</p>
    <p>ct io</p>
    <p>n</p>
    <p>Hosts sending (%)</p>
    <p>Original</p>
  </div>
  <div class="page">
    <p>Random Traffic</p>
    <p>B an</p>
    <p>dw id</p>
    <p>th p</p>
    <p>er c</p>
    <p>on ne</p>
    <p>ct io</p>
    <p>n</p>
    <p>Hosts sending (%)</p>
    <p>Original Multihomed</p>
  </div>
  <div class="page">
    <p>Random Traffic</p>
    <p>B an</p>
    <p>dw id</p>
    <p>th p</p>
    <p>er c</p>
    <p>on ne</p>
    <p>ct io</p>
    <p>n</p>
    <p>Hosts sending (%)</p>
    <p>Original GRIN1</p>
    <p>Multihomed</p>
  </div>
  <div class="page">
    <p>Random Traffic</p>
    <p>B an</p>
    <p>dw id</p>
    <p>th p</p>
    <p>er c</p>
    <p>on ne</p>
    <p>ct io</p>
    <p>n</p>
    <p>Hosts sending (%)</p>
    <p>Original GRIN1 GRIN2</p>
    <p>Multihomed</p>
  </div>
  <div class="page">
    <p>Random Traffic</p>
    <p>B an</p>
    <p>dw id</p>
    <p>th p</p>
    <p>er c</p>
    <p>on ne</p>
    <p>ct io</p>
    <p>n</p>
    <p>Hosts sending (%)</p>
    <p>Original GRIN1 GRIN2 GRIN3</p>
    <p>Multihomed</p>
  </div>
  <div class="page">
    <p>Applica2on Performance</p>
    <p>Applica+on GRIN1 GRIN2</p>
    <p>NFS (files &gt; 1MB) 1.9x 2.5x</p>
    <p>HDFS 2x 2.6x (CPU bound) 3x (for 2 clients)</p>
    <p>Xen Virtual Machine Migra2on</p>
    <p>With 1Gbps links</p>
  </div>
  <div class="page">
    <p>Applica2on Performance</p>
    <p>At 10Gbps, apps easily become CPU bound (on our machines)</p>
    <p>We needed mul2ple concurrent clients to increase bandwidth u2lisa2on at the server</p>
    <p>- Two NFS clients fully u2lised both links available to one server - Three Spark workers needed to fully u2lise one DFS node for</p>
    <p>word count</p>
  </div>
  <div class="page">
    <p>Nega2ve Impact of Opportunis2c Usage</p>
  </div>
  <div class="page">
    <p>Fair Use of Uplinks</p>
    <p>A B</p>
  </div>
  <div class="page">
    <p>Fair Use of Uplinks</p>
    <p>DSCP-based priori2za2on scheme - Direct flows receive high priority - Secondary flows receive low priority</p>
  </div>
  <div class="page">
    <p>Fair Use of Uplinks</p>
    <p>A B</p>
  </div>
  <div class="page">
    <p>Latency</p>
    <p>Increased buffer pressure</p>
    <p>One latency-sensi2ve direct flow vs. mul2ple secondary flows</p>
  </div>
  <div class="page">
    <p>Latency</p>
    <p>Outgoing on a server uplink</p>
    <p>At an egress port of a switch</p>
  </div>
  <div class="page">
    <p>Latency</p>
    <p>Outgoing on a server uplink - 1.7 ms increase without priority - 240 us increase with priority (can be improved)</p>
    <p>At an egress port of a switch - 2.3 ms increase w/o priority - 10 us increase w priority</p>
  </div>
  <div class="page">
    <p>Forwarding Overhead</p>
    <p>Compute-intensive applica2ons may suffer  Three cases: - Kernel compila2on in a ramdisk - Video transcoding - A memcached server</p>
  </div>
  <div class="page">
    <p>Forwarding Overhead</p>
    <p>Bidirec2onal 10Gbps traffic</p>
    <p>If one core is reserved for traffic forwarding, the impact is minimal &lt; 1%</p>
    <p>Otherwise, apps may suffer a 8-13% performance hit</p>
  </div>
  <div class="page">
    <p>Zero-Overhead Forwarding</p>
  </div>
  <div class="page">
    <p>Packet Differen2a2on</p>
    <p>A B</p>
    <p>Dst( ) = B Dst( ) = some other server</p>
  </div>
  <div class="page">
    <p>Packet Differen2a2on</p>
    <p>A B Rx q0</p>
    <p>Rx q1</p>
    <p>Hardware Filters</p>
  </div>
  <div class="page">
    <p>Header Field Rewri2ng</p>
    <p>Most important: update the des2na2on MAC address</p>
    <p>We argue no such thing is required at forwarding servers in a GRIN topology</p>
  </div>
  <div class="page">
    <p>Queue Bridging</p>
    <p>B Rx q1</p>
    <p>Tx q1</p>
  </div>
  <div class="page">
    <p>Queue Bridging</p>
    <p>Missing hardware func2onality</p>
    <p>So far only possible from Tx to Rx and for queues of the same physical port</p>
  </div>
  <div class="page">
    <p>GRIN Aware Applica2ons</p>
  </div>
  <div class="page">
    <p>GRIN Aware Applica2ons</p>
    <p>Distributed applica2ons (ex. Hadoop)</p>
    <p>ALempt to schedule tasks such that nega2ve interac2ons are kept to a minimum</p>
  </div>
  <div class="page">
    <p>HDFS Namenode</p>
    <p>A B C D E F Namenode</p>
    <p>Client</p>
    <p>?</p>
    <p>Client requests informa2on about a block</p>
  </div>
  <div class="page">
    <p>HDFS Namenode</p>
    <p>A B C D E F</p>
    <p>(B, D, E)</p>
    <p>Namenode responds with a list of replicas where that node is available</p>
  </div>
  <div class="page">
    <p>HDFS Namenode</p>
    <p>A B C D E F</p>
    <p>Client aLempts to contact a replica, in the order provided by the NameNode</p>
  </div>
  <div class="page">
    <p>HDFS Namenode Op2misa2on</p>
    <p>Simple change: before returning a list of replicas, sort it based on expected available uplink capacity</p>
    <p>Heuris2c based on last recommenda2on 2me</p>
  </div>
  <div class="page">
    <p>HDFS Namenode Op2misa2on</p>
    <p>Tr an</p>
    <p>sf er</p>
    <p>t im</p>
    <p>e (s</p>
    <p>)</p>
    <p>Hosts requesting (%)</p>
    <p>Base GRIN1</p>
    <p>Optimised</p>
  </div>
  <div class="page">
    <p>Conclusions</p>
    <p>GRIN can bring significant performance benefits for underu2lised networks</p>
    <p>Works with almost any exis2ng topology</p>
    <p>Cheap and incrementally deployable</p>
    <p>GRIN aware applica2ons may lessen the nega2ve impact of opportunis2c usage (while we hope for beLer hardware to become available)</p>
  </div>
</Presentation>
