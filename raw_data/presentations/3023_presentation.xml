<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Clarinet: WAN-Aware Optimization for Analytics Queries</p>
    <p>Raajay Viswanathan, Ganesh Ananthanarayanan, Aditya Akella</p>
  </div>
  <div class="page">
    <p>Overview</p>
    <p>Web apps hosted on multiple DCs  Low latency access to end-user</p>
  </div>
  <div class="page">
    <p>Overview</p>
    <p>Web apps hosted on multiple DCs  Low latency access to end-user</p>
  </div>
  <div class="page">
    <p>Overview</p>
    <p>Web apps hosted on multiple DCs  Low latency access to end-user</p>
  </div>
  <div class="page">
    <p>Overview</p>
    <p>Web apps hosted on multiple DCs  Low latency access to end-user</p>
  </div>
  <div class="page">
    <p>Overview</p>
    <p>Web apps hosted on multiple DCs  Low latency access to end-user  Need efficient methods to analyze data located in multiple data centers</p>
  </div>
  <div class="page">
    <p>Centralized Aggregation is Wasteful</p>
  </div>
  <div class="page">
    <p>Centralized Aggregation is Wasteful</p>
    <p>Intra-data center Analytics</p>
    <p>Framework</p>
    <p>SELECT *  FROM .. WHERE .. ;</p>
  </div>
  <div class="page">
    <p>Centralized Aggregation is Wasteful</p>
    <p>Intra-data center Analytics</p>
    <p>Framework</p>
    <p>SELECT *  FROM .. WHERE .. ;</p>
    <p>Available WAN bandwidth is limited  Aggregation latency overhead</p>
    <p>B a</p>
    <p>n d</p>
    <p>w id</p>
    <p>th (</p>
    <p>M b</p>
    <p>p s)</p>
    <p>Directional WAN links sorted by bandwidth</p>
    <p>Measured pairwise bandwidth between EC2 regions</p>
  </div>
  <div class="page">
    <p>Centralized Aggregation is Wasteful</p>
    <p>Intra-data center Analytics</p>
    <p>Framework</p>
    <p>SELECT *  FROM .. WHERE .. ;</p>
    <p>Available WAN bandwidth is limited  Aggregation latency overhead</p>
    <p>WAN links are expensive  High data transfer cost</p>
    <p>$$$$</p>
    <p>$$$$</p>
    <p>$$$</p>
  </div>
  <div class="page">
    <p>Geo-distributed Analytics</p>
  </div>
  <div class="page">
    <p>Geo-distributed Analytics</p>
    <p>Analytics framework</p>
    <p>One Logical Datacenter</p>
  </div>
  <div class="page">
    <p>Geo-distributed Analytics</p>
    <p>Analytics framework</p>
    <p>One Logical Datacenter</p>
    <p>Distributed Storage Layer</p>
  </div>
  <div class="page">
    <p>Geo-distributed Analytics</p>
    <p>Analytics framework</p>
    <p>One Logical Datacenter</p>
    <p>Distributed Storage Layer</p>
    <p>Distributed Execution Layer</p>
    <p>SELECT *  FROM .. WHERE .. ;</p>
    <p>Query Optimizer</p>
    <p>Multi-stage parallelizable jobs</p>
  </div>
  <div class="page">
    <p>Geo-distributed Analytics</p>
    <p>Analytics framework</p>
    <p>One Logical Datacenter</p>
    <p>Distributed Storage Layer</p>
    <p>Distributed Execution Layer</p>
    <p>SELECT *  FROM .. WHERE .. ;</p>
    <p>Query Optimizer</p>
    <p>Multi-stage parallelizable jobs</p>
    <p>Geo-distributed</p>
    <p>Requires WAN-aware optimization</p>
  </div>
  <div class="page">
    <p>Geo-distributed Analytics</p>
    <p>Analytics framework</p>
    <p>One Logical Datacenter</p>
    <p>Distributed Storage Layer</p>
    <p>Distributed Execution Layer</p>
    <p>SELECT *  FROM .. WHERE .. ;</p>
    <p>Query Optimizer</p>
    <p>Multi-stage parallelizable jobs</p>
    <p>Geo-distributed</p>
    <p>Requires WAN-aware optimization</p>
    <p>Iridium [SIGCOMM 15] GeoDe [NSDI 15]</p>
  </div>
  <div class="page">
    <p>Geo-distributed Analytics</p>
    <p>Analytics framework</p>
    <p>One Logical Datacenter</p>
    <p>Distributed Storage Layer</p>
    <p>Distributed Execution Layer</p>
    <p>SELECT *  FROM .. WHERE .. ;</p>
    <p>Query Optimizer</p>
    <p>Multi-stage parallelizable jobs</p>
    <p>Geo-distributed</p>
    <p>Requires WAN-aware optimization</p>
    <p>Clarinet</p>
  </div>
  <div class="page">
    <p>Geo-distributed Analytics</p>
    <p>Analytics framework</p>
    <p>One Logical Datacenter</p>
    <p>Distributed Storage Layer</p>
    <p>Distributed Execution Layer</p>
    <p>SELECT *  FROM .. WHERE .. ;</p>
    <p>Query Optimizer</p>
    <p>Multi-stage parallelizable jobs</p>
    <p>Geo-distributed</p>
    <p>Requires WAN-aware optimization</p>
    <p>Clarinet</p>
  </div>
  <div class="page">
    <p>WAN Aware Query Optimization</p>
    <p>T2</p>
    <p>DC2</p>
    <p>T3</p>
    <p>DC3</p>
    <p>T1</p>
    <p>DC1</p>
    <p>T1, T2, T3: Tables storing click logs</p>
  </div>
  <div class="page">
    <p>WAN Aware Query Optimization</p>
    <p>T2</p>
    <p>DC2</p>
    <p>T3</p>
    <p>DC3</p>
    <p>T1</p>
    <p>DC1</p>
    <p>T1, T2, T3: Tables storing click logs</p>
  </div>
  <div class="page">
    <p>WAN Aware Query Optimization</p>
    <p>T2</p>
    <p>DC2</p>
    <p>T3</p>
    <p>DC3</p>
    <p>T1</p>
    <p>DC1</p>
    <p>QUERY</p>
    <p>SELECT T1.user, T1.latency, T2.latency, T3.latency</p>
    <p>FROM T1, T2, T3</p>
    <p>WHERE T1.user == T2.user AND T1.user == T3.user</p>
    <p>AND T1.device == T2.device == T3.device == mobile;</p>
    <p>T1, T2, T3: Tables storing click logs</p>
  </div>
  <div class="page">
    <p>WAN Aware Query Optimization</p>
    <p>T2</p>
    <p>DC2</p>
    <p>T3</p>
    <p>DC3</p>
    <p>T1</p>
    <p>DC1</p>
    <p>T2 T3</p>
    <p>QUERY</p>
    <p>SELECT T1.user, T1.latency, T2.latency, T3.latency</p>
    <p>FROM T1, T2, T3</p>
    <p>WHERE T1.user == T2.user AND T1.user == T3.user</p>
    <p>AND T1.device == T2.device == T3.device == mobile;</p>
    <p>T1, T2, T3: Tables storing click logs</p>
  </div>
  <div class="page">
    <p>WAN Aware Query Optimization</p>
    <p>T2</p>
    <p>DC2</p>
    <p>T3</p>
    <p>DC3</p>
    <p>T1</p>
    <p>DC1</p>
    <p>T2 T3</p>
    <p>T1</p>
    <p>QUERY</p>
    <p>SELECT T1.user, T1.latency, T2.latency, T3.latency</p>
    <p>FROM T1, T2, T3</p>
    <p>WHERE T1.user == T2.user AND T1.user == T3.user</p>
    <p>AND T1.device == T2.device == T3.device == mobile;</p>
    <p>T1, T2, T3: Tables storing click logs</p>
  </div>
  <div class="page">
    <p>WAN Aware Query Optimization</p>
    <p>T2</p>
    <p>DC2</p>
    <p>T3</p>
    <p>DC3</p>
    <p>T1</p>
    <p>DC1</p>
    <p>T2 T3</p>
    <p>T1</p>
    <p>QUERY</p>
    <p>SELECT T1.user, T1.latency, T2.latency, T3.latency</p>
    <p>FROM T1, T2, T3</p>
    <p>WHERE T1.user == T2.user AND T1.user == T3.user</p>
    <p>AND T1.device == T2.device == T3.device == mobile;</p>
    <p>T1, T2, T3: Tables storing click logs</p>
  </div>
  <div class="page">
    <p>WAN Aware Query Optimization</p>
    <p>T2</p>
    <p>DC2</p>
    <p>T3</p>
    <p>DC3</p>
    <p>T1</p>
    <p>DC1</p>
    <p>T2 T3</p>
    <p>T1</p>
    <p>Plan running time: 41 s</p>
    <p>QUERY</p>
    <p>SELECT T1.user, T1.latency, T2.latency, T3.latency</p>
    <p>FROM T1, T2, T3</p>
    <p>WHERE T1.user == T2.user AND T1.user == T3.user</p>
    <p>AND T1.device == T2.device == T3.device == mobile;</p>
    <p>T1, T2, T3: Tables storing click logs</p>
  </div>
  <div class="page">
    <p>WAN Aware Query Optimization</p>
    <p>T2</p>
    <p>DC2</p>
    <p>T3</p>
    <p>DC3</p>
    <p>T1</p>
    <p>DC1</p>
    <p>T2 T3</p>
    <p>T1</p>
    <p>Plan running time: 41 s</p>
    <p>QUERY</p>
    <p>SELECT T1.user, T1.latency, T2.latency, T3.latency</p>
    <p>FROM T1, T2, T3</p>
    <p>WHERE T1.user == T2.user AND T1.user == T3.user</p>
    <p>AND T1.device == T2.device == T3.device == mobile;</p>
    <p>T1, T2, T3: Tables storing click logs</p>
  </div>
  <div class="page">
    <p>WAN Aware Query Optimization</p>
    <p>T2</p>
    <p>DC2</p>
    <p>T3</p>
    <p>DC3</p>
    <p>T1</p>
    <p>DC1</p>
    <p>T2 T3</p>
    <p>T1</p>
    <p>Plan running time: 41 s</p>
    <p>QUERY</p>
    <p>SELECT T1.user, T1.latency, T2.latency, T3.latency</p>
    <p>FROM T1, T2, T3</p>
    <p>WHERE T1.user == T2.user AND T1.user == T3.user</p>
    <p>AND T1.device == T2.device == T3.device == mobile;</p>
    <p>T1, T2, T3: Tables storing click logs</p>
    <p>WAN-only bottleneck</p>
  </div>
  <div class="page">
    <p>WAN Aware Query Optimization</p>
    <p>T2</p>
    <p>DC2</p>
    <p>T3</p>
    <p>DC3</p>
    <p>T1</p>
    <p>DC1</p>
    <p>T2 T3</p>
    <p>T1</p>
    <p>Plan running time: 41 s</p>
    <p>QUERY</p>
    <p>SELECT T1.user, T1.latency, T2.latency, T3.latency</p>
    <p>FROM T1, T2, T3</p>
    <p>WHERE T1.user == T2.user AND T1.user == T3.user</p>
    <p>AND T1.device == T2.device == T3.device == mobile;</p>
    <p>T1, T2, T3: Tables storing click logs</p>
    <p>12 GB</p>
    <p>T2 T1</p>
    <p>T3</p>
    <p>16 GB</p>
    <p>T1 T3</p>
    <p>T2</p>
    <p>Plan A Plan B Plan C</p>
    <p>Plan running time: 20.96 s Plan running time: 17.6 s</p>
    <p>WAN-only bottleneck</p>
  </div>
  <div class="page">
    <p>WAN Aware Query Optimization</p>
    <p>T2</p>
    <p>DC2</p>
    <p>T3</p>
    <p>DC3</p>
    <p>T1</p>
    <p>DC1</p>
    <p>T2 T3</p>
    <p>T1</p>
    <p>Plan running time: 41 s</p>
    <p>QUERY</p>
    <p>SELECT T1.user, T1.latency, T2.latency, T3.latency</p>
    <p>FROM T1, T2, T3</p>
    <p>WHERE T1.user == T2.user AND T1.user == T3.user</p>
    <p>AND T1.device == T2.device == T3.device == mobile;</p>
    <p>T1, T2, T3: Tables storing click logs</p>
    <p>12 GB</p>
    <p>T2 T1</p>
    <p>T3</p>
    <p>16 GB</p>
    <p>T1 T3</p>
    <p>T2</p>
    <p>Plan A Plan B Plan C</p>
    <p>Plan running time: 20.96 s Plan running time: 17.6 s</p>
    <p>Chosen by network agnostic query optimizer</p>
    <p>WAN-only bottleneck</p>
  </div>
  <div class="page">
    <p>WAN Aware Query Optimization</p>
    <p>T2</p>
    <p>DC2</p>
    <p>T3</p>
    <p>DC3</p>
    <p>T1</p>
    <p>DC1</p>
    <p>T2 T3</p>
    <p>T1</p>
    <p>Plan running time: 41 s</p>
    <p>QUERY</p>
    <p>SELECT T1.user, T1.latency, T2.latency, T3.latency</p>
    <p>FROM T1, T2, T3</p>
    <p>WHERE T1.user == T2.user AND T1.user == T3.user</p>
    <p>AND T1.device == T2.device == T3.device == mobile;</p>
    <p>T1, T2, T3: Tables storing click logs</p>
    <p>12 GB</p>
    <p>T2 T1</p>
    <p>T3</p>
    <p>16 GB</p>
    <p>T1 T3</p>
    <p>T2</p>
    <p>Plan A Plan B Plan C</p>
    <p>Plan running time: 20.96 s Plan running time: 17.6 s</p>
    <p>Chosen by network agnostic query optimizer</p>
    <p>WAN-only bottleneck</p>
  </div>
  <div class="page">
    <p>WAN Aware Query Optimization</p>
    <p>T2</p>
    <p>DC2</p>
    <p>T3</p>
    <p>DC3</p>
    <p>T1</p>
    <p>DC1</p>
    <p>T2 T3</p>
    <p>T1</p>
    <p>Plan running time: 41 s</p>
    <p>QUERY</p>
    <p>SELECT T1.user, T1.latency, T2.latency, T3.latency</p>
    <p>FROM T1, T2, T3</p>
    <p>WHERE T1.user == T2.user AND T1.user == T3.user</p>
    <p>AND T1.device == T2.device == T3.device == mobile;</p>
    <p>T1, T2, T3: Tables storing click logs</p>
    <p>12 GB</p>
    <p>T2 T1</p>
    <p>T3</p>
    <p>16 GB</p>
    <p>T1 T3</p>
    <p>T2</p>
    <p>Plan A Plan B Plan C</p>
    <p>Plan running time: 20.96 s Plan running time: 17.6 s</p>
    <p>Chosen by network agnostic query optimizer</p>
    <p>WAN-only bottleneck</p>
    <p>WAN-aware query optimizer that uses network transfer duration to choose query plans</p>
  </div>
  <div class="page">
    <p>Outline</p>
    <p>Multiple simultaneous queries</p>
  </div>
  <div class="page">
    <p>Other factors also affect query plan run time</p>
    <p>T2</p>
    <p>DC2</p>
    <p>T3</p>
    <p>DC3</p>
    <p>T1</p>
    <p>DC1</p>
  </div>
  <div class="page">
    <p>Other factors also affect query plan run time</p>
    <p>T2</p>
    <p>DC2</p>
    <p>T3</p>
    <p>DC3</p>
    <p>T1</p>
    <p>DC1</p>
    <p>200 GB 200 GB</p>
    <p>T1 T2</p>
  </div>
  <div class="page">
    <p>Other factors also affect query plan run time</p>
    <p>T2</p>
    <p>DC2</p>
    <p>T3</p>
    <p>DC3</p>
    <p>T1</p>
    <p>DC1</p>
    <p>200 GB 200 GB</p>
    <p>T1 T2</p>
    <p>T1 T2</p>
    <p>MAP: SELECT MAP: SELECT</p>
    <p>REDUCE: JOIN</p>
    <p>Map Reduce Job</p>
  </div>
  <div class="page">
    <p>Other factors also affect query plan run time</p>
    <p>T2</p>
    <p>DC2</p>
    <p>T3</p>
    <p>DC3</p>
    <p>T1</p>
    <p>DC1</p>
    <p>200 GB 200 GB</p>
    <p>T1 T2</p>
    <p>20 s</p>
    <p>T1 T2</p>
    <p>MAP: SELECT MAP: SELECT</p>
    <p>REDUCE: JOIN</p>
    <p>Map Reduce Job</p>
    <p>Tasks placed in single DC</p>
  </div>
  <div class="page">
    <p>Other factors also affect query plan run time</p>
    <p>T2</p>
    <p>DC2</p>
    <p>T3</p>
    <p>DC3</p>
    <p>T1</p>
    <p>DC1</p>
    <p>200 GB 200 GB</p>
    <p>T1 T2</p>
    <p>T1 T2</p>
    <p>MAP: SELECT MAP: SELECT</p>
    <p>REDUCE: JOIN</p>
    <p>Map Reduce Job</p>
    <p>Tasks are placed uniformly across DC1 and DC2</p>
  </div>
  <div class="page">
    <p>Other factors also affect query plan run time</p>
    <p>T2</p>
    <p>DC2</p>
    <p>T3</p>
    <p>DC3</p>
    <p>T1</p>
    <p>DC1</p>
    <p>200 GB 200 GB</p>
    <p>T1 T2</p>
    <p>T1 T2</p>
    <p>MAP: SELECT MAP: SELECT</p>
    <p>REDUCE: JOIN</p>
    <p>Map Reduce Job</p>
    <p>Tasks are placed uniformly across DC1 and DC2</p>
    <p>While evaluating different query plans</p>
  </div>
  <div class="page">
    <p>Other factors also affect query plan run time</p>
    <p>T2</p>
    <p>DC2</p>
    <p>T3</p>
    <p>DC3</p>
    <p>T1</p>
    <p>DC1</p>
    <p>200 GB 200 GB</p>
    <p>T1 T2</p>
    <p>T1 T2</p>
    <p>MAP: SELECT MAP: SELECT</p>
    <p>REDUCE: JOIN</p>
    <p>Map Reduce Job</p>
    <p>Tasks are placed uniformly across DC1 and DC2</p>
    <p>While evaluating different query plans</p>
  </div>
  <div class="page">
    <p>Other factors also affect query plan run time</p>
    <p>T2</p>
    <p>DC2</p>
    <p>T3</p>
    <p>DC3</p>
    <p>T1</p>
    <p>DC1</p>
    <p>200 GB 200 GB</p>
    <p>T1 T2</p>
    <p>T1 T2</p>
    <p>MAP: SELECT MAP: SELECT</p>
    <p>REDUCE: JOIN</p>
    <p>Map Reduce Job</p>
    <p>Tasks are placed uniformly across DC1 and DC2</p>
    <p>While evaluating different query plans</p>
    <p>Used by high priority application</p>
  </div>
  <div class="page">
    <p>Other factors also affect query plan run time</p>
    <p>T2</p>
    <p>DC2</p>
    <p>T3</p>
    <p>DC3</p>
    <p>T1</p>
    <p>DC1</p>
    <p>200 GB 200 GB</p>
    <p>T1 T2</p>
    <p>T1 T2</p>
    <p>MAP: SELECT MAP: SELECT</p>
    <p>REDUCE: JOIN</p>
    <p>Map Reduce Job</p>
    <p>Tasks are placed uniformly across DC1 and DC2</p>
    <p>While evaluating different query plans</p>
    <p>Used by high priority application</p>
  </div>
  <div class="page">
    <p>Other factors also affect query plan run time</p>
    <p>T2</p>
    <p>DC2</p>
    <p>T3</p>
    <p>DC3</p>
    <p>T1</p>
    <p>DC1</p>
    <p>200 GB 200 GB</p>
    <p>T1 T2</p>
    <p>T1 T2</p>
    <p>MAP: SELECT MAP: SELECT</p>
    <p>REDUCE: JOIN</p>
    <p>Map Reduce Job</p>
    <p>Tasks are placed uniformly across DC1 and DC2</p>
    <p>While evaluating different query plans</p>
    <p>Used by high priority application</p>
    <p>Choose query plan based on: 1. Best available task placements</p>
  </div>
  <div class="page">
    <p>Other factors also affect query plan run time</p>
    <p>T2</p>
    <p>DC2</p>
    <p>T3</p>
    <p>DC3</p>
    <p>T1</p>
    <p>DC1</p>
    <p>200 GB 200 GB</p>
    <p>T1 T2</p>
    <p>T1 T2</p>
    <p>MAP: SELECT MAP: SELECT</p>
    <p>REDUCE: JOIN</p>
    <p>Map Reduce Job</p>
    <p>Tasks are placed uniformly across DC1 and DC2</p>
    <p>While evaluating different query plans</p>
    <p>Used by high priority application</p>
    <p>Choose query plan based on: 1. Best available task placements 2. Schedule of network transfers</p>
  </div>
  <div class="page">
    <p>Joint plan selection, placement and scheduling</p>
  </div>
  <div class="page">
    <p>Joint plan selection, placement and scheduling</p>
    <p>Query Optimizer Multiple query plans (join orders) per query</p>
    <p>SELECT * FROM  WHERE.. ;</p>
  </div>
  <div class="page">
    <p>Joint plan selection, placement and scheduling</p>
    <p>Query Optimizer Multiple query plans (join orders) per query</p>
    <p>SELECT * FROM  WHERE.. ;</p>
    <p>Logical plan to physical plan Assign parallelism for each stage</p>
  </div>
  <div class="page">
    <p>Joint plan selection, placement and scheduling</p>
    <p>Clarinet</p>
    <p>Query Optimizer</p>
    <p>Network aware task placement and scheduling for each query plan</p>
    <p>Multiple query plans (join orders) per query</p>
    <p>Choose plan with smallest run time for execution</p>
    <p>SELECT * FROM  WHERE.. ;</p>
    <p>Logical plan to physical plan Assign parallelism for each stage</p>
  </div>
  <div class="page">
    <p>Joint plan selection, placement and scheduling</p>
    <p>Clarinet</p>
    <p>Query Optimizer</p>
    <p>Network aware task placement and scheduling for each query plan</p>
    <p>Multiple query plans (join orders) per query</p>
    <p>Choose plan with smallest run time for execution</p>
    <p>SELECT * FROM  WHERE.. ;</p>
    <p>Logical plan to physical plan Assign parallelism for each stageClarinet binds query to plan lower in the stack</p>
  </div>
  <div class="page">
    <p>Network aware placement and scheduling</p>
    <p>T1 T3</p>
    <p>T2 SELECT SELECT</p>
    <p>SELECTJOIN</p>
    <p>JOIN</p>
  </div>
  <div class="page">
    <p>Network aware placement and scheduling</p>
    <p>Task placement decided greedily one stage at a time  Minimize per stage run time</p>
    <p>T1 T3</p>
    <p>T2 SELECT SELECT</p>
    <p>SELECTJOIN</p>
    <p>JOIN</p>
  </div>
  <div class="page">
    <p>Network aware placement and scheduling</p>
    <p>Task placement decided greedily one stage at a time  Minimize per stage run time</p>
    <p>Scheduling of network transfers  Determines start times of inter-DC network transfers</p>
    <p>T1 T3</p>
    <p>T2 SELECT SELECT</p>
    <p>SELECTJOIN</p>
    <p>JOIN</p>
  </div>
  <div class="page">
    <p>Network aware placement and scheduling</p>
    <p>Task placement decided greedily one stage at a time  Minimize per stage run time</p>
    <p>Scheduling of network transfers  Determines start times of inter-DC network transfers  Formulate a Binary Integer Linear Program to solve</p>
    <p>scheduling  Factors transfer dependencies</p>
    <p>T1 T3</p>
    <p>T2 SELECT SELECT</p>
    <p>SELECTJOIN</p>
    <p>JOIN</p>
  </div>
  <div class="page">
    <p>How to extend the late-binding strategy to multiple queries?</p>
  </div>
  <div class="page">
    <p>Queries affect each others run time</p>
    <p>T2</p>
    <p>DC2</p>
    <p>T3</p>
    <p>DC3</p>
    <p>T1</p>
    <p>DC1</p>
  </div>
  <div class="page">
    <p>Queries affect each others run time</p>
    <p>T2</p>
    <p>DC2</p>
    <p>T3</p>
    <p>DC3</p>
    <p>T1</p>
    <p>DC1</p>
    <p>QUERY 1</p>
    <p>SELECT</p>
    <p>device == mobile</p>
    <p>;</p>
    <p>QUERY 2</p>
    <p>SELECT</p>
    <p>genre == pc</p>
    <p>;</p>
  </div>
  <div class="page">
    <p>Queries affect each others run time</p>
    <p>16 GB</p>
    <p>T1 T3</p>
    <p>T2</p>
    <p>T2</p>
    <p>DC2</p>
    <p>T3</p>
    <p>DC3</p>
    <p>T1</p>
    <p>DC1</p>
    <p>QUERY 1</p>
    <p>SELECT</p>
    <p>device == mobile</p>
    <p>;</p>
    <p>QUERY 2</p>
    <p>SELECT</p>
    <p>genre == pc</p>
    <p>;</p>
    <p>16 GB</p>
    <p>T1 T3</p>
    <p>T2</p>
    <p>Same query plan (Plan C) for Query 1 and Query 2</p>
  </div>
  <div class="page">
    <p>Queries affect each others run time</p>
    <p>16 GB</p>
    <p>T1 T3</p>
    <p>T2</p>
    <p>T2</p>
    <p>DC2</p>
    <p>T3</p>
    <p>DC3</p>
    <p>T1</p>
    <p>DC1</p>
    <p>QUERY 1</p>
    <p>SELECT</p>
    <p>device == mobile</p>
    <p>;</p>
    <p>QUERY 2</p>
    <p>SELECT</p>
    <p>genre == pc</p>
    <p>;</p>
    <p>16 GB</p>
    <p>T1 T3</p>
    <p>T2</p>
    <p>Same query plan (Plan C) for Query 1 and Query 2</p>
    <p>Contention increases query run time</p>
  </div>
  <div class="page">
    <p>Queries affect each others run time</p>
    <p>T2</p>
    <p>DC2</p>
    <p>T3</p>
    <p>DC3</p>
    <p>T1</p>
    <p>DC1</p>
    <p>QUERY 1</p>
    <p>SELECT</p>
    <p>device == mobile</p>
    <p>;</p>
    <p>QUERY 2</p>
    <p>SELECT</p>
    <p>genre == pc</p>
    <p>;</p>
    <p>16 GB</p>
    <p>T1 T3</p>
    <p>T2</p>
    <p>12 GB</p>
    <p>T2 T1</p>
    <p>T3</p>
    <p>Different query plans for Query 1 (Plan C) and Query 2 (Plan B)</p>
  </div>
  <div class="page">
    <p>Queries affect each others run time</p>
    <p>T2</p>
    <p>DC2</p>
    <p>T3</p>
    <p>DC3</p>
    <p>T1</p>
    <p>DC1</p>
    <p>QUERY 1</p>
    <p>SELECT</p>
    <p>device == mobile</p>
    <p>;</p>
    <p>QUERY 2</p>
    <p>SELECT</p>
    <p>genre == pc</p>
    <p>;</p>
    <p>16 GB</p>
    <p>T1 T3</p>
    <p>T2</p>
    <p>12 GB</p>
    <p>T2 T1</p>
    <p>T3</p>
    <p>Different query plans for Query 1 (Plan C) and Query 2 (Plan B)No contention of network links</p>
  </div>
  <div class="page">
    <p>Queries affect each others run time</p>
    <p>T2</p>
    <p>DC2</p>
    <p>T3</p>
    <p>DC3</p>
    <p>T1</p>
    <p>DC1</p>
    <p>QUERY 1</p>
    <p>SELECT</p>
    <p>device == mobile</p>
    <p>;</p>
    <p>QUERY 2</p>
    <p>SELECT</p>
    <p>genre == pc</p>
    <p>;</p>
    <p>16 GB</p>
    <p>T1 T3</p>
    <p>T2</p>
    <p>12 GB</p>
    <p>T2 T1</p>
    <p>T3</p>
    <p>Different query plans for Query 1 (Plan C) and Query 2 (Plan B)No contention of network links</p>
    <p>Choosing execution plans jointly for multiple queries improves performance</p>
  </div>
  <div class="page">
    <p>Iterative Shortest Job First</p>
    <p>QO</p>
    <p>QUERY A QUERY B</p>
    <p>QO</p>
    <p>QUERY C</p>
    <p>QO  Best combination  minimize average</p>
    <p>completion  Computationally intractable</p>
  </div>
  <div class="page">
    <p>Iterative Shortest Job First</p>
    <p>Clarinet</p>
    <p>QO</p>
    <p>QUERY A QUERY B</p>
    <p>QO</p>
    <p>QUERY C</p>
    <p>QO  Best combination  minimize average</p>
    <p>completion  Computationally intractable</p>
    <p>Iterative Shortest Job First (SJF) scheduling heuristic</p>
  </div>
  <div class="page">
    <p>Iterative Shortest Job First</p>
    <p>Clarinet</p>
    <p>QO</p>
    <p>QUERY A QUERY B</p>
    <p>QO</p>
    <p>QUERY C</p>
    <p>QO  Best combination  minimize average</p>
    <p>completion  Computationally intractable</p>
    <p>Iterative Shortest Job First (SJF) scheduling heuristic</p>
  </div>
  <div class="page">
    <p>Iterative Shortest Job First</p>
    <p>Clarinet</p>
    <p>QO</p>
    <p>QUERY A QUERY B</p>
    <p>QO</p>
    <p>QUERY C</p>
    <p>QO  Best combination  minimize average</p>
    <p>completion  Computationally intractable</p>
    <p>Iterative Shortest Job First (SJF) scheduling heuristic</p>
  </div>
  <div class="page">
    <p>Iterative Shortest Job First</p>
    <p>Clarinet</p>
    <p>QO</p>
    <p>QUERY A QUERY B</p>
    <p>QO</p>
    <p>QUERY C</p>
    <p>QO  Best combination  minimize average</p>
    <p>completion  Computationally intractable</p>
    <p>Iterative Shortest Job First (SJF) scheduling heuristic</p>
    <p>Reserve bandwidth to guarantee completion time</p>
    <p>B1Link 1</p>
    <p>Link 2</p>
  </div>
  <div class="page">
    <p>Iterative Shortest Job First</p>
    <p>Clarinet</p>
    <p>QO</p>
    <p>QUERY A QUERY B</p>
    <p>QO</p>
    <p>QUERY C</p>
    <p>QO  Best combination  minimize average</p>
    <p>completion  Computationally intractable</p>
    <p>Iterative Shortest Job First (SJF) scheduling heuristic</p>
    <p>Reserve bandwidth to guarantee completion time</p>
    <p>B1Link 1</p>
    <p>Link 2</p>
  </div>
  <div class="page">
    <p>Iterative Shortest Job First</p>
    <p>Clarinet</p>
    <p>QO</p>
    <p>QUERY A QUERY B</p>
    <p>QO</p>
    <p>QUERY C</p>
    <p>QO  Best combination  minimize average</p>
    <p>completion  Computationally intractable</p>
    <p>Iterative Shortest Job First (SJF) scheduling heuristic</p>
    <p>Reserve bandwidth to guarantee completion time</p>
    <p>B1Link 1</p>
    <p>Link 2</p>
  </div>
  <div class="page">
    <p>Iterative Shortest Job First</p>
    <p>Clarinet</p>
    <p>QO</p>
    <p>QUERY A QUERY B</p>
    <p>QO</p>
    <p>QUERY C</p>
    <p>QO  Best combination  minimize average</p>
    <p>completion  Computationally intractable</p>
    <p>Iterative Shortest Job First (SJF) scheduling heuristic</p>
    <p>Reserve bandwidth to guarantee completion time</p>
    <p>B1Link 1</p>
    <p>Link 2</p>
  </div>
  <div class="page">
    <p>Iterative Shortest Job First</p>
    <p>Clarinet</p>
    <p>QO</p>
    <p>QUERY A QUERY B</p>
    <p>QO</p>
    <p>QUERY C</p>
    <p>QO  Best combination  minimize average</p>
    <p>completion  Computationally intractable</p>
    <p>Iterative Shortest Job First (SJF) scheduling heuristic</p>
    <p>Reserve bandwidth to guarantee completion time</p>
    <p>A1</p>
    <p>A2</p>
    <p>B1Link 1</p>
    <p>Link 2</p>
  </div>
  <div class="page">
    <p>Avoid fragmentation and improve completion time</p>
  </div>
  <div class="page">
    <p>Avoid fragmentation and improve completion time</p>
    <p>SJF &amp; reservation leads to bandwidth fragmentation</p>
  </div>
  <div class="page">
    <p>Avoid fragmentation and improve completion time</p>
    <p>SJF &amp; reservation leads to bandwidth fragmentation</p>
    <p>A1</p>
    <p>A2</p>
    <p>B1Link 1</p>
    <p>Link 2</p>
    <p>Scheduled in SJF order</p>
  </div>
  <div class="page">
    <p>Avoid fragmentation and improve completion time</p>
    <p>SJF &amp; reservation leads to bandwidth fragmentation</p>
    <p>A1</p>
    <p>A2</p>
    <p>B1Link 1</p>
    <p>Link 2</p>
    <p>Scheduled in SJF order</p>
    <p>Dominant transfers execute sequentially</p>
  </div>
  <div class="page">
    <p>Avoid fragmentation and improve completion time</p>
    <p>SJF &amp; reservation leads to bandwidth fragmentation</p>
    <p>Extended idling</p>
    <p>A1</p>
    <p>A2</p>
    <p>B1Link 1</p>
    <p>Link 2</p>
    <p>Scheduled in SJF order</p>
    <p>Dominant transfers execute sequentially</p>
  </div>
  <div class="page">
    <p>Avoid fragmentation and improve completion time</p>
    <p>SJF &amp; reservation leads to bandwidth fragmentation</p>
    <p>Alternate schedule with same query plans</p>
    <p>B1A1</p>
    <p>A2</p>
    <p>Extended idling</p>
    <p>A1</p>
    <p>A2</p>
    <p>B1Link 1</p>
    <p>Link 2</p>
    <p>Scheduled in SJF order</p>
    <p>Dominant transfers execute sequentially</p>
  </div>
  <div class="page">
    <p>Avoid fragmentation and improve completion time</p>
    <p>SJF &amp; reservation leads to bandwidth fragmentation</p>
    <p>Alternate schedule with same query plans</p>
    <p>B1A1</p>
    <p>A2</p>
    <p>Extended idling</p>
    <p>A1</p>
    <p>A2</p>
    <p>B1Link 1</p>
    <p>Link 2</p>
    <p>Scheduled in SJF order</p>
    <p>Dominant transfers execute sequentiallyRe-arranging transfers resulting in deviation from</p>
    <p>SJF schedule can help</p>
  </div>
  <div class="page">
    <p>k-Shortest Jobs First Heuristic</p>
    <p>Link 1</p>
    <p>Link 2</p>
    <p>Link n Offline schedule</p>
    <p>t</p>
  </div>
  <div class="page">
    <p>k-Shortest Jobs First Heuristic</p>
    <p>Link 1</p>
    <p>Link 2</p>
    <p>Identify transfers of k-shortest yet incomplete jobs</p>
    <p>Link n Offline schedule</p>
    <p>t</p>
  </div>
  <div class="page">
    <p>k-Shortest Jobs First Heuristic</p>
    <p>Link 1</p>
    <p>Link 2</p>
    <p>Identify transfers of k-shortest yet incomplete jobs  Relax transfer schedule  Start as soon as link is free and task is available</p>
    <p>Link n Offline schedule</p>
    <p>t</p>
  </div>
  <div class="page">
    <p>k-Shortest Jobs First Heuristic</p>
    <p>Link 1</p>
    <p>Link 2</p>
    <p>Identify transfers of k-shortest yet incomplete jobs  Relax transfer schedule  Start as soon as link is free and task is available  Best k Prior observations (or) through offline simulations</p>
    <p>Link n Offline schedule</p>
    <p>t</p>
  </div>
  <div class="page">
    <p>Clarinet Implementation</p>
    <p>QUERY 1 QUERY 2 QUERY 3</p>
    <p>QO QO QO Existing Query Optimizers</p>
    <p>Batch of queries</p>
  </div>
  <div class="page">
    <p>Clarinet Implementation</p>
    <p>QUERY 1 QUERY 2 QUERY 3</p>
    <p>QO QO QO Existing Query Optimizers  Modified Hive to generate multiple</p>
    <p>plans</p>
    <p>Batch of queries</p>
  </div>
  <div class="page">
    <p>Clarinet Implementation</p>
    <p>QUERY 1 QUERY 2 QUERY 3</p>
    <p>QO QO QO Existing Query Optimizers  Modified Hive to generate multiple</p>
    <p>plans  QOs control set of generated plans  Existing optimizations are applied</p>
    <p>Push down Select  Partition pruning</p>
    <p>Batch of queries</p>
  </div>
  <div class="page">
    <p>Clarinet Implementation</p>
    <p>QUERY 1 QUERY 2 QUERY 3</p>
    <p>QO QO QO Existing Query Optimizers  Modified Hive to generate multiple</p>
    <p>plans  QOs control set of generated plans  Existing optimizations are applied</p>
    <p>Push down Select  Partition pruning</p>
    <p>Batch of queries</p>
    <p>Enforces Clarinets schedule</p>
    <p>Clarinet</p>
    <p>Execution framework</p>
  </div>
  <div class="page">
    <p>Clarinet Implementation</p>
    <p>QUERY 1 QUERY 2 QUERY 3</p>
    <p>QO QO QO Existing Query Optimizers  Modified Hive to generate multiple</p>
    <p>plans  QOs control set of generated plans  Existing optimizations are applied</p>
    <p>Push down Select  Partition pruning</p>
    <p>Batch of queries</p>
    <p>Enforces Clarinets schedule  Modified Tezs DAGScheduler</p>
    <p>Clarinet</p>
    <p>Execution framework</p>
  </div>
  <div class="page">
    <p>Clarinet Implementation</p>
    <p>QUERY 1 QUERY 2 QUERY 3</p>
    <p>QO QO QO Existing Query Optimizers  Modified Hive to generate multiple</p>
    <p>plans  QOs control set of generated plans  Existing optimizations are applied</p>
    <p>Push down Select  Partition pruning</p>
    <p>Batch of queries Online query arrivals</p>
    <p>Enforces Clarinets schedule  Modified Tezs DAGScheduler  Fairness guarantees</p>
    <p>Clarinet</p>
    <p>Execution framework</p>
  </div>
  <div class="page">
    <p>Evaluation</p>
    <p>Compare Clarinet with following GDA approaches:</p>
  </div>
  <div class="page">
    <p>Evaluation</p>
    <p>Compare Clarinet with following GDA approaches:</p>
  </div>
  <div class="page">
    <p>Evaluation</p>
    <p>: WAN agnostic task placement + scheduling</p>
    <p>Compare Clarinet with following GDA approaches:</p>
  </div>
  <div class="page">
    <p>Evaluation</p>
    <p>: WAN agnostic task placement + scheduling : WAN aware task placement across DCs</p>
    <p>Compare Clarinet with following GDA approaches:</p>
  </div>
  <div class="page">
    <p>Evaluation</p>
    <p>: WAN agnostic task placement + scheduling : WAN aware task placement across DCs : Distributed filtering + central aggregation</p>
    <p>Compare Clarinet with following GDA approaches:</p>
  </div>
  <div class="page">
    <p>Evaluation</p>
    <p>: WAN agnostic task placement + scheduling : WAN aware task placement across DCs : Distributed filtering + central aggregation</p>
    <p>Compare Clarinet with following GDA approaches:</p>
    <p>Geo-Distributed Analytics stack across 10 EC2 regions</p>
  </div>
  <div class="page">
    <p>Evaluation</p>
    <p>: WAN agnostic task placement + scheduling : WAN aware task placement across DCs : Distributed filtering + central aggregation</p>
    <p>Compare Clarinet with following GDA approaches:</p>
    <p>Geo-Distributed Analytics stack across 10 EC2 regions</p>
    <p>Workload:  30 batches of 12 randomly chosen TPC-DS queries</p>
  </div>
  <div class="page">
    <p>Evaluation: Reduction in average completion time</p>
    <p>GDA Approach Vs. Hive</p>
    <p>Average Gains</p>
    <p>Clarinet 2.7x</p>
    <p>Hive + Iridium 1.5x</p>
    <p>Hive + Reducers in single DC</p>
  </div>
  <div class="page">
    <p>Evaluation: Reduction in average completion time</p>
    <p>GDA Approach Vs. Hive</p>
    <p>Average Gains</p>
    <p>Clarinet 2.7x</p>
    <p>Hive + Iridium 1.5x</p>
    <p>Hive + Reducers in single DC</p>
    <p>Clarinet chooses a different plan for 75% of queries</p>
  </div>
  <div class="page">
    <p>Evaluation: Reduction in average completion time</p>
    <p>C D</p>
    <p>F</p>
    <p>Link ID sorted by bandwidth</p>
    <p>WAN bandwidth distribution</p>
    <p>Hive bytes distribution</p>
    <p>Clarinet bytes distribution</p>
    <p>Data from a single batch 12 queries</p>
    <p>GDA Approach Vs. Hive</p>
    <p>Average Gains</p>
    <p>Clarinet 2.7x</p>
    <p>Hive + Iridium 1.5x</p>
    <p>Hive + Reducers in single DC</p>
    <p>Clarinet chooses a different plan for 75% of queries</p>
  </div>
  <div class="page">
    <p>Evaluation: Reduction in average completion time</p>
    <p>C D</p>
    <p>F</p>
    <p>Link ID sorted by bandwidth</p>
    <p>WAN bandwidth distribution</p>
    <p>Hive bytes distribution</p>
    <p>Clarinet bytes distribution</p>
    <p>Data from a single batch 12 queries</p>
    <p>GDA Approach Vs. Hive</p>
    <p>Average Gains</p>
    <p>Clarinet 2.7x</p>
    <p>Hive + Iridium 1.5x</p>
    <p>Hive + Reducers in single DC</p>
    <p>Clarinet chooses a different plan for 75% of queries</p>
  </div>
  <div class="page">
    <p>Evaluation: Reduction in average completion time</p>
    <p>C D</p>
    <p>F</p>
    <p>Link ID sorted by bandwidth</p>
    <p>WAN bandwidth distribution</p>
    <p>Hive bytes distribution</p>
    <p>Clarinet bytes distribution</p>
    <p>Data from a single batch 12 queries</p>
    <p>GDA Approach Vs. Hive</p>
    <p>Average Gains</p>
    <p>Clarinet 2.7x</p>
    <p>Hive + Iridium 1.5x</p>
    <p>Hive + Reducers in single DC</p>
    <p>Clarinet chooses a different plan for 75% of queries</p>
  </div>
  <div class="page">
    <p>Evaluation: Optimization overhead</p>
  </div>
  <div class="page">
    <p>Evaluation: Optimization overhead</p>
  </div>
  <div class="page">
    <p>Evaluation: Optimization overhead</p>
  </div>
  <div class="page">
    <p>Evaluation: Optimization overhead</p>
  </div>
  <div class="page">
    <p>Evaluation: Optimization overhead</p>
    <p>Insignificant w.r.t. query running times (order of 10s of minutes)</p>
  </div>
  <div class="page">
    <p>Summary</p>
    <p>WAN-awareness in QO + cross-layer optimization</p>
    <p>Distributed Storage Layer</p>
    <p>Distributed Execution Layer</p>
    <p>Query Optimizer Clarinet</p>
  </div>
  <div class="page">
    <p>Summary</p>
    <p>WAN-awareness in QO + cross-layer optimization</p>
    <p>Presented a scalable way to implement multi-query optimization with minimal overhead</p>
    <p>Distributed Storage Layer</p>
    <p>Distributed Execution Layer</p>
    <p>Query Optimizer Clarinet</p>
  </div>
  <div class="page">
    <p>Summary</p>
    <p>WAN-awareness in QO + cross-layer optimization</p>
    <p>Presented a scalable way to implement multi-query optimization with minimal overhead</p>
    <p>Distributed Storage Layer</p>
    <p>Distributed Execution Layer</p>
    <p>Query Optimizer Clarinet</p>
  </div>
</Presentation>
