<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Dennis Felsch 1, Martin Grothe 1, Jrg Schwenk 1, Adam Czubak 2, Marcin Szymanek 2</p>
    <p>THE DANGERS OF KEY REUSE: PRACTICAL ATTACKS ON IPSEC IKE</p>
  </div>
  <div class="page">
    <p>VPNs (Virtual Private Networks)</p>
    <p>Internet</p>
    <p>Icons from KDE Oxygen theme licensed under GNU LGPLv3, http://www.kde.org/</p>
  </div>
  <div class="page">
    <p>IPsec (Internet Protocol Security)</p>
    <p>Internet</p>
    <p>Transport</p>
    <p>Network</p>
    <p>Access</p>
    <p>TCP/UDP</p>
    <p>IP</p>
    <p>TCP/UDP</p>
    <p>IP</p>
    <p>IPsec IPsec</p>
    <p>Application</p>
    <p>integrity authenticity confidentitiality</p>
    <p>Data Data</p>
  </div>
  <div class="page">
    <p>IKE (Internet Key Exchange)</p>
    <p>The handshake protocol of IPsec  Standardized in two major versions  IKEv1: Published in 1998, declared obsolete by the IETF  nevertheless included in all implementations</p>
    <p>IKEv2: Published in 2005, current version</p>
  </div>
  <div class="page">
    <p>IKEv1</p>
    <p>Internet</p>
    <p>Transport</p>
    <p>Network</p>
    <p>Access</p>
    <p>UDP</p>
    <p>IP</p>
    <p>UDP</p>
    <p>IP</p>
    <p>Application IKEv1 IKEv1Negotiation</p>
    <p>Authentication Key Agreement</p>
    <p>Key Confirmation</p>
  </div>
  <div class="page">
    <p>m1</p>
    <p>m2</p>
    <p>m1= {proposals}</p>
    <p>m3= g x, anc. data</p>
    <p>m2 = selected proposal</p>
    <p>m4= g y , anc. data</p>
    <p>m3</p>
    <p>m4</p>
    <p>m5</p>
    <p>m6</p>
    <p>m5 = Enc(MACI | data)</p>
    <p>IKEv1 Protocol Flow Initiator Responder</p>
  </div>
  <div class="page">
    <p>IKEv1 Authentication Methods</p>
    <p>Negotiation</p>
    <p>Authentication Key Agreement</p>
    <p>Key Confirmation</p>
  </div>
  <div class="page">
    <p>m1</p>
    <p>m2</p>
    <p>m3</p>
    <p>m4</p>
    <p>m5</p>
    <p>m6</p>
    <p>m1= {proposals}</p>
    <p>m3= g x, anc. data</p>
    <p>m2 = selected proposal</p>
    <p>m4= g y , anc. data</p>
    <p>m5 = Enc(MACI | data)</p>
    <p>IKEv1 Protocol Flow With PKE Authentication</p>
    <p>m3= g x, Encpk(nI)</p>
    <p>m4= g y, Encpk(nR)</p>
    <p>Initiator Responder</p>
  </div>
  <div class="page">
    <p>What if implementations contained Bleichenbacher oracles?</p>
  </div>
  <div class="page">
    <p>Padding oracle attack  RSA PKCS#1 v1.5 encryption padding:</p>
    <p>Attack requires oracle that tells if padding is valid</p>
    <p>Bleichenbachers Attack In Two Slides</p>
  </div>
  <div class="page">
    <p>Bleichenbachers Attack In Two Slides</p>
    <p>m Sender Receiver</p>
    <p>m' Attacker</p>
    <p>valid / invalid</p>
    <p>m''</p>
    <p>valid / invalid</p>
    <p>Leaks the plaintext of message m to the attacker</p>
  </div>
  <div class="page">
    <p>m1 m2</p>
    <p>m4= EncpkB(nRA),  m3</p>
    <p>m6</p>
    <p>m5</p>
    <p>Attack Idea On IKEv1 With PKE Authentication Attacker Responder BResponder A</p>
    <p>Decrypt nRA Derive Keys</p>
    <p>Keep A</p>
    <p>waiting</p>
    <p>Attacker impersonates Responder B !</p>
  </div>
  <div class="page">
    <p>Where To Find The PKE And RPKE Modes?</p>
    <p>Cisco includes PKE authentication in IOS  Huawei includes RPKE in some security appliances  Implementations in Clavisters cOS and ZyXELs</p>
    <p>ZyWALL USG devices broken</p>
  </div>
  <div class="page">
    <p>Where To Find The PKE And RPKE Modes?</p>
  </div>
  <div class="page">
    <p>Case Study: Bleichenbacher Oracle In Cisco IOS 1/3</p>
    <p>Test device:  Cisco ASR 1001-X router  IOS XE 03.16.02.S</p>
  </div>
  <div class="page">
    <p>Case Study: Bleichenbacher Oracle In Cisco IOS 2/3</p>
    <p>m1</p>
    <p>m2</p>
    <p>m3</p>
    <p>m4</p>
    <p>m1= proposal with PKE</p>
    <p>m2 = proposal with PKE</p>
    <p>Initiator Cisco IOS</p>
    <p>m3</p>
    <p>m2</p>
    <p>m3 with valid padding</p>
    <p>wait 1 secondm3 with invalid padding</p>
    <p>m2 = proposal with PKE</p>
  </div>
  <div class="page">
    <p>Case Study: Bleichenbacher Oracle In Cisco IOS 3/3</p>
    <p>IOS cancels IKEv1 handshake after 60 seconds at the latest  Public key 1024 bits  ~850 responses per second  60  850 = 51,000 requests per handshake</p>
    <p>Empirical study with a simulator: 26 % of attacks require less than 51,000 requests</p>
  </div>
  <div class="page">
    <p>Cisco IOS  Simulator vs. Real Hardware</p>
    <p>Ciscos IKE handshake implementation is not optimized for throughput</p>
    <p>Cryptographic calculations for IKE are done by CPU  m1/m2 negotiations take a lot of time</p>
    <p>Decryption attack with 19,000 requests took 13 minutes</p>
  </div>
  <div class="page">
    <p>Cisco IOS  Is An Attack Realistic?</p>
    <p>A too slow attack does not permanently lock out attackers</p>
    <p>Still dangerous if the victim has deployed multiple responders sharing one key pair  e. g. for load balancing</p>
  </div>
  <div class="page">
    <p>Bleichenbacher Oracles In (R)PKE Implementations</p>
    <p>Cisco: CVE-2018-0131  Huawei: CVE-2017-17305  Clavister: CVE-2018-8753  ZyXEL: CVE-2018-9129</p>
    <p>Patches are available!</p>
  </div>
  <div class="page">
    <p>Key Reuse</p>
    <p>Maintaining individual key pairs for all variants of IKE?  Common practice: A single RSA key pair  Actual security depends on  cross-ciphersuite,  cross-version, and  cross-protocol security</p>
  </div>
  <div class="page">
    <p>Bleichenbachers Attack &amp; Signatures</p>
    <p>For RSA:  A decryption &amp; creating a signature is the same</p>
    <p>operation  Bleichenbachers attack can forge a signature</p>
  </div>
  <div class="page">
    <p>Attack Against IKEv2 With Signatures</p>
    <p>Signature Based Authentication  Supported by IKEv1 and IKEv2  IKEv2 on Cisco router: 4 minutes time</p>
    <p>For Cisco: Simulation succeeds in 22% of attacks  Real hardware again lacks performance</p>
  </div>
  <div class="page">
    <p>Additional Contributions In The Paper</p>
    <p>A dictionary attack against PSK authentication in main mode (CVE-2018-5389)</p>
    <p>Message flow diagrams of all IKE variants  Description of the oracles in Huaweis, Clavisters, and</p>
    <p>ZyXELs implementations  Description of our parallelized Bleichenbacher attacker</p>
  </div>
  <div class="page">
    <p>Questions?</p>
    <p>Dennis Felsch</p>
    <p>Ruhr University Bochum Horst Grtz Institute for IT-Security Chair for Network and Data Security</p>
    <p>dennis.felsch@rub.de @dfelsch</p>
    <p>https://web-in-security.blogspot.de</p>
  </div>
</Presentation>
