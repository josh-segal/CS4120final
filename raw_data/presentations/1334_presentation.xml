<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Austin T. Clements</p>
    <p>Irfan Ahmad Murali Vilayannur Jinyuan Li</p>
    <p>VMware, Inc. MIT CSAIL</p>
  </div>
  <div class="page">
    <p>Storage Area Networks</p>
  </div>
  <div class="page">
    <p>Storage Area Networks</p>
  </div>
  <div class="page">
    <p>Storage Area Networks</p>
  </div>
  <div class="page">
    <p>Storage Area Networks</p>
  </div>
  <div class="page">
    <p>Storage Area Networks</p>
  </div>
  <div class="page">
    <p>Storage Area Networks</p>
  </div>
  <div class="page">
    <p>Storage Area Networks</p>
  </div>
  <div class="page">
    <p>Deduplication</p>
  </div>
  <div class="page">
    <p>Deduplication</p>
  </div>
  <div class="page">
    <p>Deduplication</p>
  </div>
  <div class="page">
    <p>Deduplication</p>
  </div>
  <div class="page">
    <p>Deduplication</p>
  </div>
  <div class="page">
    <p>Deduplication</p>
  </div>
  <div class="page">
    <p>Deduplication</p>
  </div>
  <div class="page">
    <p>Deduplication</p>
  </div>
  <div class="page">
    <p>The Problem</p>
    <p>Slow  Lots of IO in the write path. Cant cache the index.</p>
    <p>Very Slow  Writes require allocation and thus coordination. No hope of disk locality.</p>
    <p>Hopelessly Slow  Multi-host lock contention on shared index.</p>
  </div>
  <div class="page">
    <p>The Problem</p>
    <p>Slow  Lots of IO in the write path. Cant cache the index.</p>
    <p>Very Slow  Writes require allocation and thus coordination. No hope of disk locality.</p>
    <p>Hopelessly Slow  Multi-host lock contention on shared index.</p>
  </div>
  <div class="page">
    <p>The Problem</p>
    <p>Slow  Lots of IO in the write path. Cant cache the index.</p>
    <p>Very Slow  Writes require allocation and thus coordination. No hope of disk locality.</p>
    <p>Hopelessly Slow  Multi-host lock contention on shared index.</p>
  </div>
  <div class="page">
    <p>Three-Stage Deduplication</p>
    <p>Decentralized Deduplication</p>
    <p>Out-of-band deduplication of live, primary storage Process duplicates efficiently, in large batches Minimize contention on the index Resilient to stale index information Unique blocks remain mutable and sequential</p>
    <p>= No overhead for blocks that dont benefit from deduplication</p>
  </div>
  <div class="page">
    <p>Three-Stage Deduplication</p>
    <p>DeDe</p>
    <p>Out-of-band deduplication of live, primary storage Process duplicates efficiently, in large batches Minimize contention on the index Resilient to stale index information Unique blocks remain mutable and sequential</p>
    <p>= No overhead for blocks that dont benefit from deduplication</p>
  </div>
  <div class="page">
    <p>Three-Stage Deduplication</p>
    <p>DeDe</p>
    <p>Out-of-band deduplication of live, primary storage Process duplicates efficiently, in large batches Minimize contention on the index Resilient to stale index information Unique blocks remain mutable and sequential</p>
    <p>= No overhead for blocks that dont benefit from deduplication</p>
  </div>
  <div class="page">
    <p>Three-Stage Deduplication</p>
    <p>DeDe</p>
    <p>Out-of-band deduplication of live, primary storage Process duplicates efficiently, in large batches Minimize contention on the index Resilient to stale index information Unique blocks remain mutable and sequential</p>
    <p>= No overhead for blocks that dont benefit from deduplication</p>
  </div>
  <div class="page">
    <p>Three-Stage Deduplication</p>
    <p>DeDe</p>
  </div>
  <div class="page">
    <p>Three-Stage Deduplication</p>
    <p>DeDe</p>
  </div>
  <div class="page">
    <p>Three-Stage Deduplication</p>
    <p>DeDe</p>
  </div>
  <div class="page">
    <p>Three-Stage Deduplication</p>
    <p>DeDe</p>
  </div>
  <div class="page">
    <p>Three-Stage Deduplication</p>
    <p>DeDe</p>
    <p>f4bea9.. f2a4d2.. 0e7a26..</p>
    <p>ab7373.. 4ee207.. 9b1f28..</p>
  </div>
  <div class="page">
    <p>Three-Stage Deduplication</p>
    <p>DeDe</p>
    <p>f4bea9.. f2a4d2.. 0e7a26..</p>
    <p>ab7373.. 4ee207.. 9b1f28..</p>
  </div>
  <div class="page">
    <p>Three-Stage Deduplication</p>
    <p>DeDe</p>
    <p>f4bea9.. f2a4d2.. 0e7a26..</p>
    <p>ab7373.. 4ee207.. 9b1f28..</p>
  </div>
  <div class="page">
    <p>Three-Stage Deduplication</p>
    <p>DeDe</p>
    <p>f4bea9.. f2a4d2.. 0e7a26..</p>
    <p>ab7373.. 4ee207.. 9b1f28..</p>
  </div>
  <div class="page">
    <p>Three-Stage Deduplication</p>
    <p>DeDe</p>
    <p>ab7373.. 4ee207.. 9b1f28..</p>
  </div>
  <div class="page">
    <p>Three-Stage Deduplication</p>
    <p>DeDe</p>
    <p>ab7373.. 4ee207.. 9b1f28..</p>
  </div>
  <div class="page">
    <p>Three-Stage Deduplication</p>
    <p>DeDe</p>
    <p>ab7373.. 4ee207.. 9b1f28..</p>
  </div>
  <div class="page">
    <p>Three-Stage Deduplication</p>
    <p>DeDe</p>
  </div>
  <div class="page">
    <p>Three-Stage Deduplication</p>
    <p>DeDe</p>
  </div>
  <div class="page">
    <p>Three-Stage Deduplication</p>
    <p>DeDe</p>
    <p>?</p>
    <p>?</p>
    <p>?</p>
    <p>?</p>
  </div>
  <div class="page">
    <p>Three-Stage Deduplication</p>
    <p>DeDe</p>
    <p>?</p>
    <p>?</p>
    <p>?</p>
    <p>?</p>
  </div>
  <div class="page">
    <p>Three-Stage Deduplication</p>
    <p>DeDe</p>
    <p>?</p>
    <p>?</p>
    <p>?</p>
    <p>?</p>
  </div>
  <div class="page">
    <p>Implementation</p>
  </div>
  <div class="page">
    <p>Implementation</p>
  </div>
  <div class="page">
    <p>Implementation</p>
  </div>
  <div class="page">
    <p>Implementation</p>
  </div>
  <div class="page">
    <p>Implementation</p>
  </div>
  <div class="page">
    <p>VMFS</p>
    <p>Compare-and-share</p>
  </div>
  <div class="page">
    <p>VMFS</p>
    <p>Compare-and-share</p>
    <p>?</p>
  </div>
  <div class="page">
    <p>VMFS</p>
    <p>Compare-and-share</p>
  </div>
  <div class="page">
    <p>VMFS</p>
    <p>Compare-and-share</p>
    <p>DeDe finds duplicates. VMFS eliminates them.</p>
  </div>
  <div class="page">
    <p>Write Monitor</p>
    <p>A lightweight kernel module monitors writes, computes hashes It buffers the write log in userspace before writing it to disk Safe to buffer the log because index is resilient 150 MB of regular writes  1 MB sequential log write</p>
  </div>
  <div class="page">
    <p>Write Monitor</p>
    <p>A lightweight kernel module monitors writes, computes hashes</p>
    <p>It buffers the write log in userspace before writing it to disk Safe to buffer the log because index is resilient 150 MB of regular writes  1 MB sequential log write</p>
  </div>
  <div class="page">
    <p>Write Monitor</p>
    <p>A lightweight kernel module monitors writes, computes hashes It buffers the write log in userspace before writing it to disk</p>
    <p>Safe to buffer the log because index is resilient 150 MB of regular writes  1 MB sequential log write</p>
  </div>
  <div class="page">
    <p>Write Monitor</p>
    <p>A lightweight kernel module monitors writes, computes hashes It buffers the write log in userspace before writing it to disk</p>
    <p>Safe to buffer the log because index is resilient 150 MB of regular writes  1 MB sequential log write</p>
  </div>
  <div class="page">
    <p>Write Monitor</p>
    <p>A lightweight kernel module monitors writes, computes hashes It buffers the write log in userspace before writing it to disk Safe to buffer the log because index is resilient</p>
  </div>
  <div class="page">
    <p>Write Monitor</p>
    <p>A lightweight kernel module monitors writes, computes hashes It buffers the write log in userspace before writing it to disk Safe to buffer the log because index is resilient 150 MB of regular writes  1 MB sequential log write</p>
  </div>
  <div class="page">
    <p>The Index</p>
    <p>Map from hashes to block locators, list sorted by hash</p>
    <p>Unique blocks are located in files and remain mutable A virtual arena stores COW references to all shared blocks</p>
  </div>
  <div class="page">
    <p>The Index</p>
    <p>Unique</p>
    <p>Shared</p>
    <p>Map from hashes to block locators, list sorted by hash</p>
    <p>Unique blocks are located in files and remain mutable A virtual arena stores COW references to all shared blocks</p>
  </div>
  <div class="page">
    <p>The Index</p>
    <p>Unique</p>
    <p>Shared</p>
    <p>Map from hashes to block locators, list sorted by hash Unique blocks are located in files and remain mutable</p>
    <p>A virtual arena stores COW references to all shared blocks</p>
  </div>
  <div class="page">
    <p>The Index</p>
    <p>Unique</p>
    <p>Shared</p>
    <p>Map from hashes to block locators, list sorted by hash Unique blocks are located in files and remain mutable</p>
    <p>A virtual arena stores COW references to all shared blocks</p>
  </div>
  <div class="page">
    <p>The Index</p>
    <p>Unique</p>
    <p>Shared</p>
    <p>Map from hashes to block locators, list sorted by hash Unique blocks are located in files and remain mutable</p>
    <p>A virtual arena stores COW references to all shared blocks</p>
  </div>
  <div class="page">
    <p>The Index</p>
    <p>Unique</p>
    <p>Shared</p>
    <p>Map from hashes to block locators, list sorted by hash Unique blocks are located in files and remain mutable A virtual arena stores COW references to all shared blocks</p>
  </div>
  <div class="page">
    <p>The Index</p>
    <p>Unique</p>
    <p>Shared</p>
    <p>Map from hashes to block locators, list sorted by hash Unique blocks are located in files and remain mutable A virtual arena stores COW references to all shared blocks</p>
  </div>
  <div class="page">
    <p>The Index</p>
    <p>Unique</p>
    <p>Shared</p>
    <p>Map from hashes to block locators, list sorted by hash Unique blocks are located in files and remain mutable A virtual arena stores COW references to all shared blocks</p>
  </div>
  <div class="page">
    <p>Indexing and Duplicate Elimination</p>
    <p>Unique</p>
    <p>Shared</p>
  </div>
  <div class="page">
    <p>Indexing and Duplicate Elimination</p>
    <p>Unique</p>
    <p>Shared</p>
  </div>
  <div class="page">
    <p>Indexing and Duplicate Elimination</p>
    <p>Unique</p>
    <p>Shared</p>
  </div>
  <div class="page">
    <p>Indexing and Duplicate Elimination</p>
    <p>Unique</p>
    <p>Shared</p>
  </div>
  <div class="page">
    <p>Indexing and Duplicate Elimination</p>
    <p>Unique</p>
    <p>Shared</p>
  </div>
  <div class="page">
    <p>Indexing and Duplicate Elimination</p>
    <p>Unique</p>
    <p>Shared 12067c.. 6cd412.. c277d6..</p>
  </div>
  <div class="page">
    <p>Indexing and Duplicate Elimination</p>
    <p>Unique</p>
    <p>Shared12067c.. 6cd412.. c277d6..</p>
  </div>
  <div class="page">
    <p>Indexing and Duplicate Elimination</p>
    <p>Unique</p>
    <p>Shared 6cd412.. c277d6..</p>
  </div>
  <div class="page">
    <p>Indexing and Duplicate Elimination</p>
    <p>Unique</p>
    <p>Shared 6cd412.. c277d6..</p>
  </div>
  <div class="page">
    <p>Indexing and Duplicate Elimination</p>
    <p>Unique</p>
    <p>Shared</p>
  </div>
  <div class="page">
    <p>Indexing and Duplicate Elimination</p>
    <p>Unique</p>
    <p>Shared</p>
    <p>c277d6..</p>
  </div>
  <div class="page">
    <p>Indexing and Duplicate Elimination</p>
    <p>Unique</p>
    <p>Shared</p>
    <p>c277d6..</p>
  </div>
  <div class="page">
    <p>Indexing and Duplicate Elimination</p>
    <p>Unique</p>
    <p>Shared</p>
    <p>c277d6..</p>
  </div>
  <div class="page">
    <p>Indexing and Duplicate Elimination</p>
    <p>Unique</p>
    <p>Shared</p>
    <p>?</p>
    <p>c277d6..</p>
  </div>
  <div class="page">
    <p>Indexing and Duplicate Elimination</p>
    <p>Unique</p>
    <p>Shared</p>
    <p>c277d6..</p>
  </div>
  <div class="page">
    <p>Indexing and Duplicate Elimination</p>
    <p>Unique</p>
    <p>Shared</p>
    <p>c277d6..</p>
  </div>
  <div class="page">
    <p>Indexing and Duplicate Elimination</p>
    <p>Unique</p>
    <p>Shared</p>
  </div>
  <div class="page">
    <p>Indexing and Duplicate Elimination</p>
    <p>Unique</p>
    <p>Shared</p>
  </div>
  <div class="page">
    <p>Indexing and Duplicate Elimination</p>
    <p>Unique</p>
    <p>Shared</p>
  </div>
  <div class="page">
    <p>Indexing and Duplicate Elimination</p>
    <p>Unique</p>
    <p>Shared</p>
  </div>
  <div class="page">
    <p>Phew.</p>
  </div>
  <div class="page">
    <p>Evaluation</p>
    <p>How much space does DeDe save?</p>
    <p>How much overhead does DeDe introduce?</p>
    <p>How fast can DeDe deduplicate?</p>
  </div>
  <div class="page">
    <p>Evaluation</p>
    <p>How much space does DeDe save?</p>
    <p>How much overhead does DeDe introduce?</p>
    <p>How fast can DeDe deduplicate?</p>
  </div>
  <div class="page">
    <p>Evaluation</p>
    <p>How much space does DeDe save?</p>
    <p>How much overhead does DeDe introduce?</p>
    <p>How fast can DeDe deduplicate?</p>
  </div>
  <div class="page">
    <p>Evaluation</p>
    <p>How much space does DeDe save?</p>
    <p>How much overhead does DeDe introduce?</p>
    <p>How fast can DeDe deduplicate?</p>
  </div>
  <div class="page">
    <p>Space Savings: VDI Cluster</p>
    <p>Corporate Virtual Desktop Infrastructure cluster Desktop XP VMs 612 months of active use Originally cloned from small number of base images</p>
    <p>...</p>
    <p>113 VMs</p>
    <p>1.9 TB</p>
  </div>
  <div class="page">
    <p>Space Savings: VDI Cluster</p>
    <p>Corporate Virtual Desktop Infrastructure cluster Desktop XP VMs 612 months of active use Originally cloned from small number of base images</p>
    <p>...</p>
    <p>113 VMs</p>
    <p>1.9 TB</p>
  </div>
  <div class="page">
    <p>Space Savings: VDI Cluster</p>
    <p>Corporate Virtual Desktop Infrastructure cluster Desktop XP VMs 612 months of active use Originally cloned from small number of base images</p>
    <p>...</p>
    <p>113 VMs</p>
    <p>1.9 TB</p>
  </div>
  <div class="page">
    <p>Space Savings: VDI Cluster</p>
  </div>
  <div class="page">
    <p>Space Savings: VDI Cluster</p>
  </div>
  <div class="page">
    <p>Space Savings: VDI Cluster</p>
  </div>
  <div class="page">
    <p>Space Savings: VDI Cluster</p>
  </div>
  <div class="page">
    <p>Space Savings: VDI Cluster</p>
  </div>
  <div class="page">
    <p>Runtime Effects</p>
    <p>Write monitoring Disk array caching</p>
    <p>EMC CLARiiON CX3-40</p>
  </div>
  <div class="page">
    <p>Runtime Effects</p>
    <p>Write monitoring Disk array caching</p>
    <p>EMC CLARiiON CX3-40</p>
  </div>
  <div class="page">
    <p>Runtime Effects</p>
    <p>Write monitoring Disk array caching</p>
    <p>EMC CLARiiON CX3-40</p>
  </div>
  <div class="page">
    <p>Runtime Overhead: Write Monitoring</p>
    <p>Worst-case benchmark: 100% sequential write IO, No computation</p>
    <p>Baseline Write Monitor</p>
    <p>CPU 33%</p>
    <p>Bandwidth (MB/s) 233 233</p>
    <p>Latency (ms) 8.6 8.6</p>
    <p>(See paper for database application benchmark)</p>
  </div>
  <div class="page">
    <p>Runtime Overhead: Write Monitoring</p>
    <p>Worst-case benchmark: 100% sequential write IO, No computation</p>
    <p>Baseline Write Monitor</p>
    <p>CPU 33%</p>
    <p>Bandwidth (MB/s) 233 233</p>
    <p>Latency (ms) 8.6 8.6</p>
    <p>(See paper for database application benchmark)</p>
  </div>
  <div class="page">
    <p>Runtime Overhead: Write Monitoring</p>
    <p>Worst-case benchmark: 100% sequential write IO, No computation</p>
    <p>Baseline Write Monitor</p>
    <p>CPU 33%</p>
    <p>Bandwidth (MB/s) 233 233</p>
    <p>Latency (ms) 8.6 8.6</p>
    <p>(See paper for database application benchmark)</p>
  </div>
  <div class="page">
    <p>Runtime Overhead: Write Monitoring</p>
    <p>Worst-case benchmark: 100% sequential write IO, No computation</p>
    <p>Baseline Write Monitor</p>
    <p>CPU 33%</p>
    <p>Bandwidth (MB/s) 233 233</p>
    <p>Latency (ms) 8.6 8.6</p>
    <p>(See paper for database application benchmark)</p>
  </div>
  <div class="page">
    <p>Runtime Gains: Disk Array Caching</p>
    <p>Reduced storage footprint Better caching Less IO</p>
  </div>
  <div class="page">
    <p>Runtime Gains: Disk Array Caching</p>
    <p>Reduced storage footprint Better caching Less IO</p>
    <p>A ve</p>
    <p>ra g e b</p>
    <p>o o t tim</p>
    <p>e (</p>
    <p>se cs</p>
    <p>)</p>
    <p># VMs booting concurrently</p>
    <p>VDI &quot;boot storm&quot;</p>
  </div>
  <div class="page">
    <p>Runtime Gains: Disk Array Caching</p>
    <p>Reduced storage footprint Better caching Less IO</p>
    <p>A ve</p>
    <p>ra g e b</p>
    <p>o o t tim</p>
    <p>e (</p>
    <p>se cs</p>
    <p>)</p>
    <p># VMs booting concurrently</p>
    <p>VDI &quot;boot storm&quot;</p>
    <p>Full copies</p>
  </div>
  <div class="page">
    <p>Runtime Gains: Disk Array Caching</p>
    <p>Reduced storage footprint Better caching Less IO</p>
    <p>A ve</p>
    <p>ra g e b</p>
    <p>o o t tim</p>
    <p>e (</p>
    <p>se cs</p>
    <p>)</p>
    <p># VMs booting concurrently</p>
    <p>VDI &quot;boot storm&quot;</p>
    <p>Full copies Deduplicated</p>
  </div>
  <div class="page">
    <p>Out-of-band Deduplication Rate</p>
    <p>Index scan</p>
    <p>COW sharing</p>
    <p>Virtually no cost for unique blocks 9 GB of new shared blocks per hour</p>
    <p>(And provisioning can be special-cased)</p>
  </div>
  <div class="page">
    <p>Out-of-band Deduplication Rate</p>
    <p>Index scan 6.6 GB/sec COW sharing</p>
    <p>Virtually no cost for unique blocks</p>
  </div>
  <div class="page">
    <p>Out-of-band Deduplication Rate</p>
    <p>Index scan 6.6 GB/sec COW sharing 2.6 MB/sec</p>
    <p>(Its a prototype!)</p>
    <p>Virtually no cost for unique blocks</p>
  </div>
  <div class="page">
    <p>Out-of-band Deduplication Rate</p>
    <p>Index scan 6.6 GB/sec COW sharing 2.6 MB/sec</p>
    <p>(Its a prototype!)</p>
    <p>Virtually no cost for unique blocks</p>
  </div>
  <div class="page">
    <p>Out-of-band Deduplication Rate</p>
    <p>Index scan 6.6 GB/sec COW sharing 2.6 MB/sec</p>
    <p>(Its a prototype!)</p>
    <p>Virtually no cost for unique blocks 9 GB of new shared blocks per hour</p>
    <p>(And provisioning can be special-cased)</p>
  </div>
  <div class="page">
    <p>Related Work</p>
    <p>Centralized archival Venti Data Domain Foundation</p>
    <p>Centralized primary storage NetApp ASIS Microsoft Single Instance Store</p>
    <p>Distributed Farsite</p>
    <p>SAN with Coordinator DDE</p>
  </div>
  <div class="page">
    <p>Conclusion</p>
    <p>Decentralized, out-of-band, live file system deduplication.</p>
    <p>Deduplication is effective.</p>
    <p>Deduplication is hard.</p>
    <p>Three-stage deduplication has only modest performance overhead.</p>
    <p>Thank you.</p>
  </div>
  <div class="page">
    <p>Conclusion</p>
    <p>Decentralized, out-of-band, live file system deduplication.</p>
    <p>Deduplication is effective.</p>
    <p>Deduplication is hard.</p>
    <p>Three-stage deduplication has only modest performance overhead.</p>
    <p>Thank you.</p>
  </div>
  <div class="page">
    <p>Conclusion</p>
    <p>Decentralized, out-of-band, live file system deduplication.</p>
    <p>Deduplication is effective.</p>
    <p>Deduplication is hard.</p>
    <p>Three-stage deduplication has only modest performance overhead.</p>
    <p>Thank you.</p>
  </div>
  <div class="page">
    <p>Conclusion</p>
    <p>Decentralized, out-of-band, live file system deduplication.</p>
    <p>Deduplication is effective.</p>
    <p>Deduplication is hard.</p>
    <p>Three-stage deduplication has only modest performance overhead.</p>
    <p>Thank you.</p>
  </div>
  <div class="page">
    <p>Conclusion</p>
    <p>Decentralized, out-of-band, live file system deduplication.</p>
    <p>Deduplication is effective.</p>
    <p>Deduplication is hard.</p>
    <p>Three-stage deduplication has only modest performance overhead.</p>
    <p>Thank you.</p>
  </div>
</Presentation>
