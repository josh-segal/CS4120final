<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 1</p>
  </div>
  <div class="page">
    <p>Constrained Data-Driven Parallelism Virendra J. Marathe with Tim Harris Yossi Lev Victor Luchangco Mark Moir Scalable Synchronization Research Group Oracle Labs</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 3</p>
    <p>Data-Driven Parallelism Parallel computation driven by data updates</p>
    <p>Data Object</p>
    <p>Handler Function</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 4</p>
    <p>Data-Driven Parallelism Parallel computation driven by data updates</p>
    <p>Data Object</p>
    <p>Updated Object</p>
    <p>Handler Function</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 5</p>
    <p>Data-Driven Parallelism Parallel computation driven by data updates</p>
    <p>Data Object</p>
    <p>Updated Object</p>
    <p>Handler Function</p>
    <p>Triggered Handler Function</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 6</p>
    <p>Data-Driven Parallelism Parallel computation driven by data updates</p>
    <p>Data Object</p>
    <p>Updated Object</p>
    <p>Update</p>
    <p>Handler Function</p>
    <p>Triggered Handler Function</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 7</p>
    <p>Data-Driven Parallelism Parallel computation driven by data updates</p>
    <p>Data Object</p>
    <p>Updated Object</p>
    <p>Update</p>
    <p>Handler Function</p>
    <p>Triggered Handler Function</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 8</p>
    <p>Data-Driven Parallelism Parallel computation driven by data updates</p>
    <p>Data Object</p>
    <p>Updated Object</p>
    <p>Update</p>
    <p>Handler Function</p>
    <p>Triggered Handler Function</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 9</p>
    <p>Data-Driven Parallelism Parallel computation driven by data updates</p>
    <p>Data Object</p>
    <p>Updated Object</p>
    <p>Update</p>
    <p>Handler Function</p>
    <p>Triggered Handler Function</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 10</p>
    <p>Data-Driven Parallelism Great, but not good enough!</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 11</p>
    <p>Data-Driven Parallelism Great, but not good enough!</p>
    <p>Does not apply to lots of problem classes</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 12</p>
    <p>Data-Driven Parallelism Great, but not good enough!</p>
    <p>Does not apply to lots of problem classes</p>
    <p>Major performance problems</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 13</p>
    <p>Illustrative Example: Single-Source Shortest Paths (SSSP)</p>
    <p>S 1</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 14</p>
    <p>A Data-Driven SSSP algorithm</p>
    <p>S</p>
    <p>Directed edge</p>
    <p>Update</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 15</p>
    <p>A Data-Driven SSSP algorithm</p>
    <p>S</p>
    <p>Directed edge</p>
    <p>Update</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 16</p>
    <p>A Data-Driven SSSP algorithm</p>
    <p>S</p>
    <p>Directed edge</p>
    <p>Update</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 17</p>
    <p>A Data-Driven SSSP algorithm</p>
    <p>S</p>
    <p>Now what?</p>
    <p>Directed edge</p>
    <p>Update</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 18</p>
    <p>A Data-Driven SSSP algorithm</p>
    <p>T1</p>
    <p>T2</p>
    <p>Directed edge</p>
    <p>Update</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 19</p>
    <p>A Data-Driven SSSP algorithm</p>
    <p>T1</p>
    <p>T2</p>
    <p>Directed edge</p>
    <p>Update</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 20</p>
    <p>A Data-Driven SSSP algorithm</p>
    <p>T1 Directed edge</p>
    <p>Update</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 21</p>
    <p>A Data-Driven SSSP algorithm</p>
    <p>T1 Directed edge</p>
    <p>Update</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 22</p>
    <p>A Data-Driven SSSP algorithm</p>
    <p>T1 Directed edge</p>
    <p>Update</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 23</p>
    <p>A Data-Driven SSSP algorithm</p>
    <p>T1 Directed edge</p>
    <p>Update</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 24</p>
    <p>A Data-Driven SSSP algorithm</p>
    <p>T1 Directed edge</p>
    <p>Update</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 25</p>
    <p>A Data-Driven SSSP algorithm</p>
    <p>T1 Directed edge</p>
    <p>Update</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 26</p>
    <p>A Data-Driven SSSP algorithm</p>
    <p>T1 Directed edge</p>
    <p>Update</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 27</p>
    <p>A Data-Driven SSSP algorithm</p>
    <p>T1 Directed edge</p>
    <p>Update</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 28</p>
    <p>A Data-Driven SSSP algorithm</p>
    <p>T1 Directed edge</p>
    <p>Update</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 29</p>
    <p>A Data-Driven SSSP algorithm</p>
    <p>T1 Directed edge</p>
    <p>Update</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 30</p>
    <p>A Data-Driven SSSP algorithm</p>
    <p>Directed edge</p>
    <p>Update</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 31</p>
    <p>A Data-Driven SSSP algorithm</p>
    <p>Directed edge</p>
    <p>Update</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 32</p>
    <p>A Data-Driven SSSP algorithm</p>
    <p>Directed edge</p>
    <p>Update</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 33</p>
    <p>A Data-Driven SSSP algorithm</p>
    <p>Directed edge</p>
    <p>Update</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 34</p>
    <p>A Data-Driven SSSP algorithm</p>
    <p>Directed edge</p>
    <p>Update</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 35</p>
    <p>A Data-Driven SSSP algorithm</p>
    <p>Directed edge</p>
    <p>Update</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 36</p>
    <p>A Data-Driven SSSP algorithm</p>
    <p>Directed edge</p>
    <p>Update</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 37</p>
    <p>A Data-Driven SSSP algorithm</p>
    <p>Directed edge</p>
    <p>Update</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 38</p>
    <p>A Data-Driven SSSP algorithm</p>
    <p>Directed edge</p>
    <p>Update</p>
    <p>Too much wasted work</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 39</p>
    <p>A Data-Driven SSSP algorithm</p>
    <p>Directed edge</p>
    <p>Update</p>
    <p>Too much wasted work</p>
    <p>Possible exponential work</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 40</p>
    <p>Problem: Execution order of tasks</p>
    <p>Need to constrain the execution order  But balance is important</p>
    <p>Constraint spectrum</p>
    <p>No constraints (potential for lots of wasted work e.g. Nave DD)</p>
    <p>Excessive constraints (little parallelism</p>
    <p>e.g. Dijkstra SSSP)</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 41</p>
    <p>Problem: Execution order of tasks</p>
    <p>Need to constrain the execution order  But balance is important</p>
    <p>Constraint spectrum</p>
    <p>No constraints (potential for lots of wasted work e.g. Nave DD)</p>
    <p>Excessive constraints (little parallelism</p>
    <p>e.g. Dijkstra SSSP) Looking for</p>
    <p>intermediate sweet spots</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 42</p>
    <p>Constrained Data-Driven Parallelism</p>
    <p>Task: Schedulable unit of computation  Triggers: Associate data with triggered function</p>
    <p>Phased Execution of Tasks:  Partitions tasks into a sequence of phases  Triggers annotated to trigger tasks right now or in the next phase  All the right now tasks complete before the next phase are scheduled</p>
    <p>Abstractions to constrain computation structure</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 43</p>
    <p>Constrained Data-Driven Parallelism</p>
    <p>! ! ! !1: int * a;!</p>
    <p>! ! ! !2: *a triggers [deferred] foo();!</p>
    <p>!</p>
    <p>! ! ! !3: !</p>
    <p>! ! ! !4: *a = ; // triggers a task that runs foo()!</p>
    <p>! ! ! !5: !</p>
    <p>!</p>
    <p>! ! ! !6: WaitForTasks(); // wait for all tasks to complete!</p>
    <p>Language Constructs</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 44</p>
    <p>Constrained Data-Driven Parallelism</p>
    <p>! ! ! !1: int * a;!</p>
    <p>! ! ! !2: *a triggers [deferred] foo();!</p>
    <p>!</p>
    <p>! ! ! !3: !</p>
    <p>! ! ! !4: *a = ; // triggers a task that runs foo()!</p>
    <p>! ! ! !5: !</p>
    <p>!</p>
    <p>! ! ! !6: WaitForTasks(); // wait for all tasks to complete!</p>
    <p>Language Constructs</p>
    <p>Library based implementation at present</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 45</p>
    <p>Data-Driven SSSP Algorithms Computation on a Vertex</p>
    <p>Nave Data-Driven Data-Driven with Deferred Triggering</p>
    <p>RelaxNeighbors(Vertex&amp; v)! for all n in v.neighbors do! int * dist = &amp;n.dist;! *dist triggers RelaxNeighbors(n)! ! if (*dist &gt; v.dist + weight(v,n))! *dist = v.dist + weight(v,n)!</p>
    <p>RelaxNeighbors(Vertex&amp; v)! for all n in v.neighbors do! int * dist = &amp;n.dist;! *dist triggers deferred RelaxNeighbors(n)! ! if (*dist &gt; v.dist + weight(v,n))! *dist = v.dist + weight(v,n)! !</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 46</p>
    <p>Data-Driven SSSP Algorithms Computation on a Vertex</p>
    <p>Nave Data-Driven Data-Driven with Deferred Triggering</p>
    <p>RelaxNeighbors(Vertex&amp; v)! for all n in v.neighbors do! int * dist = &amp;n.dist;! *dist triggers RelaxNeighbors(n)! ! if (*dist &gt; v.dist + weight(v,n))! *dist = v.dist + weight(v,n)!</p>
    <p>RelaxNeighbors(Vertex&amp; v)! for all n in v.neighbors do! int * dist = &amp;n.dist;! *dist triggers deferred RelaxNeighbors(n)! ! if (*dist &gt; v.dist + weight(v,n))! *dist = v.dist + weight(v,n)! !</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 47</p>
    <p>A Data-Driven SSSP algorithm (with deferred triggering)</p>
    <p>T1</p>
    <p>T2</p>
    <p>Phase 1</p>
    <p>Directed edge</p>
    <p>Update</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 48</p>
    <p>A Data-Driven SSSP algorithm (with deferred triggering)</p>
    <p>(deferred)</p>
    <p>Phase 1</p>
    <p>T1</p>
    <p>T2</p>
    <p>Phase 2</p>
    <p>T3</p>
    <p>Directed edge</p>
    <p>Update</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 49</p>
    <p>A Data-Driven SSSP algorithm (with deferred triggering)</p>
    <p>(deferred)</p>
    <p>Phase 1</p>
    <p>T1</p>
    <p>Phase 2</p>
    <p>T3</p>
    <p>Directed edge</p>
    <p>Update</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 50</p>
    <p>A Data-Driven SSSP algorithm (with deferred triggering)</p>
    <p>(deferred)</p>
    <p>Phase 1</p>
    <p>T1</p>
    <p>Phase 2</p>
    <p>T3 T4</p>
    <p>Directed edge</p>
    <p>Update</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 51</p>
    <p>A Data-Driven SSSP algorithm (with deferred triggering)</p>
    <p>(current)</p>
    <p>Phase 1 Phase 2</p>
    <p>T3 T4</p>
    <p>Directed edge</p>
    <p>Update</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 52</p>
    <p>A Data-Driven SSSP algorithm (with deferred triggering)</p>
    <p>(current)</p>
    <p>Phase 1 Phase 2</p>
    <p>T3 T4</p>
    <p>Phase 3</p>
    <p>Directed edge</p>
    <p>Update</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 53</p>
    <p>A Data-Driven SSSP algorithm (with deferred triggering)</p>
    <p>(deferred) (current)</p>
    <p>Phase 1 Phase 2</p>
    <p>T3 T4</p>
    <p>Phase 3</p>
    <p>T5</p>
    <p>Directed edge</p>
    <p>Update</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 54</p>
    <p>A Data-Driven SSSP algorithm (with deferred triggering)</p>
    <p>(deferred) (current)</p>
    <p>Phase 1 Phase 2 Phase 3</p>
    <p>T5 T3</p>
    <p>Directed edge</p>
    <p>Update</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 55</p>
    <p>A Data-Driven SSSP algorithm (with deferred triggering)</p>
    <p>Little Wasted Work</p>
    <p>(current)</p>
    <p>Phase 1 Phase 2 Phase 3</p>
    <p>T5</p>
    <p>Directed edge</p>
    <p>Update</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 56</p>
    <p>Implementation</p>
    <p>C++ Library Implementation  Work-stealing based Task Scheduler</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 57</p>
    <p>SSSP Scalability Results</p>
    <p>E xe</p>
    <p>cu tio</p>
    <p>n tim</p>
    <p>e (m</p>
    <p>se cs</p>
    <p>)</p>
    <p># of Threads</p>
    <p>DD-Wild</p>
    <p>Input graph: ca-HepPh #vertices: 12008 #edges: 237042</p>
    <p>Nave DD</p>
    <p>Architecture: 128-thread 2-socket SPARC T2+ system</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 58</p>
    <p>SSSP Scalability Results</p>
    <p>E xe</p>
    <p>cu tio</p>
    <p>n tim</p>
    <p>e (m</p>
    <p>se cs</p>
    <p>)</p>
    <p># of Threads</p>
    <p>Dijkstra</p>
    <p>BF-OMP</p>
    <p>DD-Wild</p>
    <p>Nave DD Input graph: ca-HepPh #vertices: 12008 #edges: 237042</p>
    <p>Bellman-Ford Dijkstra</p>
    <p>Architecture: 128-thread 2-socket SPARC T2+ system</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 59</p>
    <p>SSSP Scalability Results</p>
    <p>E xe</p>
    <p>cu tio</p>
    <p>n tim</p>
    <p>e (m</p>
    <p>se cs</p>
    <p>)</p>
    <p># of Threads</p>
    <p>Dijkstra</p>
    <p>BF-OMP</p>
    <p>DD-Wild</p>
    <p>DD-Phased</p>
    <p>Nave DD</p>
    <p>Phased DD</p>
    <p>Bellman-Ford Dijkstra</p>
    <p>Input graph: ca-HepPh #vertices: 12008 #edges: 237042</p>
    <p>Architecture: 128-thread 2-socket SPARC T2+ system</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 60</p>
    <p># of</p>
    <p>N od</p>
    <p>es p</p>
    <p>ro ce</p>
    <p>ss ed</p>
    <p>re</p>
    <p>la tiv</p>
    <p>e to</p>
    <p>D ijk</p>
    <p>st ra</p>
    <p># of Threads</p>
    <p>BF-OMP</p>
    <p>DD-Wild</p>
    <p>DD-Phased</p>
    <p>SSSP Work Chart Nave DD</p>
    <p>Phased DD</p>
    <p>Bellman-Ford</p>
    <p>Dijkstra: Optimal Work</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 61</p>
    <p>See the paper for  Task Groups</p>
    <p>Phased Task Groups  More detailed evaluation</p>
    <p>SSSP  Communities  Betweenness Centrality</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 62</p>
    <p>Takeaways</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 63</p>
    <p>Takeaways  Task ordering matters a lot for many data-driven computations</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 64</p>
    <p>Takeaways  Task ordering matters a lot for many data-driven computations</p>
    <p>Need the ability to constrain task order</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 65</p>
    <p>Takeaways  Task ordering matters a lot for many data-driven computations</p>
    <p>Need the ability to constrain task order</p>
    <p>Phased execution of tasks hits a sweet-spot</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 66</p>
    <p>Takeaways  Task ordering matters a lot for many data-driven computations</p>
    <p>Need the ability to constrain task order</p>
    <p>Phased execution of tasks hits a sweet-spot</p>
    <p>Performance boost of several orders of magnitude</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 67</p>
    <p>Takeaways  Task ordering matters a lot for many data-driven computations</p>
    <p>Need the ability to constrain task order</p>
    <p>Phased execution of tasks hits a sweet-spot</p>
    <p>Performance boost of several orders of magnitude</p>
    <p>More to do  Explore more workload classes  may lead to newer and better abstractions  Distributed implementation</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 68</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 69</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 70</p>
    <p>Data-Driven Computations</p>
    <p>Computation driven by dynamic data dependencies  Not new</p>
    <p>Dataflow machines (since 1970s)  Event-driven programming  around forever (e.g. interrupt handlers, GUI,</p>
    <p>sensor networks, SEDA, etc.)  Database triggers</p>
    <p>More recently  Data triggered threads  Data-driven tasks in Habanero  Incremental or self-adjusting computation frameworks</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 71</p>
    <p>Phased Execution of Tasks Time</p>
    <p>Triggers</p>
    <p>Completed task</p>
    <p>Active task</p>
    <p>Next phase task</p>
    <p>Phase 1 Phase 2 Phase 3 (current phase)</p>
    <p>Phase 4 (next phase)</p>
  </div>
  <div class="page">
    <p>Copyright  2013, Oracle and/or its affiliates. All rights reserved. 72</p>
    <p>Takeaways  Explore more abstractions</p>
    <p>Go beyond having the current and next phase  DAG  Provide primitives to express ordering between task groups (like Dryad,</p>
    <p>Hive, etc.)</p>
    <p>Go distributed</p>
  </div>
</Presentation>
