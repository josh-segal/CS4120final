<?xml version="1.0" ?>
<Presentation>
  <div class="page"/>
  <div class="page">
    <p>Hardware Evolution in Data Centers</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers 2</p>
    <p>Trend towards customization</p>
    <p>Increase work done per dollar (CapEx + OpEx)</p>
  </div>
  <div class="page">
    <p>Hardware Evolution in Data Centers</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers 3</p>
    <p>Scale out vs. scale up</p>
    <p>Many commodity servers rather than few expensive servers</p>
  </div>
  <div class="page">
    <p>Hardware Evolution in Data Centers</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers 4</p>
    <p>Custom layout</p>
    <p>Remove unnecessary components (e.g., GPGPUs, USB ports)</p>
  </div>
  <div class="page">
    <p>Hardware Evolution in Data Centers</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers 5</p>
    <p>Integrated fabrics</p>
    <p>Higher density and bandwidth with lower power consumption</p>
  </div>
  <div class="page">
    <p>Hardware Evolution in Data Centers</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers 6</p>
    <p>System-on-Chip (SoC)</p>
    <p>CPU, IO controllers, NIC/fabric switch on the same die</p>
  </div>
  <div class="page">
    <p>Hardware Evolution in Data Centers</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers 7</p>
    <p>Silicon Photonics</p>
    <p>High-bandwidth / low-latency interconnect (resource disaggregation)</p>
  </div>
  <div class="page">
    <p>Hardware Evolution in Data Centers</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers 8</p>
    <p>intra-server BW &lt;&lt; inter-server BW intra-server BW  inter-server BW</p>
  </div>
  <div class="page">
    <p>Hardware Evolution in Data Centers</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers 9</p>
    <p>intra-server BW &lt;&lt; inter-server BW intra-server BW  inter-server BW</p>
    <p>Rack-scale Computers The rack is becoming the new unit of computing in data centers</p>
    <p>Great opportunity to revisit early design assumptions</p>
    <p>and rethink the software stack and hw/sw co-design</p>
  </div>
  <div class="page">
    <p>A First Step: Rethinking the Network Stack</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers 10</p>
  </div>
  <div class="page">
    <p>A First Step: Rethinking the Network Stack</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers 11</p>
    <p>Is it just a faster network</p>
    <p>or is it fundamentally different?</p>
  </div>
  <div class="page">
    <p>A First Step: Rethinking the Network Stack</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers 12</p>
    <p>Many designs are possible but some trends are emerging:</p>
  </div>
  <div class="page">
    <p>A First Step: Rethinking the Network Stack</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers 13</p>
    <p>High path diversity</p>
    <p>Many designs are possible but some trends are emerging:</p>
  </div>
  <div class="page">
    <p>A First Step: Rethinking the Network Stack</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers 14</p>
    <p>High path diversity Direct control on network resources</p>
    <p>Many designs are possible but some trends are emerging:</p>
  </div>
  <div class="page">
    <p>A First Step: Rethinking the Network Stack</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers 15</p>
    <p>High path diversity Direct control on network resources</p>
    <p>Many designs are possible but some trends are emerging:</p>
    <p>Research Question:</p>
    <p>How can we take advantage of these features</p>
    <p>to design a new network stack optimized for rack-scale computers?</p>
    <p>Focus of this work</p>
    <p>How to route packets (routing)?</p>
    <p>At what rate should the packets be sent (rate control)?</p>
  </div>
  <div class="page">
    <p>RaSC-Net Design</p>
    <p>Goals</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers 16</p>
  </div>
  <div class="page">
    <p>RaSC-Net Design: Routing</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers</p>
    <p>Source</p>
    <p>Destination</p>
    <p>A</p>
    <p>B</p>
  </div>
  <div class="page">
    <p>RaSC-Net Design: Routing</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers</p>
    <p>Intermediate</p>
    <p>destination</p>
    <p>Source</p>
    <p>Destination</p>
    <p>Valiant Load Balancing (VLB)</p>
    <p>Randomly selects an intermediate destination per each packet</p>
    <p>A</p>
    <p>B</p>
  </div>
  <div class="page">
    <p>RaSC-Net Design: Routing</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers</p>
    <p>Intermediate</p>
    <p>destination</p>
    <p>Source</p>
    <p>Destination</p>
    <p>Valiant Load Balancing (VLB)</p>
    <p>Randomly selects an intermediate destination per each packet</p>
    <p>A</p>
    <p>B</p>
  </div>
  <div class="page">
    <p>RaSC-Net Design: Routing</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers</p>
    <p>Intermediate</p>
    <p>destination</p>
    <p>Source</p>
    <p>Destination</p>
    <p>Valiant Load Balancing (VLB)</p>
    <p>Randomly selects an intermediate destination per each packet</p>
    <p>A</p>
    <p>B</p>
  </div>
  <div class="page">
    <p>RaSC-Net Design: Routing</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers</p>
    <p>Intermediate</p>
    <p>destination</p>
    <p>Source</p>
    <p>Destination</p>
    <p>Non-minimal routing</p>
    <p>Intermediate destinations do not need to lie on the shortest path</p>
    <p>A</p>
    <p>B</p>
  </div>
  <div class="page">
    <p>RaSC-Net Design: Routing</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers</p>
    <p>Intermediate</p>
    <p>destination</p>
    <p>Source</p>
    <p>Destination</p>
    <p>Non-minimal routing</p>
    <p>Intermediate destinations do not need to lie on the shortest path</p>
    <p>A</p>
    <p>B</p>
  </div>
  <div class="page">
    <p>RaSC-Net Design: Routing</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers</p>
    <p>Intermediate</p>
    <p>destination</p>
    <p>Source</p>
    <p>Destination</p>
    <p>Why does it work? VLB aims to transform any traffic matrix into a uniform one</p>
    <p>Link load balancing (Goal #1) and independent of traffic matrix (Goal #2)</p>
    <p>A</p>
    <p>B</p>
  </div>
  <div class="page">
    <p>RaSC-Net Design: Routing</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers</p>
    <p>Intermediate</p>
    <p>destination</p>
    <p>Source</p>
    <p>Destination</p>
    <p>VLB Drawback #1: Path Stretch</p>
    <p>Average path length and link utilization increases</p>
    <p>Solution: Locality-aware variants of VLB can be used (weighted choice)</p>
    <p>A</p>
    <p>B</p>
  </div>
  <div class="page">
    <p>RaSC-Net Design: Routing</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers</p>
    <p>Intermediate</p>
    <p>destination</p>
    <p>Source</p>
    <p>Destination</p>
    <p>A</p>
    <p>B</p>
    <p>VLB Drawback #2: Out of order packet arrival</p>
    <p>Packets need be reordered at the destination (jitter)</p>
    <p>Solution: low diameter and minimize queuing delay 25</p>
  </div>
  <div class="page">
    <p>RaSC-Net Design: Routing</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers</p>
    <p>Intermediate</p>
    <p>destination</p>
    <p>Source</p>
    <p>Destination</p>
    <p>Key observation: VLB enables global visibility</p>
    <p>Nodes inspect packet headers of forwarded packets</p>
    <p>They can locally reconstruct the traffic matrix</p>
    <p>Flow-aware</p>
    <p>Flow A -&gt; B</p>
    <p>A</p>
    <p>B</p>
    <p>C</p>
  </div>
  <div class="page">
    <p>RaSC-Net Design: Routing</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers</p>
    <p>Intermediate</p>
    <p>destination</p>
    <p>Source</p>
    <p>Destination</p>
    <p>Key observation: VLB enables global visibility</p>
    <p>Nodes inspect packet headers of forwarded packets</p>
    <p>They can locally reconstruct the traffic matrix</p>
    <p>Flow-aware</p>
    <p>Flow A -&gt; B</p>
    <p>A</p>
    <p>B</p>
    <p>C</p>
  </div>
  <div class="page">
    <p>RaSC-Net Design: Routing</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers</p>
    <p>Intermediate</p>
    <p>destination</p>
    <p>Source</p>
    <p>Destination</p>
    <p>Key observation: VLB enables global visibility</p>
    <p>Nodes inspect packet headers of forwarded packets</p>
    <p>They can locally reconstruct the traffic matrix</p>
    <p>Flow-aware</p>
    <p>Flow A -&gt; B</p>
    <p>A</p>
    <p>B</p>
    <p>C</p>
  </div>
  <div class="page">
    <p>RaSC-Net Design: Rate Control</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers</p>
    <p>Source</p>
    <p>Destination</p>
    <p>A</p>
    <p>B</p>
    <p>C</p>
    <p>D</p>
    <p>Flow A -&gt; B Flow C -&gt; D</p>
    <p>Flow A -&gt; B Flow C -&gt; D</p>
    <p>Rate Allocation</p>
    <p>Given the knowledge of the topology and the traffic matrix,</p>
    <p>each node can locally derive the correct rate for its flows 29</p>
  </div>
  <div class="page">
    <p>RaSC-Net Design: Rate Control</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers</p>
    <p>Source</p>
    <p>Destination</p>
    <p>A</p>
    <p>B</p>
    <p>C</p>
    <p>D</p>
    <p>Flow A -&gt; B Flow C -&gt; D</p>
    <p>Flow A -&gt; B Flow C -&gt; D</p>
    <p>Rate Allocation</p>
    <p>Given the knowledge of the topology and the traffic matrix,</p>
    <p>each node can locally derive the correct rate for its flows 30</p>
  </div>
  <div class="page">
    <p>RaSC-Net Design: Rate Control</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers</p>
    <p>Source</p>
    <p>Destination</p>
    <p>A</p>
    <p>B</p>
    <p>C</p>
    <p>D</p>
    <p>Flow A -&gt; B Flow C -&gt; D</p>
    <p>Flow A -&gt; B Flow C -&gt; D</p>
    <p>Rate Allocation</p>
    <p>Given the knowledge of the topology and the traffic matrix,</p>
    <p>each node can locally derive the correct rate for its flows 31</p>
  </div>
  <div class="page">
    <p>RaSC-Net Design: Rate Control</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers</p>
    <p>Source</p>
    <p>Destination</p>
    <p>A</p>
    <p>B</p>
    <p>C</p>
    <p>D</p>
    <p>Flow A -&gt; B Flow C -&gt; D</p>
    <p>Flow A -&gt; B Flow C -&gt; D</p>
    <p>Rate Allocation</p>
    <p>Given the knowledge of the topology and the traffic matrix,</p>
    <p>each node can locally derive the correct rate for its flows 32</p>
  </div>
  <div class="page">
    <p>RaSC-Net Design: Rate Control</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers</p>
    <p>Source</p>
    <p>Destination</p>
    <p>A</p>
    <p>B</p>
    <p>C</p>
    <p>D</p>
    <p>Flow A -&gt; B Flow C -&gt; D</p>
    <p>Flow A -&gt; B Flow C -&gt; D</p>
    <p>Rate Adaptation</p>
    <p>When a packet from a new flow is received,</p>
    <p>nodes can update their rates accordingly 33</p>
  </div>
  <div class="page">
    <p>RaSC-Net Design: Rate Control</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers</p>
    <p>Source</p>
    <p>Destination</p>
    <p>A</p>
    <p>B</p>
    <p>C</p>
    <p>D</p>
    <p>Flow A -&gt; B Flow C -&gt; D</p>
    <p>Flow A -&gt; B Flow C -&gt; D</p>
    <p>Key result</p>
    <p>A traditionally distributed problem (rate control)</p>
    <p>becomes a local operation 34</p>
  </div>
  <div class="page">
    <p>RaSC-Net Design: Rate Control</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers</p>
    <p>Source</p>
    <p>Destination</p>
    <p>A</p>
    <p>B</p>
    <p>C</p>
    <p>D</p>
    <p>Flow A -&gt; B Flow C -&gt; D</p>
    <p>Flow A -&gt; B Flow C -&gt; D</p>
    <p>Low queuing (Goal #3)</p>
    <p>No need to probe the network a la TCP</p>
    <p>Rates are chosen so as to minimize queuing 35</p>
  </div>
  <div class="page">
    <p>RaSC-Net Design: Rate Control</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers</p>
    <p>Source</p>
    <p>Destination</p>
    <p>A</p>
    <p>B</p>
    <p>C</p>
    <p>D</p>
    <p>Flow A -&gt; B Flow C -&gt; D</p>
    <p>Flow A -&gt; B Flow C -&gt; D</p>
    <p>Beyond max-min fairness (Goal #4)</p>
    <p>Since rate allocation is now a local computation,</p>
    <p>it is easy to encode different allocation policies 36</p>
  </div>
  <div class="page">
    <p>Something (NOT) to worry about</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers 37</p>
  </div>
  <div class="page">
    <p>Something (NOT) to worry about</p>
    <p>o Hence, the most bottleneck link is actually the bottleneck for almost all active flows</p>
    <p>o Approximate results can also be used (utilization vs. computation trade-off)</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers 38</p>
  </div>
  <div class="page">
    <p>Something (NOT) to worry about</p>
    <p>o Hence, the most bottleneck link is actually the bottleneck for almost all active flows</p>
    <p>o Approximate results can also be used (utilization vs. computation trade-off)</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers 39</p>
  </div>
  <div class="page">
    <p>RaSC-Net: Preliminary Results</p>
    <p>Simulation setup  512-node 3D torus (8 x 8 x 8)  6 10Gbps links / server  Permutation matrix with varying number of sources (load)  10-MB flows all starting at the same time</p>
    <p>Baselines  TCP: ECMP routing protocol (single path per flow) + TCP  Idealized (unlimited per-flow queues)</p>
    <p>o Ideal-ShortestPaths: Packet spraying (minimal routing)</p>
    <p>o Ideal-VLB: Valliant Load Balancing Paolo Costa Rethinking the Network Stack for Rack-scale Computers 40</p>
  </div>
  <div class="page">
    <p>Flow Completion Time (99th perc.)</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers 41</p>
    <p>th F</p>
    <p>lo w</p>
    <p>C o</p>
    <p>m p</p>
    <p>le ti</p>
    <p>o n</p>
    <p>T im</p>
    <p>e</p>
    <p>Network load</p>
    <p>TCP</p>
    <p>Ideal-ShortestPaths</p>
    <p>Ideal-VLB</p>
    <p>Worse</p>
    <p>Better</p>
    <p>Number of sources increases</p>
  </div>
  <div class="page">
    <p>Flow Completion Time (99th perc.)</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers 42</p>
    <p>th F</p>
    <p>lo w</p>
    <p>C o</p>
    <p>m p</p>
    <p>le ti</p>
    <p>o n</p>
    <p>T im</p>
    <p>e</p>
    <p>Network load</p>
    <p>TCP</p>
    <p>Ideal-ShortestPaths</p>
    <p>Ideal-VLB</p>
    <p>RaSC-Net</p>
    <p>Worse</p>
    <p>Better</p>
    <p>Number of sources increases</p>
  </div>
  <div class="page">
    <p>Flow Completion Time (99th perc.)</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers 43</p>
    <p>th F</p>
    <p>lo w</p>
    <p>C o</p>
    <p>m p</p>
    <p>le ti</p>
    <p>o n</p>
    <p>T im</p>
    <p>e</p>
    <p>Network load</p>
    <p>TCP</p>
    <p>Ideal-ShortestPaths</p>
    <p>Ideal-VLB</p>
    <p>RaSC-Net</p>
    <p>Worse</p>
    <p>Better</p>
    <p>TCP performance is limited by single path</p>
    <p>Number of sources increases</p>
    <p>RaSC-Net approximates VLB</p>
    <p>Using non-shortest paths increases</p>
    <p>bandwidth available</p>
  </div>
  <div class="page">
    <p>Flow Distribution (load = 0.5)</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers 44</p>
    <p>C D</p>
    <p>F (F</p>
    <p>lo w</p>
    <p>s)</p>
    <p>Flow Completion Time</p>
    <p>TCP Ideal-ShortestPaths</p>
    <p>Ideal-VLB RaSC-Net</p>
    <p>WorseBetter</p>
  </div>
  <div class="page">
    <p>Flow Distribution (load = 0.5)</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers 45</p>
    <p>C D</p>
    <p>F (F</p>
    <p>lo w</p>
    <p>s)</p>
    <p>Flow Completion Time</p>
    <p>TCP Ideal-ShortestPaths</p>
    <p>Ideal-VLB RaSC-Net</p>
    <p>WorseBetter</p>
    <p>Long tail due to single path</p>
    <p>ShortestPaths achieves lower</p>
    <p>median but with a tail</p>
    <p>VLB ensures good balance across flows</p>
    <p>The price for fast computation</p>
  </div>
  <div class="page">
    <p>Beyond Rate Control</p>
    <p>o Can we design a unified protocol stack (rather than PCI, QPI, SATA, DDR3, )?</p>
    <p>o How to handle heterogeneous classes of traffic (each with different requirements)?</p>
    <p>o Oversubscription? Protocol bridging?</p>
    <p>o How to assign resources to applications?</p>
    <p>o How to handle distributed faults?</p>
    <p>o Whats the programming model?</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers 46</p>
  </div>
  <div class="page">
    <p>Summary</p>
    <p>Paolo Costa Rethinking the Network Stack for Rack-scale Computers 47Rack-scale Computers @ MSR Cambridge http://research.microsoft.com/rackscale</p>
  </div>
</Presentation>
