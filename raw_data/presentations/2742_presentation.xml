<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Copa: Practical Delay-Based Congestion Control</p>
    <p>Venkat Arun and Hari Balakrishnan</p>
    <p>MIT, CSAIL web.mit.edu/copa</p>
  </div>
  <div class="page">
    <p>The Internet is more challenging than ever (Why are we still talking about congestion control in 2018?)</p>
  </div>
  <div class="page">
    <p>The Internet is more challenging than ever</p>
    <p>Greater bandwidth  Higher bandwidth-delay product</p>
    <p>Lower tolerance for non-congestive loss</p>
    <p>Greater flow-churn</p>
    <p>(Why are we still talking about congestion control in 2018?)</p>
  </div>
  <div class="page">
    <p>The Internet is more challenging than ever</p>
    <p>Greater bandwidth</p>
    <p>Large flows (e.g. video streaming) co-exist with short-flows</p>
    <p>Higher bandwidth-delay product</p>
    <p>Lower tolerance for non-congestive loss</p>
    <p>Greater flow-churn</p>
    <p>(Why are we still talking about congestion control in 2018?)</p>
  </div>
  <div class="page">
    <p>The Internet is more challenging than ever</p>
    <p>Greater bandwidth</p>
    <p>Large flows (e.g. video streaming) co-exist with short-flows</p>
    <p>Wireless links with variable bandwidths are commonplace</p>
    <p>Higher bandwidth-delay product</p>
    <p>Lower tolerance for non-congestive loss</p>
    <p>Greater flow-churn</p>
    <p>(Why are we still talking about congestion control in 2018?)</p>
  </div>
  <div class="page">
    <p>The Internet is more challenging than ever</p>
    <p>Greater bandwidth</p>
    <p>Large flows (e.g. video streaming) co-exist with short-flows</p>
    <p>Wireless links with variable bandwidths are commonplace</p>
    <p>Higher bandwidth-delay product</p>
    <p>Lower tolerance for non-congestive loss</p>
    <p>Greater flow-churn</p>
    <p>Simultaneously, users are more sensitive to performance!</p>
    <p>(Why are we still talking about congestion control in 2018?)</p>
  </div>
  <div class="page">
    <p>Loss-based schemes have long-standing problems</p>
    <p>Buffer-filling</p>
    <p>Vulnerable to non-congestive loss</p>
    <p>Loss is a coarse signal Worsens with increasing bandwidth</p>
  </div>
  <div class="page">
    <p>Delay-based congestion control?</p>
    <p>Benefits Challenges</p>
  </div>
  <div class="page">
    <p>Delay-based congestion control?</p>
    <p>Maintain low delay Not competitive with buffer-filling schemes</p>
    <p>Benefits Challenges</p>
  </div>
  <div class="page">
    <p>Delay-based congestion control?</p>
    <p>Maintain low delay</p>
    <p>Robust to misleading loss</p>
    <p>Not competitive with buffer-filling schemes</p>
    <p>Delay can mislead too!</p>
    <p>Benefits Challenges</p>
  </div>
  <div class="page">
    <p>Delay-based congestion control?</p>
    <p>Maintain low delay</p>
    <p>Robust to misleading loss</p>
    <p>Not competitive with buffer-filling schemes</p>
    <p>Delay can mislead too!</p>
    <p>Benefits Challenges</p>
    <p>Rich signal</p>
  </div>
  <div class="page">
    <p>Delay-based congestion control?</p>
    <p>Maintain low delay</p>
    <p>Robust to misleading loss</p>
    <p>Not competitive with buffer-filling schemes</p>
    <p>Delay can mislead too!</p>
    <p>Finding true minimum RTT is hard</p>
    <p>Benefits Challenges</p>
    <p>Rich signal</p>
  </div>
  <div class="page">
    <p>Delay-based congestion control?</p>
    <p>Not competitive with buffer-filling schemes</p>
    <p>Delay is noisy too!</p>
    <p>Finding true minimum RTT is hard</p>
    <p>Our SolutionChallenges</p>
  </div>
  <div class="page">
    <p>Delay-based congestion control?</p>
    <p>If buffer-fillers are present, give up on low delay</p>
    <p>Not competitive with buffer-filling schemes</p>
    <p>Delay is noisy too!</p>
    <p>Finding true minimum RTT is hard</p>
    <p>Our SolutionChallenges</p>
  </div>
  <div class="page">
    <p>Delay-based congestion control?</p>
    <p>If buffer-fillers are present, give up on low delay</p>
    <p>MIN: a more robust statistic for queuing delay</p>
    <p>Not competitive with buffer-filling schemes</p>
    <p>Delay is noisy too!</p>
    <p>Finding true minimum RTT is hard</p>
    <p>Our SolutionChallenges</p>
  </div>
  <div class="page">
    <p>Delay-based congestion control?</p>
    <p>If buffer-fillers are present, give up on low delay</p>
    <p>MIN: a more robust statistic for queuing delay</p>
    <p>Not competitive with buffer-filling schemes</p>
    <p>Delay is noisy too!</p>
    <p>Finding true minimum RTT is hard</p>
    <p>Our SolutionChallenges</p>
    <p>Empty queues periodically</p>
  </div>
  <div class="page">
    <p>Basic Goals</p>
    <p>Avoid congestion collapse +</p>
    <p>Efficient and Fair allocation of bandwidth +</p>
    <p>Low delay</p>
  </div>
  <div class="page">
    <p>Target rate = r( = )</p>
    <p>*+,</p>
    <p>Adjustable Parameter default = 0.5</p>
    <p>Queuing delay</p>
  </div>
  <div class="page">
    <p>Target Rate  Nash Equilibrium</p>
    <p>&quot;#$%$#&amp;' = log #,-#  /'log(12) Assuming Poisson arrivals (more details in paper)</p>
    <p>Selfishly optimize for:</p>
  </div>
  <div class="page">
    <p>Target Rate  Nash Equilibrium</p>
    <p>&quot;#$%$#&amp;' = log #,-#  /'log(12) Assuming Poisson arrivals (more details in paper)</p>
    <p>Selfishly optimize for:</p>
    <p>Unique and Efficient</p>
  </div>
  <div class="page">
    <p>Computing the Target Rate</p>
  </div>
  <div class="page">
    <p>Estimating queuing delay from RTT</p>
    <p>Time</p>
    <p>RT T</p>
    <p>True minimum RTT</p>
    <p>RTT</p>
    <p>RTTminQueuing delay</p>
  </div>
  <div class="page">
    <p>Estimating queuing delay from RTT</p>
    <p>Time</p>
    <p>RT T</p>
    <p>True minimum RTT</p>
    <p>RTT</p>
    <p>RTTmin RTT  RTTmin = queuing delay</p>
    <p>Queuing delay</p>
  </div>
  <div class="page">
    <p>Estimating queuing delay from RTT</p>
    <p>Time</p>
    <p>RT T</p>
    <p>True minimum RTT</p>
    <p>RTTmin</p>
    <p>New flow starts here</p>
    <p>Wrong!</p>
  </div>
  <div class="page">
    <p>Estimating queuing delay from RTT</p>
    <p>Time</p>
    <p>RT T</p>
    <p>True minimum RTT</p>
    <p>True minimum RTT = RTTmin for new flows!</p>
  </div>
  <div class="page">
    <p>A noisy cellular link: Stanford to AWS D</p>
    <p>el ay</p>
    <p>e xp</p>
    <p>er ie</p>
    <p>nc ed</p>
    <p>b y</p>
    <p>in di</p>
    <p>vi du</p>
    <p>al p</p>
    <p>ac ke</p>
    <p>ts (m</p>
    <p>s)</p>
    <p>Time (s)</p>
  </div>
  <div class="page">
    <p>Decoupling queuing delay from other delay variation</p>
    <p>Time</p>
    <p>Q ue</p>
    <p>ue le</p>
    <p>ng th Measured RTT</p>
    <p>Wireless links  Cross traffic  ACK compression  Bursty transmission</p>
  </div>
  <div class="page">
    <p>Decoupling queuing delay from other delay variation</p>
    <p>Time</p>
    <p>Q ue</p>
    <p>ue le</p>
    <p>ng th Measured RTT</p>
    <p>Wireless links  Cross traffic  ACK compression  Bursty transmission</p>
    <p>Positive Additive Noise!</p>
    <p>Take Min over last 0.5 RTT of samples</p>
  </div>
  <div class="page">
    <p>A noisy cellular link: Stanford to AWS</p>
    <p>Using the MIN delay estimator improves throughput from 0.5 Mbits/s to 3.9 Mbits/s</p>
    <p>D el</p>
    <p>ay e</p>
    <p>xp er</p>
    <p>ie nc</p>
    <p>ed b</p>
    <p>y in</p>
    <p>di vi</p>
    <p>du al</p>
    <p>p ac</p>
    <p>ke ts</p>
    <p>Time (s)</p>
  </div>
  <div class="page">
    <p>Attaining the Target</p>
  </div>
  <div class="page">
    <p>Calculate target rate = '( = ) *+,</p>
    <p>If current rate &lt; r.: additively increase by 0 * pkts/RTT</p>
    <p>Else: additively decrease by 0* pkts/RTT</p>
    <p>The Copa Algorithm</p>
  </div>
  <div class="page">
    <p>Calculate target rate = '( = ) *+,</p>
    <p>If current rate &lt; r.: additively increase by 0 * pkts/RTT</p>
    <p>Else: additively decrease by 0* pkts/RTT</p>
    <p>The Copa Algorithm Velocity for faster convergence</p>
  </div>
  <div class="page">
    <p>Calculate target rate = '( = ) *+,</p>
    <p>If current rate &lt; r.: additively increase by 0 * pkts/RTT</p>
    <p>Else: additively decrease by 0* pkts/RTT</p>
    <p>C w</p>
    <p>nd (p</p>
    <p>kt s)</p>
    <p>R TT</p>
    <p>st an</p>
    <p>di ng</p>
    <p>(m s)</p>
    <p>Time (s)</p>
    <p>Cwnd RTTstanding</p>
    <p>The Copa Algorithm</p>
    <p>RTT Cwnd</p>
    <p>Cw nd</p>
    <p>(p kt</p>
    <p>s)</p>
    <p>RT T</p>
    <p>(m s)</p>
    <p>Time (s)</p>
    <p>Velocity for faster convergence</p>
  </div>
  <div class="page">
    <p>Steady-State Dynamics of Copa Q</p>
    <p>ue ue</p>
    <p>L en</p>
    <p>gt h</p>
    <p>(in p</p>
    <p>kt s)</p>
    <p>Time</p>
    <p>Equilibrium queue length</p>
    <p>Period: 5 RTTs Amplitude: 2.5 $%&amp;</p>
  </div>
  <div class="page">
    <p>Steady-State Dynamics of Copa Q</p>
    <p>ue ue</p>
    <p>L en</p>
    <p>gt h</p>
    <p>(in p</p>
    <p>kt s)</p>
    <p>Time</p>
    <p>Equilibrium queue length</p>
    <p>T</p>
    <p>wi nd</p>
    <p>ow</p>
    <p>Switch point</p>
    <p>Queue length corresponding to RTTstanding at the switch point</p>
    <p>Period: 5 RTTs Amplitude: 2.5 $%&amp;</p>
  </div>
  <div class="page">
    <p>Steady-State Dynamics of Copa Q</p>
    <p>ue ue</p>
    <p>L en</p>
    <p>gt h</p>
    <p>(in p</p>
    <p>kt s)</p>
    <p>Time</p>
    <p>Equilibrium queue length</p>
    <p>T</p>
    <p>wi nd</p>
    <p>ow</p>
    <p>Switch point</p>
    <p>Queue length corresponding to RTTstanding at the switch point</p>
    <p>Period: 5 RTTs Amplitude: 2.5 $%&amp;</p>
  </div>
  <div class="page">
    <p>Steady-State Dynamics of Copa Q</p>
    <p>ue ue</p>
    <p>L en</p>
    <p>gt h</p>
    <p>(in p</p>
    <p>kt s)</p>
    <p>Time</p>
    <p>Equilibrium queue length</p>
    <p>T</p>
    <p>wi nd</p>
    <p>ow</p>
    <p>Switch point</p>
    <p>Queue length corresponding to RTTstanding at the switch point</p>
    <p>Period: 5 RTTs Amplitude: 2.5 $%&amp;</p>
  </div>
  <div class="page">
    <p>Steady-State Dynamics of Copa Q</p>
    <p>ue ue</p>
    <p>L en</p>
    <p>gt h</p>
    <p>(in p</p>
    <p>kt s)</p>
    <p>Time</p>
    <p>Equilibrium queue length</p>
    <p>T</p>
    <p>wi nd</p>
    <p>ow</p>
    <p>Switch point</p>
    <p>Queue length corresponding to RTTstanding at the switch point</p>
    <p>Switch point</p>
    <p>Period: 5 RTTs Amplitude: 2.5 $%&amp;</p>
  </div>
  <div class="page">
    <p>Detect buffer-filling TCP</p>
    <p>Estimate true minimum RTT</p>
    <p>Queue empties every 5 RTTs!</p>
  </div>
  <div class="page">
    <p>TCP-Competitiveness</p>
  </div>
  <div class="page">
    <p>Mode switching for TCP competitiveness</p>
    <p>T hr</p>
    <p>ou gh</p>
    <p>pu t (</p>
    <p>M bi</p>
    <p>ts /s</p>
    <p>)</p>
    <p>Q ue</p>
    <p>ui ng</p>
    <p>D el</p>
    <p>ay (</p>
    <p>m s)</p>
    <p>Time (s)</p>
    <p>Delay sensitive (! = 0.5)</p>
    <p>TCP CubicCopa</p>
  </div>
  <div class="page">
    <p>Mode switching for TCP competitiveness</p>
    <p>T hr</p>
    <p>ou gh</p>
    <p>pu t (</p>
    <p>M bi</p>
    <p>ts /s</p>
    <p>)</p>
    <p>Q ue</p>
    <p>ui ng</p>
    <p>D el</p>
    <p>ay (</p>
    <p>m s)</p>
    <p>Time (s)</p>
    <p>Delay sensitive (! = 0.5)</p>
    <p>TCP CubicCopa</p>
    <p>Low Delay Low Throughput Low Delay</p>
  </div>
  <div class="page">
    <p>Mode switching for TCP competitiveness</p>
    <p>T hr</p>
    <p>ou gh</p>
    <p>pu t (</p>
    <p>M bi</p>
    <p>ts /s</p>
    <p>)</p>
    <p>Q ue</p>
    <p>ui ng</p>
    <p>D el</p>
    <p>ay (</p>
    <p>m s)</p>
    <p>Time (s)</p>
    <p>T hr</p>
    <p>ou gh</p>
    <p>pu t (</p>
    <p>M bi</p>
    <p>ts /s</p>
    <p>)</p>
    <p>Q ue</p>
    <p>ui ng</p>
    <p>D el</p>
    <p>ay (</p>
    <p>m s)</p>
    <p>Time (s)</p>
    <p>Delay sensitive (! = 0.5)</p>
    <p>TCP Competitive (AIMD on !&amp;')</p>
    <p>TCP CubicCopa</p>
    <p>Low Delay Low Throughput</p>
    <p>High ThroughputHigh Delay</p>
    <p>Low Delay</p>
    <p>High Delay</p>
    <p>TCP CubicCopa</p>
  </div>
  <div class="page">
    <p>Mode switching for TCP competitiveness</p>
    <p>T hr</p>
    <p>ou gh</p>
    <p>pu t (</p>
    <p>M bi</p>
    <p>ts /s</p>
    <p>)</p>
    <p>Q ue</p>
    <p>ui ng</p>
    <p>D el</p>
    <p>ay (</p>
    <p>m s)</p>
    <p>Time (s)</p>
    <p>T hr</p>
    <p>ou gh</p>
    <p>pu t (</p>
    <p>M bi</p>
    <p>ts /s</p>
    <p>)</p>
    <p>Q ue</p>
    <p>ui ng</p>
    <p>D el</p>
    <p>ay (</p>
    <p>m s)</p>
    <p>Time (s)</p>
    <p>Delay sensitive (! = 0.5)</p>
    <p>TCP Competitive (AIMD on !&amp;')</p>
    <p>TCP CubicCopa</p>
    <p>Low Delay Low Throughput</p>
    <p>High ThroughputHigh Delay</p>
    <p>Low Delay</p>
    <p>High Delay</p>
    <p>TCP CubicCopa</p>
  </div>
  <div class="page">
    <p>Mode switching for TCP competitiveness</p>
    <p>T hr</p>
    <p>ou gh</p>
    <p>pu t (</p>
    <p>M bi</p>
    <p>ts /s</p>
    <p>)</p>
    <p>Q ue</p>
    <p>ui ng</p>
    <p>D el</p>
    <p>ay (</p>
    <p>m s)</p>
    <p>Time (s)</p>
    <p>TCP Cubic</p>
    <p>Copa</p>
    <p>Low Delay High Throughput Low Delay</p>
    <p>When queue doesnt empty once every 5 RTTs, switch to TCP Competitive mode!</p>
    <p>Best of both worlds!</p>
  </div>
  <div class="page">
    <p>Vegas Reno Cubic Copa PCC BBR</p>
    <p>A vg</p>
    <p>. ( Tp</p>
    <p>t / Id</p>
    <p>ea l t</p>
    <p>pt )</p>
    <p>Scheme under test's throughput Cubic's throughput</p>
    <p>Copa gets higher throughput without hurting TCP Cubic!</p>
  </div>
  <div class="page">
    <p>Vegas Reno Cubic Copa PCC BBR</p>
    <p>A vg</p>
    <p>. ( Tp</p>
    <p>t / Id</p>
    <p>ea l t</p>
    <p>pt )</p>
    <p>Scheme under test's throughput Cubic's throughput</p>
    <p>Copa gets higher throughput without hurting TCP Cubic!</p>
  </div>
  <div class="page">
    <p>Vegas Reno Cubic Copa PCC BBR</p>
    <p>A vg</p>
    <p>. ( Tp</p>
    <p>t / Id</p>
    <p>ea l t</p>
    <p>pt )</p>
    <p>Scheme under test's throughput Cubic's throughput</p>
    <p>Copa gets higher throughput without hurting TCP Cubic!</p>
    <p>Copa gets higher throughput Cubic flows are not hurt</p>
  </div>
  <div class="page">
    <p>Limitations</p>
    <p>Cannot ignore low frequency noise</p>
    <p>Queues dont empty periodically if:  Propagation delay is much smaller than queuing delay  Flows with very different propagation delays share a bottleneck queue</p>
    <p>Needs precise RTT measurements</p>
  </div>
  <div class="page">
    <p>Consistent Performance on Real Paths</p>
    <p>BBR</p>
    <p>Copa</p>
    <p>Cubic LEDBAT</p>
    <p>PCC</p>
    <p>Sprout</p>
    <p>Remy Vegas Verus</p>
    <p>Vivace latency</p>
    <p>Vivace loss Vivace LTE</p>
    <p>A vg</p>
    <p>. N or</p>
    <p>m al</p>
    <p>iz ed</p>
    <p>T hr</p>
    <p>ou gh</p>
    <p>pu t</p>
    <p>Avg. Queuing Delay (ms)</p>
    <p>Cellular Networks</p>
    <p>BBR CopaCubic</p>
    <p>LEDBAT</p>
    <p>PCC</p>
    <p>Sprout</p>
    <p>Remy</p>
    <p>VegasVerus Vivacelatency</p>
    <p>Vivace loss Vivace LTE</p>
    <p>A vg</p>
    <p>. N or</p>
    <p>m al</p>
    <p>iz ed</p>
    <p>T hr</p>
    <p>ou gh</p>
    <p>pu t</p>
    <p>Avg. Queuing Delay (ms)</p>
    <p>Wired Networks</p>
    <p>Be tte r</p>
    <p>Bet ter</p>
  </div>
  <div class="page">
    <p>Satellite link: High BDP, high loss</p>
    <p>CopaRemyPCC</p>
    <p>Cubic Vegas</p>
    <p>BBR</p>
    <p>Th ro</p>
    <p>ug hp</p>
    <p>ut (M</p>
    <p>bi t/s</p>
    <p>)</p>
    <p>Median Queuing Delay (ms)</p>
    <p>Bett er</p>
  </div>
  <div class="page">
    <p>Fairness during flow-churn</p>
    <p>Copa</p>
    <p>BBR</p>
    <p>Cubic</p>
    <p>PCC</p>
    <p>Th ro</p>
    <p>ug hp</p>
    <p>ut (M</p>
    <p>bi t/</p>
    <p>s) Av</p>
    <p>g</p>
    <p>St d.</p>
    <p>D ev</p>
    <p>.</p>
    <p>Time (s) Time (s)</p>
  </div>
  <div class="page">
    <p>Fairness during flow-churn</p>
    <p>Copa</p>
    <p>BBR</p>
    <p>Cubic</p>
    <p>PCC</p>
    <p>Th ro</p>
    <p>ug hp</p>
    <p>ut (M</p>
    <p>bi t/</p>
    <p>s) Av</p>
    <p>g</p>
    <p>St d.</p>
    <p>D ev</p>
    <p>.</p>
    <p>Time (s) Time (s)</p>
    <p>C op</p>
    <p>aC ub</p>
    <p>icB BR</p>
    <p>PC C</p>
    <p>Jain index</p>
    <p>Better</p>
  </div>
  <div class="page">
    <p>Summary</p>
    <p>Network Estimate queuing delay</p>
    <p>and compute target</p>
    <p>!</p>
    <p>A practical delay-based congestion control algorithm https://web.mit.edu/copa</p>
  </div>
  <div class="page">
    <p>Summary</p>
    <p>Network Estimate queuing delay</p>
    <p>and compute target</p>
    <p>!</p>
    <p>Outer control loop Mode switching and Competitive mode</p>
    <p>A practical delay-based congestion control algorithm https://web.mit.edu/copa</p>
  </div>
  <div class="page">
    <p>Summary</p>
    <p>Network Estimate queuing delay</p>
    <p>and compute target</p>
    <p>Move toward target (AIAD-variant)</p>
    <p>!</p>
    <p>Outer control loop Mode switching and Competitive mode</p>
    <p>A practical delay-based congestion control algorithm https://web.mit.edu/copa</p>
    <p>Rate/cwnd</p>
  </div>
</Presentation>
