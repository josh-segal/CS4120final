<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>http://www.cl.cam.ac.uk/~mgk25/sc99-tamper[-slides].pdf</p>
    <p>Oliver Kmmerling</p>
    <p>ADSR</p>
    <p>Markus G. Kuhn</p>
    <p>Computer Laboratory</p>
    <p>Design Principles for Tamper-Resistant Smartcard Processors</p>
  </div>
  <div class="page">
    <p>Classes of Attacks on Security Modules</p>
    <p>Microprobing</p>
    <p>Use the normal communication interface and abuse security vulnerabilities</p>
    <p>Open the package, access the chip surface with semiconductor test</p>
    <p>equipment, and observe and manipulate the internal data paths</p>
    <p>Eavesdropping Without opening the package, try to get access to protected information by</p>
    <p>analyzing compromising signals in emanated electromagnetic radiation, supply</p>
    <p>Fault Generation Provoke malfunctions by operating the device under environmental stress</p>
    <p>conditions such as high/low temperature, supply voltage variations and spikes,</p>
    <p>found in the protocols, cryptographic algorithms, or their implementation</p>
    <p>current fluctuations, leakage currents on signal lines, and protocol timings</p>
    <p>Software Attacks</p>
    <p>clock-phase jumps, ionising radiation, protocol violations, partial resets, etc.</p>
  </div>
  <div class="page">
    <p>Microprobing</p>
    <p>FIB editing</p>
    <p>Layout reconstruction</p>
    <p>Require between hours and weeks in a specialized laboratory, therefore the owner of</p>
    <p>Glitch attacks</p>
    <p>Power analysis</p>
    <p>violate tamper resistance requirement</p>
    <p>Invasive attacks</p>
    <p>Non-invasive attacks</p>
    <p>the card is likely to notice the attack and can revoke certificates for keys that might be lost.</p>
    <p>revoke keys.</p>
    <p>Tamper Resistance versus Tamper Evidence</p>
    <p>(FIPS 140-1 Level 4)</p>
    <p>(FIPS 140-1 Level 2) Software vulnerabilities</p>
    <p>violate in addition tamper-evidence requirement</p>
    <p>Can be performed within a few seconds inside a Trojan terminal in a Mafia-owned shop,</p>
    <p>therefore card owner will not notice that card secrets have been stolen and will not</p>
  </div>
  <div class="page">
    <p>Heat up card plastic, bend it, and remove chip module</p>
    <p>Dissolve package in 60 C fuming nitric acid, then wash in acetone,</p>
    <p>deionized water, and finally isopropanol. The etching should be</p>
    <p>carried out under very dry conditions.</p>
    <p>Preparation I: Depackaging the Processor</p>
  </div>
  <div class="page">
    <p>A manual bonding station establishes reliable contacts to the supply, communication,</p>
    <p>Preparation II: Bonding into a Test Package</p>
    <p>and test pads of the microprocessor using ultrasonic welding of a fine aluminium wire.</p>
  </div>
  <div class="page">
    <p>A B</p>
    <p>A B</p>
    <p>BVCC A A B</p>
    <p>VCC</p>
    <p>GND</p>
    <p>Confocal microscopes represent the different</p>
    <p>the metal interconnects have been removed with</p>
    <p>hydrofluoric acid. Both images together can be</p>
    <p>A B B</p>
    <p>A</p>
    <p>metal</p>
    <p>polysilicon</p>
    <p>A GND</p>
    <p>B</p>
    <p>B A</p>
    <p>areas dopant</p>
    <p>n-well</p>
    <p>chip layers in different colors. In the right image,</p>
    <p>read almost as easily as a circuit diagram.</p>
    <p>Optical Reverse-Engineering of VLSI Circuits</p>
    <p>B</p>
    <p>A</p>
  </div>
  <div class="page">
    <p>After all covering layers including the</p>
    <p>surrounding field oxide have been removed</p>
    <p>with hydrofluoric acid, the shape of the ground connection</p>
    <p>metal column access line</p>
    <p>polysilicon row access line</p>
    <p>Optical Access to Diffusion Layer ROM Content</p>
    <p>now visible diffusion areas will reveal the</p>
    <p>ROM content (here 16x10 bits).</p>
  </div>
  <div class="page">
    <p>Optical Reconstruction of Ion Implantation ROM Content</p>
    <p>View of ROM with polysilicon intact Diffusion layer after crystallographic etch</p>
    <p>This type of ROM does not reveal the bit pattern in the shape of the diffusion areas, but</p>
    <p>a crystallographic staining technique (Dash etchand) that etches doped regions faster</p>
    <p>than undoped regions will still show the ROM bits.</p>
  </div>
  <div class="page">
    <p>acquisition, oscilloscope, pattern generator, power supply,</p>
    <p>Access to CPU Bus via Laser Depassivation and Microprobing</p>
    <p>Photos: ADSR</p>
    <p>DSP card for card protocol interface handling and data</p>
    <p>Top: A complete microprobing station consisting of a micro</p>
    <p>scope (Mitutoyo FS-60), laser cutter (New Wave QuikLaze),</p>
    <p>logic analyzer, etc. Right: Eight depassivated data bus lines.</p>
    <p>four micropositioners (Karl Suss), CCD camera, PC with</p>
  </div>
  <div class="page">
    <p>to attack all applications. Carefully designed smartcard software makes it difficult</p>
    <p>Options:</p>
    <p>Disable instruction decoder, such that no JMP/CALL/RET/HALT instructions</p>
    <p>Passively monitoring and recording all memory-bus accesses might not be sufficient</p>
    <p>to trigger memory accesses to all secrets in a laboratory.</p>
    <p>Microprobing Access to All Memory Locations</p>
    <p>Card software that calculates a full memory checksum after each reset</p>
    <p>simplifies attacks considerably!</p>
    <p>Solution for Attacker:</p>
    <p>Abuse existing processor hardware as an address generator that accesses</p>
    <p>all memory locations predictably. A single probing needle can now capture</p>
    <p>all memory values, probing one bus line at a time.</p>
    <p>are executed (preferably only NOP-like instructions should be allowed).</p>
    <p>Disable program-counter load gate</p>
    <p>In many smartcard processors, this can be accomplished with just a single probe!</p>
  </div>
  <div class="page">
    <p>Focused Ion Beam Workstations for IC Modification</p>
    <p>with 30 kV and process gases like iodine or an organic</p>
    <p>Left Photo: Dept. of Material Sciences, University of Cambridge</p>
    <p>Focused ion-beam machines make high-resolution</p>
    <p>compound are injected near the target location.</p>
    <p>images of chip structures and allow us to both remove</p>
    <p>and deposit materials (metal and insulators) with</p>
  </div>
  <div class="page">
    <p>Electron Beam Testing</p>
    <p>Modified scanning electron microscope (SEM) with voltage contrast function.</p>
    <p>Primary electrons (2.5 kV, 5 nA) hit secondary electrons out of the target location.</p>
    <p>Limitation:</p>
    <p>Measured signal is the low-pass filtered product of the beam current multiplied</p>
    <p>Stroboscopic measurements allow to capture periodic signals with</p>
    <p>a bandwidth of several gigahertz</p>
    <p>limited to a few megahertz</p>
    <p>Real-time voltage contrast observation of a non-periodic signal is</p>
    <p>This allows contact-free signal measurements on the chip.</p>
    <p>indicates local field potential.</p>
    <p>Number and energy of secondary electrons recorded by spectrometer and detector</p>
    <p>with a function of the signal voltage.</p>
  </div>
  <div class="page">
    <p>Analog Circuit Characteristics Allow Non-Invasive Attacks</p>
    <p>Delays vary along various signal paths (RC and gate count)</p>
    <p>Static current consumption extremely small</p>
    <p>Significant short-circuit when SRAM cell changes state</p>
    <p>Brief short-circuit when CMOS gate changes state</p>
    <p>Flip-flop metastability</p>
    <p>Flip-flops sample input during a short interval and compare it with the</p>
    <p>supply voltage levels.</p>
    <p>Smartcards are particularly vulnerable to non-invasive attacks because the attacker</p>
    <p>simulations. Smartcard security cannot be achieved by studying</p>
    <p>only a digital abstraction of the processor design.</p>
    <p>Careful security reviews must usually include detailed analog VLSI</p>
    <p>... plus many other physical and electronic effects ...</p>
    <p>has full control over power and clock supply lines and environmental conditions.</p>
    <p>Capacitive loads draw current when a gate changes state</p>
  </div>
  <div class="page">
    <p>R</p>
    <p>C</p>
    <p>VCC</p>
    <p>CLK</p>
    <p>PROBE</p>
    <p>Change Single Instructions Using Signal Glitches</p>
    <p>Fault model:</p>
    <p>Links between gates form RC delay elements</p>
    <p>R and C vary between links and individual chips</p>
    <p>Max. RC sum of any signal path determines max.CLK frequency</p>
    <p>External electrical fields could open/close channels</p>
    <p>Transistors compare VCC and V , which allows VCC glitchesC</p>
  </div>
  <div class="page">
    <p>Instruction 1: CLR C Instruction 2: XOR B Instruction 3:</p>
    <p>Data values appear in power profiles either as differential Hamming weights</p>
    <p>Activation of EEPROM programming-voltage charge pump observable,</p>
    <p>which allows to abort before state changes (e.g., with bad retry counters)</p>
    <p>(~0.5-1 mA/bit) or as individual bits, e.g. with multiplication or shift instructions</p>
    <p>Characteristic current spikes can identify executed instruction</p>
    <p>EEPROM read-out amplifier, etc.)</p>
    <p>Power Supply Current Forms a Significant Covert Channel</p>
    <p>executed instruction sequence and observe cryptographic computations.</p>
    <p>Record current in VCC/GND connection with 12-bit, 30-MHz ADC, in order to reconstruct</p>
    <p>Current signature depends on accessed memory type (SRAM-write short circuit,</p>
  </div>
  <div class="page">
    <p>After 1000 external clock cycles, 200-300 internal clock cycles have been</p>
    <p>executed internally (binomial distribution).</p>
    <p>Randomized Internal Clock Signal</p>
    <p>Only timer and I/O shift registers are directly operated by external clock.</p>
    <p>Randomized Instruction-Level Multithreading</p>
    <p>program counter, and instruction register.</p>
    <p>Parallel encryption or background dummy operations introduce non-determinism</p>
    <p>Dummy loads are activated during rest periods to suppress the random sequence</p>
    <p>in the supply current.</p>
    <p>Every register and latch (except SRAM) is replicated, including stack pointer,</p>
    <p>Hardware random-bit generator schedules per instruction cycle between the</p>
    <p>Non-Deterministic Processors Complicate Observation</p>
    <p>Hardware random-bit generator supplies internal clock signal.</p>
    <p>two or more threads of execution that run on these register sets.</p>
    <p>and correlated covert-channel noise.</p>
  </div>
  <div class="page">
    <p>:4D</p>
    <p>Q</p>
    <p>Q</p>
    <p>QS</p>
    <p>R</p>
    <p>RST</p>
    <p>CLK</p>
    <p>Bus</p>
    <p>Tamper-Resistant Low-Frequency Sensor Design</p>
    <p>Processor blocks between power-up and reset. External reset triggers sensor test, which then</p>
    <p>CLK</p>
    <p>RST</p>
    <p>triggers internal reset. Internal reset terminates sensor test and thereby completes internal reset.</p>
    <p>Bus and control lines are immediately grounded by internal reset, which is also verified. Parts of</p>
    <p>the circuit are replicated (not shown here).</p>
    <p>No simple FIB or laser edit will allow real-time (single-shot) EBT bus recording</p>
  </div>
  <div class="page">
    <p>Attackers and test engineers share similar</p>
    <p>interests. Both need easy access to the</p>
    <p>Blown polysilicon fuse near test pad (Motorola)</p>
    <p>possible.</p>
    <p>Full bus available on large probing pads</p>
    <p>Solution:</p>
    <p>Test circuitry must not only be disabled by</p>
    <p>blowing fuses. It must be structurally</p>
    <p>destroyed.</p>
    <p>Test circuitry can be located on the 80-200 m</p>
    <p>wide area between the dies that is removed</p>
    <p>during wafer cutting.</p>
    <p>Pads usually disabled by blowing a poly fuse,</p>
    <p>but can easily be reconnected via FIB.</p>
    <p>on-chip bus lines with as few probes as</p>
    <p>Parallel/serial converters for full bus</p>
    <p>Commonly used test circuitry:</p>
    <p>Destruction of Test Circuitry</p>
  </div>
  <div class="page">
    <p>Restricted Program Counter</p>
    <p>Solution:</p>
    <p>full-size segment register S and a short (e.g., 7 bit) offset register O.</p>
    <p>Instructions are fetched from address S+O.</p>
    <p>A jump to address X is performed by loading X into S and setting O to zero.</p>
    <p>assembler preprocessor used by the developer can ensure automatically.</p>
    <p>Now, no simple FIB edit can cause the program counter to cover all addresses.</p>
    <p>circuitry requires many transistors and simple forms are also easily disabled.</p>
    <p>Only O is automatically incremented after every instruction. An overflow</p>
    <p>Replace the normal program counter (e.g., 16 bit) by a combination of a</p>
    <p>Unconditional jump commands must be less than 128 bytes apart, which an</p>
    <p>generator. Tamper-resistant design of the instruction decoder is difficult. Watchdog</p>
    <p>A standard program-counter mechanism is too easily abused as an address-sequence</p>
    <p>of O will halt the processor.</p>
  </div>
  <div class="page">
    <p>SENSE</p>
    <p>VCC</p>
    <p>GND</p>
    <p>SENSE</p>
    <p>The sensor line is checked during operation</p>
    <p>for interruptions or short-circuits, which trigger</p>
    <p>alarms (e.g., processor halt or flash erase).</p>
    <p>The power lines are at some places used to</p>
    <p>supply the circuits below.</p>
    <p>ST16SF48A</p>
    <p>Example of a Top-Layer Sensor Mesh</p>
  </div>
  <div class="page">
    <p>a) b)</p>
    <p>a)</p>
    <p>on top for easy microprobing.</p>
    <p>b)</p>
    <p>c) can be removed with a laser cutter to allow access to signals below the mesh.</p>
    <p>imprisoned crypto bits!&quot;).</p>
    <p>Not all power supply lines are used, so they</p>
    <p>Sensor Meshes: Vulnerabilities and Attacks</p>
    <p>via between mesh lines with an access cross FIB workstation can be used to place a new</p>
    <p>Design flaw: redundant bus lines extend beyond the sensor mesh, allowing easy microprobing access (&quot;Freedom for</p>
    <p>c)</p>
  </div>
  <div class="page">
    <p>Invasive techniques break all currently available smartcards and have</p>
    <p>led to continued conditional-access smartcard piracy since 1994</p>
    <p>tamper-resistant sensors</p>
    <p>top-layer sensor mesh</p>
    <p>Examples for lowest-cost countermeasures that are not yet implemented</p>
    <p>(conditional access, copy protection), better use battery-backed SRAM</p>
    <p>randomized clock</p>
    <p>instruction multi-threading</p>
    <p>constant-current regulators</p>
    <p>destruction of test circuits</p>
    <p>microprobing is generally the far easier and more universal type of attack</p>
    <p>loosely coupled clock PLL</p>
    <p>Extremely careful engineering might lead to high tamper-evidence assurance</p>
    <p>for smartcards one day (for banking, authentication, digital signatures)</p>
    <p>widely or in effective ways:</p>
    <p>Summary and Conclusions</p>
    <p>only in tamper-evidence applications (banking, signatures), because</p>
    <p>Non-invasive attacks (glitching, current analysis) are the main concern</p>
    <p>Smartcard form probably unsuitable for strong tamper-resistance requirements</p>
  </div>
</Presentation>
