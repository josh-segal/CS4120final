<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>The Mystery Machine: End-to-end performance analysis</p>
    <p>of large-scale Internet services</p>
    <p>Michael Chow David Meisner, Jason Flinn, Daniel Peek,</p>
    <p>Thomas F. Wenisch</p>
  </div>
  <div class="page">
    <p>Internet services are complex</p>
    <p>Michael Chow 2</p>
    <p>Tasks</p>
    <p>Time</p>
    <p>Scale and heterogeneity make Internet services complex</p>
  </div>
  <div class="page">
    <p>Internet services are complex</p>
    <p>Michael Chow 3</p>
    <p>Tasks</p>
    <p>Time</p>
    <p>Scale and heterogeneity make Internet services complex</p>
  </div>
  <div class="page">
    <p>Analysis Pipeline</p>
    <p>Michael Chow 4</p>
  </div>
  <div class="page">
    <p>Step 1: Identify segments</p>
    <p>Michael Chow 5</p>
  </div>
  <div class="page">
    <p>Step 2: Infer causal model</p>
    <p>Michael Chow 6</p>
  </div>
  <div class="page">
    <p>Step 3: Analyze individual requests</p>
    <p>Michael Chow 7</p>
  </div>
  <div class="page">
    <p>Step 4: Aggregate results</p>
    <p>Michael Chow 8</p>
  </div>
  <div class="page">
    <p>Challenges</p>
    <p>Previous methods derive a causal model  Instrument scheduler and communication  Build model through human knowledge</p>
    <p>Michael Chow 9</p>
    <p>Need method that works at scale with heterogeneous components</p>
  </div>
  <div class="page">
    <p>Opportunities</p>
    <p>Component-level logging is ubiquitous</p>
    <p>Handle a large number of requests</p>
    <p>Michael Chow 10</p>
    <p>Tremendous detail about a requests execution</p>
    <p>Coverage of a large range of behaviors</p>
  </div>
  <div class="page">
    <p>The Mystery Machine</p>
    <p>Michael Chow 11</p>
  </div>
  <div class="page">
    <p>Step 1: Identify segments</p>
    <p>Michael Chow 12</p>
  </div>
  <div class="page">
    <p>Define a minimal schema</p>
    <p>Michael Chow 13</p>
    <p>Segment 1 Segment 2</p>
    <p>Task</p>
    <p>Event Event Event</p>
  </div>
  <div class="page">
    <p>Define a minimal schema</p>
    <p>Michael Chow 14</p>
    <p>Segment 1 Segment 2</p>
    <p>Task</p>
    <p>Event Event Event</p>
    <p>Request identifier Machine identifier Timestamp Task Event</p>
    <p>Aggregate existing logs using minimal schema</p>
  </div>
  <div class="page">
    <p>Step 2: Infer causal model</p>
    <p>Michael Chow 15</p>
  </div>
  <div class="page">
    <p>Types of causal relationships</p>
    <p>Michael Chow 16</p>
    <p>Relationship Counterexample Happens-Before</p>
    <p>Mutual Exclusion</p>
    <p>Pipeline</p>
    <p>B A A B</p>
    <p>B A</p>
    <p>A B OR B A</p>
    <p>B A C</p>
    <p>B A C</p>
    <p>B A C</p>
    <p>B C A</p>
    <p>t1</p>
    <p>t2</p>
    <p>t1</p>
    <p>t2</p>
  </div>
  <div class="page">
    <p>Producing causal model</p>
    <p>Michael Chow 17</p>
    <p>Causal Model</p>
    <p>S1 N1 C1</p>
    <p>S2 N2 C2</p>
  </div>
  <div class="page">
    <p>Producing causal model</p>
    <p>Michael Chow 18</p>
    <p>Causal Model</p>
    <p>S1 N1 C1</p>
    <p>S2 N2 C2</p>
    <p>C1 N1 S1</p>
    <p>C2 N2 S2 Trace 1</p>
    <p>Time</p>
  </div>
  <div class="page">
    <p>Producing causal model</p>
    <p>Michael Chow 19</p>
    <p>Causal Model</p>
    <p>S1 N1 C1</p>
    <p>S2 N2 C2</p>
    <p>C1 N1 S1</p>
    <p>C2 N2 S2 Trace 1</p>
    <p>Time</p>
  </div>
  <div class="page">
    <p>Producing causal model</p>
    <p>Michael Chow 20</p>
    <p>Causal Model</p>
    <p>S1 N1 C1</p>
    <p>S2 N2 C2</p>
    <p>C1 N1 S1</p>
    <p>C2 N2 S2</p>
    <p>Time</p>
    <p>Trace 2</p>
  </div>
  <div class="page">
    <p>Producing causal model</p>
    <p>Michael Chow 21</p>
    <p>Causal Model</p>
    <p>S1 N1 C1</p>
    <p>S2 N2 C2</p>
    <p>C1 N1 S1</p>
    <p>C2 N2 S2</p>
    <p>Time</p>
    <p>Trace 2</p>
  </div>
  <div class="page">
    <p>Producing causal model</p>
    <p>Michael Chow 22</p>
    <p>Causal Model</p>
    <p>S1 N1 C1</p>
    <p>S2 N2 C2</p>
    <p>C1 N1 S1</p>
    <p>C2 N2 S2</p>
    <p>Time</p>
    <p>Trace 2</p>
  </div>
  <div class="page">
    <p>Step 3: Analyze individual requests</p>
    <p>Michael Chow 23</p>
  </div>
  <div class="page">
    <p>Critical path using causal model</p>
    <p>Michael Chow 24</p>
    <p>S1 N1 C1</p>
    <p>S2 N2 C2</p>
    <p>C1 N1 S1</p>
    <p>C2 N2 S2 Trace 1</p>
    <p>Time</p>
  </div>
  <div class="page">
    <p>Critical path using causal model</p>
    <p>Michael Chow 25</p>
    <p>S1 N1 C1</p>
    <p>S2 N2 C2</p>
    <p>C1 N1 S1</p>
    <p>C2 N2 S2</p>
    <p>Trace 1</p>
  </div>
  <div class="page">
    <p>Critical path using causal model</p>
    <p>Michael Chow 26</p>
    <p>S1 N1 C1</p>
    <p>S2 N2 C2</p>
    <p>C1 N1 S1</p>
    <p>C2 N2 S2</p>
    <p>Trace 1</p>
  </div>
  <div class="page">
    <p>Step 4: Aggregate results</p>
    <p>Michael Chow 27</p>
  </div>
  <div class="page">
    <p>Inaccuracies of Nave Aggregation</p>
    <p>Michael Chow 28</p>
  </div>
  <div class="page">
    <p>Inaccuracies of Nave Aggregation</p>
    <p>Michael Chow 29</p>
  </div>
  <div class="page">
    <p>Inaccuracies of Nave Aggregation</p>
    <p>Michael Chow 30</p>
    <p>Need a causal model to correctly understand latency</p>
  </div>
  <div class="page">
    <p>High variance in critical path</p>
    <p>Breakdown in critical path shifts drastically  Server, network, or client can dominate latency</p>
    <p>Michael Chow 31</p>
    <p>Server Network Client</p>
    <p>Percent of critical path Percent of critical path Percent of critical path</p>
    <p>cd f</p>
  </div>
  <div class="page">
    <p>High variance in critical path</p>
    <p>Breakdown in critical path shifts drastically  Server, network, or client can dominate latency</p>
    <p>Michael Chow 32</p>
    <p>Server Network Client</p>
    <p>Percent of critical path Percent of critical path Percent of critical path</p>
    <p>cd f</p>
  </div>
  <div class="page">
    <p>High variance in critical path</p>
    <p>Breakdown in critical path shifts drastically  Server, network, or client can dominate latency</p>
    <p>Michael Chow 33</p>
    <p>Server Network Client</p>
    <p>Percent of critical path Percent of critical path Percent of critical path</p>
    <p>cd f</p>
    <p>of latency</p>
  </div>
  <div class="page">
    <p>Diverse clients and networks</p>
    <p>Michael Chow 34</p>
    <p>Server Network Client</p>
    <p>Server Network Client</p>
    <p>Server Network Client</p>
  </div>
  <div class="page">
    <p>Diverse clients and networks</p>
    <p>Michael Chow 35</p>
    <p>Server Network Client</p>
    <p>Server Network Client</p>
    <p>Server Network Client</p>
  </div>
  <div class="page">
    <p>Diverse clients and networks</p>
    <p>Michael Chow 36</p>
    <p>Server Network Client</p>
    <p>Server Network Client</p>
    <p>Server Network Client</p>
  </div>
  <div class="page">
    <p>Differentiated service</p>
    <p>Michael Chow 37</p>
    <p>Deliver data when needed and reduce average response time</p>
    <p>No slack in server generation time Produce data faster</p>
    <p>Decrease end-to-end latency</p>
    <p>Slack in server generation time Produce data slower</p>
    <p>End-to-end latency stays same</p>
  </div>
  <div class="page">
    <p>Additional analysis techniques</p>
    <p>Slack analysis</p>
    <p>What-if analysis  Use natural variation in large data set</p>
    <p>Michael Chow 38</p>
    <p>C1 N1 S1</p>
    <p>C2 N2 S2</p>
    <p>Time</p>
  </div>
  <div class="page">
    <p>What-if questions</p>
    <p>Does server generation time affect end-toend latency?</p>
    <p>Can we predict which connections exhibit server slack?</p>
    <p>Michael Chow 39</p>
  </div>
  <div class="page">
    <p>Server slack analysis</p>
    <p>Michael Chow 40</p>
    <p>Slack &lt; 25ms Slack &gt; 2.5s</p>
  </div>
  <div class="page">
    <p>Server slack analysis</p>
    <p>Michael Chow 41</p>
    <p>Slack &lt; 25ms Slack &gt; 2.5s</p>
    <p>End-to-end latency increases as server</p>
    <p>generation time increases</p>
    <p>Server generation time has little effect</p>
    <p>on end-to-end latency</p>
  </div>
  <div class="page">
    <p>Predicting server slack</p>
    <p>Predict slack at the receipt of a request  Past slack is representative of future slack</p>
    <p>Michael Chow 42</p>
    <p>First slack (ms)</p>
    <p>S ec</p>
    <p>on d</p>
    <p>sl ac</p>
    <p>k (m</p>
    <p>s)</p>
  </div>
  <div class="page">
    <p>Predicting server slack</p>
    <p>Predict slack at the receipt of a request  Past slack is representative of future slack</p>
    <p>Michael Chow 43</p>
    <p>Classifies 83% of</p>
    <p>requests correctly</p>
    <p>Type II Error 9%</p>
    <p>Type I Error 8%</p>
    <p>First slack (ms)</p>
    <p>S ec</p>
    <p>on d</p>
    <p>sl ac</p>
    <p>k (m</p>
    <p>s)</p>
  </div>
  <div class="page">
    <p>Conclusion</p>
    <p>Michael Chow 44</p>
  </div>
  <div class="page">
    <p>Questions</p>
    <p>Michael Chow 45</p>
  </div>
</Presentation>
