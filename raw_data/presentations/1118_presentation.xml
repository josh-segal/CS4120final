<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Throwhammer Rowhammer Attacks over the Network and Defenses</p>
    <p>Andrei Tatar</p>
    <p>Radhesh Krishnan Konoth Elias Athanasopoulos</p>
    <p>Cristiano Giuffrida Herbert Bos Kaveh Razavi</p>
  </div>
  <div class="page">
    <p>What is this about?</p>
    <p>Fast networks</p>
    <p>Smart NICs (RDMA)</p>
    <p>Dense DRAM</p>
    <p>}  rowhammer</p>
    <p>Rowhammer over RDMA</p>
    <p>@vu5ec #throwhammer 1</p>
  </div>
  <div class="page">
    <p>What is this about?</p>
    <p>Fast networks</p>
    <p>Smart NICs (RDMA)</p>
    <p>Dense DRAM</p>
    <p>}  rowhammer</p>
    <p>Rowhammer over RDMA</p>
    <p>@vu5ec #throwhammer 1</p>
  </div>
  <div class="page">
    <p>What is this about?</p>
    <p>Throwhammer:</p>
    <p>Rowhammer attack over the network</p>
    <p>Requires no code execution on victim</p>
    <p>Vanilla network stack</p>
    <p>@vu5ec #throwhammer 2</p>
  </div>
  <div class="page">
    <p>What is this about?</p>
    <p>Defending against Throwhammer:</p>
    <p>Main idea: isolate RDMA buffers</p>
    <p>Challenges of isolation  not trivial</p>
    <p>Solution: ALIS</p>
    <p>@vu5ec #throwhammer 3</p>
  </div>
  <div class="page">
    <p>Inside DRAM</p>
    <p>...</p>
    <p>...</p>
    <p>...</p>
    <p>...</p>
    <p>.. .</p>
    <p>.. .</p>
    <p>.. .</p>
    <p>...</p>
    <p>row0</p>
    <p>row1</p>
    <p>row2</p>
    <p>row3</p>
    <p>rowN</p>
    <p>col0 col1 col2 col3 colM</p>
    <p>@vu5ec #throwhammer 4</p>
  </div>
  <div class="page">
    <p>Accessing DRAM</p>
    <p>...</p>
    <p>...</p>
    <p>...</p>
    <p>...</p>
    <p>.. .</p>
    <p>.. .</p>
    <p>.. .</p>
    <p>...</p>
    <p>row0</p>
    <p>row1</p>
    <p>row2</p>
    <p>row3</p>
    <p>rowN</p>
    <p>col0 col1 col2 col3 colM</p>
    <p>@vu5ec #throwhammer 5</p>
  </div>
  <div class="page">
    <p>Accessing DRAM</p>
    <p>...</p>
    <p>...</p>
    <p>...</p>
    <p>...</p>
    <p>.. .</p>
    <p>.. .</p>
    <p>.. .</p>
    <p>...</p>
    <p>row0</p>
    <p>row1</p>
    <p>row2</p>
    <p>row3</p>
    <p>rowN</p>
    <p>col0 col1 col2 col3 colM</p>
    <p>@vu5ec #throwhammer 5</p>
  </div>
  <div class="page">
    <p>Leaking Charge: Rowhammer</p>
    <p>...</p>
    <p>...</p>
    <p>...</p>
    <p>...</p>
    <p>.. .</p>
    <p>.. .</p>
    <p>.. .</p>
    <p>...</p>
    <p>row0</p>
    <p>row1</p>
    <p>row2</p>
    <p>row3</p>
    <p>rowN</p>
    <p>col0 col1 col2 col3 colM</p>
    <p>@vu5ec #throwhammer 6</p>
  </div>
  <div class="page">
    <p>Leaking Charge: Rowhammer</p>
    <p>...</p>
    <p>...</p>
    <p>...</p>
    <p>...</p>
    <p>.. .</p>
    <p>.. .</p>
    <p>.. .</p>
    <p>...</p>
    <p>row0</p>
    <p>row1</p>
    <p>row2</p>
    <p>row3</p>
    <p>rowN</p>
    <p>col0 col1 col2 col3 colM</p>
    <p>@vu5ec #throwhammer 6</p>
  </div>
  <div class="page">
    <p>Leaking Charge: Rowhammer</p>
    <p>...</p>
    <p>...</p>
    <p>...</p>
    <p>...</p>
    <p>.. .</p>
    <p>.. .</p>
    <p>.. .</p>
    <p>...</p>
    <p>row0</p>
    <p>row1</p>
    <p>row2</p>
    <p>row3</p>
    <p>rowN</p>
    <p>col0 col1 col2 col3 colM</p>
    <p>@vu5ec #throwhammer 7</p>
  </div>
  <div class="page">
    <p>Leaking Charge: Rowhammer</p>
    <p>...</p>
    <p>...</p>
    <p>...</p>
    <p>...</p>
    <p>.. .</p>
    <p>.. .</p>
    <p>.. .</p>
    <p>...</p>
    <p>row0</p>
    <p>row1</p>
    <p>row2</p>
    <p>row3</p>
    <p>rowN</p>
    <p>col0 col1 col2 col3 colM</p>
    <p>@vu5ec #throwhammer 7</p>
  </div>
  <div class="page">
    <p>Leaking Charge: Rowhammer</p>
    <p>...</p>
    <p>...</p>
    <p>...</p>
    <p>...</p>
    <p>.. .</p>
    <p>.. .</p>
    <p>.. .</p>
    <p>...</p>
    <p>row0</p>
    <p>row1</p>
    <p>row2</p>
    <p>row3</p>
    <p>rowN</p>
    <p>col0 col1 col2 col3 colM</p>
    <p>! ! !!</p>
    <p>@vu5ec #throwhammer 7</p>
  </div>
  <div class="page">
    <p>Rowhammer: The Basics</p>
    <p>First study published in 2014</p>
    <p>Present in DDR3 DRAM and newer</p>
    <p>Affected devices in all price ranges and form factors</p>
    <p>Vulnerable locations are specific to particular chips</p>
    <p>... and are reproducible  attackers can choose their flip</p>
    <p>@vu5ec #throwhammer 8</p>
  </div>
  <div class="page">
    <p>Rowhammer: The Basics</p>
    <p>First study published in 2014</p>
    <p>Present in DDR3 DRAM and newer</p>
    <p>Affected devices in all price ranges and form factors</p>
    <p>Vulnerable locations are specific to particular chips</p>
    <p>... and are reproducible  attackers can choose their flip</p>
    <p>@vu5ec #throwhammer 8</p>
  </div>
  <div class="page">
    <p>Triggering Rowhammer</p>
    <p>500k activations / refresh interval (64 ms)</p>
    <p>High spatial and temporal locality</p>
    <p>... caches get in the way of accidental triggering</p>
    <p>@vu5ec #throwhammer 9</p>
  </div>
  <div class="page">
    <p>Triggering Rowhammer</p>
    <p>500k activations / refresh interval (64 ms)</p>
    <p>High spatial and temporal locality</p>
    <p>... caches get in the way of accidental triggering</p>
    <p>@vu5ec #throwhammer 9</p>
  </div>
  <div class="page">
    <p>Triggering Rowhammer</p>
    <p>Can be triggered on purpose:</p>
    <p>Cache flushing (clflush on x86)</p>
    <p>Cache eviction strategies</p>
    <p>Uncached memory</p>
    <p>@vu5ec #throwhammer 10</p>
  </div>
  <div class="page">
    <p>Exploiting Rowhammer</p>
    <p>Has been exploited from:</p>
    <p>Unprivileged native code (e.g., co-hosted VMs)</p>
    <p>Interpreted/Sandboxed languages (e.g., Javascript)</p>
    <p>WebGL code running on the integrated GPU (GLitch)</p>
    <p>@vu5ec #throwhammer 11</p>
  </div>
  <div class="page">
    <p>However</p>
    <p>All previous attacks relied on code execution on the victim machine</p>
    <p>... a privilege most attackers dont have</p>
    <p>... and one that can be revoked if necessary</p>
    <p>@vu5ec #throwhammer 12</p>
  </div>
  <div class="page">
    <p>However</p>
    <p>So are we safe?</p>
    <p>@vu5ec #throwhammer 12</p>
  </div>
  <div class="page">
    <p>A Step Back: Network Speeds Over Time</p>
    <p>G b p s</p>
    <p>Infiniband Ethernet</p>
    <p>Year</p>
    <p>@vu5ec #throwhammer 13</p>
  </div>
  <div class="page">
    <p>A Step Back: Network Speeds Over Time</p>
    <p>G b</p>
    <p>p s</p>
    <p>Infiniband Ethernet</p>
    <p>Vulnerable DIMMs</p>
    <p>Year</p>
    <p>@vu5ec #throwhammer 13</p>
  </div>
  <div class="page">
    <p>A Step Back: Triggering Rowhammer</p>
    <p>500k accesses / 64ms</p>
    <p>8M accesses / sec</p>
    <p>= 8M packets / sec ... feasible with 10Gbps</p>
    <p>@vu5ec #throwhammer 14</p>
  </div>
  <div class="page">
    <p>A Step Back: Triggering Rowhammer</p>
    <p>500k accesses / 64ms  8M accesses / sec</p>
    <p>= 8M packets / sec ... feasible with 10Gbps</p>
    <p>@vu5ec #throwhammer 14</p>
  </div>
  <div class="page">
    <p>A Step Back: Triggering Rowhammer</p>
    <p>500k accesses / 64ms  8M accesses / sec</p>
    <p>= 8M packets / sec</p>
    <p>... feasible with 10Gbps</p>
    <p>@vu5ec #throwhammer 14</p>
  </div>
  <div class="page">
    <p>A Step Back: Triggering Rowhammer</p>
    <p>500k accesses / 64ms  8M accesses / sec</p>
    <p>= 8M packets / sec ... feasible with 10Gbps</p>
    <p>@vu5ec #throwhammer 14</p>
  </div>
  <div class="page">
    <p>Vulnerable Networks?</p>
    <p>G b</p>
    <p>p s</p>
    <p>Infiniband Ethernet</p>
    <p>Vulnerable DIMMs</p>
    <p>Year</p>
    <p>@vu5ec #throwhammer 15</p>
  </div>
  <div class="page">
    <p>Vulnerable Networks?</p>
    <p>G b</p>
    <p>p s</p>
    <p>Infiniband Ethernet</p>
    <p>Vulnerable DIMMs</p>
    <p>Bit Flip Bandwidth</p>
    <p>Year</p>
    <p>@vu5ec #throwhammer 15</p>
  </div>
  <div class="page">
    <p>Vulnerable Networks?</p>
    <p>G b</p>
    <p>p s</p>
    <p>Infiniband Ethernet</p>
    <p>Vulnerable DIMMs</p>
    <p>Bit Flip Bandwidth</p>
    <p>Year</p>
    <p>@vu5ec #throwhammer 15</p>
  </div>
  <div class="page">
    <p>Not So Fast</p>
    <p>User</p>
    <p>Kernel</p>
    <p>Server App</p>
    <p>Net BufferClient App</p>
    <p>App Buffer</p>
    <p>DMA Buffer NIC</p>
    <p>CPU</p>
    <p>User</p>
    <p>Kernel</p>
    <p>Client App</p>
    <p>Net Buffer Server App</p>
    <p>App Buffer</p>
    <p>NIC</p>
    <p>CPU</p>
    <p>DMA BufferDMA Buffer</p>
    <p>Tradional Networks</p>
    <p>Client Server</p>
    <p>@vu5ec #throwhammer 16</p>
  </div>
  <div class="page">
    <p>Not So Fast</p>
    <p>User</p>
    <p>Kernel</p>
    <p>Server App</p>
    <p>Net BufferClient App</p>
    <p>App Buffer</p>
    <p>DMA Buffer NIC</p>
    <p>CPU</p>
    <p>User</p>
    <p>Kernel</p>
    <p>Client App</p>
    <p>Net Buffer Server App</p>
    <p>App Buffer</p>
    <p>NIC</p>
    <p>CPU</p>
    <p>DMA BufferDMA Buffer</p>
    <p>Tradional Networks</p>
    <p>Client Server</p>
    <p>@vu5ec #throwhammer 16</p>
  </div>
  <div class="page">
    <p>Not So Fast</p>
    <p>User</p>
    <p>Kernel</p>
    <p>Server App</p>
    <p>Net BufferClient App</p>
    <p>App Buffer</p>
    <p>DMA Buffer NIC</p>
    <p>CPU</p>
    <p>User</p>
    <p>Kernel</p>
    <p>Client App</p>
    <p>Net Buffer Server App</p>
    <p>App Buffer</p>
    <p>NIC</p>
    <p>CPU</p>
    <p>DMA BufferDMA Buffer</p>
    <p>Tradional Networks</p>
    <p>Client Server</p>
    <p>@vu5ec #throwhammer 16</p>
  </div>
  <div class="page">
    <p>Not So Fast</p>
    <p>User</p>
    <p>Kernel</p>
    <p>Server App</p>
    <p>Net BufferClient App</p>
    <p>App Buffer</p>
    <p>DMA Buffer NIC</p>
    <p>CPU</p>
    <p>User</p>
    <p>Kernel</p>
    <p>Client App</p>
    <p>Net Buffer Server App</p>
    <p>App Buffer</p>
    <p>NIC</p>
    <p>CPU</p>
    <p>DMA BufferDMA Buffer</p>
    <p>Tradional Networks</p>
    <p>Client Server</p>
    <p>@vu5ec #throwhammer 16</p>
  </div>
  <div class="page">
    <p>Not So Fast</p>
    <p>User</p>
    <p>Kernel</p>
    <p>Server App</p>
    <p>Net BufferClient App</p>
    <p>App Buffer</p>
    <p>DMA Buffer NIC</p>
    <p>CPU</p>
    <p>User</p>
    <p>Kernel</p>
    <p>Client App</p>
    <p>Net Buffer Server App</p>
    <p>App Buffer</p>
    <p>NIC</p>
    <p>CPU</p>
    <p>DMA BufferDMA Buffer</p>
    <p>Tradional Networks</p>
    <p>Client Server</p>
    <p>@vu5ec #throwhammer 16</p>
  </div>
  <div class="page">
    <p>Not So Fast</p>
    <p>User</p>
    <p>Kernel</p>
    <p>Server App</p>
    <p>Net BufferClient App</p>
    <p>App Buffer</p>
    <p>DMA Buffer NIC</p>
    <p>CPU</p>
    <p>User</p>
    <p>Kernel</p>
    <p>Client App</p>
    <p>Net Buffer Server App</p>
    <p>App Buffer</p>
    <p>NIC</p>
    <p>CPU</p>
    <p>DMA BufferDMA Buffer</p>
    <p>Tradional Networks</p>
    <p>Client Server</p>
    <p>@vu5ec #throwhammer 16</p>
  </div>
  <div class="page">
    <p>Not So Fast</p>
    <p>User</p>
    <p>Kernel</p>
    <p>Server App</p>
    <p>Net BufferClient App</p>
    <p>App Buffer</p>
    <p>DMA Buffer NIC</p>
    <p>CPU</p>
    <p>User</p>
    <p>Kernel</p>
    <p>Client App</p>
    <p>Net Buffer Server App</p>
    <p>App Buffer</p>
    <p>NIC</p>
    <p>CPU</p>
    <p>DMA BufferDMA Buffer</p>
    <p>Tradional Networks</p>
    <p>Client Server</p>
    <p>@vu5ec #throwhammer 16</p>
  </div>
  <div class="page">
    <p>Not So Fast</p>
    <p>User</p>
    <p>Kernel</p>
    <p>Server App</p>
    <p>Net BufferClient App</p>
    <p>App Buffer</p>
    <p>DMA Buffer NIC</p>
    <p>CPU</p>
    <p>User</p>
    <p>Kernel</p>
    <p>Client App</p>
    <p>Net Buffer Server App</p>
    <p>App Buffer</p>
    <p>NIC</p>
    <p>CPU</p>
    <p>DMA BufferDMA Buffer</p>
    <p>Tradional Networks</p>
    <p>Client Server</p>
    <p>@vu5ec #throwhammer 16</p>
  </div>
  <div class="page">
    <p>Not So Fast</p>
    <p>User</p>
    <p>Kernel</p>
    <p>Server App</p>
    <p>Net BufferClient App</p>
    <p>App Buffer</p>
    <p>DMA Buffer NIC</p>
    <p>CPU</p>
    <p>User</p>
    <p>Kernel</p>
    <p>Client App</p>
    <p>Net Buffer Server App</p>
    <p>App Buffer</p>
    <p>NIC</p>
    <p>CPU</p>
    <p>DMA BufferDMA Buffer</p>
    <p>Tradional Networks</p>
    <p>Client Server</p>
    <p>@vu5ec #throwhammer 16</p>
  </div>
  <div class="page">
    <p>Not So Fast</p>
    <p>Network I/O entails many memory accesses per packet</p>
    <p>... DMA from the NIC</p>
    <p>... memory copies within the network stack</p>
    <p>... userspace handling of packet data</p>
    <p>Reduces control of targeted memory accesses</p>
    <p>... and involves the cache</p>
    <p>@vu5ec #throwhammer 17</p>
  </div>
  <div class="page">
    <p>Not So Fast</p>
    <p>Network I/O entails many memory accesses per packet</p>
    <p>... DMA from the NIC</p>
    <p>... memory copies within the network stack</p>
    <p>... userspace handling of packet data</p>
    <p>Reduces control of targeted memory accesses</p>
    <p>... and involves the cache</p>
    <p>@vu5ec #throwhammer 17</p>
  </div>
  <div class="page">
    <p>Not So Fast</p>
    <p>Network I/O entails many memory accesses per packet</p>
    <p>... DMA from the NIC</p>
    <p>... memory copies within the network stack</p>
    <p>... userspace handling of packet data</p>
    <p>Reduces control of targeted memory accesses</p>
    <p>... and involves the cache</p>
    <p>@vu5ec #throwhammer 17</p>
  </div>
  <div class="page">
    <p>Not So Fast</p>
    <p>Are we safe now?</p>
    <p>@vu5ec #throwhammer 17</p>
  </div>
  <div class="page">
    <p>Enter RDMA</p>
    <p>Short for Remote Direct Memory Access</p>
    <p>High speed, low latency networking</p>
    <p>Supported by an real world network daemons (e.g., NFS, SMB)</p>
    <p>Used extensively in data centers</p>
    <p>Available in public clouds (e.g., Azure)</p>
    <p>@vu5ec #throwhammer 18</p>
  </div>
  <div class="page">
    <p>Enter RDMA</p>
    <p>User</p>
    <p>Kernel</p>
    <p>Server App</p>
    <p>Net BufferClient App</p>
    <p>App Buffer</p>
    <p>DMA Buffer NIC</p>
    <p>CPU</p>
    <p>User</p>
    <p>Kernel</p>
    <p>Client App</p>
    <p>Net Buffer Server App</p>
    <p>App Buffer</p>
    <p>NIC</p>
    <p>CPU</p>
    <p>DMA BufferDMA Buffer</p>
    <p>Tradional Networks</p>
    <p>Client Server</p>
    <p>@vu5ec #throwhammer 18</p>
  </div>
  <div class="page">
    <p>Enter RDMA</p>
    <p>User</p>
    <p>Kernel</p>
    <p>Server App</p>
    <p>Net BufferClient App</p>
    <p>RDMA Buffer</p>
    <p>NIC</p>
    <p>CPU</p>
    <p>User</p>
    <p>Kernel</p>
    <p>Client App</p>
    <p>Net Buffer Server App</p>
    <p>RDMA Buffer</p>
    <p>NIC</p>
    <p>CPU</p>
    <p>RDMA-enabled Networks</p>
    <p>Client Server</p>
    <p>@vu5ec #throwhammer 19</p>
  </div>
  <div class="page">
    <p>Enter RDMA</p>
    <p>User</p>
    <p>Kernel</p>
    <p>Server App</p>
    <p>Net BufferClient App</p>
    <p>RDMA Buffer</p>
    <p>NIC</p>
    <p>CPU</p>
    <p>User</p>
    <p>Kernel</p>
    <p>Client App</p>
    <p>Net Buffer Server App</p>
    <p>RDMA Buffer</p>
    <p>NIC</p>
    <p>CPU</p>
    <p>RDMA-enabled Networks</p>
    <p>Client Server</p>
    <p>@vu5ec #throwhammer 19</p>
  </div>
  <div class="page">
    <p>Enter RDMA</p>
    <p>User</p>
    <p>Kernel</p>
    <p>Server App</p>
    <p>Net BufferClient App</p>
    <p>RDMA Buffer</p>
    <p>NIC</p>
    <p>CPU</p>
    <p>User</p>
    <p>Kernel</p>
    <p>Client App</p>
    <p>Net Buffer Server App</p>
    <p>RDMA Buffer</p>
    <p>NIC</p>
    <p>CPU</p>
    <p>RDMA-enabled Networks</p>
    <p>Client Server</p>
    <p>@vu5ec #throwhammer 19</p>
  </div>
  <div class="page">
    <p>Enter RDMA</p>
    <p>User</p>
    <p>Kernel</p>
    <p>Server App</p>
    <p>Net BufferClient App</p>
    <p>RDMA Buffer</p>
    <p>NIC</p>
    <p>CPU</p>
    <p>User</p>
    <p>Kernel</p>
    <p>Client App</p>
    <p>Net Buffer Server App</p>
    <p>RDMA Buffer</p>
    <p>NIC</p>
    <p>CPU</p>
    <p>RDMA-enabled Networks</p>
    <p>Client Server</p>
    <p>@vu5ec #throwhammer 19</p>
  </div>
  <div class="page">
    <p>Enter RDMA</p>
    <p>User</p>
    <p>Kernel</p>
    <p>Server App</p>
    <p>Net BufferClient App</p>
    <p>RDMA Buffer</p>
    <p>NIC</p>
    <p>CPU</p>
    <p>User</p>
    <p>Kernel</p>
    <p>Client App</p>
    <p>Net Buffer Server App</p>
    <p>RDMA Buffer</p>
    <p>NIC</p>
    <p>CPU</p>
    <p>RDMA-enabled Networks</p>
    <p>Client Server</p>
    <p>@vu5ec #throwhammer 19</p>
  </div>
  <div class="page">
    <p>Putting It All Together</p>
    <p>With RDMA we have a client requesting data from a server ...</p>
    <p>... requests that each directly determine a memory location</p>
    <p>... from which the NIC does uncached reads</p>
    <p>... at a rate of millions every second</p>
    <p>Can we trigger Rowhammer?</p>
    <p>@vu5ec #throwhammer 20</p>
  </div>
  <div class="page">
    <p>Putting It All Together</p>
    <p>With RDMA we have a client requesting data from a server ...</p>
    <p>... requests that each directly determine a memory location</p>
    <p>... from which the NIC does uncached reads</p>
    <p>... at a rate of millions every second</p>
    <p>Can we trigger Rowhammer?</p>
    <p>@vu5ec #throwhammer 20</p>
  </div>
  <div class="page">
    <p>Putting It All Together</p>
    <p>With RDMA we have a client requesting data from a server ...</p>
    <p>... requests that each directly determine a memory location</p>
    <p>... from which the NIC does uncached reads</p>
    <p>... at a rate of millions every second</p>
    <p>Can we trigger Rowhammer?</p>
    <p>@vu5ec #throwhammer 20</p>
  </div>
  <div class="page">
    <p>Putting It All Together</p>
    <p>With RDMA we have a client requesting data from a server ...</p>
    <p>... requests that each directly determine a memory location</p>
    <p>... from which the NIC does uncached reads</p>
    <p>... at a rate of millions every second</p>
    <p>Can we trigger Rowhammer?</p>
    <p>@vu5ec #throwhammer 20</p>
  </div>
  <div class="page">
    <p>Putting It All Together</p>
    <p>With RDMA we have a client requesting data from a server ...</p>
    <p>... requests that each directly determine a memory location</p>
    <p>... from which the NIC does uncached reads</p>
    <p>... at a rate of millions every second</p>
    <p>Can we trigger Rowhammer?</p>
    <p>@vu5ec #throwhammer 20</p>
  </div>
  <div class="page">
    <p>Throwhammer: Remote Rowhammer</p>
    <p>Yes.</p>
    <p>Rowhammer can be triggered remotely through RDMA networks.</p>
    <p>@vu5ec #throwhammer 21</p>
  </div>
  <div class="page">
    <p>Throwhammer: Remote Rowhammer</p>
    <p>Yes. Rowhammer can be triggered remotely through</p>
    <p>RDMA networks.</p>
    <p>@vu5ec #throwhammer 21</p>
  </div>
  <div class="page">
    <p>Throwhammer: Remote Rowhammer</p>
    <p>Our setup:</p>
    <p>2 x Mellanox ConnectX-4 NICs @ 40Gbps</p>
    <p>Client repeatedly requests data from locations of its choosing</p>
    <p>@vu5ec #throwhammer 22</p>
  </div>
  <div class="page">
    <p>Throwhammer: Remote Rowhammer</p>
    <p>U n iq</p>
    <p>u e fl</p>
    <p>ip s</p>
    <p>Minutes</p>
    <p>Hynix</p>
    <p>Corsair</p>
    <p>@vu5ec #throwhammer 23</p>
  </div>
  <div class="page">
    <p>Throwhammer: Lower Speeds</p>
    <p>We throttled the packet rate to test lower network speeds.</p>
    <p>Similar bit flip success rate as for 40Gbps down to 26 Gbps</p>
    <p>Found bit flips with speeds as low as 10Gbps</p>
    <p>@vu5ec #throwhammer 24</p>
  </div>
  <div class="page">
    <p>Exploiting Remote Bit Flips</p>
    <p>Threat model:</p>
    <p>Malicious client connected to victim via RDMA</p>
    <p>Client can repeatedly induce memory errors outside RDMA buffers</p>
    <p>All server software is bug-free</p>
    <p>@vu5ec #throwhammer 25</p>
  </div>
  <div class="page">
    <p>Exploiting Remote Bit Flips</p>
    <p>RDMA Memcached</p>
    <p>RDMA-enabled fork of memcached</p>
    <p>Memcached</p>
    <p>In-memory key/value store commonly used as a backend DB cache</p>
    <p>Retrieves values using a hash table</p>
    <p>@vu5ec #throwhammer 26</p>
  </div>
  <div class="page">
    <p>Exploiting Remote Bit Flips</p>
    <p>In a nutshell:</p>
    <p>Template memory to find which bit flips we can use</p>
    <p>Spray memory with hash colliding target items</p>
    <p>Use bit flip to add counterfeit item to collision chain</p>
    <p>Escalate!</p>
    <p>@vu5ec #throwhammer 27</p>
  </div>
  <div class="page">
    <p>Exploiting Remote Bit Flips</p>
    <p>*next *prev *h_next</p>
    <p>... key +</p>
    <p>value</p>
    <p>attacker controlled</p>
    <p>item metadata</p>
    <p>@vu5ec #throwhammer 28</p>
  </div>
  <div class="page">
    <p>Exploiting Remote Bit Flips</p>
    <p>...</p>
    <p>... h_next</p>
    <p>...</p>
    <p>... h_next</p>
    <p>...</p>
    <p>... h_next</p>
    <p>attacker controlled</p>
    <p>attacker controlled</p>
    <p>@vu5ec #throwhammer 28</p>
  </div>
  <div class="page">
    <p>Exploiting Remote Bit Flips</p>
    <p>...</p>
    <p>... h_next</p>
    <p>...</p>
    <p>... h_next</p>
    <p>...</p>
    <p>... h_next</p>
    <p>attacker controlled</p>
    <p>attacker controlled</p>
    <p>@vu5ec #throwhammer 28</p>
  </div>
  <div class="page">
    <p>Exploiting Remote Bit Flips</p>
    <p>...</p>
    <p>... h_next</p>
    <p>...</p>
    <p>... h_next</p>
    <p>...</p>
    <p>... h_next</p>
    <p>counterfeit item...</p>
    <p>*next *prev</p>
    <p>*h_next</p>
    <p>nbytes</p>
    <p>bit flip</p>
    <p>@vu5ec #throwhammer 28</p>
  </div>
  <div class="page">
    <p>Defending Against Throwhammer</p>
    <p>Dont Use RDMA</p>
    <p>... and pay the price of a traditional network stack</p>
    <p>... and even then you may not be 100% safe</p>
    <p>@vu5ec #throwhammer 29</p>
  </div>
  <div class="page">
    <p>Defending Against Throwhammer</p>
    <p>Dont Use RDMA</p>
    <p>... and pay the price of a traditional network stack</p>
    <p>... and even then you may not be 100% safe</p>
    <p>@vu5ec #throwhammer 29</p>
  </div>
  <div class="page">
    <p>Defending Against Throwhammer</p>
    <p>Dont Use RDMA</p>
    <p>... and pay the price of a traditional network stack</p>
    <p>... and even then you may not be 100% safe</p>
    <p>@vu5ec #throwhammer 29</p>
  </div>
  <div class="page">
    <p>Defending Against Throwhammer</p>
    <p>Dont Use RDMA</p>
    <p>... and pay the price of a traditional network stack</p>
    <p>... and even then you may not be 100% safe</p>
    <p>@vu5ec #throwhammer 29</p>
  </div>
  <div class="page">
    <p>Defending Against Throwhammer</p>
    <p>G b</p>
    <p>p s</p>
    <p>Infiniband Ethernet</p>
    <p>Vulnerable DIMMs</p>
    <p>Bit Flip Bandwidth</p>
    <p>Year</p>
    <p>@vu5ec #throwhammer 29</p>
  </div>
  <div class="page">
    <p>Defending Against Throwhammer</p>
    <p>Dont Use RDMA</p>
    <p>... and pay the price of a traditional network stack</p>
    <p>... and even then you may not be 100% safe</p>
    <p>Isolate untrusted buffers</p>
    <p>... not quite trivial</p>
    <p>@vu5ec #throwhammer 29</p>
  </div>
  <div class="page">
    <p>Defending Against Throwhammer</p>
    <p>Dont Use RDMA</p>
    <p>... and pay the price of a traditional network stack</p>
    <p>... and even then you may not be 100% safe</p>
    <p>Isolate untrusted buffers</p>
    <p>... not quite trivial</p>
    <p>@vu5ec #throwhammer 29</p>
  </div>
  <div class="page">
    <p>Defending Against Throwhammer</p>
    <p>Dont Use RDMA</p>
    <p>... and pay the price of a traditional network stack</p>
    <p>... and even then you may not be 100% safe</p>
    <p>Isolate untrusted buffers</p>
    <p>... not quite trivial</p>
    <p>@vu5ec #throwhammer 29</p>
  </div>
  <div class="page">
    <p>Challenges of Memory Isolation</p>
    <p>Isolation must be done at DRAM row level</p>
    <p>Software sees at most physical addresses</p>
    <p>Memory Controller has much freedom in mapping phys  DRAM addresses</p>
    <p>heuristics based on physical addresses simply wont do</p>
    <p>@vu5ec #throwhammer 30</p>
  </div>
  <div class="page">
    <p>Challenges of Memory Isolation</p>
    <p>Isolation must be done at DRAM row level</p>
    <p>Software sees at most physical addresses</p>
    <p>Memory Controller has much freedom in mapping phys  DRAM addresses</p>
    <p>heuristics based on physical addresses simply wont do</p>
    <p>@vu5ec #throwhammer 30</p>
  </div>
  <div class="page">
    <p>Challenges of Memory Isolation: Example</p>
    <p>Physical Address Space</p>
    <p>+0</p>
    <p>+16M</p>
    <p>Buffer</p>
    <p>DRAM Address Space</p>
    <p>RANK 0</p>
    <p>RANK 1</p>
    <p>@vu5ec #throwhammer 31</p>
  </div>
  <div class="page">
    <p>Challenges of Memory Isolation: Example</p>
    <p>Physical Address Space</p>
    <p>+0</p>
    <p>+16M</p>
    <p>Buffer</p>
    <p>DRAM Address Space</p>
    <p>RANK 0</p>
    <p>RANK 1</p>
    <p>@vu5ec #throwhammer 31</p>
  </div>
  <div class="page">
    <p>Challenges of Memory Isolation: Example</p>
    <p>Physical Address Space</p>
    <p>+0</p>
    <p>+16M</p>
    <p>Buffer</p>
    <p>DRAM Address Space</p>
    <p>RANK 0</p>
    <p>RANK 1</p>
    <p>@vu5ec #throwhammer 31</p>
  </div>
  <div class="page">
    <p>ALIS</p>
    <p>Generic, policy-driven isolation algorithm for arbitrary memory mappings</p>
    <p>Supports common memory controllers (documented or reverse-engineered)</p>
    <p>Easily extensible and adaptable</p>
    <p>@vu5ec #throwhammer 32</p>
  </div>
  <div class="page">
    <p>ALIS</p>
    <p>Now were safe.</p>
    <p>@vu5ec #throwhammer 32</p>
  </div>
  <div class="page">
    <p>Protecting Applications</p>
    <p>We implemented ALIS as a userspace library along with drop-in changes for:</p>
    <p>HERD  in-memory key/value store designed for RDMA</p>
    <p>rdma-memcached</p>
    <p>HERD: 10 line diff</p>
    <p>rdma-memcached: binary patch</p>
    <p>@vu5ec #throwhammer 33</p>
  </div>
  <div class="page">
    <p>Protecting Applications</p>
    <p>We implemented ALIS as a userspace library along with drop-in changes for:</p>
    <p>HERD  in-memory key/value store designed for RDMA</p>
    <p>rdma-memcached</p>
    <p>HERD: 10 line diff</p>
    <p>rdma-memcached: binary patch</p>
    <p>@vu5ec #throwhammer 33</p>
  </div>
  <div class="page">
    <p>Protecting Applications: Allocation Cost</p>
    <p>T im</p>
    <p>e (</p>
    <p>s)</p>
    <p>M e m</p>
    <p>o ry</p>
    <p>o v e rh</p>
    <p>e a d</p>
    <p>( M</p>
    <p>B )</p>
    <p>MB</p>
    <p>Time Memory</p>
    <p>Four 8 GB (two ranks, dual channel)</p>
    <p>@vu5ec #throwhammer 34</p>
  </div>
  <div class="page">
    <p>Protecting Applications: Runtime Overhead</p>
    <p>L a te</p>
    <p>n c y (</p>
    <p>u s)</p>
    <p>Object Size (bytes)</p>
    <p>memcached memcached secured</p>
    <p>@vu5ec #throwhammer 35</p>
  </div>
  <div class="page">
    <p>Conclusions</p>
    <p>New attack vector: Rowhammer over the network</p>
    <p>RDMA buffers are viable attack surfaces in real binaries</p>
    <p>ALIS: generic low-overhead isolation for untrusted memory areas</p>
    <p>Code for Throwhammer and ALIS available open-source https://github.com/vusec</p>
    <p>VUSecVUSec @vu5ec #throwhammer 36</p>
  </div>
</Presentation>
