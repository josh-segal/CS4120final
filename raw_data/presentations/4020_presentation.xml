<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>NFC Research Lab Hagenberg  www.nfc-research.at A research group of the University of Applied Sciences Upper Austria</p>
    <p>This work is part of the project High Speed RFID within the EU program Regionale Wettbewerbsfhigkeit O 20072013 (Regio 13) funded by the European regional development fund (ERDF) and the Province of Upper Austria (Land Obersterreich).</p>
    <p>Michael Roland 13 August 2013  USENIX WOOT13  Washington, D.C., USA</p>
    <p>Cloning Credit Cards: A combined pre-play and downgrade attack on EMV Contactless</p>
  </div>
  <div class="page">
    <p>www.nfc-research.at Outline</p>
    <p>Introduction  EMV Contactless  MasterCard PayPass</p>
    <p>Pre-play and Downgrade Attack  How it works  Implementation  Results &amp; Improvements  Workarounds</p>
    <p>Demo  Conclusion</p>
    <p>Cloning Credit Cards: A combined pre-play and downgrade attack on EMV Contactless 2</p>
  </div>
  <div class="page">
    <p>www.nfc-research.at</p>
    <p>EMV Contactless</p>
    <p>Standard for credit/debit cards with contactless interface  Based on ISO 14443</p>
    <p>Inductive coupling  13.56 MHz  Compatible to NFC</p>
    <p>Combines different payment systems  AmEx ExpressPay: Kernel 4  JCB J/Speedy: Kernel 1 &amp; 5*  MasterCard PayPass: Kernel 2  Visa payWave: Kernel 1 &amp; 3</p>
    <p>Cloning Credit Cards: A combined pre-play and downgrade attack on EMV Contactless</p>
    <p>*) since version 2.3, March 2013</p>
  </div>
  <div class="page">
    <p>www.nfc-research.at Kernel 2: MasterCard PayPass</p>
    <p>2 modes  EMV mode  Mag-Stripe mode</p>
    <p>EMV mode  Secure chip uses EMV protocol over contactless (Chip &amp; PIN)</p>
    <p>Mag-Stripe mode  Secure chip emulates magnetic stripe system</p>
    <p>Compatibility mode to magnetic stripe back-end systems</p>
    <p>Support in contactless cards and terminals  Mag-Stripe mode: mandatory  EMV mode: optional (Europe/SEPA: mandatory)</p>
    <p>Cloning Credit Cards: A combined pre-play and downgrade attack on EMV Contactless 4</p>
  </div>
  <div class="page">
    <p>www.nfc-research.at Kernel 2: EMV Mode</p>
    <p>Card contains  Static card data (e.g. account number, expiry date, etc.)  Issuers digital signature over static data  Public keys of card and issuer  Secret key of card for digital signature</p>
    <p>Transaction  Terminal reads card data  Terminal authenticates card data</p>
    <p>using issuers digital signature  Card authenticates payment transaction</p>
    <p>by generating digital signature over transaction data (amount, date, etc.)</p>
    <p>Cloning Credit Cards: A combined pre-play and downgrade attack on EMV Contactless 5</p>
  </div>
  <div class="page">
    <p>www.nfc-research.at Kernel 2: Mag-Stripe Mode</p>
    <p>Card contains  Static card data (e.g. account number, expiry date, etc.)</p>
    <p>Format comparable to that on magnetic stripe  Secret key for generating dynamic card verification codes</p>
    <p>Transaction  Terminal reads card data  Terminal sends unpredictable number (UN) to card  Card generates dynamic card verification code (CVC3) for UN</p>
    <p>Authenticates card (but not the contents of a transaction)  Can be verified by card issuer during online authorization</p>
    <p>Main differences to EMV mode  No offline authentication of static card data  No authentication of payment transaction data</p>
    <p>Cloning Credit Cards: A combined pre-play and downgrade attack on EMV Contactless 6</p>
  </div>
  <div class="page">
    <p>www.nfc-research.at Goal of our Attack</p>
    <p>Skimming of contactless credit cards  We want to create a clone of a credit card  We want to use this clone to pay at POS terminals</p>
    <p>Target of our attack: Kernel 2s Mag-Stripe mode  Supported by all cards and terminals  Most data is static and can be skimmed  Terminal cannot check integrity of static data (no signature, etc.)  Problem: Dynamic card verification code (CVC3)</p>
    <p>Used as a proof that terminal communicates with original card  Existing attacks simply skip CVC3 and use skimmed data with</p>
    <p>merchants that do not require a CVC (e.g. Amazon)</p>
    <p>Cloning Credit Cards: A combined pre-play and downgrade attack on EMV Contactless 7</p>
  </div>
  <div class="page">
    <p>www.nfc-research.at</p>
    <p>CVC3 Dynamic Card Verification Code</p>
    <p>CVC3 = function( unpredictable number, transaction counter, secret card key/card data )  Secret card key:</p>
    <p>Securely stored on card and cannot be skimmed  Protects against generation of CVC3s without original card</p>
    <p>Transaction counter (ATC):  Stored on card and incremented for every transaction  Protects against re-use of CVC3s (re-play)  Protects against out-of-sequence use of CVC3s</p>
    <p>Unpredictable number (UN):  Challenge generated by terminal  Protects against pre-generation of CVC3s (pre-play)</p>
    <p>Cloning Credit Cards: A combined pre-play and downgrade attack on EMV Contactless 8</p>
  </div>
  <div class="page">
    <p>www.nfc-research.at Pre-play Attack despite CVC3</p>
    <p>Pre-play protection relies on unpredictable number  If UN is predictable an attacker can pre-generate CVC3s!</p>
    <p>UN in EMV Contactless Kernel 2:  UN is a 4-byte field</p>
    <p>232 (~4.3 billion) possible values  Pre-generation unfeasible</p>
    <p>BUT: field is limited to BCD-encoding  100 million possible values  ~43 times less than field limit  Pre-generation still unfeasible</p>
    <p>BUT: number of BCD digits is defined by issuer (&amp; stored on card)  Typical limit: 2-3 digits  3 digits: 1000 possible values  ~4.3 million times less than field limit  Pre-generation is feasible!!!  Pre-play attack</p>
    <p>Cloning Credit Cards: A combined pre-play and downgrade attack on EMV Contactless 9</p>
  </div>
  <div class="page">
    <p>www.nfc-research.at Limitations</p>
    <p>ATC sequence  Any transaction with a higher ATC invalidates CVC3s for lower ATCs  Attack is only possible until original card is used for another</p>
    <p>transaction</p>
    <p>Mag-Stripe mode only  Attack only works for Mag-Stripe mode transactions  BUT: EMV mode transaction is performed if both, card and terminal,</p>
    <p>support EMV mode (e.g. in Europe)  Attack does not work if card and terminal support EMV mode</p>
    <p>Cloning Credit Cards: A combined pre-play and downgrade attack on EMV Contactless 10</p>
  </div>
  <div class="page">
    <p>www.nfc-research.at Downgrade Attack</p>
    <p>Limitation: Attack only works if either card or terminal support only Mag-Stripe mode</p>
    <p>Solution: Downgrade to Mag-Stripe mode  Make terminal believe it talks to a Mag-Stripe only card  Support for EMV mode is a flag in the Application Interchange</p>
    <p>Profile (one of the first data elements that the terminal reads from the card)</p>
    <p>AIP has no integrity protection  Change flag in AIP on card clone  Downgrade attack</p>
    <p>Cloning Credit Cards: A combined pre-play and downgrade attack on EMV Contactless 11</p>
  </div>
  <div class="page">
    <p>www.nfc-research.at Mounting the Attack  Collect data for pre-play and downgrade attack</p>
    <p>Use app on NFC-enabled mobile phone (e.g. Galaxy Nexus)  Read static card data  Modify EMV mode flag  Pre-generate 1000 CVC3s</p>
    <p>One code for each possible UN  At least one transaction can be performed</p>
    <p>Performance  ~1000 codes/minute with Galaxy Nexus  BUT: not every card works well with every phone</p>
    <p>Create clone card  Use applet on Java Card  Applet contains data structures of credit card</p>
    <p>Filled with static data from original card  Applet contains list of UN + ATC + CVC3 sets</p>
    <p>Filled with pre-played CVC3s  Clone returns first set that matches given UN</p>
    <p>Cloning Credit Cards: A combined pre-play and downgrade attack on EMV Contactless 12</p>
  </div>
  <div class="page">
    <p>www.nfc-research.at Results</p>
    <p>Test  Read card data and pre-generate CVC3s using</p>
    <p>Galaxy Nexus  Copy data to clone card  Pay with clone card at POS</p>
    <p>Performed test using  3 credit cards (from 2 different issuers)  3 different terminals (all from same acquirer)</p>
    <p>Payments were approved in all cases</p>
    <p>Cloning Credit Cards: A combined pre-play and downgrade attack on EMV Contactless 13</p>
  </div>
  <div class="page">
    <p>www.nfc-research.at Improvements</p>
    <p>Cloning Credit Cards: A combined pre-play and downgrade attack on EMV Contactless 14</p>
    <p>Further reduce number of digits of UN  Number of digits is stored on card  Can be modified in clone card  Result: Faster pre-generation of CVC3s  BUT: Can be detected by issuer</p>
    <p>Number of digits is sent to issuer during Mag-Stripe online authorization  1 of 2 tested issuers detects &amp; rejects such transactions</p>
    <p>Abuse terminal-specific weaknesses  Communication with 1 of 3 tested terminals can be forced to restart</p>
    <p>Even after terminal sent unpredictable number to card  Upon restart terminal uses new unpredictable number  Works up to 6 times for one transaction</p>
    <p>Clone card can restart transaction if no CVC3 is available for a given UN  Clone card can choose between 6 UNs  Card does not need to know a CVC3 for every UN</p>
    <p>Result: Faster pre-generation of CVC3s</p>
  </div>
  <div class="page">
    <p>www.nfc-research.at Workarounds</p>
    <p>Mag-Stripe mode vs. EMV mode  Issuer receives information if terminal supports EMV mode  Issuer receives information if transaction was performed using EMV</p>
    <p>mode or Mag-Stripe mode  Issuer knows if card supports EMV mode  Issuer can detect downgrade-case where EMV mode card is used</p>
    <p>at EMV mode terminal in Mag-Stripe mode  Our results show that issuers do not currently perform such checks</p>
    <p>Cloning Credit Cards: A combined pre-play and downgrade attack on EMV Contactless 15</p>
  </div>
  <div class="page">
    <p>www.nfc-research.at Workarounds (contd)</p>
    <p>Reduction of number of digits of UN  Number of digits used in transaction is sent to issuer  Issuer can detect if number of digits was tampered with  Our results show that some issuers have such checks in place</p>
    <p>Maximizing number of digits of UN  Adding one digit increases pre-generation time by factor 10  4 digits: already 10 minutes  Pre-play infeasible!  Number of digits limited by Mag-Stripe back-end  Issuers should try to maximize size of UN</p>
    <p>Cloning Credit Cards: A combined pre-play and downgrade attack on EMV Contactless 16</p>
  </div>
  <div class="page">
    <p>www.nfc-research.at Video</p>
    <p>Cloning Credit Cards: A combined pre-play and downgrade attack on EMV Contactless 17</p>
    <p>http://youtu.be/VlAwxUs1ZFo</p>
  </div>
  <div class="page">
    <p>www.nfc-research.at Conclusion</p>
    <p>Successful pre-play attack against Mag-Stripe mode  Extended attack to EMV mode cards by downgrading to</p>
    <p>Mag-Stripe mode</p>
    <p>Protocols already contain countermeasures  Many countermeasures are not implemented by issuers  Reported our finding to MasterCard</p>
    <p>Acknowledged vulnerabilities  Pointed out that their protocols and rules provide countermeasures  Left to the issuer to implement these measures</p>
    <p>Cloning Credit Cards: A combined pre-play and downgrade attack on EMV Contactless 18</p>
  </div>
  <div class="page">
    <p>NFC Research Lab Hagenberg  www.nfc-research.at A research group of the University of Applied Sciences Upper Austria</p>
    <p>This work is part of the project High Speed RFID within the EU program Regionale Wettbewerbsfhigkeit O 20072013 (Regio 13) funded by the European regional development fund (ERDF) and the Province of Upper Austria (Land Obersterreich).</p>
    <p>Michael Roland Research Associate, NFC Research Lab Hagenberg University of Applied Sciences Upper Austria</p>
    <p>michael.roland (at) fh-hagenberg.at</p>
  </div>
</Presentation>
