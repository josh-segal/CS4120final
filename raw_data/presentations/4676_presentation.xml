<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Beyond Loose LP-relaxations: Optimizing MRFs by Repairing Cycles</p>
    <p>Nikos Komodakis (University of Crete) Nikos Paragios (Ecole Centrale de Paris)</p>
  </div>
  <div class="page"/>
  <div class="page">
    <p>Discrete MRF optimization  Given:</p>
    <p>Objects from a graph  Discrete label set</p>
    <p>Assign labels (to objects) that minimize MRF energy:</p>
    <p>edgesobjects</p>
    <p>pairwise potentialunary potential</p>
    <p>MRF optimization ubiquitous in vision (and beyond)  Stereo, optical flow, segmentation, recognition,   Extensive research for more than 20 years</p>
  </div>
  <div class="page">
    <p>MRFs and Linear Programming  Tight connection between MRF optimization and</p>
    <p>Linear Programming (LP) recently emerged  E.g., state of the art MRF algorithms are now known</p>
    <p>to be directly related to LP:  Graph-cut based techniques such as a-expansion:</p>
    <p>generalized by primal-dual schema algorithms [Komodakis et al. 05, 07]</p>
    <p>generalized by TRW methods [Wainwright 03, Kolmogorov 05] further generalized by Dual-Decomposition [Komodakis et al. 07] [Schlesinger 07]</p>
    <p>Message-passing techniques:</p>
    <p>Above statement more or less true for almost all state-of-the-art MRF techniques</p>
  </div>
  <div class="page">
    <p>MRFs and Linear Programming</p>
    <p>State-of-the-art LP-based methods for MRFs have two key characteristics in common:</p>
    <p>Make heavy use of dual information (dual-based algorithms)</p>
    <p>But: They all rely on the same LP-relaxation, called standard LP-relaxation hereafter</p>
    <p>But: They all rely on the same LP-relaxation, called standard LP-relaxation hereafter</p>
    <p>OK</p>
    <p>NOT OK</p>
    <p>Make use of a relaxation of the MRF problem, i.e., approximate it with an easier (i.e., convex) one</p>
    <p>OK</p>
  </div>
  <div class="page">
    <p>Importance of the choice of dual relaxation</p>
    <p>optimum</p>
    <p>lower bounds (dual costs) from loose dual LP-relaxation</p>
    <p>resulting MRF energies</p>
  </div>
  <div class="page">
    <p>optimum</p>
    <p>lower bounds from tight dual LP-relaxation</p>
    <p>resulting MRF energies</p>
    <p>Importance of the choice of dual relaxation</p>
  </div>
  <div class="page">
    <p>Contributions</p>
    <p>Dynamic hierarchy of dual LP-relaxations (goes all the way up to the exact MRF problem)</p>
    <p>Dealing with particular class from this hierarchy called cycle-relaxations  much tighter than standard relaxation</p>
    <p>Efficient dual-based algorithm  Basic operation: cycle-repairing  Allows dynamic and adaptive tightening</p>
  </div>
  <div class="page">
    <p>Related work  MRFs and LP-relaxations</p>
    <p>[Wainwright et al. 05] [Komodakis et al. 05, 07] [Kolmogorov 05] [Weiss et al. 07] [Werner 07] [Globerson 07] [Kohli et al. 08] [Schlesinger] [Boros]</p>
    <p>Similar approaches concurrently with our work [Kumar and Torr 08], [Sontag et al. 08], [Werner 08]</p>
    <p>LP relaxations vs alternative relaxations (e.g., quadratic, SOCP)  LP not only more efficient but also more powerful</p>
    <p>[Kumar et al. 07]</p>
  </div>
  <div class="page">
    <p>Building the dynamic hierarchy</p>
  </div>
  <div class="page">
    <p>Dynamic hierarchy of dual relaxations</p>
    <p>Starting point is the dual LP to the standard relaxation</p>
    <p>ffff</p>
    <p>This is the building block as well as the relaxation at one end of our hierarchy</p>
    <p>Denoted hereafter by  I.e., coefficients of this LP depend only on</p>
    <p>unary and pairwise MRF potentials</p>
  </div>
  <div class="page">
    <p>Dynamic hierarchy of dual relaxations  To see how to build the rest of the hierarchy, let us</p>
    <p>look at relaxation lying at the other end, denoted by</p>
    <p>We are maximizing over  Hence better lower bounds (tighter dual relaxation)  In fact, is exact (equivalent to )</p>
  </div>
  <div class="page">
    <p>Dynamic hierarchy of dual relaxations</p>
    <p>relies on:  Extra sets of variables f for set of all MRF edges</p>
    <p>( virtual potentials on )</p>
    <p>Extra sets of constraints through operator</p>
    <p>relies on:  Extra sets of variables f for set of all MRF edges</p>
    <p>( virtual potentials on )</p>
    <p>Extra sets of constraints through operator</p>
  </div>
  <div class="page">
    <p>Comparison operator</p>
    <p>Can be defined for any subset of the edges of the MRF graph (it is then denoted by ):</p>
    <p>Generalizes comparison of pairwise potentials f, f  comparison between f, f done at a more global</p>
    <p>level than individual edges</p>
    <p>Standard operator  results from</p>
  </div>
  <div class="page">
    <p>The two ends of the hierarchy  Relaxations and lie at</p>
    <p>opposite ends.</p>
    <p>Relaxation :  Loose  Efficient (due to using operator )</p>
    <p>Relaxation :  Tight (equivalent to )  Inefficient (due to using operator )</p>
  </div>
  <div class="page">
    <p>Building the dynamic hierarchy</p>
    <p>This must be done in a dynamic fashion (implicitly leads to a dynamic hierarchy of relaxations)</p>
    <p>But many other relaxations in between are possible:  simply choose subsets of edges  for each subset Ci introduce an extra set of</p>
    <p>variables (virtual potentials) fi , defined for all the edges in Ci and constrained by operator</p>
  </div>
  <div class="page">
    <p>Building the dynamic hierarchy</p>
    <p>Initially set f cur  Repeat</p>
    <p>optimize pick a subset Ci f next  { improve dual by adjusting virtual</p>
    <p>potentials fi subject to }</p>
    <p>f cur  f next until convergence</p>
    <p>Initially set f cur  Repeat</p>
    <p>optimize pick a subset Ci f next  { improve dual by adjusting virtual</p>
    <p>potentials fi subject to }</p>
    <p>f cur  f next until convergence</p>
  </div>
  <div class="page">
    <p>Building the dynamic hierarchy</p>
    <p>Initially set f cur  Repeat</p>
    <p>optimize pick a subset Ci f next  { improve dual by adjusting virtual</p>
    <p>potentials fi subject to }</p>
    <p>f cur  f next until convergence</p>
    <p>Initially set f cur  Repeat</p>
    <p>optimize pick a subset Ci f next  { improve dual by adjusting virtual</p>
    <p>potentials fi subject to }</p>
    <p>f cur  f next until convergence</p>
  </div>
  <div class="page">
    <p>Building the dynamic hierarchy</p>
    <p>Initially set f cur  Repeat</p>
    <p>optimize pick a subset Ci f next  { improve dual by adjusting virtual</p>
    <p>potentials fi subject to }</p>
    <p>f cur  f next until convergence</p>
    <p>Initially set f cur  Repeat</p>
    <p>optimize pick a subset Ci f next  { improve dual by adjusting virtual</p>
    <p>potentials fi subject to }</p>
    <p>f cur  f next until convergence</p>
  </div>
  <div class="page">
    <p>Building the dynamic hierarchy</p>
    <p>Initially set f cur  Repeat</p>
    <p>optimize pick a subset Ci f next  { improve dual by adjusting virtual</p>
    <p>potentials fi subject to }</p>
    <p>f cur  f next until convergence</p>
    <p>Initially set f cur  Repeat</p>
    <p>optimize pick a subset Ci f next  { improve dual by adjusting virtual</p>
    <p>potentials fi subject to }</p>
    <p>f cur  f next until convergence</p>
  </div>
  <div class="page">
    <p>Building the dynamic hierarchy</p>
    <p>Initially set f cur  Repeat</p>
    <p>optimize pick a subset Ci f next  { improve dual by adjusting virtual</p>
    <p>potentials fi subject to }</p>
    <p>f cur  f next until convergence</p>
    <p>Initially set f cur  Repeat</p>
    <p>optimize pick a subset Ci f next  { improve dual by adjusting virtual</p>
    <p>potentials fi subject to }</p>
    <p>f cur  f next until convergence</p>
  </div>
  <div class="page">
    <p>Building the dynamic hierarchy</p>
    <p>Initially set f cur  Repeat</p>
    <p>optimize pick a subset Ci f next  { improve dual by adjusting virtual</p>
    <p>potentials fi subject to }</p>
    <p>f cur  f next until convergence</p>
    <p>Initially set f cur  Repeat</p>
    <p>optimize pick a subset Ci f next  { improve dual by adjusting virtual</p>
    <p>potentials fi subject to }</p>
    <p>f cur  f next until convergence</p>
    <p>Many variations of the above basic scheme are possible</p>
  </div>
  <div class="page">
    <p>Cycle-relaxations  As special case, we considered choosing only</p>
    <p>subsets Ci that are cycles in the MRF graph</p>
    <p>Resulting class of relaxations called cycle-relaxations</p>
    <p>Good compromise between efficiency and accuracy</p>
  </div>
  <div class="page">
    <p>Cycle-relaxations</p>
    <p>Initially set f cur  Repeat</p>
    <p>optimize pick a subset Ci f next  { improve dual by adjusting virtual</p>
    <p>potentials fi subject to }</p>
    <p>f cur  f next until convergence</p>
    <p>Initially set f cur  Repeat</p>
    <p>optimize pick a subset Ci f next  { improve dual by adjusting virtual</p>
    <p>potentials fi subject to }</p>
    <p>f cur  f next until convergence</p>
  </div>
  <div class="page">
    <p>Cycle-relaxations</p>
    <p>Initially set f cur  Repeat</p>
    <p>optimize pick a subset Ci f next  { improve dual by adjusting virtual</p>
    <p>potentials fi subject to }</p>
    <p>f cur  f next until convergence</p>
    <p>Initially set f cur  Repeat</p>
    <p>optimize pick a subset Ci f next  { improve dual by adjusting virtual</p>
    <p>potentials fi subject to }</p>
    <p>f cur  f next until convergence</p>
  </div>
  <div class="page">
    <p>Cycle-relaxations</p>
    <p>Initially set f cur  Repeat</p>
    <p>optimize pick a cycle Ci f next  { improve dual by adjusting virtual</p>
    <p>potentials fi subject to }</p>
    <p>f cur  f next until convergence</p>
    <p>Initially set f cur  Repeat</p>
    <p>optimize pick a cycle Ci f next  { improve dual by adjusting virtual</p>
    <p>potentials fi subject to }</p>
    <p>f cur  f next until convergence</p>
  </div>
  <div class="page">
    <p>Cycle-relaxations</p>
    <p>Initially set f cur  Repeat</p>
    <p>optimize pick a cycle Ci f next  { improve dual by adjusting virtual</p>
    <p>potentials fi subject to }</p>
    <p>f cur  f next until convergence</p>
    <p>Initially set f cur  Repeat</p>
    <p>optimize pick a cycle Ci f next  { improve dual by adjusting virtual</p>
    <p>potentials fi subject to }</p>
    <p>f cur  f next until convergence</p>
  </div>
  <div class="page">
    <p>Cycle-relaxations</p>
    <p>Initially set f cur  Repeat</p>
    <p>optimize pick a cycle Ci f next  { improve dual by adjusting virtual</p>
    <p>potentials fi subject to }</p>
    <p>f cur  f next until convergence</p>
    <p>Initially set f cur  Repeat</p>
    <p>optimize pick a cycle Ci f next  { improve dual by adjusting virtual</p>
    <p>potentials fi subject to }</p>
    <p>f cur  f next until convergence</p>
    <p>cycle-repairing</p>
  </div>
  <div class="page">
    <p>Cycle-relaxations</p>
    <p>Initially set f cur  Repeat</p>
    <p>optimize pick a cycle Ci f next  { improve dual by adjusting virtual</p>
    <p>potentials fi subject to }</p>
    <p>f cur  f next until convergence</p>
    <p>Initially set f cur  Repeat</p>
    <p>optimize pick a cycle Ci f next  { improve dual by adjusting virtual</p>
    <p>potentials fi subject to }</p>
    <p>f cur  f next until convergence</p>
    <p>cycle-repairing</p>
  </div>
  <div class="page">
    <p>Cycle-relaxations</p>
    <p>Initially set f cur  Repeat</p>
    <p>optimize pick a cycle Ci f next  { improve dual by adjusting virtual</p>
    <p>potentials fi subject to }</p>
    <p>f cur  f next until no more cycles to repair</p>
    <p>Initially set f cur  Repeat</p>
    <p>optimize pick a cycle Ci f next  { improve dual by adjusting virtual</p>
    <p>potentials fi subject to }</p>
    <p>f cur  f next until no more cycles to repair</p>
    <p>cycle-repairing</p>
  </div>
  <div class="page">
    <p>Cycle-repairing</p>
    <p>repair cycles (tighten relaxation)repair cycles</p>
    <p>(tighten relaxation)</p>
    <p>repair cycles (tighten relaxation)</p>
    <p>repair cycles (tighten relaxation)</p>
    <p>optimum lower bound</p>
    <p>energy</p>
  </div>
  <div class="page"/>
  <div class="page">
    <p>To get an intuition of what cycle-repairing tries to achieve, we need to take a look at relaxation (the building block of our hierarchy)</p>
    <p>Back to relaxation</p>
    <p>Essentially, that relaxation is defined in terms of 2 kinds of variables:  Heights  Residuals</p>
  </div>
  <div class="page">
    <p>b</p>
    <p>a</p>
    <p>b</p>
    <p>aa</p>
    <p>0</p>
    <p>non-minimal nodeobject p2</p>
    <p>tight link</p>
    <p>heights</p>
    <p>r 2 3p p r</p>
    <p>node ( p3,a)</p>
    <p>residuals</p>
    <p>= maximize sum of minimal heights subject to all residuals kept nonnegative = maximize sum of minimal heights subject to all residuals kept nonnegative</p>
    <p>But: for a height to go up, some residuals must go downBut: for a height to go up, some residuals must go down</p>
    <p>minimal node</p>
    <p>minimal height</p>
    <p>e.g, to raise this minimal height</p>
    <p>e.g, to raise this minimal height</p>
    <p>or both of these residuals</p>
    <p>or both of these residuals</p>
    <p>We must lower either both of these residuals</p>
    <p>We must lower either both of these residuals</p>
  </div>
  <div class="page">
    <p>b</p>
    <p>a</p>
    <p>b</p>
    <p>aa</p>
    <p>0</p>
    <p>0</p>
    <p>0 1 2p p</p>
    <p>r 2 3p p r</p>
    <p>= maximize sum of minimal heights subject to all residuals kept nonnegative = maximize sum of minimal heights subject to all residuals kept nonnegative</p>
    <p>But: for a height to go up, some residuals must go downBut: for a height to go up, some residuals must go down</p>
    <p>Deadlock reached: dual objective cannot increase</p>
    <p>Deadlock reached: dual objective cannot increase</p>
    <p>But this is a nice deadlock: it happens at global optimum</p>
    <p>But this is a nice deadlock: it happens at global optimum</p>
  </div>
  <div class="page">
    <p>= maximize sum of minimal heights subject to all residuals kept nonnegative = maximize sum of minimal heights subject to all residuals kept nonnegative</p>
    <p>But: for a height to go up, some residuals must go downBut: for a height to go up, some residuals must go down</p>
    <p>However, life is not always so easy</p>
    <p>However, life is not always so easy</p>
    <p>This is a bad deadlock: not at global optimum</p>
    <p>This is a bad deadlock: not at global optimum</p>
    <p>ba</p>
    <p>b</p>
    <p>aa</p>
    <p>b</p>
    <p>0</p>
    <p>0</p>
    <p>0</p>
  </div>
  <div class="page">
    <p>However, life is not always so easy</p>
    <p>However, life is not always so easy</p>
    <p>= maximize sum of minimal heights subject to all residuals kept nonnegative = maximize sum of minimal heights subject to all residuals kept nonnegative</p>
    <p>But: for a height to go up, some residuals must go downBut: for a height to go up, some residuals must go down</p>
    <p>inconsistent cycles: e.g., cycle p1p2p3 w.r.t. node (p1,a)</p>
    <p>inconsistent cycles: e.g., cycle p1p2p3 w.r.t. node (p1,a)</p>
    <p>This is a bad deadlock: not at global optimum</p>
    <p>This is a bad deadlock: not at global optimum</p>
    <p>ba</p>
    <p>b</p>
    <p>aa</p>
    <p>b</p>
    <p>0</p>
    <p>0</p>
    <p>0</p>
  </div>
  <div class="page">
    <p>What does cycle-repairing do?</p>
    <p>Tries to eliminate inconsistent cycles</p>
    <p>It thus allows escaping from bad deadlocks, and helps dual objective to increase even further</p>
    <p>Cycle-repairing impossible when using relaxation</p>
    <p>Possible due to extra variables used in tighter relaxations (i.e., virtual potentials):</p>
  </div>
  <div class="page"/>
  <div class="page">
    <p>Results when standard relaxation is a good approximation</p>
  </div>
  <div class="page">
    <p>Results when standard relaxation is a bad approximation</p>
  </div>
  <div class="page">
    <p>Further comparison results</p>
  </div>
  <div class="page">
    <p>Middlebury MRFs</p>
  </div>
  <div class="page">
    <p>Middlebury MRFs</p>
  </div>
  <div class="page">
    <p>Deformable matching</p>
  </div>
  <div class="page">
    <p>the fastest</p>
    <p>very accurate</p>
  </div>
  <div class="page">
    <p>Take home message: LP and its duality theory provides:</p>
  </div>
</Presentation>
