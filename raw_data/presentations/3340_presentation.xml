<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Predicting, Decrypting, and Abusing</p>
    <p>WPA2/802.11 Group Keys</p>
    <p>Mathy Vanhoef and Frank Piessens, iMinds-DistriNet, KU Leuven</p>
    <p>USENIX Security 2016</p>
  </div>
  <div class="page">
    <p>Security of Wi-Fi group keys?</p>
    <p>Protect broadcast and multicast Wi-Fi frames:</p>
    <p>All clients share a copy of the group key</p>
    <p>Security of groups keys not yet properly investigated!</p>
    <p>In contrast with preshared &amp; pairwise keys</p>
    <p>Analyze security of group</p>
    <p>key during its full lifetime!</p>
  </div>
  <div class="page">
    <p>Contributions: Security of Group Keys</p>
    <p>Flawed generation Force RC4 in handshake</p>
    <p>New Wi-Fi tailored RNGInject &amp; decrypt all traffic</p>
  </div>
  <div class="page">
    <p>Contributions: Security of Group Keys</p>
    <p>Flawed generation Force RC4 in handshake</p>
    <p>New Wi-Fi tailored RNGInject &amp; decrypt all traffic</p>
  </div>
  <div class="page">
    <p>How are group keys generated?</p>
    <p>Group key hierarchy:</p>
    <p>AP generates public counter and secret master key</p>
    <p>Derive group temporal keys (GTKs)</p>
    <p>Entropy only introduced at boot</p>
    <p>If master key is leaked, all group keys become known</p>
    <p>Public</p>
    <p>counter</p>
    <p>Private</p>
    <p>master key</p>
    <p>+1</p>
    <p>PRF-X</p>
    <p>Group Temporal</p>
    <p>Key (GTK)</p>
    <p>Sampled only at boot!</p>
  </div>
  <div class="page">
    <p>How are random numbers generated?</p>
    <p>11.1.6a:  can generate cryptographic-quality randomness</p>
    <p>Annex M.5: This solution is expository only</p>
    <p>Inconsistent description of RNGs security guarantees!</p>
    <p>How secure is the design of the 802.11 RNG?</p>
    <p>How many platforms implement this RNG?</p>
  </div>
  <div class="page">
    <p>The 802.11 RNG is a stateless function returning 32 bytes</p>
    <p>Collects entropy on-demand</p>
    <p>Entropy extracted from frame arrival times and clock jitter</p>
    <p>Deviates from traditional RNG design:</p>
    <p>No entropy pools being maintained</p>
    <p>Entropy only extracted from events when the RNG is being invoked</p>
  </div>
  <div class="page">
    <p>Frame arrival times:</p>
    <p>Collected by repeatedly starting &amp; aborting 4-way handshake</p>
    <p>Problem: AP is blacklisted after several handshake failures</p>
    <p>Clock jitter and drift:</p>
    <p>Note: Routers current time is leaked in beacons</p>
    <p>Problem: No minimum time resolution  small clock jitter</p>
  </div>
  <div class="page">
    <p>Surely no one implemented this?</p>
    <p>Weakened 802.11 RNG</p>
    <p>Depends on OS</p>
  </div>
  <div class="page">
    <p>Surely no one implemented this?</p>
    <p>Weakened 802.11 RNG</p>
    <p>Depends on OS</p>
  </div>
  <div class="page">
    <p>MediaTek RNG: Linux-based APs</p>
    <p>Uses custom Linux drivers:</p>
    <p>Implements 802.11s RNG using only clock jitter</p>
    <p>Uses jiffies for current time: at best millisecond accuracy</p>
    <p>OpenCL ~3 mins GMK &amp; GTKRT-AC51U</p>
  </div>
  <div class="page">
    <p>Contributions: Security of Group Keys</p>
    <p>Flawed generation Force RC4 in handshake</p>
    <p>New Wi-Fi tailored RNGInject &amp; decrypt all traffic</p>
  </div>
  <div class="page">
    <p>Simplified 4-way hanshake</p>
  </div>
  <div class="page">
    <p>Simplified 4-way hanshake</p>
    <p>Group key encrypted</p>
    <p>and transmitted</p>
    <p>before downgrade</p>
    <p>attack detection!</p>
  </div>
  <div class="page">
    <p>Simplified 4-way hanshake</p>
    <p>Group key encrypted</p>
    <p>and transmitted</p>
    <p>before downgrade</p>
    <p>attack detection!</p>
    <p>Pairwise Cipher GTK encryption</p>
    <p>WPA-TKIP RC4</p>
    <p>AES-CCMP AES Key Wrap</p>
  </div>
  <div class="page">
    <p>Downgrade attack</p>
    <p>advertise WPA-TKIP</p>
    <p>WPA-TKIP</p>
    <p>with RC4!</p>
    <p>detected</p>
  </div>
  <div class="page">
    <p>Attacking RC4 encryption of GTK</p>
    <p>RC4 Key: 16-byte IV ||16-byte secret key</p>
    <p>First 256 keystream bytes are dropped</p>
    <p>Recover repeated encryptions of GTK:</p>
    <p>Requires ~231 handshakes: takes &gt;50 years</p>
    <p>Countermeasures:</p>
    <p>Disable WPA-TKIP &amp; RC4</p>
    <p>Send GTK after handshake</p>
  </div>
  <div class="page">
    <p>Contributions: Security of Group Keys</p>
    <p>Flawed generation Force RC4 in handshake</p>
    <p>New Wi-Fi tailored RNGInject &amp; decrypt all traffic</p>
  </div>
  <div class="page">
    <p>Abusing the group key: Hole 196?</p>
    <p>Inject unicast IP packet in broadcast Wi-Fi frame</p>
    <p>Detected by Hole 196 check</p>
    <p>Hole 196 check done at network-layer</p>
    <p>but an AP works at link-layer!</p>
    <p>Victim Attacker (has GTK)</p>
    <p>AP</p>
  </div>
  <div class="page">
    <p>AP</p>
    <p>Forging unicast frames using group key</p>
    <p>Abuse AP to bypass Hole 196 check:</p>
    <p>Victim Attacker</p>
    <p>Sender Destination Data</p>
  </div>
  <div class="page">
    <p>AP</p>
    <p>Forging unicast frames using group key</p>
    <p>Abuse AP to bypass Hole 196 check:</p>
    <p>Victim Attacker</p>
    <p>Flags Receiver</p>
    <p>To AP FF::FF Sender Destination Data</p>
  </div>
  <div class="page">
    <p>Forging unicast frames using group key</p>
    <p>Abuse AP to bypass Hole 196 check:</p>
    <p>AP</p>
    <p>Victim Attacker</p>
    <p>Flags Receiver</p>
    <p>To AP FF::FF Sender Destination Data</p>
    <p>Decrypted using group key802.11 specific</p>
  </div>
  <div class="page">
    <p>Forging unicast frames using group key</p>
    <p>Abuse AP to bypass Hole 196 check:</p>
    <p>Victim Attacker</p>
    <p>AP</p>
    <p>Flags Receiver</p>
    <p>To STA Destination Sender Destination Data</p>
    <p>Encrypted using pairwise key802.11 specific</p>
  </div>
  <div class="page">
    <p>Forging unicast frames using group key</p>
    <p>Abuse AP to bypass Hole 196 check:</p>
    <p>Victim Attacker</p>
    <p>Flags Receiver</p>
    <p>To STA Destination Sender Destination Data</p>
    <p>Decrypted using pairwise key</p>
    <p>AP</p>
  </div>
  <div class="page">
    <p>Forging unicast frames using group key</p>
    <p>Abuse AP to bypass Hole 196 check:</p>
    <p>Victim Attacker</p>
    <p>Flags Receiver</p>
    <p>To STA Destination Sender Destination Payload</p>
    <p>Decrypted using pairwise key</p>
    <p>AP</p>
  </div>
  <div class="page">
    <p>Decrypting all traffic</p>
    <p>ARP poison to broadcast MAC address</p>
    <p>Poison both router and clients</p>
    <p>Targets network-layer protocols: IPv4, IPv6,</p>
    <p>Countermeasure:</p>
    <p>AP should ignore frames received on broadcast or multicast MAC address.</p>
  </div>
  <div class="page">
    <p>Contributions: Security of Group Keys</p>
    <p>Flawed generation Force RC4 in handshake</p>
    <p>New Wi-Fi tailored RNGInject &amp; decrypt all traffic</p>
  </div>
  <div class="page">
    <p>An improved 802.11 RNG</p>
    <p>Entropy present on al Wi-Fi chips?</p>
    <p>Wi-Fi signals &amp; background noise</p>
    <p>Spectral scan feature in commodity chips:</p>
    <p>Can generate 3 million samples / second</p>
    <p>First XOR samples in firmware</p>
    <p>Extract &amp; manage resulting entropy using known approaches</p>
    <p>Additional research needed: performance under jamming?</p>
  </div>
  <div class="page">
    <p>Conclusion: lessons learned</p>
    <p>Questions?</p>
  </div>
</Presentation>
