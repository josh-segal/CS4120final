<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>The Margrave Tool for Firewall Analysis</p>
    <p>Tim Nelson (WPI), Christopher Barratt (Brown),</p>
    <p>Daniel J. Dougherty (WPI), Kathi Fisler (WPI)</p>
    <p>and Shriram Krishnamurthi (Brown)</p>
  </div>
  <div class="page">
    <p>and other dens of iniquity</p>
  </div>
  <div class="page">
    <p>I dont really know whats wrong.</p>
    <p>Im having this strange issue with</p>
    <p>Cisco IOS</p>
    <p>I need your advice</p>
  </div>
  <div class="page">
    <p>Policy-based routing</p>
    <p>Static routing, NAT</p>
    <p>ACLs, reflexive access-lists</p>
  </div>
  <div class="page"/>
  <div class="page">
    <p>Try this!</p>
  </div>
  <div class="page">
    <p>Try this! No! Try</p>
    <p>this!</p>
  </div>
  <div class="page">
    <p>Try this! No! Try</p>
    <p>this!</p>
    <p>No, no, try this.</p>
  </div>
  <div class="page">
    <p>Suggestions do not always agree.</p>
    <p>Try this! No! Try</p>
    <p>this!</p>
    <p>No, no, try this.</p>
  </div>
  <div class="page">
    <p>Debugging Questions:</p>
  </div>
  <div class="page">
    <p>Debugging Questions:</p>
    <p>Q: Which hop will SMTP packets take next?</p>
  </div>
  <div class="page">
    <p>Debugging Questions:</p>
    <p>Q: Which hop will SMTP packets take next?</p>
    <p>A:</p>
  </div>
  <div class="page">
    <p>Debugging Questions:</p>
    <p>Q: Which configuration rules caused the incorrect routing?</p>
    <p>Q: Which hop will SMTP packets take next?</p>
    <p>A:</p>
  </div>
  <div class="page">
    <p>Debugging Questions:</p>
    <p>Q: Which configuration rules caused the incorrect routing?</p>
    <p>Q: Which hop will SMTP packets take next?</p>
    <p>A: Line 14 applied to</p>
    <p>Line 15 applied to</p>
    <p>A:</p>
  </div>
  <div class="page">
    <p>Debugging Questions:</p>
    <p>Q: What packets will pass the firewall?</p>
    <p>Q: Which configuration rules caused the incorrect routing?</p>
    <p>Q: Which hop will SMTP packets take next?</p>
    <p>A: Line 14 applied to</p>
    <p>Line 15 applied to</p>
    <p>A:</p>
  </div>
  <div class="page">
    <p>Debugging Questions:</p>
    <p>Q: What packets will pass the firewall?</p>
    <p>Q: Which configuration rules caused the incorrect routing?</p>
    <p>Q: Which hop will SMTP packets take next?</p>
    <p>A: Line 14 applied to</p>
    <p>Line 15 applied to</p>
    <p>A:</p>
    <p>TCP From X to Y A:</p>
  </div>
  <div class="page">
    <p>Debugging Questions:</p>
    <p>Q: What packets will pass the firewall?</p>
    <p>Q: Which configuration rules caused the incorrect routing?</p>
    <p>Q: Which hop will SMTP packets take next?</p>
    <p>Q: How do a pair of configurations behave differently?</p>
    <p>A: Line 14 applied to</p>
    <p>Line 15 applied to</p>
    <p>A:</p>
    <p>TCP From X to Y A:</p>
  </div>
  <div class="page">
    <p>Debugging Questions:</p>
    <p>Q: What packets will pass the firewall?</p>
    <p>Q: Which configuration rules caused the incorrect routing?</p>
    <p>Q: Which hop will SMTP packets take next?</p>
    <p>Q: How do a pair of configurations behave differently?</p>
    <p>A: Line 14 applied to</p>
    <p>Line 15 applied to</p>
    <p>A:</p>
    <p>TCP From X to Y A:</p>
    <p>Time Connection State</p>
    <p>A:</p>
  </div>
  <div class="page">
    <p>Debugging Questions:</p>
    <p>Q: What packets will pass the firewall?</p>
    <p>Q: Which configuration rules caused the incorrect routing?</p>
    <p>Q: Which hop will SMTP packets take next?</p>
    <p>Q: How do a pair of configurations behave differently?</p>
    <p>A: Line 14 applied to</p>
    <p>Line 15 applied to</p>
    <p>A:</p>
    <p>TCP From X to Y A:</p>
    <p>Time Connection State</p>
    <p>A:</p>
    <p>Scenarios</p>
  </div>
  <div class="page">
    <p>Debugging Questions:</p>
    <p>Q: What packets will pass the firewall?</p>
    <p>Q: Which configuration rules caused the incorrect routing?</p>
    <p>Q: Which hop will SMTP packets take next?</p>
    <p>Q: How do a pair of configurations behave differently?</p>
    <p>A: Line 14 applied to</p>
    <p>Line 15 applied to</p>
    <p>A:</p>
    <p>TCP From X to Y A:</p>
    <p>Time Connection State</p>
    <p>A: Margrave</p>
    <p>Scenarios</p>
  </div>
  <div class="page"/>
  <div class="page"/>
  <div class="page"/>
  <div class="page"/>
  <div class="page"/>
  <div class="page"/>
  <div class="page"/>
  <div class="page">
    <p>Firewall</p>
    <p>Server: 192.168.2.6</p>
    <p>Fe0 209.172.108.16</p>
    <p>Vlan1 192.168.2.1/24</p>
    <p>The web can access my server, but my server cant access the web.</p>
  </div>
  <div class="page">
    <p>Firewall</p>
    <p>Server: 192.168.2.6</p>
    <p>The web can access my server, but my server cant access the web.</p>
    <p>Fe0 209.172.108.16</p>
    <p>Vlan1 192.168.2.1/24</p>
    <p>interface FastEthernet0 ip address 209.172.108.16 255.255.255.224</p>
    <p>interface Vlan1 ip address 192.168.2.1 255.255.255.0</p>
  </div>
  <div class="page">
    <p>Firewall</p>
    <p>Server: 192.168.2.6</p>
    <p>Fe0 209.172.108.16</p>
    <p>Vlan1 192.168.2.1/24</p>
    <p>The web can access my server, but my server cant access the web.</p>
    <p>access-list 102 permit tcp any host 209.172.108.16 eq 80 access-list 102 permit tcp any host 209.172.108.16 eq 21 access-list 102 permit tcp any host 209.172.108.16 eq 20 access-list 102 permit tcp any host 209.172.108.16 eq 23 access-list 102 deny tcp any host 209.172.108.16</p>
    <p>ip access-group 102 in</p>
  </div>
  <div class="page">
    <p>Firewall</p>
    <p>Server: 192.168.2.6</p>
    <p>Fe0 209.172.108.16</p>
    <p>Vlan1 192.168.2.1/24</p>
    <p>The web can access my server, but my server cant access the web.</p>
    <p>ip route 0.0.0.0 0.0.0.0 209.172.108.1</p>
  </div>
  <div class="page">
    <p>Firewall</p>
    <p>Server: 192.168.2.6</p>
    <p>Fe0 209.172.108.16</p>
    <p>Vlan1 192.168.2.1/24</p>
    <p>The web can access my server, but my server cant access the web.</p>
    <p>ip nat outside</p>
    <p>access-list 1 permit 192.168.2.0 0.0.0.255</p>
    <p>ip nat inside</p>
    <p>ip nat pool localnet 209.172.108.16 prefix-length 24 ip nat inside source list 1 pool localnet overload ip nat inside source list 1 interface FastEthernet0 ip nat inside source static tcp 192.168.2.6 80 209.172.108.16 80 ip nat inside source static tcp 192.168.2.6 21 209.172.108.16 21 ip nat inside source static tcp 192.168.2.6 3389 209.172.108.16</p>
  </div>
  <div class="page">
    <p>Firewall</p>
    <p>Server: 192.168.2.6</p>
    <p>Fe0 209.172.108.16</p>
    <p>Vlan1 192.168.2.1/24</p>
    <p>The web can access my server, but my server cant access the web.</p>
    <p>access-list 102 permit tcp any host 209.172.108.16 eq 80 access-list 102 permit tcp any host 209.172.108.16 eq 21 access-list 102 permit tcp any host 209.172.108.16 eq 20 access-list 102 permit tcp any host 209.172.108.16 eq 23 access-list 102 deny tcp any host 209.172.108.16</p>
  </div>
  <div class="page">
    <p>Firewall</p>
    <p>Server: 192.168.2.6</p>
    <p>Fe0 209.172.108.16</p>
    <p>Vlan1 192.168.2.1/24</p>
    <p>The web can access my server, but my server cant access the web.</p>
    <p>access-list 102 permit tcp any host 209.172.108.16 eq 80 access-list 102 permit tcp any host 209.172.108.16 eq 21 access-list 102 permit tcp any host 209.172.108.16 eq 20 access-list 102 permit tcp any host 209.172.108.16 eq 23 access-list 102 deny tcp any host 209.172.108.16</p>
  </div>
  <div class="page">
    <p>Firewall</p>
    <p>Server: 192.168.2.6</p>
    <p>Fe0 209.172.108.16</p>
    <p>Vlan1 192.168.2.1/24</p>
    <p>The web can access my server, but my server cant access the web.</p>
    <p>access-list 102 permit tcp any host 209.172.108.16 eq 80 access-list 102 permit tcp any host 209.172.108.16 eq 21 access-list 102 permit tcp any host 209.172.108.16 eq 20 access-list 102 permit tcp any host 209.172.108.16 eq 23 access-list 102 deny tcp any host 209.172.108.16</p>
  </div>
  <div class="page">
    <p>The web can access my server, but my server cant access the web.</p>
  </div>
  <div class="page">
    <p>Passes fe0s Inbound ACL?</p>
    <p>Can it be routed?</p>
    <p>Passes vlan1s Outbound</p>
    <p>ACL?</p>
    <p>Returning packets</p>
    <p>The web can access my server, but my server cant access the web.</p>
  </div>
  <div class="page">
    <p>Passes fe0s Inbound ACL?</p>
    <p>Can it be routed?</p>
    <p>Passes vlan1s Outbound</p>
    <p>ACL?</p>
    <p>Returning packets</p>
    <p>Passes fe0s Outbound</p>
    <p>ACL?</p>
    <p>Can it be routed?</p>
    <p>Passes vlan1s Inbound ACL?</p>
    <p>Outgoing packets</p>
    <p>The web can access my server, but my server cant access the web.</p>
  </div>
  <div class="page">
    <p>Can returning packets be lost?</p>
  </div>
  <div class="page">
    <p>Can returning packets be lost?</p>
    <p>EXPLORE</p>
    <p>Find me scenarios where</p>
  </div>
  <div class="page">
    <p>Can returning packets be lost?</p>
    <p>EXPLORE NOT passes-firewall(&lt;pkt&gt;);</p>
    <p>Dropped or rejected</p>
    <p>&lt;pkt&gt; = entry-interface</p>
    <p>src-addr-in protocol</p>
  </div>
  <div class="page">
    <p>Can returning packets be lost?</p>
    <p>EXPLORE NOT passes-firewall(&lt;pkt&gt;) AND internal-result(&lt;pktplus&gt;) ;</p>
    <p>Compute next hop and NAT</p>
    <p>&lt;pktplus&gt; = &lt;pkt&gt;</p>
    <p>+ temporary variables</p>
  </div>
  <div class="page">
    <p>Can returning packets be lost?</p>
    <p>EXPLORE NOT passes-firewall(&lt;pkt&gt;) AND internal-result(&lt;pktplus&gt;) AND FastEthernet0 = entry-interface;</p>
    <p>Arriving at FastEthernet0</p>
  </div>
  <div class="page">
    <p>Can returning packets be lost?</p>
    <p>EXPLORE NOT passes-firewall(&lt;pkt&gt;) AND internal-result(&lt;pktplus&gt;) AND FastEthernet0 = entry-interface AND NOT src-addr-in IN 192.168.2.0/255.255.255.0;</p>
    <p>Reasonable source</p>
  </div>
  <div class="page">
    <p>Can returning packets be lost?</p>
    <p>EXPLORE NOT passes-firewall(&lt;pkt&gt;) AND internal-result(&lt;pktplus&gt;) AND FastEthernet0 = entry-interface AND NOT src-addr-in IN 192.168.2.0/255.255.255.0</p>
    <p>AND prot-TCP = protocol AND port-80 = src-port-in;</p>
    <p>TCP from port 80</p>
  </div>
  <div class="page">
    <p>Can returning packets be lost?</p>
    <p>EXPLORE NOT passes-firewall(&lt;pkt&gt;) AND internal-result(&lt;pktplus&gt;) AND FastEthernet0 = entry-interface AND NOT src-addr-in IN 192.168.2.0/255.255.255.0</p>
    <p>AND prot-TCP = protocol AND port-80 = src-port-in; AND dest-addr-in = 209.172.108.16;</p>
    <p>To public address</p>
  </div>
  <div class="page">
    <p>Can returning packets be lost?</p>
    <p>EXPLORE NOT passes-firewall(&lt;pkt&gt;) AND internal-result(&lt;pktplus&gt;) AND FastEthernet0 = entry-interface AND NOT src-addr-in IN 192.168.2.0/255.255.255.0</p>
    <p>AND prot-TCP = protocol AND port-80 = src-port-in; AND dest-addr-in = 209.172.108.16;</p>
    <p>To public address Here, a scenario is:</p>
    <p>Data about a packets contents &amp; handling</p>
  </div>
  <div class="page">
    <p>Can returning packets be lost?</p>
    <p>Check for denied return packets:</p>
    <p>Result:</p>
    <p>&gt; EXPLORE NOT src-addr-in IN 192.168.2.0/255.255.255.0 AND FastEthernet0 = entry-interface AND prot-TCP = protocol AND port-80 = src-port-in AND dest-addr-in = 209.172.108.16 AND internal-result(&lt;pktplus&gt;) AND NOT passes-firewall(&lt;pkt&gt;);</p>
    <p>&gt; IS POSSIBLE?;</p>
  </div>
  <div class="page">
    <p>Can returning packets be lost?</p>
    <p>Check for denied return packets:</p>
    <p>Result:</p>
    <p>&gt; EXPLORE NOT src-addr-in IN 192.168.2.0/255.255.255.0 AND FastEthernet0 = entry-interface AND prot-TCP = protocol AND port-80 = src-port-in AND dest-addr-in = 209.172.108.16 AND internal-result(&lt;pktplus&gt;) AND NOT passes-firewall(&lt;pkt&gt;);</p>
    <p>&gt; IS POSSIBLE?; true &gt;</p>
    <p>Some return packets will be</p>
    <p>dropped.</p>
  </div>
  <div class="page">
    <p>Can returning packets be lost?</p>
    <p>Check for denied return packets:</p>
    <p>Result:</p>
    <p>Similar query: outgoing packets all pass the firewall.</p>
    <p>&gt; EXPLORE NOT src-addr-in IN 192.168.2.0/255.255.255.0 AND FastEthernet0 = entry-interface AND prot-TCP = protocol AND port-80 = src-port-in AND dest-addr-in = 209.172.108.16 AND internal-result(&lt;pktplus&gt;) AND NOT passes-firewall(&lt;pkt&gt;);</p>
    <p>&gt; IS POSSIBLE?; true &gt;</p>
    <p>Some return packets will be</p>
    <p>dropped.</p>
  </div>
  <div class="page">
    <p>Which rule(s) were responsible?</p>
    <p>&gt; EXPLORE NOT src-addr-in IN 192.168.2.0/255.255.255.0 AND FastEthernet0 = entry-interface AND prot-TCP = protocol AND port-80 = src-port-in AND dest-addr-in = 209.172.108.16 AND internal-result(&lt;pktplus&gt;) AND NOT passes-firewall(&lt;pkt&gt;);</p>
    <p>&gt; SHOW REALIZED InboundACL:router-FastEthernet0-line22_applies(&lt;pkt&gt;), InboundACL:router-FastEthernet0-line23_applies(&lt;pkt&gt;), InboundACL:router-FastEthernet0-line24_applies(&lt;pkt&gt;), InboundACL:router-FastEthernet0-line25_applies(&lt;pkt&gt;), InboundACL:router-FastEthernet0-line26_applies(&lt;pkt&gt;);</p>
  </div>
  <div class="page">
    <p>Which rule(s) were responsible?</p>
    <p>&gt; EXPLORE NOT src-addr-in IN 192.168.2.0/255.255.255.0 AND FastEthernet0 = entry-interface AND prot-TCP = protocol AND port-80 = src-port-in AND dest-addr-in = 209.172.108.16 AND internal-result(&lt;pktplus&gt;) AND NOT passes-firewall(&lt;pkt&gt;);</p>
    <p>&gt; SHOW REALIZED InboundACL:router-FastEthernet0-line22_applies(&lt;pkt&gt;), InboundACL:router-FastEthernet0-line23_applies(&lt;pkt&gt;), InboundACL:router-FastEthernet0-line24_applies(&lt;pkt&gt;), InboundACL:router-FastEthernet0-line25_applies(&lt;pkt&gt;), InboundACL:router-FastEthernet0-line26_applies(&lt;pkt&gt;);</p>
    <p>The ACL rules tied to FastEthernet0</p>
  </div>
  <div class="page">
    <p>Which rule(s) were responsible?</p>
    <p>&gt; EXPLORE NOT src-addr-in IN 192.168.2.0/255.255.255.0 AND FastEthernet0 = entry-interface AND prot-TCP = protocol AND port-80 = src-port-in AND dest-addr-in = 209.172.108.16 AND internal-result(&lt;pktplus&gt;) AND NOT passes-firewall(&lt;pkt&gt;);</p>
    <p>&gt; SHOW REALIZED InboundACL:router-FastEthernet0-line22_applies(&lt;pkt&gt;), InboundACL:router-FastEthernet0-line23_applies(&lt;pkt&gt;), InboundACL:router-FastEthernet0-line24_applies(&lt;pkt&gt;), InboundACL:router-FastEthernet0-line25_applies(&lt;pkt&gt;), InboundACL:router-FastEthernet0-line26_applies(&lt;pkt&gt;);</p>
    <p>&gt; EXPLORE NOT src-addr-in IN 192.168.2.0/255.255.255.0 AND FastEthernet0 = entry-interface AND prot-TCP = protocol AND port-80 = src-port-in AND dest-addr-in = 209.172.108.16 AND internal-result(&lt;pktplus&gt;) AND NOT passes-firewall(&lt;pkt&gt;);</p>
    <p>&gt; SHOW REALIZED InboundACL:router-FastEthernet0-line22_applies(&lt;pkt&gt;), InboundACL:router-FastEthernet0-line23_applies(&lt;pkt&gt;), InboundACL:router-FastEthernet0-line24_applies(&lt;pkt&gt;), InboundACL:router-FastEthernet0-line25_applies(&lt;pkt&gt;), InboundACL:router-FastEthernet0-line26_applies(&lt;pkt&gt;);</p>
    <p>{ InboundACL:router-FastEthernet0-line26_applies(  ) } &gt;</p>
  </div>
  <div class="page">
    <p>{ InboundACL:router-FastEthernet0-line26_applies(  ) }</p>
    <p>The ACL rule</p>
    <p>Can apply.</p>
    <p>Appearing on line 26</p>
    <p>Tied to the routers</p>
    <p>FastEthernet0 interface</p>
  </div>
  <div class="page">
    <p>{ InboundACL:router-FastEthernet0-line26_applies(  ) }</p>
    <p>The ACL rule</p>
    <p>Can apply.</p>
    <p>Appearing on line 26</p>
    <p>Tied to the routers</p>
    <p>FastEthernet0 interface</p>
    <p>EXPLORE InboundACL:router-FastEthernet0-line26_applies(&lt;pkt&gt;);</p>
    <p>Use these in queries too:</p>
  </div>
  <div class="page">
    <p>{ InboundACL:router-FastEthernet0-line26_applies(  ) }</p>
    <p>The ACL rule</p>
    <p>Can apply.</p>
    <p>Appearing on line 26</p>
    <p>Tied to the routers</p>
    <p>FastEthernet0 interface</p>
    <p>EXPLORE InboundACL:router-FastEthernet0-line26_applies(&lt;pkt&gt;);</p>
    <p>EXPLORE InboundACL:router-FastEthernet0-line26_matches (&lt;pkt&gt;);</p>
    <p>Use these in queries too:</p>
  </div>
  <div class="page">
    <p>Add a rule allowing all returning traffic from</p>
    <p>port 80</p>
  </div>
  <div class="page">
    <p>Will this change fix my problem?</p>
    <p>Add a rule allowing all returning traffic from</p>
    <p>port 80</p>
  </div>
  <div class="page">
    <p>Will it introduce new problems?</p>
    <p>Will this change fix my problem?</p>
    <p>Add a rule allowing all returning traffic from</p>
    <p>port 80</p>
  </div>
  <div class="page"/>
  <div class="page">
    <p>diff says:</p>
  </div>
  <div class="page"/>
  <div class="page">
    <p>EXPLORE NOT src-addr-in IN 192.168.2.0/255.255.255.0 AND FastEthernet0 = entry-interface AND</p>
    <p>internal-result1(&lt;pktplus&gt;) AND</p>
    <p>(passes-firewall1(&lt;pkt&gt;) AND NOT passes-firewall2(&lt;pkt&gt;) OR passes-firewall2(&lt;pkt&gt;) AND NOT passes-firewall1(&lt;pkt&gt;) );</p>
  </div>
  <div class="page">
    <p>EXPLORE NOT src-addr-in IN 192.168.2.0/255.255.255.0 AND FastEthernet0 = entry-interface AND</p>
    <p>internal-result1(&lt;pktplus&gt;) AND</p>
    <p>(passes-firewall1(&lt;pkt&gt;) AND NOT passes-firewall2(&lt;pkt&gt;) OR passes-firewall2(&lt;pkt&gt;) AND NOT passes-firewall1(&lt;pkt&gt;) );</p>
    <p>EXPLORE NOT src-addr-in IN 192.168.2.0/255.255.255.0 AND FastEthernet0 = entry-interface AND</p>
    <p>internal-result1(&lt;pktplus&gt;) AND</p>
    <p>(passes-firewall1(&lt;pkt&gt;) AND NOT passes-firewall2(&lt;pkt&gt;) OR passes-firewall2(&lt;pkt&gt;) AND NOT passes-firewall1(&lt;pkt&gt;) );</p>
  </div>
  <div class="page">
    <p>EXPLORE NOT src-addr-in IN 192.168.2.0/255.255.255.0 AND FastEthernet0 = entry-interface AND</p>
    <p>internal-result1(&lt;pktplus&gt;) AND</p>
    <p>(passes-firewall1(&lt;pkt&gt;) AND NOT passes-firewall2(&lt;pkt&gt;) OR passes-firewall2(&lt;pkt&gt;) AND NOT passes-firewall1(&lt;pkt&gt;) );</p>
    <p>EXPLORE NOT src-addr-in IN 192.168.2.0/255.255.255.0 AND FastEthernet0 = entry-interface AND</p>
    <p>internal-result1(&lt;pktplus&gt;) AND</p>
    <p>(passes-firewall1(&lt;pkt&gt;) AND NOT passes-firewall2(&lt;pkt&gt;) OR passes-firewall2(&lt;pkt&gt;) AND NOT passes-firewall1(&lt;pkt&gt;) );</p>
    <p>Change-impact analysis</p>
  </div>
  <div class="page">
    <p>&gt; EXPLORE NOT src-addr-in IN 192.168.2.0/255.255.255.0 AND fastethernet0 = entry-interface AND internal-result1(&lt;pktplus&gt;) AND (passes-firewall1(&lt;pkt&gt;) AND NOT passes-firewall2(&lt;pkt&gt;) OR passes-firewall2(&lt;pkt&gt;) AND NOT passes-firewall1(&lt;pkt&gt;) );</p>
    <p>&gt; SHOW ALL;</p>
  </div>
  <div class="page">
    <p>&gt; EXPLORE NOT src-addr-in IN 192.168.2.0/255.255.255.0 AND fastethernet0 = entry-interface AND internal-result1(&lt;pktplus&gt;) AND (passes-firewall1(&lt;pkt&gt;) AND NOT passes-firewall2(&lt;pkt&gt;) OR passes-firewall2(&lt;pkt&gt;) AND NOT passes-firewall1(&lt;pkt&gt;) );</p>
    <p>&gt; SHOW ALL;</p>
    <p>protocol: prot-tcp entry-interface: fastethernet0 dest-addr-in: 209.172.108.16</p>
    <p>src-addr-in: ipaddress dest-port-in: port</p>
    <p>src-port-in: port-80 exit-interface: vlan1</p>
  </div>
  <div class="page">
    <p>&gt; EXPLORE NOT src-addr-in IN 192.168.2.0/255.255.255.0 AND fastethernet0 = entry-interface AND internal-result1(&lt;pktplus&gt;) AND (passes-firewall1(&lt;pkt&gt;) AND NOT passes-firewall2(&lt;pkt&gt;) OR passes-firewall2(&lt;pkt&gt;) AND NOT passes-firewall1(&lt;pkt&gt;) );</p>
    <p>&gt; SHOW ALL;</p>
    <p>protocol: prot-tcp entry-interface: fastethernet0 dest-addr-in: 209.172.108.16</p>
    <p>src-addr-in: ipaddress dest-port-in: port</p>
    <p>src-port-in: port-80 exit-interface: vlan1</p>
    <p>Public address of server</p>
  </div>
  <div class="page">
    <p>&gt; EXPLORE NOT src-addr-in IN 192.168.2.0/255.255.255.0 AND fastethernet0 = entry-interface AND internal-result1(&lt;pktplus&gt;) AND (passes-firewall1(&lt;pkt&gt;) AND NOT passes-firewall2(&lt;pkt&gt;) OR passes-firewall2(&lt;pkt&gt;) AND NOT passes-firewall1(&lt;pkt&gt;) );</p>
    <p>&gt; SHOW ALL;</p>
    <p>protocol: prot-tcp entry-interface: fastethernet0 dest-addr-in: 209.172.108.16</p>
    <p>src-addr-in: ipaddress dest-port-in: port</p>
    <p>src-port-in: port-80 exit-interface: vlan1</p>
    <p>Some other address</p>
    <p>Some other port</p>
  </div>
  <div class="page">
    <p>&gt; EXPLORE NOT src-addr-in IN 192.168.2.0/255.255.255.0 AND fastethernet0 = entry-interface AND internal-result1(&lt;pktplus&gt;) AND (passes-firewall1(&lt;pkt&gt;) AND NOT passes-firewall2(&lt;pkt&gt;) OR passes-firewall2(&lt;pkt&gt;) AND NOT passes-firewall1(&lt;pkt&gt;) );</p>
    <p>&gt; SHOW ALL;</p>
    <p>protocol: prot-tcp entry-interface: fastethernet0 dest-addr-in: 209.172.108.16</p>
    <p>src-addr-in: ipaddress dest-port-in: port</p>
    <p>src-port-in: port-80 exit-interface: vlan1</p>
    <p>Packet is routed successfully</p>
  </div>
  <div class="page">
    <p>&gt; EXPLORE NOT src-addr-in IN 192.168.2.0/255.255.255.0 AND fastethernet0 = entry-interface AND internal-result1(&lt;pktplus&gt;) AND (passes-firewall1(&lt;pkt&gt;) AND NOT passes-firewall2(&lt;pkt&gt;) OR passes-firewall2(&lt;pkt&gt;) AND NOT passes-firewall1(&lt;pkt&gt;) );</p>
    <p>&gt; SHOW ALL;</p>
    <p>protocol: prot-tcp entry-interface: fastethernet0 dest-addr-in: 209.172.108.16</p>
    <p>src-addr-in: ipaddress dest-port-in: port</p>
    <p>src-port-in: port-80 exit-interface: vlan1</p>
    <p>protocol: prot-tcp entry-interface: fastethernet0</p>
    <p>dest-addr-in: ipaddress src-addr-in: ipaddress</p>
    <p>dest-port-in: port src-port-in: port-80 exit-interface: vlan1</p>
  </div>
  <div class="page">
    <p>&gt; EXPLORE NOT src-addr-in IN 192.168.2.0/255.255.255.0 AND fastethernet0 = entry-interface AND internal-result1(&lt;pktplus&gt;) AND (passes-firewall1(&lt;pkt&gt;) AND NOT passes-firewall2(&lt;pkt&gt;) OR passes-firewall2(&lt;pkt&gt;) AND NOT passes-firewall1(&lt;pkt&gt;) );</p>
    <p>&gt; SHOW ALL;</p>
    <p>protocol: prot-tcp entry-interface: fastethernet0 dest-addr-in: 209.172.108.16</p>
    <p>src-addr-in: ipaddress dest-port-in: port</p>
    <p>src-port-in: port-80 exit-interface: vlan1</p>
    <p>protocol: prot-tcp entry-interface: fastethernet0</p>
    <p>dest-addr-in: ipaddress src-addr-in: ipaddress</p>
    <p>dest-port-in: port src-port-in: port-80 exit-interface: vlan1</p>
    <p>More than we intended?</p>
  </div>
  <div class="page">
    <p>&gt; EXPLORE NOT src-addr-in IN 192.168.2.0/255.255.255.0 AND fastethernet0 = entry-interface AND internal-result1(&lt;pktplus&gt;) AND (passes-firewall1(&lt;pkt&gt;) AND NOT passes-firewall2(&lt;pkt&gt;) OR passes-firewall2(&lt;pkt&gt;) AND NOT passes-firewall1(&lt;pkt&gt;) );</p>
    <p>&gt; SHOW ALL;</p>
    <p>protocol: prot-tcp</p>
    <p>entry-interface: fastethernet0 dest-addr-in: 209.172.108.16</p>
    <p>src-addr-in: ipaddress dest-port-in: port</p>
    <p>src-port-in: port-80 exit-interface: vlan1</p>
    <p>protocol: prot-tcp entry-interface: fastethernet0</p>
    <p>dest-addr-in: ipaddress src-addr-in: ipaddress</p>
    <p>dest-port-in: port src-port-in: port-80 exit-interface: vlan1</p>
    <p>More than we intended?</p>
  </div>
  <div class="page">
    <p>&gt; EXPLORE NOT src-addr-in IN 192.168.2.0/255.255.255.0 AND fastethernet0 = entry-interface AND internal-result1(&lt;pktplus&gt;) AND (passes-firewall1(&lt;pkt&gt;) AND NOT passes-firewall2(&lt;pkt&gt;) OR passes-firewall2(&lt;pkt&gt;) AND NOT passes-firewall1(&lt;pkt&gt;) );</p>
    <p>&gt; SHOW ALL;</p>
    <p>protocol: prot-tcp</p>
    <p>entry-interface: fastethernet0 dest-addr-in: 209.172.108.16</p>
    <p>src-addr-in: ipaddress dest-port-in: port</p>
    <p>src-port-in: port-80 exit-interface: vlan1</p>
    <p>protocol: prot-tcp entry-interface: fastethernet0</p>
    <p>dest-addr-in: ipaddress src-addr-in: ipaddress</p>
    <p>dest-port-in: port src-port-in: port-80 exit-interface: vlan1</p>
    <p>More than we intended?</p>
  </div>
  <div class="page">
    <p>Query:</p>
  </div>
  <div class="page">
    <p>EXPLORE passes-firewall(&lt;pkt&gt;)</p>
    <p>Query:</p>
  </div>
  <div class="page">
    <p>EXPLORE passes-firewall(&lt;pkt&gt;)</p>
    <p>Query:</p>
    <p>Variables for packet contents &amp; handling</p>
  </div>
  <div class="page">
    <p>EXPLORE passes-firewall(&lt;pkt&gt;)</p>
    <p>Query:</p>
    <p>entry-interface, next-hop,</p>
    <p>dest-addr-in,</p>
  </div>
  <div class="page">
    <p>entry-interface: fe0 next-hop: 192.168.2.6</p>
    <p>dest-addr-in: 209.172.108.16</p>
    <p>EXPLORE passes-firewall(&lt;pkt&gt;)</p>
    <p>Query: Scenario:</p>
    <p>entry-interface, next-hop,</p>
    <p>dest-addr-in,</p>
  </div>
  <div class="page">
    <p>entry-interface: fe0 next-hop: 192.168.2.6</p>
    <p>dest-addr-in: 209.172.108.16</p>
    <p>EXPLORE passes-firewall(&lt;pkt&gt;)</p>
    <p>Query: Scenario:</p>
    <p>fe0</p>
  </div>
  <div class="page">
    <p>entry-interface: fe0 next-hop: 192.168.2.6</p>
    <p>dest-addr-in: 209.172.108.16</p>
    <p>EXPLORE passes-firewall(&lt;pkt&gt;)</p>
    <p>Query: Scenario:</p>
    <p>fe0</p>
    <p>How large a scenario do we need to check?</p>
  </div>
  <div class="page">
    <p>entry-interface: fe0 next-hop: 192.168.2.6</p>
    <p>dest-addr-in: 209.172.108.16</p>
    <p>EXPLORE passes-firewall(&lt;pkt&gt;)</p>
    <p>Query: Scenario:</p>
    <p>fe0</p>
    <p>How large a scenario do we need to check?</p>
    <p>Margrave computes a bound automatically, most of the time.</p>
  </div>
  <div class="page">
    <p>Lets Recap:</p>
  </div>
  <div class="page">
    <p>Lets Recap:</p>
    <p>Do scenarios exist?</p>
    <p>True/false</p>
  </div>
  <div class="page">
    <p>Lets Recap:</p>
    <p>Do scenarios exist?</p>
    <p>True/false</p>
    <p>Which scenarios exist?</p>
    <p>protocol: prot-tcp entry-interface: fastethernet0 dest-addr-in: 209.172.108.16</p>
    <p>src-addr-in: ipaddress dest-port-in: port</p>
    <p>src-port-in: port-80 exit-interface: vlan1</p>
  </div>
  <div class="page">
    <p>Lets Recap:</p>
    <p>Do scenarios exist?</p>
    <p>True/false</p>
    <p>Which scenarios exist? Which rules can</p>
    <p>take effect?</p>
    <p>InboundACL for FastEthernet0 on Line26</p>
    <p>protocol: prot-tcp entry-interface: fastethernet0 dest-addr-in: 209.172.108.16</p>
    <p>src-addr-in: ipaddress dest-port-in: port</p>
    <p>src-port-in: port-80 exit-interface: vlan1</p>
  </div>
  <div class="page">
    <p>Lets Recap:</p>
    <p>Do scenarios exist?</p>
    <p>True/false</p>
    <p>Which scenarios exist? Which rules can</p>
    <p>take effect?</p>
    <p>InboundACL for FastEthernet0 on Line26</p>
    <p>Single-configuration</p>
    <p>and</p>
    <p>multi-configuration queries</p>
    <p>(Change-impact analysis)</p>
    <p>protocol: prot-tcp entry-interface: fastethernet0 dest-addr-in: 209.172.108.16</p>
    <p>src-addr-in: ipaddress dest-port-in: port</p>
    <p>src-port-in: port-80 exit-interface: vlan1</p>
  </div>
  <div class="page">
    <p>Passes fe0s Inbound ACL?</p>
    <p>Can it be routed?</p>
    <p>Passes vlan1s Outbound</p>
    <p>ACL?</p>
    <p>Returning packets</p>
  </div>
  <div class="page">
    <p>interface GigabitEthernet0/0 ip address 10.232.0.1 255.255.252.0 ip access-group 101 in ip policy route-map internet ! ip route 10.232.100.0 255.255.252.0 10.254.1.130 ip route 10.232.104.0 255.255.252.0 10.254.1.130 ! access-list 101 deny ip 10.232.0.0 0.0.3.255 10.232.4.0 0.0.3.255 access-list 101 deny ip 10.232.4.0 0.0.3.255 10.232.0.0 0.0.3.255 access-list 101 permit ip any any ! access-list 10 permit 10.232.0.0 0.0.3.255 access-list 10 permit 10.232.100.0 0.0.3.255 ! route-map internet permit 10 match ip address 10 set ip next-hop 10.232.0.15</p>
    <p>Can it be routed?</p>
  </div>
  <div class="page">
    <p>interface GigabitEthernet0/0 ip address 10.232.0.1 255.255.252.0 ip access-group 101 in ip policy route-map internet ! ip route 10.232.100.0 255.255.252.0 10.254.1.130 ip route 10.232.104.0 255.255.252.0 10.254.1.130 ! access-list 101 deny ip 10.232.0.0 0.0.3.255 10.232.4.0 0.0.3.255 access-list 101 deny ip 10.232.4.0 0.0.3.255 10.232.0.0 0.0.3.255 access-list 101 permit ip any any ! access-list 10 permit 10.232.0.0 0.0.3.255 access-list 10 permit 10.232.100.0 0.0.3.255 ! route-map internet permit 10 match ip address 10 set ip next-hop 10.232.0.15</p>
    <p>How is it routed?</p>
  </div>
  <div class="page"/>
  <div class="page">
    <p>InboundACL:Permit InboundACL:Deny</p>
    <p>ip access-group 102 in</p>
    <p>Provides these query terms:</p>
  </div>
  <div class="page">
    <p>interface GigabitEthernet0/0 ip address 10.232.0.1 255.255.252.0</p>
    <p>LocalSwitching:Forward LocalSwitching:Pass</p>
    <p>ip access-group 102 in</p>
    <p>Provides these query terms:</p>
  </div>
  <div class="page">
    <p>interface GigabitEthernet0/0 ip address 10.232.0.1 255.255.252.0</p>
    <p>ip policy route-map internet</p>
    <p>route-map internet permit 10 match ip address 10 set ip next-hop 10.232.0.15 PolicyRouting:Forward</p>
    <p>PolicyRouting:Route PolicyRouting:Pass</p>
    <p>ip access-group 102 in</p>
    <p>Provides these query terms:</p>
  </div>
  <div class="page">
    <p>interface GigabitEthernet0/0 ip address 10.232.0.1 255.255.252.0</p>
    <p>ip policy route-map internet</p>
    <p>route-map internet permit 10 match ip address 10 set ip next-hop 10.232.0.15 StaticRouting:Forward</p>
    <p>StaticRouting:Route StaticRouting:Pass</p>
    <p>ip access-group 102 in</p>
    <p>ip route 10.232.100.0 255.255.252.0 10.254.1.130 ip route 10.232.104.0 255.255.252.0 10.254.1.130</p>
    <p>Provides these query terms:</p>
  </div>
  <div class="page">
    <p>interface GigabitEthernet0/0 ip address 10.232.0.1 255.255.252.0</p>
    <p>DefaultPolicyRouting:Forward DefaultPolicyRouting:Route DefaultPolicyRouting:Pass</p>
    <p>ip access-group 102 in</p>
    <p>ip policy route-map internet</p>
    <p>route-map internet permit 10 match ip address 10 set ip [default] next-hop 10.232.0.15</p>
    <p>ip route 10.232.100.0 255.255.252.0 10.254.1.130 ip route 10.232.104.0 255.255.252.0 10.254.1.130</p>
    <p>Provides these query terms:</p>
  </div>
  <div class="page">
    <p>interface GigabitEthernet0/0 ip address 10.232.0.1 255.255.252.0</p>
    <p>NetworkSwitching:Forward NetworkSwitching:Pass</p>
    <p>ip access-group 102 in</p>
    <p>ip policy route-map internet</p>
    <p>route-map internet permit 10 match ip address 10 set ip [default] next-hop 10.232.0.15</p>
    <p>ip route 10.232.100.0 255.255.252.0 10.254.1.130 ip route 10.232.104.0 255.255.252.0 10.254.1.130</p>
    <p>Provides these query terms:</p>
  </div>
  <div class="page">
    <p>interface GigabitEthernet0/0 ip address 10.232.0.1 255.255.252.0</p>
    <p>OutboundACL:Permit OutboundACL:Deny</p>
    <p>ip access-group 102 in ip access-group 102 out</p>
    <p>ip policy route-map internet</p>
    <p>route-map internet permit 10 match ip address 10 set ip [default] next-hop 10.232.0.15</p>
    <p>ip route 10.232.100.0 255.255.252.0 10.254.1.130 ip route 10.232.104.0 255.255.252.0 10.254.1.130</p>
    <p>Provides these query terms:</p>
  </div>
  <div class="page">
    <p>EXPLORE</p>
    <p>entry-interface = fastethernet0</p>
    <p>AND NOT LocalSwitching:Forward(&lt;pkt&gt;)</p>
    <p>I only want packets that dont have a local</p>
    <p>destination.</p>
  </div>
  <div class="page">
    <p>EXPLORE</p>
    <p>entry-interface = fastethernet0</p>
    <p>AND NOT LocalSwitching:Forward(&lt;pkt&gt;)</p>
    <p>I only want packets that dont have a local</p>
    <p>destination.</p>
    <p>Which permitted packets are</p>
    <p>handled by policy routing?</p>
    <p>Does the static route ever apply</p>
    <p>to WWW packets?</p>
  </div>
  <div class="page">
    <p>Scenario-finding logic engine</p>
  </div>
  <div class="page">
    <p>Scenario-finding logic engine</p>
    <p>Kodkod &amp; SAT Solving</p>
  </div>
  <div class="page">
    <p>Scenario-finding logic engine</p>
    <p>General Policy Language</p>
    <p>Kodkod &amp; SAT Solving</p>
  </div>
  <div class="page">
    <p>Scenario-finding logic engine</p>
    <p>Query Language</p>
    <p>General Policy Language</p>
    <p>Kodkod &amp; SAT Solving</p>
  </div>
  <div class="page">
    <p>Scenario-finding logic engine</p>
    <p>Query Language</p>
    <p>General Policy Language</p>
    <p>Kodkod &amp; SAT Solving</p>
  </div>
  <div class="page">
    <p>Scenario-finding logic engine</p>
    <p>Query Language</p>
    <p>General Policy Language</p>
    <p>Supported subset of Cisco IOS</p>
    <p>Kodkod &amp; SAT Solving</p>
  </div>
  <div class="page">
    <p>Scenario-finding logic engine</p>
    <p>Query Language</p>
    <p>General Policy Language</p>
    <p>Supported subset of Cisco IOS</p>
    <p>Kodkod &amp; SAT Solving</p>
    <p>XACML</p>
    <p>Amazon SQS Iptables</p>
    <p>(in progress)</p>
  </div>
  <div class="page"/>
  <div class="page">
    <p>Future Work</p>
  </div>
  <div class="page">
    <p>Future Work</p>
    <p>Port 25</p>
    <p>Port 80</p>
  </div>
  <div class="page">
    <p>Future Work</p>
    <p>Port 25</p>
    <p>Port 80</p>
    <p>Ports 25, 80</p>
  </div>
  <div class="page">
    <p>Future Work</p>
    <p>Port 25</p>
    <p>Port 80</p>
    <p>Ports 25, 80</p>
  </div>
  <div class="page">
    <p>Future Work</p>
    <p>EXPLORE FastEthernet0 = entry-interface AND prot-TCP = protocol AND port-80 = src-port-in</p>
    <p>Port 25</p>
    <p>Port 80</p>
    <p>Ports 25, 80</p>
  </div>
  <div class="page">
    <p>Future Work</p>
    <p>EXPLORE FastEthernet0 = entry-interface AND prot-TCP = protocol AND port-80 = src-port-in</p>
    <p>Try stateful inspection.</p>
    <p>Port 25</p>
    <p>Port 80</p>
    <p>Ports 25, 80</p>
  </div>
  <div class="page">
    <p>What configuration problems do you face?</p>
    <p>Come talk to me! (Im here until Friday.)</p>
    <p>Text me: (774) 314-1128</p>
    <p>Email me: tn@cs.wpi.edu</p>
    <p>Download the tool:</p>
    <p>www.margrave-tool.org</p>
    <p>Thank you to:</p>
    <p>Varun Singh (Brown), Morgan Quirk (WPI), Emina Torlak (IBM Watson)</p>
  </div>
</Presentation>
