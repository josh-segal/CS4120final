<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>FTW: Fast Similarity Search under the Time Warping Distance</p>
    <p>Yasushi Sakurai (NTT Cyber Space Labs)</p>
    <p>Masatoshi Yoshikawa (Nagoya Univ.)</p>
    <p>Christos Faloutsos (Carnegie Mellon Univ.)</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 2</p>
    <p>Motivation</p>
    <p>Time-series data  many applications</p>
    <p>computational biology, astrophysics, geology, meteorology, multimedia, economics</p>
    <p>Similarity search  Euclidean distance  DTW (Dynamic Time Warping)</p>
    <p>Useful for different sequence lengths  Different sampling rates  scaling along the time axis</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 3</p>
    <p>Mini-introduction to DTW  DTW allows sequences to be stretched along the</p>
    <p>time axis  Minimize the distance of sequences  Insert stutters into a sequence  THEN compute the (Euclidean) distance</p>
    <p>stutters:original</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 4</p>
    <p>Mini-introduction to DTW  DTW is computed by dynamic programming</p>
    <p>Warping path: set of grid cells in the time warping matrix</p>
    <p>data sequence P of length N</p>
    <p>query sequence Q of length M</p>
    <p>pN</p>
    <p>q M</p>
    <p>pi</p>
    <p>qj q1</p>
    <p>p1</p>
    <p>P</p>
    <p>Q</p>
    <p>p1 pi pN q1</p>
    <p>qj</p>
    <p>q M</p>
    <p>p-stutters</p>
    <p>q-stutters</p>
    <p>Optimum warping path (the best alignment)</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 5</p>
    <p>Mini-introduction to DTW</p>
    <p>)1,1(</p>
    <p>),1(</p>
    <p>)1,(</p>
    <p>min),(</p>
    <p>),(),(</p>
    <p>jif</p>
    <p>jif</p>
    <p>jif</p>
    <p>qpjif</p>
    <p>MNfQPD</p>
    <p>ji</p>
    <p>dtw</p>
    <p>q-stutter no stutter</p>
    <p>p-stutter</p>
    <p>DTW is computed by dynamic programming</p>
    <p>p1, p2, , pi,; q1, q2, , qj</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 6</p>
    <p>Mini-introduction to DTW  Global constraints limit the warping scope</p>
    <p>Warping scope: area that the warping path is allowed to visit</p>
    <p>P</p>
    <p>Q</p>
    <p>p1 pi pN q1</p>
    <p>qj</p>
    <p>q M</p>
    <p>P</p>
    <p>Q</p>
    <p>p1 pi pN q1</p>
    <p>qj</p>
    <p>q M</p>
    <p>Itakura ParallelogramSakoe-Chiba Band</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 7</p>
    <p>Mini-introduction to DTW  Width of the warping scope W is user-defined</p>
    <p>P</p>
    <p>Q</p>
    <p>p1 pi pN q1</p>
    <p>qj</p>
    <p>q M</p>
    <p>Sakoe-Chiba Band</p>
    <p>W1</p>
    <p>P</p>
    <p>Q</p>
    <p>p1 pi pN q1</p>
    <p>qj</p>
    <p>q M</p>
    <p>W2</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 8</p>
    <p>Motivation</p>
    <p>Similarity search for time-series data  DTW (Dynamic Time Warping)</p>
    <p>scaling along the time axis</p>
    <p>But  High search cost O(NM)  prohibitive for long sequences</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 9</p>
    <p>Our Solution, FTW</p>
    <p>Requirements: 1. Fast</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 10</p>
    <p>Problem Definition</p>
    <p>Given  S time-series data sequences of unequal lengths</p>
    <p>{P1, P2, , PS},  a query sequence Q,  an integer k,  (optionally) a warping scope W,</p>
    <p>Find the k-nearest neighbors of Q from the data sequence set by using DTW with W</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 11</p>
    <p>Overview</p>
    <p>Introduction  Related work  Main ideas  Experimental results  Conclusions</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 12</p>
    <p>Related Work</p>
    <p>Sequence indexing  Agrawal et al. (FODO 1998)  Keogh et al. (SIGMOD 2001)</p>
    <p>Subsequence matching  Faloutsos et al. (SIGMOD 1994)  Moon et al. (SIGMOD 2002)</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 13</p>
    <p>Related Work</p>
    <p>Fast sequence matching for DTW  Yi et al. (ICDE 1998)  Kim et al. (ICDE 2001)  Chu et al. (SDM 2002)  Keogh (VLDB 2002)  Zhu et al. (SIGMOD 2003)</p>
    <p>None of the existing methods for DTW fulfills all the requirements</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 14</p>
    <p>Overview</p>
    <p>Introduction  Related work  Main ideas  Experimental results  Conclusions</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 15</p>
    <p>Main Idea (1) LBS</p>
    <p>LBS (Lower Bounding distance measure with Segmentation)</p>
    <p>PA : Approximate sequences  : segment range  : upper value  : lower value</p>
    <p>t: length of time intervals*</p>
    <p>):( Ui L i</p>
    <p>R i ppp</p>
    <p>U ip</p>
    <p>R ip</p>
    <p>L ip AP</p>
    <p>Rp1 Rp4</p>
    <p>Rp3</p>
    <p>t t t t</p>
    <p>Rp2</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 16</p>
    <p>Main Idea (1) LBS</p>
    <p>R jq</p>
    <p>R ip</p>
    <p>Compute lower bounding distance  Distance of the two ranges and :</p>
    <p>distance of their two closest points</p>
    <p>R jq</p>
    <p>R ip</p>
    <p>Time</p>
    <p>Value Lower bound</p>
    <p>Time</p>
    <p>Value Lower bound =0</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 17</p>
    <p>Main Idea (1) LBS</p>
    <p>Compute lower bounding distance  Distance of the two ranges and :</p>
    <p>distance of their two closest points</p>
    <p>R jq</p>
    <p>)(0</p>
    <p>)(</p>
    <p>)(</p>
    <p>),(</p>
    <p>otherwise</p>
    <p>pqpq</p>
    <p>qpqp</p>
    <p>qpD Ui L j</p>
    <p>U i</p>
    <p>L j</p>
    <p>U j</p>
    <p>L i</p>
    <p>U j</p>
    <p>L i</p>
    <p>R j</p>
    <p>R iseg</p>
    <p>R ip</p>
    <p>details</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 18</p>
    <p>Main Idea (1) LBS</p>
    <p>P</p>
    <p>Q</p>
    <p>P</p>
    <p>Q</p>
    <p>Exact DTW distance</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 19</p>
    <p>Main Idea (1) LBS</p>
    <p>Compute lower bounding distance from PA and QA  Use a dynamic programming approach</p>
    <p>AP</p>
    <p>AQ</p>
    <p>AP</p>
    <p>AQ</p>
    <p>),(),( QPDQPD dtw AA</p>
    <p>lbs</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 20</p>
    <p>Main Idea (1) LBS</p>
    <p>Compute lower bounding distance from PA and QA  Use a dynamic programming approach</p>
    <p>AP</p>
    <p>AQ</p>
    <p>),(),( QPDQPD dtw AA</p>
    <p>lbs</p>
    <p>P</p>
    <p>Q</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 21</p>
    <p>Main Idea (2)  EarlyStopping  Exploit the fact that we have found k-near neighbors</p>
    <p>at distance dcb  dcb: k-nearest neighbor distance (the Current Best)</p>
    <p>the exact distance of the best k candidates so far</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 22</p>
    <p>Main Idea (2)  EarlyStopping  Exclude useless warping paths by using</p>
    <p>Omit g(1,3) if  Omit g(4,1) if</p>
    <p>AP</p>
    <p>AQ</p>
    <p>g(1,2)</p>
    <p>g(3,1)</p>
    <p>AP</p>
    <p>AQ</p>
    <p>cbdg )2,1( cbd</p>
    <p>cbdg )1,3(</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 23</p>
    <p>Main Idea (3) Refinement  Q: How to choose t (length of time intervals)?</p>
    <p>AP</p>
    <p>AQ</p>
    <p>g(1,2)</p>
    <p>g(3,1)</p>
    <p>AP</p>
    <p>AQ</p>
    <p>t</p>
    <p>t</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 24</p>
    <p>Main Idea (3) Refinement  Q: How to choose t (length of intervals)?  A: Use multiple granularities, as follows:</p>
    <p>AP</p>
    <p>AQ</p>
    <p>g(1,2)</p>
    <p>g(3,1)</p>
    <p>AP</p>
    <p>AQ</p>
    <p>t</p>
    <p>t</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 25</p>
    <p>Main Idea (3) Refinement  Compute the lower bounding distance from the</p>
    <p>coarsest sequences as the first refinement step  Ignore P if , otherwise:</p>
    <p>AP</p>
    <p>AQ</p>
    <p>g(1,2)</p>
    <p>g(3,1)</p>
    <p>AP</p>
    <p>AQ</p>
    <p>cb AA</p>
    <p>lbs dQPD ),(</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 26</p>
    <p>Main Idea (3) Refinement   compute the distance from more accurate</p>
    <p>sequences as the second refinement step   repeat</p>
    <p>AP</p>
    <p>AQ</p>
    <p>AQ</p>
    <p>AP</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 27</p>
    <p>Main Idea (3) Refinement   until the finest granularity  Update the list of k-nearest neighbors if</p>
    <p>P</p>
    <p>Q</p>
    <p>P</p>
    <p>Q</p>
    <p>cbdtw dQPD ),(</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 28</p>
    <p>Overview</p>
    <p>Introduction  Related work  Main ideas  Experimental results  Conclusions</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 29</p>
    <p>Experimental results</p>
    <p>Setup  Intel Xeon 2.8GHz, 1GB memory, Linux  Datasets:</p>
    <p>Temperature, Fintime, RandomWalk  Four different time intervals (for n=2048)</p>
    <p>t1=2, t2=8, t3=32, t4=128</p>
    <p>Evaluation  Compared FTW with LB_PAA (the best so far)  Mainly computation time</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 30</p>
    <p>Outline of experiments</p>
    <p>Speed vs db size  Speed vs warping scope W  Effect of filtering  Effect of varying-length data sequences</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 31</p>
    <p>Search Performance</p>
    <p>Itakura Parallelogram</p>
    <p>P</p>
    <p>Q</p>
    <p>p1 pi pN q1</p>
    <p>qj</p>
    <p>q M</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 32</p>
    <p>Search Performance</p>
    <p>Wall clock time as a function of data set size  Temperature</p>
    <p>FTW is up to 50 times</p>
    <p>faster!</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 33</p>
    <p>Search Performance</p>
    <p>Wall clock time as a function of data set size  Fintime</p>
    <p>FTW is up to 40 times</p>
    <p>faster!</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 34</p>
    <p>Search Performance</p>
    <p>Wall clock time as a function of data set size  RandomWalk</p>
    <p>FTW is up to 40 times</p>
    <p>faster!</p>
    <p>More effective as the size</p>
    <p>grows</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 35</p>
    <p>Outline of experiments</p>
    <p>Speed vs db size  Speed vs warping scope W  Effect of filtering  Effect of varying-length data sequences</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 36</p>
    <p>Search Performance</p>
    <p>Sakoe-Chiba Band</p>
    <p>P</p>
    <p>Q</p>
    <p>p1 pi pN q1</p>
    <p>qj</p>
    <p>q M</p>
    <p>W1</p>
    <p>P</p>
    <p>Q</p>
    <p>p1 pi pN q1</p>
    <p>qj</p>
    <p>q M</p>
    <p>W2</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 37</p>
    <p>Search Performance</p>
    <p>Wall clock time as a function of warping scope  Temperature</p>
    <p>FTW is up to 220 times</p>
    <p>faster!</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 38</p>
    <p>Search Performance</p>
    <p>Wall clock time as a function of warping scope  Fintime</p>
    <p>FTW is up to 70 times</p>
    <p>faster!</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 39</p>
    <p>Search Performance</p>
    <p>Wall clock time as a function of warping scope  RandomWalk</p>
    <p>FTW is up to 100 times</p>
    <p>faster!</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 40</p>
    <p>Outline of experiments</p>
    <p>Speed vs db size  Speed vs warping scope W  Effect of filtering  Effect of varying-length data sequences</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 41</p>
    <p>Effect of filtering</p>
    <p>Most of data sequences are excluded by coarser approximations (t4=128 and t3=32)  Using multiple granularities has significant advantages</p>
    <p>Frequency of approximation use</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 42</p>
    <p>Outline of experiments</p>
    <p>Speed vs db size  Speed vs warping scope W  Effect of filtering  Effect of varying-length sequences</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 43</p>
    <p>Difference in Sequence Lengths 5 sequence data sets</p>
    <p>Random(2048,0): length 2048 +/- 0</p>
    <p>Random(2048,32): length 2048 +/- 16</p>
    <p>Random(2048,64), Random(2048,128), Random(2048,256)</p>
    <p>Outperform by 2+ orders of magnitude</p>
    <p>LB_PAA can not handle</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 44</p>
    <p>Overview</p>
    <p>Introduction  Related work  Main ideas  Experimental results  Conclusions</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 45</p>
    <p>Conclusions</p>
    <p>Design goals: 1. Fast</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 46</p>
    <p>Conclusions</p>
    <p>Design goals: 1. Fast (up to 220 times faster)</p>
  </div>
  <div class="page">
    <p>PODS 2005 Y. Sakurai et al 47</p>
    <p>Page Accesses  Sequential scan of feature data should boost</p>
    <p>performance (speed-up factors SF=5, SF=10) PAds: page accesses for data sequences</p>
    <p>PAfd: page accesses for feature datads fd</p>
    <p>SF PA SF</p>
    <p>PA PA</p>
    <p>details</p>
  </div>
</Presentation>
