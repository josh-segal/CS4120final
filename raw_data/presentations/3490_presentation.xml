<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>The Secure Socket API TLS as an Operating System Service</p>
    <p>Mark O'Neill, Scott Heidbrink, Jordan Whitehead, Tanner Perdue, Luke Dickinson, Torstein Collett, Nick Bonner, Kent Seamons, and Daniel Zappala</p>
  </div>
  <div class="page">
    <p>your apps are vulnerable</p>
  </div>
  <div class="page"/>
  <div class="page">
    <p>why?</p>
  </div>
  <div class="page">
    <p>The root cause of most of these vulnerabilities is the terrible design of the APIs</p>
    <p>to the underlying SSL libraries</p>
    <p>--The most dangerous code in the world: validating SSL certificates in non-browser software. Martin Georgiev et al., 2012. ACM CCS.</p>
  </div>
  <div class="page">
    <p>using TLS is hard</p>
    <p>Symbols in libssl: 504</p>
  </div>
  <div class="page"/>
  <div class="page">
    <p>can we do better?</p>
  </div>
  <div class="page">
    <p>can we use the POSIX socket API?</p>
  </div>
  <div class="page">
    <p>int socket = socket(PF_INET, SOCK_STREAM, IPPROTO_TCP);</p>
    <p>can we use the POSIX socket API?</p>
  </div>
  <div class="page">
    <p>int socket = socket(PF_INET, SOCK_STREAM, IPPROTO_TLS);</p>
    <p>can we use the POSIX socket API?</p>
  </div>
  <div class="page">
    <p>the Secure Socket API (SSA)</p>
  </div>
  <div class="page">
    <p>the Secure Socket API (SSA)</p>
    <p>connect</p>
    <p>send/sendto/etc.</p>
    <p>recv/recvfrom/etc.</p>
    <p>TLS close notifyclose</p>
    <p>decrypt and read</p>
    <p>encrypt and send</p>
    <p>TLS handshake</p>
  </div>
  <div class="page">
    <p>TLS via the POSIX socket API</p>
    <p>Security Library</p>
    <p>Network Application</p>
    <p>Network Subsystem</p>
    <p>UDPTCP Raw</p>
    <p>POSIX Socket API</p>
    <p>Internet</p>
    <p>Network Application</p>
    <p>Network Subsystem</p>
    <p>UDPTCP Raw</p>
    <p>Internet</p>
    <p>TLS</p>
    <p>K e</p>
    <p>rn e</p>
    <p>ls p</p>
    <p>a ce</p>
    <p>U se</p>
    <p>rs p</p>
    <p>a ce</p>
    <p>K e</p>
    <p>rn e</p>
    <p>ls p</p>
    <p>a ce</p>
    <p>U se</p>
    <p>rs p</p>
    <p>a ce</p>
    <p>POSIX Socket API</p>
  </div>
  <div class="page">
    <p>Userspace Encryption Daemon</p>
    <p>Network Subsystem</p>
    <p>K e</p>
    <p>rn e</p>
    <p>ls p</p>
    <p>a ce</p>
    <p>U se</p>
    <p>rs p</p>
    <p>a ce</p>
    <p>Security Library</p>
    <p>Encryption Daemon</p>
    <p>Admin Config</p>
    <p>Internet</p>
    <p>UDPTCP Raw TLS</p>
    <p>POSIX Socket API</p>
    <p>Network Application</p>
  </div>
  <div class="page">
    <p>TLS API reduction</p>
    <p>Secure Socket API</p>
    <p>socket</p>
    <p>bind</p>
    <p>listen</p>
    <p>connect</p>
    <p>setsockopt</p>
    <p>getsockopt</p>
    <p>close</p>
    <p>recv/recvfrom/recvmsg</p>
    <p>send/sendto/sendmsg</p>
    <p>getaddrinfo</p>
    <p>OpenSSL</p>
    <p>SSL_CTX_new</p>
    <p>SSL_CTX_set_verify</p>
    <p>SSL_new</p>
    <p>SSL_set_fd</p>
    <p>TLS_method</p>
    <p>SSL_exts_set_hostname</p>
    <p>SSL_do_handshake</p>
    <p>SSL_set_verify_callback</p>
    <p>SSL_get_peer_certificate</p>
    <p>And 495 more</p>
  </div>
  <div class="page"/>
  <div class="page">
    <p>reconnaissance</p>
    <p>Features Symbols</p>
    <p>version selection 29</p>
    <p>cipher suite selection 39</p>
    <p>extension management 68</p>
    <p>certificate/key management 73</p>
    <p>certificate/key validation 51</p>
    <p>session management 61</p>
    <p>configuration 19</p>
    <p>allocation 33</p>
    <p>connection management 41</p>
    <p>miscellaneous 64</p>
    <p>instrumentation 26</p>
    <p>analyzed 410 Ubuntu packages that depended on libssl</p>
    <p>used developer behavior to guide our design</p>
  </div>
  <div class="page">
    <p>developer options</p>
    <p>setsockopt</p>
    <p>getsockopt</p>
  </div>
  <div class="page">
    <p>developer options</p>
    <p>...</p>
    <p>fd = socket (PF_INET, SOCK_STREAM, IPPROTO_TLS);</p>
    <p>/* Bind to local address and port */</p>
    <p>bind (fd, &amp;addr, sizeof(addr));</p>
    <p>/* Assign certificate chain */</p>
    <p>setsockopt(fd, IPPROTO_TLS, TLS_CERTIFICATE_CHAIN, CERT_FILE, sizeof(CERT_FILE));</p>
    <p>/* Assign private key */</p>
    <p>setsockopt(fd, IPPROTO_TLS, TLS_PRIVATE_KEY, KEY_FILE, sizeof(KEY_FILE));</p>
    <p>...</p>
  </div>
  <div class="page">
    <p>developer options</p>
    <p>Option</p>
    <p>TLS_REMOTE_HOSTNAME</p>
    <p>TLS_HOSTNAME</p>
    <p>TLS_TRUSTED_PEER_CERTIFICATES</p>
    <p>TLS_CERTIFICATE_CHAIN</p>
    <p>TLS_PRIVATE_KEY</p>
    <p>TLS_ALPN</p>
    <p>TLS_SESSION_TTL</p>
    <p>TLS_DISABLE_CIPHER</p>
    <p>TLS_PEER_IDENTITY</p>
    <p>TLS_PEER_CERTIFICATE_CHAIN</p>
    <p>setsockopt</p>
    <p>getsockopt</p>
  </div>
  <div class="page">
    <p>administrator options</p>
    <p>global configuration file assigns TLS defaults</p>
    <p>per-application profiles can further customize settings</p>
    <p>Option Description</p>
    <p>TLS Version Enabled TLS versions, in order of preference</p>
    <p>Cipher Suites Allowed cipher suites, in order of preference</p>
    <p>Certificate Validation</p>
    <p>Specified root store for certificate validation, or custom validation engine like TrustBase</p>
    <p>Enabled Extensions Specified TLS extensions to use (e.g., ALPN)</p>
    <p>Session Caching Specified session cache parameters</p>
    <p>Default cert/key paths</p>
    <p>Specify location of certificates and keys to use when application does not specify</p>
  </div>
  <div class="page">
    <p>certificate validation</p>
    <p>admins choice  standard validation</p>
    <p>TrustBase</p>
    <p>TrustBase is an OS service that validates certificates according to admin config</p>
    <p>can enable multiple services (OSCP, CRLsets, custom root stores, Convergence, etc.)</p>
    <p>API</p>
    <p>SSA Validation</p>
    <p>Plugins</p>
    <p>TrustBase</p>
  </div>
  <div class="page">
    <p>using the SSA</p>
    <p>Application LOC</p>
    <p>Modified LOC</p>
    <p>Removed Familiar with</p>
    <p>Code? Time Taken</p>
    <p>Already using TLS</p>
    <p>wget 15 1,020 No 5 Hrs.</p>
    <p>lighttpd 8 2,063 No 5 Hrs.</p>
    <p>Not using TLS</p>
    <p>in-house webserver 5 0 Yes 5 Min.</p>
    <p>netcat 5 0 No 10 Min.</p>
  </div>
  <div class="page">
    <p>language support</p>
    <p>any language that uses the network uses network system calls (directly or indirectly)</p>
    <p>the SSA is implemented behind the system call layer</p>
    <p>adding SSA support to a language is trivial  Go: &lt; 50 lines of code (syscall</p>
    <p>wrappers)  Python: new constants only  PHP: new constants only  C/C++: new constants only</p>
    <p>Network System Calls</p>
    <p>libc</p>
    <p>JVM</p>
    <p>native languages</p>
    <p>cpython</p>
    <p>go</p>
    <p>Secure Socket API</p>
    <p>network</p>
  </div>
  <div class="page">
    <p>performance vs OpenSSL</p>
    <p>no discernable time overhead for 0  100 concurrent TLS-using processes</p>
  </div>
  <div class="page">
    <p>broadening coverage</p>
    <p>OpenSSL Emulator</p>
    <p>OpenSSL Application</p>
    <p>Secure Socket API</p>
    <p>OpenSSL</p>
    <p>Linker Override</p>
    <p>dynamically ported ncat, wget, lighttpd, irssi</p>
  </div>
  <div class="page">
    <p>outcomes</p>
    <p>general benefits  TLS through a known API</p>
    <p>admin control of TLS settings</p>
    <p>implementation benefits  easy language support</p>
    <p>natural privilege separation</p>
    <p>alternative implementations supported</p>
  </div>
  <div class="page">
    <p>the Secure Socket API:</p>
    <p>enabling developers to secure connections</p>
    <p>using a known API</p>
    <p>in ways you can control</p>
  </div>
  <div class="page">
    <p>Thank You</p>
    <p>kernel module: https://github.com/markoneill/ssa</p>
    <p>encryption daemon: https://github.com/markoneill/ssa-daemon</p>
    <p>pull requests welcome!</p>
    <p>project website: https://owntrust.org</p>
    <p>contact me: mto@byu.edu</p>
    <p>thanks to our sponsors</p>
  </div>
  <div class="page">
    <p>Image Attributions</p>
    <p>Productivity by Gregor Cresnar from the Noun Project</p>
    <p>confused by Gregor Cresnar from the Noun Project</p>
  </div>
</Presentation>
