<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>tensorflow-tracing Performance Tuning in Production</p>
    <p>May 2019</p>
    <p>Sayed Hadi Hashemi Paul Rausch Benjamin Rabe Kuan-Yen Chou Simeng Liu Volodymyr Kindratenko Roy H Campbell</p>
  </div>
  <div class="page">
    <p>Performance Changes</p>
    <p>!2</p>
    <p>Ite ra</p>
    <p>tio n</p>
    <p>Ti m</p>
    <p>e</p>
    <p>Time</p>
  </div>
  <div class="page">
    <p>Performance Changes</p>
    <p>!2</p>
    <p>Ite ra</p>
    <p>tio n</p>
    <p>Ti m</p>
    <p>e</p>
    <p>Time</p>
  </div>
  <div class="page">
    <p>Performance Changes</p>
    <p>!2</p>
    <p>Ite ra</p>
    <p>tio n</p>
    <p>Ti m</p>
    <p>e</p>
    <p>Time</p>
  </div>
  <div class="page">
    <p>Performance Changes</p>
    <p>!2</p>
    <p>Change of Model Hyper parameters: e.g. Batch Size</p>
    <p>Ite ra</p>
    <p>tio n</p>
    <p>Ti m</p>
    <p>e</p>
    <p>Time</p>
  </div>
  <div class="page">
    <p>Performance Changes</p>
    <p>!2</p>
    <p>Change of Model Hyper parameters: e.g. Batch Size</p>
    <p>Storage Network Memory</p>
    <p>Ite ra</p>
    <p>tio n</p>
    <p>Ti m</p>
    <p>e</p>
    <p>Time</p>
  </div>
  <div class="page">
    <p>Performance Changes</p>
    <p>!2</p>
    <p>Change of Model Hyper parameters: e.g. Batch Size</p>
    <p>Storage Network Memory</p>
    <p>Driver Software Stack Misconfiguration</p>
    <p>Ite ra</p>
    <p>tio n</p>
    <p>Ti m</p>
    <p>e</p>
    <p>Time</p>
  </div>
  <div class="page">
    <p>Performance Tuning Developer</p>
    <p>!3</p>
    <p>Code Probe</p>
    <p>Python</p>
    <p>Images Credit: Google Brain</p>
  </div>
  <div class="page">
    <p>Performance Tuning Developer</p>
    <p>!3</p>
    <p>Code Probe DAG Probe</p>
    <p>Python TensorBoard</p>
    <p>Images Credit: Google Brain</p>
  </div>
  <div class="page">
    <p>Performance Tuning Developer</p>
    <p>!3</p>
    <p>Code Probe DAG Probe Whole DAG Runtime Execution</p>
    <p>Python TensorBoard Chrome Tracing</p>
    <p>Images Credit: Google Brain</p>
  </div>
  <div class="page">
    <p>Performance Tuning Admin</p>
    <p>!4</p>
    <p>Application-Level</p>
  </div>
  <div class="page">
    <p>Performance Tuning Admin</p>
    <p>!4</p>
    <p>Application-Level</p>
    <p>Pros Effective</p>
    <p>Cons Code Modification Advance Planning Could be complicated (e.g. T2T)</p>
  </div>
  <div class="page">
    <p>Performance Tuning Admin</p>
    <p>!4</p>
    <p>Application-Level Resource-Level</p>
    <p>Pros Effective</p>
    <p>Cons Code Modification Advance Planning Could be complicated (e.g. T2T)</p>
    <p>netstat nvidia-smi</p>
    <p>NSight dstat</p>
    <p>Pros Easy to Use</p>
    <p>No Code Modification No Advance Planning</p>
    <p>General Availability</p>
    <p>Cons Too Coarse</p>
    <p>Dont distinguish different tasks The report time is too small</p>
    <p>Data is hard to interpret without context</p>
  </div>
  <div class="page">
    <p>Challenges Admin</p>
    <p>!5</p>
    <p>Detect Problems Find the Baseline Detect Anomaly</p>
    <p>Root Cause Analysis Runtime Profiling/Tracing without modification/planning Data Exchange</p>
  </div>
  <div class="page">
    <p>!6</p>
    <p>MonkeyPatching Intercepts Framework Calls No need for code modification</p>
    <p>Admin Portal Runs at the start of a job Collects Task-Base Profiling to Establish Baseline On Demand Tracing/No need for advanced planning</p>
    <p>Tracing File Format Portable format CLI to explore traces</p>
  </div>
  <div class="page">
    <p>tensorflow-tracing MonkeyPatching</p>
    <p>!7</p>
    <p>session.run TensorFlow</p>
    <p>Tensorflow Application</p>
  </div>
  <div class="page">
    <p>tensorflow-tracing MonkeyPatching</p>
    <p>!7</p>
    <p>session.run TensorFlow</p>
    <p>Tensorflow Application</p>
    <p>MonkeyPatching</p>
    <p>tensorflow-tracing</p>
  </div>
  <div class="page">
    <p>tensorflow-tracing MonkeyPatching</p>
    <p>!7</p>
    <p>Disabled No interception Only Manage Selected Sessions</p>
    <p>session.run TensorFlow</p>
    <p>Tensorflow Application</p>
    <p>MonkeyPatching</p>
    <p>tensorflow-tracing</p>
    <p>Per Application Intercept an application Manage all the sessions</p>
    <p>System-wide Intercept the global library Manage all applications</p>
  </div>
  <div class="page">
    <p>tensorflow-tracing Admin Portal</p>
    <p>!8</p>
    <p>Separate Different Tasks</p>
  </div>
  <div class="page">
    <p>tensorflow-tracing Collection</p>
    <p>!9</p>
    <p>Profile Collect Automatically Low Overhead (0%) Establish the Baseline</p>
    <p>Trace Collect On Demand High Overhead (3%) Root Cause Analysis</p>
  </div>
  <div class="page">
    <p>tensorflow-tracing Availability</p>
    <p>!10</p>
    <p>Deploy Campus-wide Deep Learning Cluster In use at NCSA since Fall 2018</p>
    <p>Apache-2 Downloaded +4k times from Pip</p>
    <p>Quick Start pip install tensorflow-tracer</p>
    <p>Source Code https://github.com/xldrx/tensorflow-tracer</p>
  </div>
  <div class="page">
    <p>Demo</p>
    <p>!11</p>
  </div>
  <div class="page">
    <p>Experiences Common Causes</p>
    <p>!12</p>
    <p>Network Transfer Timing [Hashemi et al, SysML19] Congestion Wrong Network Interface</p>
    <p>Storage NFS Exhaustion - Rogue Application Small Reads vs TFRecords</p>
    <p>Platform Software Stack Drivers Containers</p>
    <p>Device Placement CPU/GPU Locality</p>
  </div>
  <div class="page">
    <p>TicTac Result</p>
    <p>!13</p>
    <p>Hashemi et al, SysML19</p>
  </div>
  <div class="page">
    <p>Tensor2Tensor</p>
    <p>!14</p>
    <p>tennsor2tensor</p>
  </div>
  <div class="page">
    <p>Questions</p>
    <p>Image Credit: The Neverhood</p>
    <p>This work is supported by: National Science Foundation under Grant No. 1725729</p>
    <p>Quick Start pip install tensorflow-tracer</p>
    <p>Source Code https://github.com/xldrx/tensorflow-tracer</p>
    <p>hashemi3@illinois.edu</p>
  </div>
</Presentation>
