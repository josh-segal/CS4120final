<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>On the Characteristics and On the Characteristics and Origins of Internet Flow RatesOrigins of Internet Flow Rates</p>
    <p>ACM SIGCOMM 2002ACM SIGCOMM 2002</p>
    <p>ICIR {vern,shenker}@icir.org</p>
    <p>AT&amp;T Labs  Research {yzhang,breslau}@research.att.com</p>
    <p>Vern PaxsonVern Paxson Scott ShenkerScott Shenker</p>
    <p>Yin ZhangYin Zhang Lee BreslauLee Breslau</p>
  </div>
  <div class="page">
    <p>MotivationMotivation</p>
    <p>Limited knowledge about flow rates</p>
    <p>Flow rates are impacted by many factors</p>
    <p>Congestion, bandwidth, applications, host limits,</p>
    <p>Little is known about the resulting rates or their causes</p>
    <p>Why is it important to understand flow rates?</p>
    <p>Understanding the network</p>
    <p>User experience</p>
    <p>Improving the network</p>
    <p>Identify and eliminate bottlenecks</p>
    <p>Designing scalable network control algorithms</p>
    <p>Scalability depends on the distribution of flow rates</p>
    <p>Deriving better models of Internet traffic</p>
    <p>Useful for workload generation and various network problems</p>
  </div>
  <div class="page">
    <p>Two QuestionsTwo Questions</p>
    <p>What are the characteristics of flow rates?</p>
    <p>Rate distribution</p>
    <p>Correlations</p>
    <p>What are the causes of flow rates?</p>
    <p>T-RAT: TCP Rate Analysis Tool</p>
    <p>Design</p>
    <p>Validation</p>
    <p>Results</p>
  </div>
  <div class="page">
    <p>Characteristics of Characteristics of Internet Flow RatesInternet Flow Rates</p>
  </div>
  <div class="page">
    <p>Datasets and MethodologyDatasets and Methodology</p>
    <p>Datasets</p>
    <p>Packet traces at ISP backbones and campus access links</p>
    <p>8 datasets; each lasts 0.5  24 hours; over 110 million packets</p>
    <p>Summary flow statistics collected at 19 backbone routers</p>
    <p>76 datasets; each lasts 24 hours; over 20 billion packets</p>
    <p>Flow definition</p>
    <p>Flow ID: &lt;SrcIP, DstIP, SrcPort, DstPort, Protocol&gt;</p>
    <p>Timeout: 60 seconds</p>
    <p>Rate = Size / Duration</p>
    <p>Exclude flows with duration &lt; 100 msec</p>
    <p>Look at:</p>
    <p>Rate distribution</p>
    <p>Correlations among rate, size, and duration</p>
  </div>
  <div class="page">
    <p>Flow Rate CharacteristicsFlow Rate Characteristics</p>
    <p>Rate distribution</p>
    <p>Most flows are slow, but most bytes are in fast flows</p>
    <p>Distribution is skewed</p>
    <p>Not as skewed as size distribution</p>
    <p>Consistent with log-normal distribution [BSSK97]</p>
    <p>Correlations</p>
    <p>Rate and size are strongly correlated</p>
    <p>Not due to TCP slow-start</p>
    <p>Removed initial 1 second of each connection; correlations increase</p>
    <p>What users download is a function of their bandwidth</p>
  </div>
  <div class="page">
    <p>Causes of Causes of Internet Flow RatesInternet Flow Rates</p>
  </div>
  <div class="page">
    <p>TT--RAT: TCP Rate Analysis ToolRAT: TCP Rate Analysis Tool  Goal</p>
    <p>Analyze TCP packet traces and determine ratelimiting factors for different connections</p>
    <p>Requirements</p>
    <p>Work for traces recorded anywhere along a network path</p>
    <p>Traces dont have to be recorded near an endpoint</p>
    <p>Work just seeing one direction of a connection</p>
    <p>Data only or ACK only  there is no easy cause &amp; effect</p>
    <p>Work with partial connections</p>
    <p>Prevent bias against long-lived flows</p>
    <p>Work in a streaming fashion</p>
    <p>Avoid having to read the entire trace into memory</p>
  </div>
  <div class="page">
    <p>TCP Rate Limiting FactorsTCP Rate Limiting Factors</p>
    <p>Flow never leaves slow-startOpportunity</p>
    <p>Flow fully utilizes and is limited by bottleneck link bandwidth</p>
    <p>Bandwidth</p>
    <p>Flow is limited by sending bufferSender</p>
    <p>Flow responds to packet lossCongestion</p>
    <p>Flow has left slow-start &amp; no packet loss &amp; not limited by receiver/sender/bandwidth</p>
    <p>Transport</p>
    <p>Flow is limited by receiver advertised windowReceiver</p>
    <p>Application doesnt generate data fast enoughApplication</p>
    <p>DescriptionFactor</p>
  </div>
  <div class="page">
    <p>TT--RAT ComponentsRAT Components</p>
    <p>MSS Estimator</p>
    <p>Identify Maximum Segment Size (MSS)</p>
    <p>RTT Estimator</p>
    <p>Estimate RTT</p>
    <p>Group packets into flights</p>
    <p>Flight: packets sent during the same RTT</p>
    <p>Rate Limit Analyzer</p>
    <p>Determine rate-limiting factors based on MSS, RTT, and the evolution of flight size</p>
  </div>
  <div class="page">
    <p>What Makes It Difficult?What Makes It Difficult?</p>
    <p>The network may introduce a lot of noise</p>
    <p>E.g. significant delay variation, ACK compression, ...</p>
    <p>Time-varying RTT is difficult to track</p>
    <p>E.g., handshake delay and median RTT may differ substantially</p>
    <p>Delayed ACK significantly complicates TCP dynamics</p>
    <p>E.g. congestion avoidance: 12, 12, 13, 12, 12, 14, 14, 15,</p>
    <p>There are a large number of TCP flavors &amp; implementations</p>
    <p>Different loss recovery algorithms, initial cwnd, bugs, weirdness</p>
    <p>Timers may introduce behavior difficult to analyze</p>
    <p>E.g. delack timer may expire in the middle of an RTT</p>
    <p>Packets missing due to packet filter drop, route change</p>
    <p>They are not lost!</p>
    <p>There may be multiple causes for a connection</p>
    <p>Some behaviors are intrinsically ambiguous</p>
    <p>And a lot more</p>
  </div>
  <div class="page">
    <p>MSS EstimatorMSS Estimator</p>
    <p>Data stream</p>
    <p>MSS  largest data packet payload</p>
    <p>ACK stream</p>
    <p>MSS  most frequent common divisor</p>
    <p>Like GCD, apply heuristics to</p>
    <p>avoid looking for divisors of numbers that are not multiples of MSS</p>
    <p>favor popular MSS (e.g. 536, 1460, 512)</p>
  </div>
  <div class="page">
    <p>RTT EstimatorRTT Estimator</p>
    <p>Generate a set of candidate RTTs</p>
    <p>Between 3 msec and 3 sec: 0.003 x 1.3K sec</p>
    <p>Assign a score to each candidate RTT</p>
    <p>Group packets into flights</p>
    <p>Flight boundary: packet with large inter-arrival time</p>
    <p>Track evolution of flight size over time and match it to identifiable TCP behavior</p>
    <p>Slow start</p>
    <p>Congestion avoidance</p>
    <p>Loss recovery</p>
    <p>Score  # packets in flights consistent with identifiable TCP behavior</p>
    <p>Pick the top scoring candidate RTT</p>
  </div>
  <div class="page">
    <p>Rate Limit AnalyzerRate Limit Analyzer</p>
    <p>Total bytes &lt; 13*MSS, or it never leaves slow-startOpportunity 3 consecutive flights with size &gt; awndmax  3*MSSReceiver Flight size stays constant, and not receiver limitedSender</p>
    <p>Sender has left slow-start and there is no packet lossTransport Flight size stays constant, but we only see data packets and cant tell between sender and receiver</p>
    <p>Host</p>
    <p>None of the aboveUnknown</p>
    <p>Packet loss and not bandwidth-limitedCongestion</p>
    <p>A sub-MSS packet followed by a lull &gt; RTT, followed by new data</p>
    <p>Application</p>
    <p>A flow keeps achieving same amount of data in flights prior to loss; or it has nearly equally spaced packets</p>
    <p>Bandwidth</p>
    <p>TestCause</p>
  </div>
  <div class="page">
    <p>RTT ValidationRTT Validation Validation against tcpanaly [Pax97] over NPD N2 (17,248 conn)</p>
    <p>C um</p>
    <p>ul at</p>
    <p>iv e</p>
    <p>F ra</p>
    <p>ct io</p>
    <p>n</p>
    <p>Accurate within a factor of X</p>
    <p>Data-based sender-side estimation Data-based receiver-side estimation</p>
    <p>Ack-based sender-side estimation Ack-based receiver-side estimation</p>
    <p>SYN/ACK estimation</p>
    <p>RTT estimator works reasonably well in most cases</p>
  </div>
  <div class="page">
    <p>Rate Limit ValidationRate Limit Validation  Methodology</p>
    <p>ns2 simulations + dummynet experiments  T-RAT correctly identifies the cause in vast</p>
    <p>majority of cases  Failure scenarios</p>
    <p>transport limited w/o loss  NOT failure!Congestion</p>
    <p>Less accurate with Nagles algorithmApplication</p>
    <p>Connection size is very largeOpportunity RTT wrong, but rate limit correctBandwidth</p>
    <p>High background load (esp. on ACK stream)Transport</p>
    <p>Window = 2 packets; or link utilization &gt; 90%Rcvr/Sndr</p>
  </div>
  <div class="page">
    <p>Rate Limiting Factors (Bytes)Rate Limiting Factors (Bytes)</p>
    <p>Acc ess</p>
    <p>Acc ess</p>
    <p>Acc ess</p>
    <p>ess 2</p>
    <p>Pee ring</p>
    <p>Re gio</p>
    <p>nal 1 a</p>
    <p>Re gio</p>
    <p>nal 1 b</p>
    <p>Re gio</p>
    <p>nal 2</p>
    <p>P er</p>
    <p>ce nt</p>
    <p>ag e</p>
    <p>of B</p>
    <p>yt es</p>
    <p>Congestion</p>
    <p>Host/Sndr/Rcvr</p>
    <p>Opportunity</p>
    <p>Application</p>
    <p>Transport</p>
    <p>Unknow n</p>
    <p>Dominant causes by bytes: Congestion, Receiver</p>
  </div>
  <div class="page">
    <p>Rate Limiting Factors (Flows)Rate Limiting Factors (Flows)</p>
    <p>Acc ess</p>
    <p>Acc ess</p>
    <p>Acc ess</p>
    <p>ess 2</p>
    <p>Pe erin</p>
    <p>g1</p>
    <p>Re gio</p>
    <p>nal 1a</p>
    <p>Re gio</p>
    <p>nal 1 b</p>
    <p>Re gio</p>
    <p>nal 2</p>
    <p>P er</p>
    <p>ce n</p>
    <p>ta g</p>
    <p>e o</p>
    <p>f F</p>
    <p>lo w</p>
    <p>s Congestion</p>
    <p>Host/Sndr/Rcvr</p>
    <p>Opportunity</p>
    <p>Application</p>
    <p>Transport</p>
    <p>Unknow n</p>
    <p>Dominant causes by flows: Opportunity, Application</p>
  </div>
  <div class="page">
    <p>Flow Characteristics by CauseFlow Characteristics by Cause</p>
    <p>Different causes are associated with different performance for users</p>
    <p>Rate distribution</p>
    <p>Highest rates: Receiver, Transport</p>
    <p>Size distribution</p>
    <p>Largest sizes: Receiver</p>
    <p>Duration distribution</p>
    <p>Longest duration: Congestion</p>
  </div>
  <div class="page">
    <p>ConclusionConclusion</p>
    <p>Characteristics of Internet flow rates</p>
    <p>Fast flows carry most of the bytes</p>
    <p>It is important to understand their behavior.</p>
    <p>Strong correlation between flow rate and size</p>
    <p>What users download is a function of their bandwidth.</p>
    <p>Causes of Internet flow rates</p>
    <p>Dominant causes:</p>
    <p>In terms of bytes: congestion, receiver</p>
    <p>In terms of flows: opportunity, application</p>
    <p>Different causes are associated with different performance</p>
    <p>T-RAT has applicability beyond the results we have so far</p>
    <p>E.g. correlating rate limiting factors with other user characteristics like application type, access method, etc.</p>
  </div>
  <div class="page">
    <p>Thank you!Thank you! http://www.research.att.com/projects/T-RAT/</p>
  </div>
</Presentation>
