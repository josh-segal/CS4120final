<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>Exact Indexing of Dynamic Exact Indexing of Dynamic Time WarpingTime Warping</p>
    <p>Eamonn KeoghEamonn Keogh Computer Science &amp; Engineering Department</p>
    <p>University of California - Riverside Riverside,CA 92521 eamonn@cs.ucr.edu</p>
  </div>
  <div class="page">
    <p>Fair Use Agreement Fair Use Agreement</p>
    <p>If you use these slides (or any part thereof) for any lecture or class, please send me an email, if possible with a pointer to the relevant web page or document.</p>
    <p>eamonn eamonn@cs.ucr.edu</p>
  </div>
  <div class="page">
    <p>Outline of TalkOutline of Talk  Why do Time Series Similarity Matching?Why do Time Series Similarity Matching?  Limitations of Euclidean DistanceLimitations of Euclidean Distance</p>
    <p>Dynamic Time Warping Dynamic Time Warping</p>
    <p>Lower Bounding Dynamic Time WarpingLower Bounding Dynamic Time Warping</p>
    <p>Indexing Dynamic Time WarpingIndexing Dynamic Time Warping</p>
    <p>Experimental Evaluation Experimental Evaluation</p>
    <p>ConclusionsConclusions</p>
    <p>Questions Questions</p>
  </div>
  <div class="page">
    <p>ClusteringClustering ClassificationClassification</p>
    <p>Rule DiscoveryRule Discovery</p>
    <p>s = 0.5 c = 0.3</p>
    <p>Why do Time Series Similarity Matching?Why do Time Series Similarity Matching?</p>
    <p>Query by Content</p>
  </div>
  <div class="page">
    <p>Euclidean Vs Dynamic Time WarpingEuclidean Vs Dynamic Time Warping</p>
    <p>Euclidean Distance Sequences are aligned one to one.</p>
    <p>Warped Time Axis Nonlinear alignments are possible.</p>
  </div>
  <div class="page">
    <p>Training data consists of 10 exemplars from each class.  (One) Nearest Neighbor Algorithm  Leaving-one-out evaluation, averaged over 100 runs</p>
    <p>Euclidean Distance Error rate Euclidean Distance Error rate 26.10%26.10%  Dynamic Time Warping Error rateDynamic Time Warping Error rate 2.87%2.87%</p>
    <p>Classification Experiment on Classification Experiment on CylinderCylinder--BellBell--FunnelFunnel Dataset Dataset</p>
    <p>Limitations of Euclidean Distance ILimitations of Euclidean Distance I ClassificationClassification</p>
  </div>
  <div class="page">
    <p>Limitations of Euclidean Distance IILimitations of Euclidean Distance II ClusteringClustering</p>
    <p>Monday</p>
    <p>Tuesday</p>
    <p>Wednesday</p>
    <p>Thursday</p>
    <p>Friday</p>
    <p>Saturday</p>
    <p>Sunday</p>
    <p>Wednesday was a national holiday Euclidean Dynamic Time Warping</p>
  </div>
  <div class="page">
    <p>Bioinformatics: Aach, J. and Church, G. (2001). Aligning gene expression time series with time warping algorithms. Bioinformatics. Volume 17, pp 495-508.</p>
    <p>Robotics: Schmill, M., Oates, T. &amp; Cohen, P. (1999). Learned models for continuous planning. In 7th International Workshop on Artificial Intelligence and Statistics.</p>
    <p>Medicine: Caiani, E.G., et. al. (1998) Warped-average template technique to track on a cycle-by-cycle basis the cardiac filling phases on left ventricular volume. IEEE Computers in Cardiology.</p>
    <p>Chemistry: Gollmer, K., &amp; Posten, C. (1995) Detection of distorted pattern using dynamic time warping algorithm and application for supervision of bioprocesses. IFAC CHEMFAS-4</p>
    <p>Meteorology/ Tracking/ Biometrics / Astronomy / Finance / Manufacturing</p>
    <p>Gesture Recognition: Gavrila, D. M. &amp; Davis,L. S.(1995). Towards 3-d model-based tracking and recognition of human movement: a multiview approach. In IEEE IWAFGR</p>
    <p>Because of the robustness of Dynamic Time Warping Because of the robustness of Dynamic Time Warping compared to Euclidean Distance, it is used incompared to Euclidean Distance, it is used in</p>
  </div>
  <div class="page">
    <p>C</p>
    <p>Q</p>
    <p>C</p>
    <p>Q</p>
    <p>How is DTW How is DTW Calculated?Calculated?</p>
    <p>KwCQDTW</p>
    <p>K</p>
    <p>k k1 min),(</p>
    <p>(i,j) = d(qi,cj) + min{ (i-1,j-1) , (i-1,j ) , (i,j-1) }</p>
    <p>Warping path w</p>
  </div>
  <div class="page">
    <p>DTW is much better than Euclidean distance for</p>
    <p>classification, clustering, query by content etc.</p>
    <p>But is it not true that dynamic time warping cannot be speeded up by indexing *, and is</p>
    <p>O(n2)?</p>
    <p>Doo h</p>
    <p>* Agrawal, R., Lin, K. I., Sawhney, H. S., &amp; Shim, K. (1995). Fast similarity search in the presence of noise, scaling, and translation in times-series databases. VLDB pp. 490-501.</p>
  </div>
  <div class="page">
    <p>C</p>
    <p>Q</p>
    <p>C</p>
    <p>Q</p>
    <p>Sakoe-Chiba Band Itakura Parallelogram</p>
    <p>Global Global ConstraintsConstraints  Slightly speed up the calculations  Prevent pathological warpings</p>
  </div>
  <div class="page">
    <p>Sakoe-Chiba Band Itakura Parallelogram</p>
    <p>A global constraint constrains the indices of the warping path w</p>
    <p>k = (i,j)</p>
    <p>k such that j-r  i  j+r</p>
    <p>Where r is a term defining allowed range of warping for a given point in a sequence.</p>
    <p>r =</p>
  </div>
  <div class="page">
    <p>Lower BoundingLower Bounding</p>
    <p>Intuition</p>
    <p>Try to use a cheap lower bounding calculation as often as possible.</p>
    <p>Only do the expensive, full calculations when it is absolutely necessary.</p>
    <p>Algorithm Lower_Bounding_Sequential_Scan(Q)</p>
    <p>Algorithm Lower_Bounding_Sequential_Scan(Q)</p>
    <p>We can speed up similarity search under DTW by using a lower bounding function.</p>
  </div>
  <div class="page">
    <p>Lower Bound of Kim et. al.Lower Bound of Kim et. al.</p>
    <p>A</p>
    <p>B</p>
    <p>C</p>
    <p>D</p>
    <p>The squared difference between the two sequences first (A), last (D), minimum (B) and maximum points (C) is returned as the lower bound</p>
    <p>Kim, S, Park, S, &amp; Chu, W. An index-based approach for similarity search supporting time warping in large sequence databases. ICDE 01, pp 607-614</p>
    <p>LB_Kim</p>
  </div>
  <div class="page">
    <p>Lower Bound of Yi et. al.Lower Bound of Yi et. al.</p>
    <p>The sum of the squared length of gray lines represent the minimum the corresponding points contribution to the overall DTW distance, and thus can be returned as the lower bounding measure</p>
    <p>Yi, B, Jagadish, H &amp; Faloutsos, C. Efficient retrieval of similar time sequences under time warping. ICDE 98, pp 23-27.</p>
    <p>max(Q)</p>
    <p>min(Q)</p>
    <p>LB_Yi</p>
  </div>
  <div class="page">
    <p>What we have seen so farWhat we have seen so far  Dynamic Time Warping (DTW) is a very robust technique for measuring time series similarity.</p>
    <p>DTW is widely used in diverse fields.</p>
    <p>Since DTW is expensive to calculate, techniques to speed up similarity search have been introduced, including global constraints and two different lower bounding techniques.</p>
  </div>
  <div class="page">
    <p>A Novel Lower Bounding Technique IA Novel Lower Bounding Technique I</p>
    <p>L</p>
    <p>U</p>
    <p>Q</p>
    <p>U</p>
    <p>LQ</p>
    <p>C</p>
    <p>Q</p>
    <p>C</p>
    <p>Q</p>
    <p>Sakoe-Chiba Band</p>
    <p>Itakura Parallelogram</p>
    <p>Ui = max(qi-r : qi+r) Li = min(qi-r : qi+r)</p>
  </div>
  <div class="page">
    <p>C U</p>
    <p>LQ</p>
    <p>C U</p>
    <p>LQ</p>
    <p>C</p>
    <p>Q</p>
    <p>C</p>
    <p>Q</p>
    <p>Sakoe-Chiba Band</p>
    <p>Itakura Parallelogram</p>
    <p>n</p>
    <p>i iiii</p>
    <p>iiii</p>
    <p>otherwise</p>
    <p>LcifLc</p>
    <p>UcifUc</p>
    <p>CQKeoghLB 1</p>
    <p>)(</p>
    <p>)(</p>
    <p>),(_</p>
    <p>LB_Keogh</p>
    <p>A Novel Lower Bounding Technique IIA Novel Lower Bounding Technique II</p>
  </div>
  <div class="page">
    <p>LB_Keogh Sakoe-Chiba</p>
    <p>LB_Keogh Itakura</p>
    <p>LB_Yi</p>
    <p>LB_Kim</p>
    <p>The tightness of the lower bound for each technique is proportional The tightness of the lower bound for each technique is proportional to the length of gray lines used in the illustrations to the length of gray lines used in the illustrations</p>
  </div>
  <div class="page">
    <p>Before we consider the problem of Before we consider the problem of indexing, let us empirically evaluate the indexing, let us empirically evaluate the quality of the proposed lowering quality of the proposed lowering bounding technique.bounding technique.</p>
    <p>This is a good idea, since it is an This is a good idea, since it is an implementation freeimplementation free measure of quality. measure of quality.</p>
    <p>First we must discuss our experimental First we must discuss our experimental philosophyphilosophy</p>
  </div>
  <div class="page">
    <p>Experimental PhilosophyExperimental Philosophy  We tested on 32 datasets from such diverse fields as finance, medicine, biometrics, chemistry, astronomy, robotics, networking and industry. The datasets cover the complete spectrum of stationary/ non-stationary, noisy/ smooth, cyclical/ non-cyclical, symmetric/ asymmetric etc</p>
    <p>Our experiments are completely reproducible. We saved every random number, every setting and all data.</p>
    <p>To ensure true randomness, we use random numbers created by a quantum mechanical process.</p>
    <p>We test with the Sakoe-Chiba Band, which is the worst case for us (the Itakura Parallelogram would give us much better results).</p>
  </div>
  <div class="page">
    <p>Tightness of Lower Bound ExperimentTightness of Lower Bound Experiment</p>
    <p>We measured T</p>
    <p>For each dataset, we randomly extracted 50 sequences of length 256. We compared each sequence to the 49 others.</p>
    <p>For each dataset we report T as average ratio from the 1,225 (50*49/2) comparisons made.</p>
    <p>nceDistaWarpTimeDynamicTrue nceDistaWarpTimeDynamicofEstimateBoundLowerT</p>
    <p>Query length of 256 is about the mean in the literature.</p>
  </div>
  <div class="page">
    <p>LB_Kim LB_Yi LB_Keogh</p>
  </div>
  <div class="page">
    <p>Query Length</p>
    <p>Tightness of Lower Bound T</p>
    <p>LB_Kim LB_Yi LB_Keogh</p>
    <p>Effect of Query Length on Tightness of Lower Bounds Effect of Query Length on Tightness of Lower Bounds</p>
  </div>
  <div class="page">
    <p>These experiments suggest we can use the</p>
    <p>new lower bounding technique to speed up</p>
    <p>sequential search. Thats super!</p>
    <p>Excellent! But what we really</p>
    <p>need is a technique to index the time series</p>
  </div>
  <div class="page">
    <p>A Dimensionality Reduction TechniqueA Dimensionality Reduction Technique Piecewise Aggregate Approximation (PAA)Piecewise Aggregate Approximation (PAA)</p>
    <p>C</p>
    <p>C</p>
    <p>c1</p>
    <p>c2</p>
    <p>c3</p>
    <p>c4</p>
    <p>c5</p>
    <p>c6</p>
    <p>c7</p>
    <p>c8</p>
    <p>i</p>
    <p>ij jn</p>
    <p>N i</p>
    <p>N n</p>
    <p>N n</p>
    <p>cC 1)1(</p>
    <p>Keogh, E,. Chakrabarti, K,. Pazzani, M. &amp; Mehrotra, S. (2000). Dimensionality reduction for fast similarity search in large time series databases. KAIS. pp 263-286.</p>
    <p>Yi, B, K., &amp; Faloutsos, C.(2000). Fast time sequence indexing for arbitrary Lp norms. VLDB. pp 385-394.</p>
    <p>Advantages of PAA (for Euclidean Indexing)Advantages of PAA (for Euclidean Indexing)</p>
    <p>Extremely fast to calculate</p>
    <p>As efficient as other approaches such as wavelets and Fourier transform (empirically)</p>
    <p>Support queries of arbitrary lengths on the same index</p>
    <p>Supports weighted Euclidean distance</p>
    <p>Simple! Intuitive!</p>
  </div>
  <div class="page">
    <p>iii N n</p>
    <p>N n UUU ,...,max 11</p>
    <p>iii N n</p>
    <p>N n LLL ,...,min 11</p>
    <p>U</p>
    <p>L</p>
    <p>We create special PAA of U and L, which we will denote and . U L</p>
    <p>U</p>
    <p>LQ</p>
  </div>
  <div class="page">
    <p>MINDIST(Q,R)</p>
    <p>N</p>
    <p>i iiii</p>
    <p>iiii</p>
    <p>otherwise</p>
    <p>LhifLh</p>
    <p>UlifUl</p>
    <p>N</p>
    <p>n</p>
    <p>)(</p>
    <p>)(</p>
    <p>Our index structure contains a leaf node U. Let R = (L, H) be the MBR associated with U</p>
    <p>MBR R = (L,H) L = {l</p>
    <p>N }</p>
    <p>H = {h 1 , h</p>
    <p>N }</p>
    <p>h1 h2</p>
    <p>hi</p>
    <p>l1 l2</p>
    <p>li</p>
    <p>),( RQMINDIST</p>
    <p>We have seen how to define and U L</p>
    <p>We can now define the MINDIST function, which returns the distance between a query Q and a MBR R</p>
    <p>iii N n</p>
    <p>N n UUU ,...,max 11</p>
    <p>iii N n</p>
    <p>N n LLL ,...,min 11</p>
    <p>U</p>
    <p>L</p>
  </div>
  <div class="page">
    <p>Variable queue: MinPriorityQueue; Variable list: temp; 1. queue.push(root_node_of_index, 0); 2. while not queue.IsEmpty() do 3. top = queue.Top(); 4. for each time series C in temp such that DTW(Q,C)  top.dist 5. Remove C from temp; 6. Add C to result; 7. if |result| = K return result ; 8. queue.Pop(); 9. if top is an PAA point C 10. Retrieve full sequence C from database; 11. temp.insert(C, DTW(Q,C)); 12. else if top is a leaf node 13. for each data item C in top 14. queue.push(C, LB_PAA(Q,)); 15. else // top is a non-leaf node 16. for each child node U in top 17. queue.push(U, MINDIST(Q,R)) // R is MBR associated with U.</p>
    <p>Algorithm KNNSearch(Q,K)</p>
    <p>Seidl, T. &amp; Kriegel, H. (1998). Optimal multi-step k-nearest neighbor search. SIGMOD. pp 154-165.</p>
    <p>Having defined the Having defined the MINDISTMINDIST function we can use (slightly function we can use (slightly modified) classic K-Nearest modified) classic K-Nearest Neighbor and Range Queries Neighbor and Range Queries</p>
    <p>if T is a non-leaf node for each child U of T if MINDIST(Q,R)</p>
    <p>RangeSearch(Q,U); / / R is MBR of U else // T is a leaf node</p>
    <p>for each PAA point C in T if LB_PAA(Q,)  Retrieve full sequence C from database; if DTW(Q,C)  e Add C to result;</p>
    <p>Algorithm</p>
    <p>RangeSearch(Q,T) 1. 2. 3.</p>
  </div>
  <div class="page">
    <p>Pruning Power ExperimentPruning Power Experiment</p>
    <p>We measured P</p>
    <p>We randomly extract 50 sequences of length 256. For each of the 50 sequences we separate out the sequence from the other 49 sequences, then find the nearest match to our withheld sequence among the remaining 49 sequences using the sequential scan</p>
    <p>We measure the number of times we can use the fast lower bounding functions to prune away the quadratictime computation of the full DTW algorithm.</p>
    <p>For fairness we visit the 49 sequences in the same order for each approach.</p>
    <p>databaseinobjectsofNumber DTWfullrequirenotdothatobjectsofNumberP</p>
    <p>Query length of 256 is about the mean in the literature.</p>
  </div>
  <div class="page">
    <p>LB_Kim LB_Yi LB_Keogh</p>
  </div>
  <div class="page">
    <p>Database Size</p>
    <p>Pruning Power P</p>
    <p>LB_Kim LB_Yi LB_Keogh</p>
    <p>Effect of Database Size on Pruning PowerEffect of Database Size on Pruning Power</p>
  </div>
  <div class="page">
    <p>Experiment on Implemented SystemExperiment on Implemented System</p>
    <p>Metric Definition: The Normalized CPU cost: The ratio of average CPU time to execute a query using the index to the average CPU time required to perform a linear (sequential) scan. The normalized cost of linear scan is 1.0</p>
    <p>Datasets  Mixed Bag: All 32 datasets pooled together. 763,270 items</p>
    <p>Random Walk: The most common test dataset in the literature. 1,048,576 items</p>
    <p>System: AMD Athlon 1.4 GHZ processor, with 512 MB of physical memory and 57.2 GB of secondary storage. The index used was the R-Tree</p>
    <p>Algorithms: We compare the proposed technique to linear scan. LB_Yi does not have an index method and LB_Kim never beats linear scan</p>
  </div>
  <div class="page">
    <p>Implemented System ExperimentImplemented System Experiment</p>
    <p>Normalized CPU Cost</p>
    <p>Random Walk II Mixed Bag</p>
    <p>LScan LB_Keogh</p>
    <p>LScan LB_Keogh</p>
    <p>Note that the X-axis is logarithmic</p>
  </div>
  <div class="page">
    <p>ConclusionsConclusions  We have shown that DTW is better distance We have shown that DTW is better distance measure than Euclidean distance.measure than Euclidean distance.</p>
    <p>We have introduced a new lower bounding We have introduced a new lower bounding technique for DTW.technique for DTW.</p>
    <p>We have shown how to index the new lower We have shown how to index the new lower bounding technique.bounding technique.</p>
    <p>We demonstrated the utility of our approach We demonstrated the utility of our approach with a comprehensive empirical evaluation.with a comprehensive empirical evaluation.</p>
  </div>
  <div class="page">
    <p>Questions?Questions?</p>
    <p>www.cs.ucr.edu/~eamonn/TSDMA/index.htmlwww.cs.ucr.edu/~eamonn/TSDMA/index.html</p>
    <p>Thanks to Kaushik Chakrabarti, Dennis DeCoste, Sharad Mehrotra, Michalis Vlachos and the VLDB reviewers for their useful comments.</p>
    <p>Datasets and code used in this paper can be found at..</p>
  </div>
</Presentation>
