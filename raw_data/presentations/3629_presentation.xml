<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>MAX PLANCK INSTITUTE</p>
    <p>FOR SECURITY AND</p>
    <p>PRIVACY</p>
    <p>STARBLEED A FULL BREAK OF THE BITSTREAM ENCRYPTION OF XILINX 7-SERIES FPGAS</p>
    <p>M a i k E n d e r, A m i r M o r a d i , a n d C h r i s t o f P a a r</p>
    <p>Ruhr University Bochum &amp; MPI for Privacy and Security</p>
    <p>U S E N I X S e c u r i t y, A u g u s t 1 4 , 2 0 2 0</p>
  </div>
  <div class="page">
    <p>MAX PLANCK INSTITUTE</p>
    <p>FOR SECURITY AND</p>
    <p>PRIVACY</p>
    <p>STARBLEED A FULL BREAK OF THE BITSTREAM ENCRYPTION OF XILINX 7-SERIES FPGAS</p>
    <p>M a i k E n d e r, A m i r M o r a d i , a n d C h r i s t o f P a a r</p>
    <p>Ruhr University Bochum &amp; MPI for Privacy and Security</p>
    <p>U S E N I X S e c u r i t y, A u g u s t 1 4 , 2 0 2 0</p>
    <p>https://www.reddit.com/r/ElectricalEngineering/comments/g6vaey/u/iguetesilva</p>
  </div>
  <div class="page">
    <p>FIELD PROGRAMMABLE GATE ARRAYS</p>
    <p>Field Programmable Gate Array</p>
    <p>(FPGA)</p>
    <p>Special IC</p>
    <p>Reprogrammable logic</p>
    <p>Bitstream</p>
    <p>program01</p>
    <p>P h</p>
    <p>o to</p>
    <p>b y</p>
    <p>P a</p>
    <p>trick T</p>
    <p>o m</p>
    <p>a sso</p>
    <p>o n</p>
    <p>U n</p>
    <p>sp la</p>
    <p>sh</p>
    <p>P h</p>
    <p>o to</p>
    <p>b y</p>
    <p>C h</p>
    <p>u a</p>
    <p>n ch</p>
    <p>a i P</p>
    <p>u n</p>
    <p>d e</p>
    <p>j o</p>
    <p>n U</p>
    <p>n sp</p>
    <p>la sh</p>
    <p>P h</p>
    <p>o to</p>
    <p>b y</p>
    <p>A m</p>
    <p>e rica</p>
    <p>n P</p>
    <p>u b</p>
    <p>lic P o</p>
    <p>w e</p>
    <p>r A sso</p>
    <p>cia tio</p>
    <p>n o</p>
    <p>n U</p>
    <p>n sp</p>
    <p>la sh</p>
    <p>P h</p>
    <p>o to</p>
    <p>b y</p>
    <p>T h</p>
    <p>o m</p>
    <p>a s Je</p>
    <p>n se</p>
    <p>n o</p>
    <p>n U</p>
    <p>n sp</p>
    <p>la sh</p>
    <p>Bitstream contains</p>
    <p>FPGAs design</p>
    <p>Stored on external</p>
    <p>memory</p>
  </div>
  <div class="page">
    <p>Bitstream Security</p>
    <p>BITSTREAM SECURITY</p>
    <p>Possible Consequences</p>
    <p>IP theft &amp; design cloning</p>
    <p>Reverse engineering</p>
    <p>Design manipulation</p>
    <p>Hardware Trojans</p>
    <p>Bitstream</p>
    <p>FFFFFFFF AA995566 &quot;StartDec&quot; &quot;WrCntr0&quot; 02003FE5</p>
    <p>program</p>
    <p>P h</p>
    <p>o to</p>
    <p>b y</p>
    <p>P a</p>
    <p>trick T</p>
    <p>o m</p>
    <p>a sso</p>
    <p>o n</p>
    <p>U n</p>
    <p>sp la</p>
    <p>sh</p>
    <p>P h</p>
    <p>o to</p>
    <p>b y</p>
    <p>C h</p>
    <p>u a</p>
    <p>n ch</p>
    <p>a i P</p>
    <p>u n</p>
    <p>d e</p>
    <p>j o</p>
    <p>n U</p>
    <p>n sp</p>
    <p>la sh</p>
    <p>P h</p>
    <p>o to</p>
    <p>b y</p>
    <p>A m</p>
    <p>e rica</p>
    <p>n P</p>
    <p>u b</p>
    <p>lic P o</p>
    <p>w e</p>
    <p>r A sso</p>
    <p>cia tio</p>
    <p>n o</p>
    <p>n U</p>
    <p>n sp</p>
    <p>la sh</p>
    <p>P h</p>
    <p>o to</p>
    <p>b y</p>
    <p>T h</p>
    <p>o m</p>
    <p>a s Je</p>
    <p>n se</p>
    <p>n o</p>
    <p>n U</p>
    <p>n sp</p>
    <p>la sh</p>
  </div>
  <div class="page">
    <p>Bitstream Encryption</p>
    <p>BITSTREAM ENCRYPTION</p>
    <p>Bitstream</p>
    <p>FFFFFFF</p>
    <p>F</p>
    <p>AA995566</p>
    <p>&quot;StartEnc&quot;</p>
    <p>&quot;WrCntr0&quot;</p>
    <p>Security Goals  Confidentiality: bitstream is encrypted</p>
    <p>Authenticity: FPGA loads only designs from integrator</p>
    <p>Integrity: Bitstream is not changed</p>
    <p>Key</p>
    <p>FPGA</p>
    <p>encrypted program</p>
    <p>AES-256</p>
    <p>HMAC</p>
  </div>
  <div class="page">
    <p>Attack in a Nutshell</p>
    <p>ATTACK IN A NUTSHELL</p>
    <p>Bitstream</p>
    <p>FFFFFFF</p>
    <p>F</p>
    <p>AA995566</p>
    <p>&quot;StartEnc&quot;</p>
    <p>&quot;WrCntr0&quot;</p>
    <p>CRYPTO</p>
    <p>FPGA</p>
    <p>encrypted programplease decrypt the bitstream</p>
    <p>Manipulate the</p>
    <p>encrypted bitstream</p>
    <p>Bitstream</p>
    <p>FFFFFFFF AA995566 &quot;StartEnc&quot; &quot;WrCntr0&quot; 02003FE5</p>
    <p>Security Goals  Confidentiality: bitstream is encrypted</p>
    <p>Authenticity: FPGA loads only designs from integrator</p>
    <p>Integrity: Bitstream is not changed</p>
    <p>Starbleed Attack I:</p>
    <p>Break Confidentiality</p>
    <p>Starbleed Attack II:</p>
    <p>Break Authenticity</p>
    <p>Key</p>
  </div>
  <div class="page">
    <p>HOW TO PROGRAM AN FPGA?</p>
  </div>
  <div class="page">
    <p>CONFIGURATION ENGINE</p>
    <p>Fabric J T A</p>
    <p>G</p>
    <p>FPGA</p>
    <p>Bitstream</p>
    <p>&quot;Header&quot; &quot;StartDec&quot; HMACHead</p>
    <p>&quot;WrCntr0&quot; 02003FE5 &quot;WrFDRI&quot; COFFEEEE BADB0070</p>
    <p>HMAC tag</p>
  </div>
  <div class="page">
    <p>CONFIGURATION ENGINE</p>
    <p>FDRO</p>
    <p>Status</p>
    <p>Control 0</p>
    <p>WBSTAR</p>
    <p>FDRI Fabric</p>
    <p>C o n fi g u ra</p>
    <p>ti o</p>
    <p>n E</p>
    <p>n g in</p>
    <p>e</p>
    <p>Configuration</p>
    <p>RegistersBitstream</p>
    <p>D e c ?</p>
    <p>AES</p>
    <p>J T A</p>
    <p>G &quot;Header&quot;</p>
    <p>&quot;StartDec&quot; HMACHead</p>
    <p>&quot;WrCntr0&quot; 02003FE5 &quot;WrFDRI&quot; COFFEEEE BADB0070</p>
    <p>HMAC tag</p>
    <p>FPGA</p>
  </div>
  <div class="page">
    <p>BITSTREAM PROGRAM</p>
    <p>FDRO</p>
    <p>Status</p>
    <p>Control 0</p>
    <p>WBSTAR</p>
    <p>FDRI Fabric</p>
    <p>C o n fi g u ra</p>
    <p>ti o</p>
    <p>n E</p>
    <p>n g in</p>
    <p>e</p>
    <p>Configuration</p>
    <p>RegistersBitstream</p>
    <p>D e c ?</p>
    <p>AES</p>
    <p>J T A</p>
    <p>G</p>
    <p>&quot;Header&quot;&quot;StartDec&quot;HMACHead&quot;WrCntr0&quot;02003FE5&quot;WrFDRI&quot;COFFEEEE</p>
    <p>&quot;Header&quot; &quot;StartDec&quot; HMACHead</p>
    <p>&quot;WrCntr0&quot; 02003FE5 &quot;WrFDRI&quot; COFFEEEE BADB0070</p>
    <p>HMAC tag</p>
    <p>FPGA</p>
  </div>
  <div class="page">
    <p>ATTACK I BREAKING CONFIDENTIALITY</p>
  </div>
  <div class="page">
    <p>Authenticity</p>
    <p>Check</p>
    <p>FPGA</p>
    <p>ATTACK</p>
    <p>FDRO</p>
    <p>Status</p>
    <p>Control 0</p>
    <p>WBSTAR</p>
    <p>FDRI Fabric</p>
    <p>C o</p>
    <p>n fi g</p>
    <p>u ra</p>
    <p>ti o</p>
    <p>n E</p>
    <p>n g</p>
    <p>in e</p>
    <p>Configuration</p>
    <p>RegistersBitstream</p>
    <p>D e c ?</p>
    <p>AES</p>
    <p>J T A</p>
    <p>G</p>
    <p>&quot;WrCntr0&quot;</p>
    <p>WrWBSTARCOFFEEEEBADB0070HMAC tag</p>
    <p>&quot;Header&quot; &quot;StartEnc&quot; HMACHead</p>
    <p>&quot;WrCntr0&quot; 02003FE5 &quot;WrFDRI&quot; COFFEEEE BADB0070</p>
    <p>&quot;Header&quot; &quot;StartDec&quot; HMACHead</p>
    <p>&quot;WrCntr0&quot; 02003FE5 &quot;WrWBSTAR&quot;</p>
    <p>COFFEEEE BADB0070</p>
    <p>HMAC tag</p>
    <p>Exploit CBC</p>
    <p>malleability</p>
    <p>COFFEEEE</p>
    <p>Cut bitstream</p>
    <p>FPGA resets</p>
  </div>
  <div class="page">
    <p>MultiBoot  Documentation</p>
    <p>MULTIBOOT  DOCUMENTATION</p>
  </div>
  <div class="page">
    <p>ATTACK  READOUT</p>
    <p>FDRO</p>
    <p>Status</p>
    <p>Control 0</p>
    <p>WBSTAR</p>
    <p>FDRI Fabric</p>
    <p>C o n fi g u ra</p>
    <p>ti o</p>
    <p>n E</p>
    <p>n g in</p>
    <p>e</p>
    <p>Configuration</p>
    <p>Registers</p>
    <p>D e c ?</p>
    <p>AES</p>
    <p>J T A</p>
    <p>G</p>
    <p>COFFEEEE</p>
    <p>Bitstream</p>
    <p>RdWBSTARRdWBSTAR</p>
    <p>FPGA</p>
    <p>HMAC tag</p>
    <p>COFFEEEE</p>
    <p>Authenticity</p>
    <p>Check</p>
    <p>FPGA resets</p>
    <p>Bitstream</p>
    <p>&quot;Header&quot; &quot;StartDec&quot; HMACHead</p>
    <p>&quot;WrCntr0&quot; 02003FE5 &quot;WrWBSTAR&quot;</p>
    <p>COFFEEEE BADB0070</p>
    <p>HMAC tag</p>
    <p>Exploit CBC</p>
    <p>malleability</p>
    <p>Cut bitstream</p>
  </div>
  <div class="page">
    <p>Authenticity</p>
    <p>Check</p>
    <p>FPGA resets</p>
    <p>Configuration</p>
    <p>Registers</p>
    <p>FPGA</p>
    <p>ATTACK  OVERVIEW</p>
    <p>FDRO</p>
    <p>Status</p>
    <p>Control 0</p>
    <p>WBSTAR</p>
    <p>FDRI Fabric</p>
    <p>C o n fi g u ra</p>
    <p>ti o</p>
    <p>n E</p>
    <p>n g in</p>
    <p>e</p>
    <p>D e c ?</p>
    <p>AES</p>
    <p>J T A</p>
    <p>G</p>
    <p>COFFEEEE</p>
    <p>WrWBSTAR</p>
    <p>&quot;Header&quot; &quot;StartDec&quot; HMACHead</p>
    <p>&quot;WrCntr0&quot; 02003FE5 &quot;WrWBSTAR&quot;</p>
    <p>COFFEEEE BADB0070</p>
    <p>&quot;Header&quot; RdWBSTAR</p>
    <p>Bitstream</p>
    <p>register</p>
    <p>(automatically)</p>
    <p>the malicious bitstream</p>
    <p>(manually)</p>
    <p>HMAC tag</p>
    <p>Bitstream</p>
    <p>Leaks one bitstream word (32 bits)</p>
  </div>
  <div class="page">
    <p>ATTACK II BREAKING AUTHENTICITY</p>
  </div>
  <div class="page">
    <p>HMAC key can be decrypted by attack I</p>
    <p>Forge new valid HMAC tags</p>
    <p>ATTACK II: BREAKING AUTHENTICITY</p>
    <p>Bitstream</p>
    <p>&quot;Header&quot; &quot;StartEnc&quot; HMACHead</p>
    <p>&quot;WrCntr0&quot; 02003FE5 &quot;WrFDRI&quot; COFFEEEE BADB0070</p>
    <p>HMAC tag</p>
    <p>HMAC key</p>
    <p>Attacker can forge</p>
    <p>valid HMAC tags</p>
  </div>
  <div class="page">
    <p>WHAT WENT WRONG?</p>
  </div>
  <div class="page">
    <p>WHAT WENT WRONG?</p>
    <p>Bitstream</p>
    <p>&quot;Header&quot; &quot;StartDec&quot; HMACHead</p>
    <p>&quot;WrCntr0&quot; 02003FE5 &quot;WrFDRI&quot; COFFEEEE BADB0070</p>
    <p>HMAC tag</p>
    <p>Commands</p>
    <p>interpreted before</p>
    <p>HMAC validation</p>
    <p>HMAC key</p>
  </div>
  <div class="page">
    <p>COUNTERMEASURES</p>
    <p>AND</p>
    <p>DEFENSE TECHNIQUES</p>
  </div>
  <div class="page">
    <p>Countermeasures</p>
    <p>Current 7-Series</p>
    <p>Only raise-the-bare</p>
    <p>countermeasures exists</p>
    <p>COUNTERMEASURES &amp; DEFENSE TECHNIQUES</p>
    <p>Countermeasures</p>
    <p>New FPGA Series</p>
    <p>Validate the bitstream before use</p>
    <p>Needs new silicon</p>
    <p>Available in new FPGA Series</p>
    <p>General defense</p>
    <p>techniques</p>
    <p>Avoid ad-hoc security designs</p>
    <p>Model checking, information flow analysis</p>
    <p>Community analysis</p>
  </div>
  <div class="page">
    <p>CONCLUSION</p>
  </div>
  <div class="page">
    <p>CONCLUSION</p>
    <p>Full break of</p>
    <p>Xilinx 7-Series</p>
    <p>Bitstream</p>
    <p>Encryption Any questions? @MaikEnderEU</p>
    <p>Amir Moradi</p>
    <p>@ChristofPaar</p>
  </div>
</Presentation>
