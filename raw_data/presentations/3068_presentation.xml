<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>MAELSTROM</p>
    <p>Kaushik Veeraraghavan, Justin Meza, Scott Michelson, Sankaralingam Paneerselvam, Alex Gyori, David Chou, Sonia Margulis, Daniel Obenshain, Shruti Padmanabha, Ashish Shah, Yee Jiun Song, Tianyin Xu*</p>
    <p>Facebook, Inc. *UIUC 1</p>
    <p>MITIGATING DATACENTER-LEVEL DISASTERS BY DRAINING INDEPENDENT TRAFFIC SAFELY AND EFFECTIVELY</p>
  </div>
  <div class="page">
    <p>Forest City Data Center</p>
  </div>
  <div class="page">
    <p>But...</p>
  </div>
  <div class="page">
    <p>Leased Data Center</p>
    <p>Forest City Data Center</p>
  </div>
  <div class="page">
    <p>Leased Data Center</p>
    <p>Forest City Data Center Can we run Facebook</p>
    <p>without one of our data centers?</p>
  </div>
  <div class="page">
    <p>Fault tolerance without compromising correctness</p>
    <p>Must track dependencies between micro services</p>
    <p>Testing to verify dependencies and configuration</p>
  </div>
  <div class="page">
    <p>Draining Runbooks</p>
  </div>
  <div class="page">
    <p>Me!</p>
  </div>
  <div class="page"/>
  <div class="page">
    <p>MAELSTROM</p>
    <p>Drains traffic from data centers</p>
    <p>Minimal operator interaction</p>
    <p>Used in tests and production events</p>
  </div>
  <div class="page"/>
  <div class="page"/>
  <div class="page">
    <p>Monolithic system</p>
  </div>
  <div class="page">
    <p>Micro services</p>
  </div>
  <div class="page">
    <p>Web server</p>
    <p>NewsfeedNewsfeed</p>
    <p>DBDB</p>
    <p>CacheCache</p>
    <p>PYMLPYML</p>
    <p>AdsAds</p>
    <p>SearchSearch</p>
    <p>EverstoreEverstore</p>
    <p>ScribePtail</p>
    <p>CoefficientCoefficient</p>
    <p>LaserLaser</p>
    <p>ScribeScribe</p>
  </div>
  <div class="page">
    <p>Traffic types Stateless</p>
    <p>Stateful</p>
    <p>Sticky</p>
    <p>Replication</p>
  </div>
  <div class="page">
    <p>{ vip_type: &lt;virtualIP&gt;, target: &lt;datacenter&gt;, ratio: &lt;amount&gt; }</p>
    <p>Task TrafficShift</p>
    <p>TEMPLATE RUNBOOK EXECUTION</p>
  </div>
  <div class="page">
    <p>DEPENDENCE VALIDATIONAUTOMATION</p>
  </div>
  <div class="page">
    <p>DEPENDENCE</p>
    <p>Captures service dependence</p>
    <p>Directed acyclic graph</p>
    <p>Manually curated in runbooks</p>
  </div>
  <div class="page"/>
  <div class="page"/>
  <div class="page">
    <p>AUTOMATION</p>
    <p>Traffic shifting</p>
    <p>Job manipulation</p>
    <p>Configuration changes</p>
    <p>Shard movement</p>
  </div>
  <div class="page">
    <p>VALIDATION</p>
    <p>Metrics and thresholds</p>
    <p>When to launch a step</p>
    <p>When a step has completed</p>
    <p>Service health checks</p>
  </div>
  <div class="page">
    <p>DEPENDENCE VALIDATIONAUTOMATION</p>
  </div>
  <div class="page">
    <p>DEPENDENCE VALIDATIONAUTOMATION Scheduler</p>
  </div>
  <div class="page">
    <p>Runbook DB (MySQL)</p>
    <p>Tasks</p>
    <p>Dependencies</p>
    <p>Runbook UI</p>
    <p>Metadata</p>
  </div>
  <div class="page">
    <p>Runbook DB (MySQL)</p>
    <p>Scheduler</p>
    <p>Runbook</p>
    <p>Status</p>
    <p>Runbook UI</p>
    <p>Health checks</p>
    <p>Tasks</p>
    <p>Dependencies Metadata</p>
  </div>
  <div class="page">
    <p>Runbook DB (MySQL)</p>
    <p>Scheduler Executor</p>
    <p>Runbook</p>
    <p>Status</p>
    <p>Runbook UI</p>
    <p>Tasks</p>
    <p>Health checks</p>
    <p>Shift traffic Shift shards</p>
    <p>Update jobs Change configs</p>
    <p>Tasks</p>
    <p>Dependencies Metadata</p>
  </div>
  <div class="page">
    <p>Ready Running Done</p>
  </div>
  <div class="page">
    <p>Drain tests Performed weekly</p>
    <p>Verify dependencies</p>
    <p>Ensure tools work</p>
  </div>
  <div class="page">
    <p>Limitations Must plan for shared resources</p>
    <p>Reactive approach to mitigation</p>
    <p>Need to avoid cascading failures</p>
    <p>Not fastest for every disaster</p>
  </div>
  <div class="page">
    <p>Forest City Data Center</p>
  </div>
  <div class="page">
    <p>R eq</p>
    <p>ue st</p>
    <p>s pe</p>
    <p>r se</p>
    <p>co nd</p>
    <p>M ul</p>
    <p>ti pl</p>
    <p>ie r</p>
    <p>va lu</p>
    <p>e</p>
    <p>September 13, 8 AM PDT 9 AM PDT</p>
    <p>Stateless traffic</p>
  </div>
  <div class="page">
    <p>A ct</p>
    <p>iv e</p>
    <p>se ss</p>
    <p>io ns</p>
    <p>M ul</p>
    <p>ti pl</p>
    <p>ie r</p>
    <p>va lu</p>
    <p>e</p>
    <p>September 13, 8 AM PDT 9 AM PDT</p>
    <p>Sticky traffic</p>
    <p>Se ssi</p>
    <p>on ev</p>
    <p>ict ion</p>
  </div>
  <div class="page">
    <p>P ri</p>
    <p>m ar</p>
    <p>y sh</p>
    <p>ar ds</p>
    <p>September 13, 7 AM PDT 1 PM PDT</p>
    <p>Stateful traffic</p>
  </div>
  <div class="page">
    <p>MAELSTROM</p>
    <p>Fault tolerance without compromising correctness</p>
    <p>Must track dependencies between micro services</p>
    <p>Tests verify dependencies and configuration</p>
  </div>
</Presentation>
