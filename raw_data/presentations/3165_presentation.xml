<?xml version="1.0" ?>
<Presentation>
  <div class="page">
    <p>A Large Scale Analysis of the Security of Embedded Firmwares</p>
    <p>A. Costin, J. Zaddach, A. Francillon, D. Balzarotti</p>
    <p>EURECOM, France</p>
    <p>USENIX Security '14  San Diego, USA</p>
  </div>
  <div class="page">
    <p>Andrei Costin 2</p>
    <p>Embedded Systems Are Everywhere</p>
    <p>By Wilgengebroed on Flickr [CC-BY-2.0]</p>
  </div>
  <div class="page">
    <p>Andrei Costin 3</p>
    <p>Smarter &amp; More Complex</p>
    <p>By Wilgengebroed on Flickr [CC-BY-2.0]</p>
  </div>
  <div class="page">
    <p>Andrei Costin 4</p>
    <p>Heavily Interconnected</p>
    <p>By Wilgengebroed on Flickr [CC-BY-2.0]</p>
  </div>
  <div class="page">
    <p>Andrei Costin 5</p>
    <p>Many Examples of Insecure Embedded Systems</p>
    <p>Routers</p>
  </div>
  <div class="page">
    <p>Andrei Costin 6</p>
    <p>Many Examples of Insecure Embedded Systems</p>
    <p>Routers  Printers</p>
  </div>
  <div class="page">
    <p>Andrei Costin 7</p>
    <p>Many Examples of Insecure Embedded Systems</p>
    <p>Routers  Printers  VoIP</p>
  </div>
  <div class="page">
    <p>Andrei Costin 8</p>
    <p>Many Examples of Insecure Embedded Systems</p>
    <p>Routers  Printers  VoIP  Cars</p>
  </div>
  <div class="page">
    <p>Andrei Costin 9</p>
    <p>Many Examples of Insecure Embedded Systems</p>
    <p>Routers  Printers  VoIP  Cars  Drones</p>
  </div>
  <div class="page">
    <p>Andrei Costin 10</p>
    <p>Many Examples of Insecure Embedded Systems</p>
    <p>Routers  Printers  VoIP  Cars  Drones  ...</p>
  </div>
  <div class="page">
    <p>Andrei Costin 11</p>
    <p>Many Examples of Insecure Embedded Systems</p>
    <p>Routers  Printers  VoIP  Cars  Drones  ...</p>
    <p>Each of above is a result of an individual analysis  Manual and tedious efforts, Does not scale</p>
  </div>
  <div class="page">
    <p>Andrei Costin 12</p>
    <p>The Goal</p>
    <p>Perform a large scale analysis to provide a better</p>
    <p>undestanding of the problem</p>
  </div>
  <div class="page">
    <p>Andrei Costin 13</p>
    <p>The Problem With Large Scale Analysis</p>
    <p>Heterogeneity of  Hardware, architectures, OSes  Users, requirements  Security goals</p>
  </div>
  <div class="page">
    <p>Andrei Costin 14</p>
    <p>The Problem With Large Scale Analysis</p>
    <p>Heterogeneity of  Hardware, architectures, OSes  Users, requirements  Security goals</p>
    <p>Manual analysis does not scale, it requires  Finding and downloading the firmwares  Unpacking and performing initial analysis  Re-discovering the same or similar bug in other</p>
    <p>firmwares</p>
  </div>
  <div class="page">
    <p>Andrei Costin 15</p>
    <p>Previous Approaches</p>
    <p>Test on real devices [Bojinov09CCS]  Accurate results  Does not scale well</p>
  </div>
  <div class="page">
    <p>Andrei Costin 16</p>
    <p>Previous Approaches</p>
    <p>Test on real devices [Bojinov09CCS]  Accurate results  Does not scale well</p>
    <p>Scan devices on the Internet  Large scale testing [Cui10ACSAC]</p>
    <p>Can only test for known vulnerabilities  Blackbox approach</p>
    <p>More is too intrusive [Census2012]</p>
  </div>
  <div class="page">
    <p>Andrei Costin 17</p>
    <p>Our Approach to The Large Scale Analysis</p>
    <p>Collect a large number of firmware images</p>
  </div>
  <div class="page">
    <p>Andrei Costin 18</p>
    <p>Our Approach to The Large Scale Analysis</p>
    <p>Collect a large number of firmware images  Perform broad but simple static analysis</p>
  </div>
  <div class="page">
    <p>Andrei Costin 19</p>
    <p>Our Approach to The Large Scale Analysis</p>
    <p>Collect a large number of firmware images  Perform broad but simple static analysis  Correlate across firmwares</p>
  </div>
  <div class="page">
    <p>Andrei Costin 20</p>
    <p>Our Approach to The Large Scale Analysis</p>
    <p>Collect a large number of firmware images  Perform broad but simple static analysis  Correlate across firmwares  Advantages</p>
    <p>No intrusive online testing, no devices involved  Scalable</p>
  </div>
  <div class="page">
    <p>Andrei Costin 21</p>
    <p>Our Approach to The Large Scale Analysis</p>
    <p>Collect a large number of firmware images  Perform broad but simple static analysis  Correlate across firmwares  Advantages</p>
    <p>No intrusive online testing, no devices involved  Scalable</p>
    <p>But many challenges</p>
  </div>
  <div class="page">
    <p>Andrei Costin 22</p>
    <p>Mainstream Systems Have Centralized Updates</p>
  </div>
  <div class="page">
    <p>Andrei Costin 23</p>
    <p>Challenge: Embedded Systems Have No Centralized Updates</p>
  </div>
  <div class="page">
    <p>Andrei Costin 24</p>
    <p>Collecting a Dataset</p>
    <p>No large scale firmware dataset yet  As opposed to existing datasets in security or other</p>
    <p>CS research areas</p>
  </div>
  <div class="page">
    <p>Andrei Costin 25</p>
    <p>Collecting a Dataset</p>
    <p>No large scale firmware dataset yet  As opposed to existing datasets in security or other</p>
    <p>CS research areas</p>
    <p>We collected a subset of the firmwares available for download</p>
  </div>
  <div class="page">
    <p>Andrei Costin 26</p>
    <p>Collecting a Dataset</p>
    <p>No large scale firmware dataset yet  As opposed to existing datasets in security or other</p>
    <p>CS research areas</p>
    <p>We collected a subset of the firmwares available for download</p>
    <p>Many firmwares are not publicly available  Not intended to have an upgrade  Require product purchase and registration</p>
  </div>
  <div class="page">
    <p>Andrei Costin 27</p>
    <p>Collecting a Dataset</p>
    <p>No large scale firmware dataset yet  As opposed to existing datasets in security or other</p>
    <p>CS research areas</p>
    <p>We collected a subset of the firmwares available for download</p>
    <p>Many firmwares are not publicly available  Not intended to have an upgrade  Require product purchase and registration</p>
    <p>www.firmware.re project</p>
  </div>
  <div class="page">
    <p>Andrei Costin 28</p>
    <p>Challenge: Firmware Identification</p>
    <p>Clearly a Firmware</p>
  </div>
  <div class="page">
    <p>Andrei Costin 29</p>
    <p>Challenge: Firmware Identification</p>
    <p>Clearly a Firmware Clearly not a Firmware</p>
  </div>
  <div class="page">
    <p>Andrei Costin 30</p>
    <p>Challenge: Firmware Identification</p>
    <p>Clearly a Firmware Clearly not a Firmware</p>
    <p>Uncertain</p>
  </div>
  <div class="page">
    <p>Andrei Costin 31</p>
    <p>Challenge: Firmware Identification</p>
    <p>E.g., upgrade by printing a PS document</p>
  </div>
  <div class="page">
    <p>Andrei Costin 32</p>
    <p>Challenge: Unpacking &amp; Custom Formats</p>
    <p>How to reliably unpack and learn formats?</p>
  </div>
  <div class="page">
    <p>Andrei Costin 33</p>
    <p>Challenge: Unpacking &amp; Custom Formats</p>
    <p>How to reliably unpack and learn formats?  E.g., vendor provides a .ZIP 'firmware package'</p>
    <p>.ZIP.EXE+.PS  .EXEself-extracting archive</p>
    <p>Extract more or not?  Turns out to contain a printer driver inside</p>
  </div>
  <div class="page">
    <p>Andrei Costin 34</p>
    <p>Challenge: Unpacking &amp; Custom Formats</p>
    <p>How to reliably unpack and learn formats?  E.g., vendor provides a .ZIP 'firmware package'</p>
    <p>.ZIP.EXE+.PS  .EXEself-extracting archive</p>
    <p>Extract more or not?  Turns out to contain a printer driver inside</p>
    <p>.PSASCII85 streamELF file that could be:  A complete embedded system software  An executable performing the firmware upgrade  A firmware patch</p>
  </div>
  <div class="page">
    <p>Andrei Costin 35</p>
    <p>Challenge: Unpacking &amp; Custom Formats</p>
    <p>How to reliably unpack and learn formats?  E.g., vendor provides a .ZIP 'firmware package'</p>
    <p>.ZIP.EXE+.PS  .EXEself-extracting archive</p>
    <p>Extract more or not?  Turns out to contain a printer driver inside</p>
    <p>.PSASCII85 streamELF file that could be:  A complete embedded system software  An executable performing the firmware upgrade  A firmware patch</p>
    <p>Often, a firmware imagejust 'data' binary blob</p>
  </div>
  <div class="page">
    <p>Andrei Costin 36</p>
    <p>Our Approach to Unpacking &amp; Custom Formats</p>
    <p>We compared existing tools  Used BAT (Binary Analysis Toolkit)</p>
    <p>Extended it with multiple custom unpackers  Continuous development effort</p>
  </div>
  <div class="page">
    <p>Andrei Costin 37</p>
    <p>Our Approach to Unpacking &amp; Custom Formats</p>
    <p>We compared existing tools  Used BAT (Binary Analysis Toolkit)</p>
    <p>Extended it with multiple custom unpackers  Continuous development effort</p>
    <p>Often, a firmware imagejust 'data' binary blob  File carving required  Bruteforce at every offset with all known unpackers</p>
  </div>
  <div class="page">
    <p>Andrei Costin 38</p>
    <p>Our Approach to Unpacking &amp; Custom Formats</p>
    <p>We compared existing tools  Used BAT (Binary Analysis Toolkit)</p>
    <p>Extended it with multiple custom unpackers  Continuous development effort</p>
    <p>Often, a firmware imagejust 'data' binary blob  File carving required  Bruteforce at every offset with all known unpackers</p>
    <p>Heuristics for detecting when to stop</p>
  </div>
  <div class="page">
    <p>Andrei Costin 39</p>
    <p>Challenge: Scalability &amp; Computational Limits</p>
    <p>Unpacking and file carving is very CPU intensive</p>
  </div>
  <div class="page">
    <p>Andrei Costin 40</p>
    <p>Challenge: Scalability &amp; Computational Limits</p>
    <p>Unpacking and file carving is very CPU intensive</p>
    <p>Results in millions of unpacked files  Manual analysis infeasible  One-to-one fuzzy hash comparison is CPU</p>
    <p>intensive</p>
  </div>
  <div class="page">
    <p>Andrei Costin 41</p>
    <p>Challenge: Results Confirmation</p>
    <p>An issue found statically  May not apply to a real-device  Cannot guarantee exploitability  E.g., vulnerable daemon present but never started</p>
  </div>
  <div class="page">
    <p>Andrei Costin 42</p>
    <p>Challenge: Results Confirmation</p>
    <p>An issue found statically  May not apply to a real-device  Cannot guarantee exploitability  E.g., vulnerable daemon present but never started</p>
    <p>Issue confirmation is difficult  Requires advanced analysis (static &amp; dynamic)  Often requires real embedded devices  Does not scale well in heterogeneous environments</p>
  </div>
  <div class="page">
    <p>Andrei Costin 43</p>
    <p>Architecture</p>
    <p>Internet</p>
    <p>Crawl</p>
    <p>Firmware Datastore</p>
  </div>
  <div class="page">
    <p>Andrei Costin 44</p>
    <p>Architecture</p>
    <p>Internet Public Web Interface</p>
    <p>Crawl Submit</p>
    <p>Firmware Datastore</p>
  </div>
  <div class="page">
    <p>Andrei Costin 45</p>
    <p>Architecture</p>
    <p>Internet Public Web Interface</p>
    <p>Crawl Submit</p>
    <p>Firmware Datastore</p>
    <p>Firmware Analysis Cloud</p>
  </div>
  <div class="page">
    <p>Andrei Costin 46</p>
    <p>Architecture</p>
    <p>Internet Public Web Interface</p>
    <p>Crawl Submit</p>
    <p>Firmware Datastore</p>
    <p>Master</p>
    <p>Firmware Analysis Cloud</p>
  </div>
  <div class="page">
    <p>Andrei Costin 47</p>
    <p>Architecture</p>
    <p>Internet Public Web Interface</p>
    <p>Crawl Submit</p>
    <p>Firmware Datastore</p>
    <p>Master</p>
    <p>Workers</p>
    <p>Distribute</p>
    <p>Unpacking Static Analysis Fuzzy Hashing</p>
    <p>Firmware Analysis Cloud</p>
    <p>Password Hash Cracker</p>
  </div>
  <div class="page">
    <p>Andrei Costin 48</p>
    <p>Architecture</p>
    <p>Internet Public Web Interface</p>
    <p>Crawl Submit</p>
    <p>Firmware Datastore</p>
    <p>Master</p>
    <p>Workers</p>
    <p>Distribute</p>
    <p>Unpacking Static Analysis Fuzzy Hashing</p>
    <p>Firmware Analysis &amp; Reports DB</p>
    <p>Firmware Analysis Cloud</p>
    <p>Password Hash Cracker</p>
  </div>
  <div class="page">
    <p>Andrei Costin 49</p>
    <p>Architecture</p>
    <p>Internet Public Web Interface</p>
    <p>Crawl Submit</p>
    <p>Firmware Datastore</p>
    <p>Master</p>
    <p>Workers</p>
    <p>Distribute</p>
    <p>Unpacking Static Analysis Fuzzy Hashing</p>
    <p>Firmware Analysis &amp; Reports DB</p>
    <p>Firmware Analysis Cloud</p>
    <p>Password Hash Cracker</p>
    <p>Data Enrichment</p>
    <p>Correlation Engine</p>
  </div>
  <div class="page">
    <p>Andrei Costin 50</p>
    <p>Crawler</p>
    <p>759 K collected files, 1.8 TB of disk space</p>
  </div>
  <div class="page">
    <p>Andrei Costin 51</p>
    <p>Crawler</p>
    <p>759 K collected files, 1.8 TB of disk space  FTP-index engines</p>
  </div>
  <div class="page">
    <p>Andrei Costin 52</p>
    <p>Crawler</p>
    <p>759 K collected files, 1.8 TB of disk space  FTP-index engines and GCSE</p>
  </div>
  <div class="page">
    <p>Andrei Costin 53</p>
    <p>www.Firmware.RE (beta) Will provide Unpacking and Analysis</p>
  </div>
  <div class="page">
    <p>Andrei Costin 54</p>
    <p>Unpacking</p>
    <p>759 K total files collected</p>
    <p>172 K filtered interesting files</p>
    <p>32 K analyzed</p>
    <p>26 K unpacked (fully or partially)</p>
    <p>1.7 M resulted files after unpacking</p>
    <p>Filter non firmware</p>
    <p>Random selection</p>
    <p>Successful unpack</p>
    <p>Unpacked files</p>
  </div>
  <div class="page">
    <p>Andrei Costin 55</p>
    <p>Static Analysis</p>
    <p>Correlation/clustering  Fuzzy hashes, Private SSL keys, Credentials</p>
    <p>Misconfigurations  Web-server configs, Credentials, Code repositories</p>
    <p>Data enrichment  Version banners  Keywords (e.g., telnet, shell, UART, backdoor)</p>
  </div>
  <div class="page">
    <p>Andrei Costin 56</p>
    <p>Example: Correlation</p>
    <p>Correlation via fuzzy-hashes (ssdeep, sdhash)  E.g., Vulnerability Propagation</p>
    <p>Firmware 1</p>
  </div>
  <div class="page">
    <p>Andrei Costin 57</p>
    <p>Example: Correlation</p>
    <p>Correlation via fuzzy-hashes (ssdeep, sdhash)  E.g., Vulnerability Propagation</p>
    <p>Firmware 1</p>
  </div>
  <div class="page">
    <p>Andrei Costin 58</p>
    <p>Example: Correlation</p>
    <p>Correlation via fuzzy-hashes (ssdeep, sdhash)  E.g., Vulnerability Propagation</p>
    <p>Firmware 1</p>
    <p>Firmware 2</p>
    <p>Firmware 3</p>
    <p>Firmware 4</p>
    <p>Firmware 5</p>
  </div>
  <div class="page">
    <p>Andrei Costin 59</p>
    <p>Example: Correlation</p>
    <p>Correlation via fuzzy-hashes (ssdeep, sdhash)  E.g., Vulnerability Propagation</p>
    <p>Firmware 1</p>
    <p>Firmware 2</p>
    <p>Firmware 3</p>
    <p>Firmware 4</p>
    <p>Firmware 5</p>
  </div>
  <div class="page">
    <p>Andrei Costin 60</p>
    <p>Example: Correlation</p>
    <p>Correlation via fuzzy-hashes (ssdeep, sdhash)  E.g., Vulnerability Propagation</p>
    <p>Firmware 1</p>
    <p>Firmware 2</p>
    <p>Firmware 3</p>
    <p>Firmware 4</p>
    <p>Firmware 5</p>
  </div>
  <div class="page">
    <p>Andrei Costin 61</p>
    <p>Private RSA keys</p>
    <p>SSL keys correlation + vulnerability propagation</p>
    <p>Example: RSA Keys</p>
  </div>
  <div class="page">
    <p>Andrei Costin 62</p>
    <p>Analysis &amp; Reports Database</p>
    <p>Private RSA keys</p>
    <p>SSL keys correlation + vulnerability propagation</p>
    <p>Example: RSA Keys</p>
  </div>
  <div class="page">
    <p>Andrei Costin 63</p>
    <p>Analysis &amp; Reports Database</p>
    <p>Private RSA keys</p>
    <p>VendorA Device1</p>
    <p>SSL keys correlation + vulnerability propagation</p>
    <p>Example: RSA Keys</p>
  </div>
  <div class="page">
    <p>Andrei Costin 64</p>
    <p>Analysis &amp; Reports Database</p>
    <p>Private RSA keys</p>
    <p>VendorA</p>
    <p>HTTPS Ecosystem Scans</p>
    <p>Device1</p>
    <p>Check ZMap IP addresses</p>
    <p>SSL keys correlation + vulnerability propagation</p>
    <p>Example: RSA Keys</p>
  </div>
  <div class="page">
    <p>Andrei Costin 65</p>
    <p>Analysis &amp; Reports Database</p>
    <p>Private RSA keys</p>
    <p>VendorA</p>
    <p>HTTPS Ecosystem Scans</p>
    <p>VendorB</p>
    <p>SAME private RSA SAME self-signed SSL certificate DIFFERENT vendor</p>
    <p>Device1</p>
    <p>Device2</p>
    <p>Check ZMap IP addresses</p>
    <p>SSL keys correlation + vulnerability propagation</p>
    <p>Example: RSA Keys</p>
  </div>
  <div class="page">
    <p>Andrei Costin 66</p>
    <p>Analysis &amp; Reports Database</p>
    <p>Private RSA keys</p>
    <p>VendorA</p>
    <p>HTTPS Ecosystem Scans</p>
    <p>VendorB</p>
    <p>SAME private RSA SAME self-signed SSL certificate DIFFERENT vendor</p>
    <p>Device1</p>
    <p>Device2</p>
    <p>Check ZMap IP addresses</p>
    <p>Common Vulnerable Components</p>
    <p>SSL keys correlation + vulnerability propagation</p>
    <p>Example: RSA Keys</p>
  </div>
  <div class="page">
    <p>Andrei Costin 67</p>
    <p>Results: Summary</p>
    <p>38 new vulnerabilities (CVE)</p>
    <p>Correlated them to 140 K online devices</p>
    <p>Affected 693 firmware files by at least one vuln</p>
  </div>
  <div class="page">
    <p>Andrei Costin 68</p>
    <p>Contributions Summary</p>
    <p>First large-scale static analysis of firmwares  Described the main challenges associated  Shown the advantages of performing a large</p>
    <p>scale analysis of firmware images  Implemented a framework and several efficient</p>
    <p>static techniques</p>
  </div>
  <div class="page">
    <p>Andrei Costin 69</p>
    <p>Conclusions</p>
    <p>A broader view on firmwares  Not only beneficial  But necessary for discovery and analysis of</p>
    <p>vulnerabilities</p>
    <p>Correlation reveals firmware relatioship  Shows how vulnerabilities reappear across different</p>
    <p>products  Could allow seeing how firmwares evolve/get fixed</p>
  </div>
  <div class="page">
    <p>Andrei Costin 70</p>
    <p>Conclusions</p>
    <p>There are plenty of latent vulnerabilities</p>
    <p>Security  Tradeoff with cost and time-to-market  Clearly not a priority for some vendors</p>
  </div>
  <div class="page">
    <p>Andrei Costin 71</p>
    <p>Thank You! Questions?</p>
    <p>{name.surname}@eurecom.fr</p>
  </div>
  <div class="page">
    <p>Andrei Costin 72</p>
    <p>References  [1] A. Costin, J. Zaddach, A. Francillon, D. Balzarotti,</p>
    <p>A Large-Scale Analysis of the Security of Embedded Firmwares, In Proceedings of the 23rd USENIX Conference on Security (to appear)</p>
    <p>[2] A. Costin, J. Zaddach, Poster: Firmware.RE: Firmware Unpacking and Analysis as a Service, In Proceedings of the ACM Conference on Security and Privacy in Wireless Mobile Networks (WiSec) '14</p>
    <p>[3] A. Costin, A. Francillon, Short paper: A Dangerous 'Pyrotechnic Composition': Fireworks, Embedded Wireless and Insecurity-by-Design, In Proceedings of the ACM Conference on Security and Privacy in Wireless Mobile Networks (WiSec) '14</p>
  </div>
</Presentation>
